<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Smarter&#39;s blog</title>
  
  <subtitle>è¦å­¦ä¹ ã€è¦å¿«ä¹</subtitle>
  <link href="https://smarter.xin/atom.xml" rel="self"/>
  
  <link href="https://smarter.xin/"/>
  <updated>2026-01-18T14:12:10.556Z</updated>
  <id>https://smarter.xin/</id>
  
  <author>
    <name>Smarter</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PMPP-ç¬¬åä¸‰ç« ï¼šæ’åº</title>
    <link href="https://smarter.xin/posts/d9ee9484/"/>
    <id>https://smarter.xin/posts/d9ee9484/</id>
    <published>2026-01-18T14:04:20.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>å‰ä¸¤ç« å­¦äº†å½’çº¦å’Œå½’å¹¶ï¼Œè¿™ç« å­¦<strong>æ’åº</strong>â€”â€”æŠŠæ— åºæ•°æ®å˜æˆæœ‰åºæ•°æ®ã€‚æ’åºæ˜¯æœ€åŸºç¡€çš„ç®—æ³•ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰é¢†åŸŸéƒ½ç”¨å¾—åˆ°ã€‚GPU æ’åºçš„æŒ‘æˆ˜åœ¨äºï¼šä¼ ç»Ÿæ’åºç®—æ³•ï¼ˆå¦‚å¿«é€Ÿæ’åºï¼‰çš„é€’å½’å’Œæ•°æ®ä¾èµ–ä¸é€‚åˆ GPU çš„ SIMT æ¨¡å‹ã€‚ç¬¬åä¸‰ç« ä»‹ç»é€‚åˆ GPU çš„æ’åºç®—æ³•ï¼Œé‡ç‚¹æ˜¯<strong>åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰</strong>â€”â€”åˆ©ç”¨å‰ç¼€å’Œå®ç°é«˜æ•ˆå¹¶è¡Œæ’åºã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="pai-xu-suan-fa-gai-lan" tabindex="-1" id="æ’åºç®—æ³•æ¦‚è§ˆ">æ’åºç®—æ³•æ¦‚è§ˆ</h2><h3 id="ji-yu-bi-jiao-de-pai-xu" tabindex="-1" id="åŸºäºæ¯”è¾ƒçš„æ’åº">åŸºäºæ¯”è¾ƒçš„æ’åº</h3><table><thead><tr><th>ç®—æ³•</th><th>å¹³å‡å¤æ‚åº¦</th><th>æœ€åå¤æ‚åº¦</th><th>ç©ºé—´</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>å†’æ³¡æ’åº</td><td>O(nÂ²)</td><td>O(nÂ²)</td><td>O(1)</td><td>ç¨³å®š</td></tr><tr><td>æ’å…¥æ’åº</td><td>O(nÂ²)</td><td>O(nÂ²)</td><td>O(1)</td><td>ç¨³å®š</td></tr><tr><td>å¿«é€Ÿæ’åº</td><td>O(n log n)</td><td>O(nÂ²)</td><td>O(log n)</td><td>ä¸ç¨³å®š</td></tr><tr><td>å½’å¹¶æ’åº</td><td>O(n log n)</td><td>O(n log n)</td><td>O(n)</td><td>ç¨³å®š</td></tr><tr><td>å †æ’åº</td><td>O(n log n)</td><td>O(n log n)</td><td>O(1)</td><td>ä¸ç¨³å®š</td></tr></tbody></table><p><strong>ç†è®ºä¸‹ç•Œ</strong>ï¼šåŸºäºæ¯”è¾ƒçš„æ’åºæœ€ä¼˜æ˜¯ O(n log n)ã€‚</p><h3 id="fei-bi-jiao-pai-xu" tabindex="-1" id="éæ¯”è¾ƒæ’åº">éæ¯”è¾ƒæ’åº</h3><table><thead><tr><th>ç®—æ³•</th><th>å¤æ‚åº¦</th><th>é€‚ç”¨ç±»å‹</th></tr></thead><tbody><tr><td>è®¡æ•°æ’åº</td><td>O(n + k)</td><td>å°èŒƒå›´æ•´æ•°</td></tr><tr><td>åŸºæ•°æ’åº</td><td>O(d(n + k))</td><td>å›ºå®šä½æ•°æ•´æ•°</td></tr><tr><td>æ¡¶æ’åº</td><td>O(n + k)</td><td>å‡åŒ€åˆ†å¸ƒ</td></tr></tbody></table><p><strong>çªç ´ä¸‹ç•Œ</strong>ï¼šéæ¯”è¾ƒæ’åºå¯ä»¥è¾¾åˆ° O(n)ï¼Œä½†æœ‰ç±»å‹é™åˆ¶ã€‚</p><h3 id="gpu-pai-xu-de-xuan-ze" tabindex="-1" id="GPU-æ’åºçš„é€‰æ‹©">GPU æ’åºçš„é€‰æ‹©</h3><p><strong>å¿«é€Ÿæ’åºä¸é€‚åˆ GPU</strong>ï¼š</p><ul><li>é€’å½’æ·±åº¦ä¸ç¡®å®š</li><li>åˆ†åŒºä¸å¹³è¡¡å¯¼è‡´è´Ÿè½½ä¸å‡</li><li>æ•°æ®ä¾èµ–å¯¼è‡´åˆ†æ”¯å‘æ•£</li></ul><p><strong>GPU å‹å¥½çš„ç®—æ³•</strong>ï¼š</p><ul><li><strong>åŸºæ•°æ’åº</strong>ï¼šè§„åˆ™çš„æ•°æ®è®¿é—®æ¨¡å¼ï¼Œåˆ©ç”¨å‰ç¼€å’Œ</li><li><strong>å½’å¹¶æ’åº</strong>ï¼šç¡®å®šçš„æ­¥éª¤æ•°ï¼Œå¯å¹¶è¡Œå½’å¹¶</li><li><strong>åŒè°ƒæ’åº</strong>ï¼šå®Œå…¨æ•°æ®æ— å…³çš„æ¯”è¾ƒç½‘ç»œ</li></ul><h2 id="ji-shu-pai-xu" tabindex="-1" id="åŸºæ•°æ’åº">åŸºæ•°æ’åº</h2><h3 id="he-xin-si-xiang" tabindex="-1" id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3><p>æŒ‰ä½æ’åºï¼Œä»æœ€ä½ä½åˆ°æœ€é«˜ä½ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹:    [329, 457, 657, 839, 436, 720, 355]</span><br><span class="line"></span><br><span class="line">æŒ‰ä¸ªä½æ’åºï¼ˆç¬¬0ä½ï¼‰:</span><br><span class="line">         [720, 355, 436, 457, 657, 329, 839]</span><br><span class="line"></span><br><span class="line">æŒ‰åä½æ’åºï¼ˆç¬¬1ä½ï¼‰:</span><br><span class="line">         [720, 329, 436, 839, 355, 457, 657]</span><br><span class="line"></span><br><span class="line">æŒ‰ç™¾ä½æ’åºï¼ˆç¬¬2ä½ï¼‰:</span><br><span class="line">         [329, 355, 436, 457, 657, 720, 839]</span><br><span class="line"></span><br><span class="line">å®Œæˆï¼</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šæ¯ä¸€è½®æ’åºå¿…é¡»æ˜¯<strong>ç¨³å®š</strong>çš„ï¼Œä¿æŒç›¸åŒé”®å€¼å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><h3 id="wei-pai-xu-yu-ji-shu-pai-xu" tabindex="-1" id="ä½æ’åºä¸è®¡æ•°æ’åº">ä½æ’åºä¸è®¡æ•°æ’åº</h3><p>æ¯ä¸€è½®æŒ‰æŸä¸€ä½æ’åºï¼Œä½¿ç”¨<strong>è®¡æ•°æ’åº</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. ç»Ÿè®¡æ¯ä¸ªå€¼çš„å‡ºç°æ¬¡æ•°</span><br><span class="line">2. è®¡ç®—å‰ç¼€å’Œå¾—åˆ°æ¯ä¸ªå€¼çš„èµ·å§‹ä½ç½®</span><br><span class="line">3. æŒ‰åŸé¡ºåºåˆ†é…åˆ°è¾“å‡ºä½ç½®</span><br></pre></td></tr></table></figure><p>å¯¹äºäºŒè¿›åˆ¶ä½ï¼ˆ0 æˆ– 1ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:    [1, 0, 1, 1, 0, 0, 1, 0]</span><br><span class="line">è®¡æ•°:    count[0]=4, count[1]=4</span><br><span class="line">å‰ç¼€å’Œ:  pos[0]=0, pos[1]=4</span><br><span class="line">åˆ†é…:    è¾“å‡ºä½ç½® = pos[bit]++</span><br><span class="line">ç»“æœ:    [0, 0, 0, 0, 1, 1, 1, 1]</span><br></pre></td></tr></table></figure><h3 id="duo-wei-yi-qi-chu-li" tabindex="-1" id="å¤šä½ä¸€èµ·å¤„ç†">å¤šä½ä¸€èµ·å¤„ç†</h3><p>ä¸€æ¬¡å¤„ç†å¤šä½ï¼ˆå¦‚ 4 ä½ï¼‰å¯ä»¥å‡å°‘è½®æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">32 ä½æ•´æ•°:</span><br><span class="line">  1 ä½/è½®: 32 è½®</span><br><span class="line">  4 ä½/è½®: 8 è½®</span><br><span class="line">  8 ä½/è½®: 4 è½®</span><br></pre></td></tr></table></figure><p>ä»£ä»·æ˜¯æ¯è½®éœ€è¦æ›´å¤§çš„è®¡æ•°æ•°ç»„ï¼ˆ2^b ä¸ªæ¡¶ï¼‰ã€‚</p><h2 id="bing-xing-ji-shu-pai-xu" tabindex="-1" id="å¹¶è¡ŒåŸºæ•°æ’åº">å¹¶è¡ŒåŸºæ•°æ’åº</h2><h3 id="dan-block-ban-ben" tabindex="-1" id="å•-Block-ç‰ˆæœ¬">å• Block ç‰ˆæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#define RADIX_BITS 4</span><br><span class="line">#define RADIX (1 &lt;&lt; RADIX_BITS)  // 16</span><br><span class="line">#define RADIX_MASK (RADIX - 1)</span><br><span class="line"></span><br><span class="line">__global__ void radix_sort_block(unsigned int *data, int n, int bit) &#123;</span><br><span class="line">    __shared__ unsigned int s_data[BLOCK_SIZE];</span><br><span class="line">    __shared__ int s_count[RADIX];</span><br><span class="line">    __shared__ int s_offset[RADIX];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½æ•°æ®</span><br><span class="line">    s_data[tid] = (tid &lt; n) ? data[tid] : 0xFFFFFFFF;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ç»Ÿè®¡æ¯ä¸ªæ¡¶çš„è®¡æ•°ï¼ˆè¿™é‡Œç®€åŒ–ï¼Œå®é™…éœ€è¦åŸå­æˆ–è§„çº¦ï¼‰</span><br><span class="line">    if (tid &lt; RADIX) s_count[tid] = 0;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    int digit = (s_data[tid] &gt;&gt; bit) &amp; RADIX_MASK;</span><br><span class="line">    atomicAdd(&amp;s_count[digit], 1);</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å‰ç¼€å’Œå¾—åˆ°åç§»</span><br><span class="line">    // ... exclusive scan on s_count â†’ s_offset ...</span><br><span class="line">    </span><br><span class="line">    // åˆ†é…åˆ°è¾“å‡ºä½ç½®</span><br><span class="line">    int pos = atomicAdd(&amp;s_offset[digit], 1);  // åŠ¨æ€åˆ†é…</span><br><span class="line">    </span><br><span class="line">    __shared__ unsigned int s_temp[BLOCK_SIZE];</span><br><span class="line">    s_temp[pos] = s_data[tid];</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å†™å›</span><br><span class="line">    s_data[tid] = s_temp[tid];</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    if (tid &lt; n) data[tid] = s_data[tid];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="da-gui-mo-ji-shu-pai-xu" tabindex="-1" id="å¤§è§„æ¨¡åŸºæ•°æ’åº">å¤§è§„æ¨¡åŸºæ•°æ’åº</h3><p>å¯¹äºè¶…è¿‡å• Block çš„æ•°æ®ï¼Œéœ€è¦åˆ†é˜¶æ®µï¼š</p><p><strong>é˜¶æ®µ 1ï¼šå±€éƒ¨ç›´æ–¹å›¾</strong></p><p>æ¯ä¸ª Block ç»Ÿè®¡è‡ªå·±åŒºåŸŸçš„æ¡¶è®¡æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__global__ void compute_histograms(unsigned int *data, int *histograms, </span><br><span class="line">                                    int n, int bit) &#123;</span><br><span class="line">    __shared__ int local_hist[RADIX];</span><br><span class="line">    </span><br><span class="line">    // åˆå§‹åŒ–</span><br><span class="line">    if (threadIdx.x &lt; RADIX) local_hist[threadIdx.x] = 0;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ç»Ÿè®¡</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        int digit = (data[i] &gt;&gt; bit) &amp; RADIX_MASK;</span><br><span class="line">        atomicAdd(&amp;local_hist[digit], 1);</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å†™å…¥å…¨å±€ç›´æ–¹å›¾</span><br><span class="line">    if (threadIdx.x &lt; RADIX) &#123;</span><br><span class="line">        histograms[blockIdx.x * RADIX + threadIdx.x] = local_hist[threadIdx.x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ 2ï¼šå‰ç¼€å’Œ</strong></p><p>å¯¹æ‰€æœ‰ Block çš„ç›´æ–¹å›¾åšå…¨å±€å‰ç¼€å’Œï¼Œå¾—åˆ°æ¯ä¸ª Block æ¯ä¸ªæ¡¶çš„å…¨å±€èµ·å§‹ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Block 0 æ¡¶ k çš„èµ·å§‹ä½ç½® = Î£(Block &lt; 0, æ¡¶ &lt; k çš„è®¡æ•°) + Î£(Block &lt; 0, æ¡¶ k çš„è®¡æ•°)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªäºŒç»´å‰ç¼€å’Œé—®é¢˜ã€‚</p><p><strong>é˜¶æ®µ 3ï¼šé‡æ’ï¼ˆScatterï¼‰</strong></p><p>æ ¹æ®è®¡ç®—å‡ºçš„ä½ç½®ï¼ŒæŠŠå…ƒç´ ç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__global__ void scatter(unsigned int *in, unsigned int *out, </span><br><span class="line">                        int *prefix, int n, int bit) &#123;</span><br><span class="line">    __shared__ int local_prefix[RADIX];</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½æœ¬ Block çš„å‰ç¼€</span><br><span class="line">    if (threadIdx.x &lt; RADIX) &#123;</span><br><span class="line">        local_prefix[threadIdx.x] = prefix[blockIdx.x * RADIX + threadIdx.x];</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        int digit = (in[i] &gt;&gt; bit) &amp; RADIX_MASK;</span><br><span class="line">        int pos = atomicAdd(&amp;local_prefix[digit], 1);</span><br><span class="line">        out[pos] = in[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wan-zheng-liu-cheng" tabindex="-1" id="å®Œæ•´æµç¨‹">å®Œæ•´æµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">void radix_sort(unsigned int *data, int n) &#123;</span><br><span class="line">    unsigned int *d_data, *d_temp;</span><br><span class="line">    int *d_histograms, *d_prefix;</span><br><span class="line">    </span><br><span class="line">    int num_blocks = (n + BLOCK_SIZE - 1) / BLOCK_SIZE;</span><br><span class="line">    </span><br><span class="line">    cudaMalloc(&amp;d_data, n * sizeof(unsigned int));</span><br><span class="line">    cudaMalloc(&amp;d_temp, n * sizeof(unsigned int));</span><br><span class="line">    cudaMalloc(&amp;d_histograms, num_blocks * RADIX * sizeof(int));</span><br><span class="line">    cudaMalloc(&amp;d_prefix, num_blocks * RADIX * sizeof(int));</span><br><span class="line">    </span><br><span class="line">    cudaMemcpy(d_data, data, n * sizeof(unsigned int), cudaMemcpyHostToDevice);</span><br><span class="line">    </span><br><span class="line">    for (int bit = 0; bit &lt; 32; bit += RADIX_BITS) &#123;</span><br><span class="line">        // é˜¶æ®µ 1ï¼šè®¡ç®—ç›´æ–¹å›¾</span><br><span class="line">        compute_histograms&lt;&lt;&lt;num_blocks, BLOCK_SIZE&gt;&gt;&gt;</span><br><span class="line">            (d_data, d_histograms, n, bit);</span><br><span class="line">        </span><br><span class="line">        // é˜¶æ®µ 2ï¼šå…¨å±€å‰ç¼€å’Œ</span><br><span class="line">        exclusive_scan(d_histograms, d_prefix, num_blocks * RADIX);</span><br><span class="line">        </span><br><span class="line">        // é˜¶æ®µ 3ï¼šé‡æ’</span><br><span class="line">        scatter&lt;&lt;&lt;num_blocks, BLOCK_SIZE&gt;&gt;&gt;</span><br><span class="line">            (d_data, d_temp, d_prefix, n, bit);</span><br><span class="line">        </span><br><span class="line">        // äº¤æ¢ç¼“å†²åŒº</span><br><span class="line">        swap(d_data, d_temp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cudaMemcpy(data, d_data, n * sizeof(unsigned int), cudaMemcpyDeviceToHost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="you-hua-ji-zhu" tabindex="-1" id="ä¼˜åŒ–æŠ€æœ¯">ä¼˜åŒ–æŠ€æœ¯</h2><h3 id="bi-mian-yuan-zi-cao-zuo" tabindex="-1" id="é¿å…åŸå­æ“ä½œ">é¿å…åŸå­æ“ä½œ</h3><p>é˜¶æ®µ 3 çš„ <code>atomicAdd</code> æ˜¯ç“¶é¢ˆã€‚å¯ä»¥ç”¨<strong>æœ¬åœ°æ’åº + å‰ç¼€å’Œ</strong>æ›¿ä»£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. æ¯ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ </span><br><span class="line">2. æœ¬åœ°è®¡ç®—æ¯ä¸ªæ¡¶çš„å…ƒç´ ä¸ªæ•°</span><br><span class="line">3. Block å†…å‰ç¼€å’Œå¾—åˆ°æ¯ä¸ªçº¿ç¨‹çš„èµ·å§‹åç§»</span><br><span class="line">4. æ— å†²çªåœ°å†™å…¥è¾“å‡º</span><br></pre></td></tr></table></figure><h3 id="xiang-liang-hua-jia-zai" tabindex="-1" id="å‘é‡åŒ–åŠ è½½">å‘é‡åŒ–åŠ è½½</h3><p>æ¯æ¬¡åŠ è½½ 4 ä¸ªå…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint4 data4 = *reinterpret_cast&lt;uint4*&gt;(&amp;data[i]);</span><br><span class="line">// å¤„ç† data4.x, data4.y, data4.z, data4.w</span><br></pre></td></tr></table></figure><p>å‡å°‘å†…å­˜äº‹åŠ¡æ•°ã€‚</p><h3 id="fen-tong-you-hua" tabindex="-1" id="åˆ†æ¡¶ä¼˜åŒ–">åˆ†æ¡¶ä¼˜åŒ–</h3><p>å¯¹äºå¤§èŒƒå›´æ•°æ®ï¼Œå…ˆæŒ‰é«˜ä½åˆ†æˆå¤§æ¡¶ï¼Œå†åˆ†åˆ«æ’åºå°æ¡¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€éï¼šæŒ‰é«˜ 8 ä½åˆ†æˆ 256 ä¸ªæ¡¶</span><br><span class="line">ç¬¬äºŒéï¼šå¯¹æ¯ä¸ªæ¡¶æŒ‰å‰©ä½™ 24 ä½æ’åº</span><br></pre></td></tr></table></figure><p>å‡å°‘æ¯è½®éœ€è¦å¤„ç†çš„æ•°æ®é‡ã€‚</p><h2 id="gui-bing-pai-xu" tabindex="-1" id="å½’å¹¶æ’åº">å½’å¹¶æ’åº</h2><h3 id="gpu-gui-bing-pai-xu-liu-cheng" tabindex="-1" id="GPU-å½’å¹¶æ’åºæµç¨‹">GPU å½’å¹¶æ’åºæµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. Block å†…æ’åºï¼ˆç”¨å…±äº«å†…å­˜ï¼‰</span><br><span class="line">2. è·¨ Block å½’å¹¶ï¼ˆç”¨å¹¶è¡Œå½’å¹¶ï¼‰</span><br></pre></td></tr></table></figure><p><strong>Block å†…æ’åº</strong>å¯ä»¥ç”¨ï¼š</p><ul><li>æ¯”ç‰¹åºåˆ—æ’åºï¼ˆBitonic Sortï¼‰</li><li>å¥‡å¶å½’å¹¶æ’åº</li><li>ç›´æ¥å½’å¹¶æ’åº</li></ul><h3 id="block-nei-pai-xu" tabindex="-1" id="Block-å†…æ’åº">Block å†…æ’åº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__global__ void block_sort(int *data, int n) &#123;</span><br><span class="line">    __shared__ int s_data[BLOCK_SIZE];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int gid = blockIdx.x * blockDim.x + tid;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½</span><br><span class="line">    s_data[tid] = (gid &lt; n) ? data[gid] : INT_MAX;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åŒè°ƒæ’åºï¼ˆBitonic Sortï¼‰</span><br><span class="line">    for (int k = 2; k &lt;= BLOCK_SIZE; k *= 2) &#123;</span><br><span class="line">        for (int j = k / 2; j &gt; 0; j /= 2) &#123;</span><br><span class="line">            int ixj = tid ^ j;</span><br><span class="line">            if (ixj &gt; tid) &#123;</span><br><span class="line">                bool ascending = ((tid &amp; k) == 0);</span><br><span class="line">                if ((s_data[tid] &gt; s_data[ixj]) == ascending) &#123;</span><br><span class="line">                    // äº¤æ¢</span><br><span class="line">                    int temp = s_data[tid];</span><br><span class="line">                    s_data[tid] = s_data[ixj];</span><br><span class="line">                    s_data[ixj] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            __syncthreads();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å†™å›</span><br><span class="line">    if (gid &lt; n) data[gid] = s_data[tid];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kua-block-gui-bing" tabindex="-1" id="è·¨-Block-å½’å¹¶">è·¨ Block å½’å¹¶</h3><p>ä½¿ç”¨ç¬¬åäºŒç« çš„å¹¶è¡Œå½’å¹¶æŠ€æœ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void merge_sort_gpu(int *data, int n) &#123;</span><br><span class="line">    // é˜¶æ®µ 1ï¼šBlock å†…æ’åº</span><br><span class="line">    int num_blocks = (n + BLOCK_SIZE - 1) / BLOCK_SIZE;</span><br><span class="line">    block_sort&lt;&lt;&lt;num_blocks, BLOCK_SIZE&gt;&gt;&gt;(data, n);</span><br><span class="line">    </span><br><span class="line">    // é˜¶æ®µ 2ï¼šé€å±‚å½’å¹¶</span><br><span class="line">    for (int width = BLOCK_SIZE; width &lt; n; width *= 2) &#123;</span><br><span class="line">        int num_merges = (n + 2 * width - 1) / (2 * width);</span><br><span class="line">        </span><br><span class="line">        parallel_merge&lt;&lt;&lt;num_merges, BLOCK_SIZE&gt;&gt;&gt;(</span><br><span class="line">            data, n, width);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fu-za-du-fen-xi" tabindex="-1" id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3><table><thead><tr><th>é˜¶æ®µ</th><th>å·¥ä½œé‡</th><th>å¹¶è¡Œåº¦</th></tr></thead><tbody><tr><td>Block æ’åº</td><td>O(n log B)</td><td>n/B ä¸ª Block</td></tr><tr><td>å½’å¹¶ k å±‚</td><td>O(n) Ã— log(n/B)</td><td>é€’å‡</td></tr><tr><td><strong>æ€»è®¡</strong></td><td>O(n log n)</td><td></td></tr></tbody></table><h2 id="yang-ben-pai-xu-sample-sort" tabindex="-1" id="æ ·æœ¬æ’åºï¼ˆSample-Sortï¼‰">æ ·æœ¬æ’åºï¼ˆSample Sortï¼‰</h2><h3 id="si-xiang" tabindex="-1" id="æ€æƒ³">æ€æƒ³</h3><ol><li><strong>é‡‡æ ·</strong>ï¼šä»æ•°æ®ä¸­éšæœºé€‰å–æ ·æœ¬</li><li><strong>æ’åºæ ·æœ¬</strong>ï¼šå¾—åˆ°åˆ†å‰²ç‚¹ï¼ˆsplittersï¼‰</li><li><strong>åˆ†åŒº</strong>ï¼šæ ¹æ®åˆ†å‰²ç‚¹æŠŠæ•°æ®åˆ†åˆ°ä¸åŒæ¡¶</li><li><strong>æ¡¶æ’åº</strong>ï¼šæ¯ä¸ªæ¡¶ç‹¬ç«‹æ’åº</li><li><strong>åˆå¹¶</strong>ï¼šæŒ‰é¡ºåºæ‹¼æ¥æ‰€æœ‰æ¡¶</li></ol><h3 id="you-shi" tabindex="-1" id="ä¼˜åŠ¿">ä¼˜åŠ¿</h3><ul><li>è´Ÿè½½å‡è¡¡æ›´å¥½ï¼ˆé‡‡æ ·ä¿è¯æ¡¶å¤§å°æ¥è¿‘ï¼‰</li><li>å‡å°‘åŒæ­¥å¼€é”€ï¼ˆæ¡¶é—´ç‹¬ç«‹ï¼‰</li></ul><h3 id="gpu-shi-xian-yao-dian" tabindex="-1" id="GPU-å®ç°è¦ç‚¹">GPU å®ç°è¦ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">void sample_sort(int *data, int n) &#123;</span><br><span class="line">    // 1. é‡‡æ ·</span><br><span class="line">    int sample_size = min(n, 1024);</span><br><span class="line">    sample_and_sort(data, n, samples, sample_size);</span><br><span class="line">    </span><br><span class="line">    // 2. é€‰æ‹©åˆ†å‰²ç‚¹</span><br><span class="line">    int num_buckets = 256;</span><br><span class="line">    select_splitters(samples, sample_size, splitters, num_buckets);</span><br><span class="line">    </span><br><span class="line">    // 3. åˆ†åŒº</span><br><span class="line">    partition_to_buckets(data, n, splitters, bucket_ids, bucket_counts);</span><br><span class="line">    </span><br><span class="line">    // 4. å‰ç¼€å’Œå¾—åˆ°æ¡¶åç§»</span><br><span class="line">    exclusive_scan(bucket_counts, bucket_offsets, num_buckets);</span><br><span class="line">    </span><br><span class="line">    // 5. é‡æ’åˆ°æ¡¶</span><br><span class="line">    scatter_to_buckets(data, bucket_ids, bucket_offsets, temp, n);</span><br><span class="line">    </span><br><span class="line">    // 6. æ¡¶å†…æ’åº</span><br><span class="line">    for (int b = 0; b &lt; num_buckets; b++) &#123;</span><br><span class="line">        int start = bucket_offsets[b];</span><br><span class="line">        int end = bucket_offsets[b + 1];</span><br><span class="line">        sort_bucket&lt;&lt;&lt;...&gt;&gt;&gt;(temp + start, end - start);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 7. æ‹·è´å›</span><br><span class="line">    cudaMemcpy(data, temp, n * sizeof(int), cudaMemcpyDeviceToDevice);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pai-xu-wen-ding-xing" tabindex="-1" id="æ’åºç¨³å®šæ€§">æ’åºç¨³å®šæ€§</h2><h3 id="wei-shi-yao-zhong-yao" tabindex="-1" id="ä¸ºä»€ä¹ˆé‡è¦">ä¸ºä»€ä¹ˆé‡è¦</h3><p><strong>ç¨³å®šæ’åº</strong>ï¼šç›¸åŒé”®å€¼çš„å…ƒç´ ä¿æŒåŸæœ‰çš„ç›¸å¯¹é¡ºåºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹:    [(3,&#x27;a&#x27;), (1,&#x27;b&#x27;), (3,&#x27;c&#x27;), (2,&#x27;d&#x27;)]</span><br><span class="line">æŒ‰æ•°å­—ç¨³å®šæ’åº:</span><br><span class="line">         [(1,&#x27;b&#x27;), (2,&#x27;d&#x27;), (3,&#x27;a&#x27;), (3,&#x27;c&#x27;)]</span><br><span class="line">                          â†‘ &#x27;a&#x27; ä»åœ¨ &#x27;c&#x27; å‰é¢</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨</strong>ï¼š</p><ul><li>å¤šå…³é”®å­—æ’åºï¼ˆå…ˆæŒ‰æ¬¡å…³é”®å­—ï¼Œå†æŒ‰ä¸»å…³é”®å­—ï¼‰</li><li>æ•°æ®åº“æ“ä½œï¼ˆä¿æŒæ’å…¥é¡ºåºï¼‰</li><li>åŸºæ•°æ’åºçš„æ­£ç¡®æ€§ä¾èµ–ç¨³å®šæ€§</li></ul><h3 id="gpu-pai-xu-de-wen-ding-xing" tabindex="-1" id="GPU-æ’åºçš„ç¨³å®šæ€§">GPU æ’åºçš„ç¨³å®šæ€§</h3><table><thead><tr><th>ç®—æ³•</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>åŸºæ•°æ’åº</td><td>ç¨³å®š</td></tr><tr><td>å½’å¹¶æ’åº</td><td>ç¨³å®š</td></tr><tr><td>åŒè°ƒæ’åº</td><td>ä¸ç¨³å®š</td></tr><tr><td>å¿«é€Ÿæ’åº</td><td>ä¸ç¨³å®š</td></tr></tbody></table><p>åŸºæ•°æ’åºå¤©ç„¶ç¨³å®šï¼Œæ˜¯ GPU æ’åºçš„é¦–é€‰ã€‚</p><h2 id="cub-thrust-ku" tabindex="-1" id="CUB-Thrust-åº“">CUB/Thrust åº“</h2><h3 id="shi-yong-thrust" tabindex="-1" id="ä½¿ç”¨-Thrust">ä½¿ç”¨ Thrust</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;thrust/sort.h&gt;</span><br><span class="line">#include &lt;thrust/device_vector.h&gt;</span><br><span class="line"></span><br><span class="line">void sortWithThrust(int *d_data, int n) &#123;</span><br><span class="line">    thrust::device_ptr&lt;int&gt; d_ptr(d_data);</span><br><span class="line">    thrust::sort(d_ptr, d_ptr + n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç¨³å®šæ’åº</span><br><span class="line">thrust::stable_sort(d_ptr, d_ptr + n);</span><br><span class="line"></span><br><span class="line">// æŒ‰é”®æ’åº</span><br><span class="line">thrust::sort_by_key(d_keys, d_keys + n, d_values);</span><br></pre></td></tr></table></figure><h3 id="shi-yong-cub" tabindex="-1" id="ä½¿ç”¨-CUB">ä½¿ç”¨ CUB</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cub/cub.cuh&gt;</span><br><span class="line"></span><br><span class="line">void sortWithCub(unsigned int *d_data, int n) &#123;</span><br><span class="line">    void *d_temp = nullptr;</span><br><span class="line">    size_t temp_bytes = 0;</span><br><span class="line">    </span><br><span class="line">    // ç¡®å®šä¸´æ—¶å­˜å‚¨å¤§å°</span><br><span class="line">    cub::DeviceRadixSort::SortKeys(d_temp, temp_bytes, </span><br><span class="line">                                    d_data, d_data, n);</span><br><span class="line">    </span><br><span class="line">    cudaMalloc(&amp;d_temp, temp_bytes);</span><br><span class="line">    </span><br><span class="line">    // æ‰§è¡Œæ’åº</span><br><span class="line">    cub::DeviceRadixSort::SortKeys(d_temp, temp_bytes,</span><br><span class="line">                                    d_data, d_data, n);</span><br><span class="line">    </span><br><span class="line">    cudaFree(d_temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é”®å€¼å¯¹æ’åº</span><br><span class="line">cub::DeviceRadixSort::SortPairs(d_temp, temp_bytes,</span><br><span class="line">                                 d_keys, d_keys,</span><br><span class="line">                                 d_values, d_values, n);</span><br></pre></td></tr></table></figure><h3 id="xing-neng-dui-bi" tabindex="-1" id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h3><p>ä»¥ 1 äº¿ä¸ª 32 ä½æ•´æ•°ä¸ºä¾‹ï¼ˆRTX 3090ï¼‰ï¼š</p><table><thead><tr><th>åº“/å®ç°</th><th>æ—¶é—´</th><th>ååé‡</th></tr></thead><tbody><tr><td>std::sort (CPU)</td><td>~8 ç§’</td><td>50 M/s</td></tr><tr><td>Thrust sort</td><td>~30 ms</td><td>3.3 G/s</td></tr><tr><td>CUB RadixSort</td><td>~15 ms</td><td>6.6 G/s</td></tr></tbody></table><p>GPU æ’åºæ¯” CPU å¿« 200-500 å€ã€‚</p><h2 id="xing-neng-you-hua-zong-jie" tabindex="-1" id="æ€§èƒ½ä¼˜åŒ–æ€»ç»“">æ€§èƒ½ä¼˜åŒ–æ€»ç»“</h2><h3 id="you-hua-ceng-ci" tabindex="-1" id="ä¼˜åŒ–å±‚æ¬¡">ä¼˜åŒ–å±‚æ¬¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ Level 4: ç®—æ³•é€‰æ‹©                                â”‚</span><br><span class="line">â”‚   - åŸºæ•°æ’åºï¼ˆæ•´æ•°æœ€å¿«ï¼‰                         â”‚</span><br><span class="line">â”‚   - å½’å¹¶æ’åºï¼ˆé€šç”¨ç¨³å®šï¼‰                         â”‚</span><br><span class="line">â”‚   - æ ·æœ¬æ’åºï¼ˆè´Ÿè½½å‡è¡¡ï¼‰                         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 3: æ•°æ®å±€éƒ¨æ€§                              â”‚</span><br><span class="line">â”‚   - Block å†…å…±äº«å†…å­˜æ’åº                         â”‚</span><br><span class="line">â”‚   - å‘é‡åŒ–åŠ è½½/å­˜å‚¨                              â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 2: å‡å°‘åŒæ­¥                                â”‚</span><br><span class="line">â”‚   - Warp å†…æ’åºæ— éœ€åŒæ­¥                          â”‚</span><br><span class="line">â”‚   - å‡å°‘ Kernel å¯åŠ¨æ¬¡æ•°                         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 1: åˆ©ç”¨å‰ç¼€å’Œ                              â”‚</span><br><span class="line">â”‚   - é«˜æ•ˆçš„ç›´æ–¹å›¾å’Œåˆ†é…                           â”‚</span><br><span class="line">â”‚   - é¿å…åŸå­æ“ä½œäº‰ç”¨                             â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="xuan-ze-zhi-nan" tabindex="-1" id="é€‰æ‹©æŒ‡å—">é€‰æ‹©æŒ‡å—</h3><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æ¨èç®—æ³•</th></tr></thead><tbody><tr><td>32 ä½æ•´æ•°</td><td>åŸºæ•°æ’åº</td></tr><tr><td>64 ä½æ•´æ•°</td><td>åŸºæ•°æ’åº</td></tr><tr><td>æµ®ç‚¹æ•°</td><td>åŸºæ•°æ’åº*</td></tr><tr><td>ç»“æ„ä½“/è‡ªå®šä¹‰</td><td>å½’å¹¶æ’åº</td></tr><tr><td>éœ€è¦ç¨³å®šæ€§</td><td>åŸºæ•°/å½’å¹¶</td></tr></tbody></table><p>*æµ®ç‚¹æ•°éœ€è¦ç‰¹æ®Šå¤„ç†ç¬¦å·ä½å’ŒæŒ‡æ•°ã€‚</p><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬åä¸‰ç« ç³»ç»Ÿè®²è§£ GPU æ’åºï¼š</p><p><strong>åŸºæ•°æ’åº</strong>ï¼šGPU ä¸Šæœ€å¿«çš„æ•´æ•°æ’åºã€‚æŒ‰ä½å¤„ç†ï¼Œåˆ©ç”¨å‰ç¼€å’Œç¡®å®šè¾“å‡ºä½ç½®ã€‚å¤šè½®ï¼ˆ32 ä½éœ€è¦ 8 è½® 4 ä½ï¼‰ä½†æ¯è½®é«˜åº¦å¹¶è¡Œã€‚</p><p><strong>ä¸‰é˜¶æ®µæµç¨‹</strong>ï¼šç›´æ–¹å›¾ç»Ÿè®¡ â†’ å‰ç¼€å’Œè®¡ç®— â†’ å…ƒç´ é‡æ’ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯é«˜æ•ˆçš„å¹¶è¡Œæ“ä½œã€‚</p><p><strong>å½’å¹¶æ’åº</strong>ï¼šé€šç”¨ä¸”ç¨³å®šã€‚Block å†…ç”¨åŒè°ƒæ’åºï¼Œè·¨ Block ç”¨å¹¶è¡Œå½’å¹¶ã€‚é€‚åˆä»»æ„å¯æ¯”è¾ƒç±»å‹ã€‚</p><p><strong>æ ·æœ¬æ’åº</strong>ï¼šé€šè¿‡é‡‡æ ·å®ç°è´Ÿè½½å‡è¡¡ã€‚é€‚åˆæ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µã€‚</p><p><strong>ç¨³å®šæ€§</strong>ï¼šåŸºæ•°æ’åºå¤©ç„¶ç¨³å®šï¼Œå¤šå…³é”®å­—æ’åºå’Œæ•°æ®åº“æ“ä½œå¿…éœ€ã€‚</p><p><strong>åº“ä¼˜å…ˆ</strong>ï¼šCUB çš„ RadixSort é«˜åº¦ä¼˜åŒ–ï¼Œç”Ÿäº§ç¯å¢ƒç›´æ¥ä½¿ç”¨ã€‚ç†è§£åŸç†æœ‰åŠ©äºç‰¹æ®Šéœ€æ±‚çš„å®šåˆ¶ã€‚</p><p>æ’åºæ˜¯å¹¶è¡Œè®¡ç®—çš„è¯•é‡‘çŸ³ï¼ŒæŠŠå‰é¢å­¦çš„å½’çº¦ã€å‰ç¼€å’Œã€å½’å¹¶ç­‰æŠ€æœ¯ç»¼åˆè¿ç”¨ã€‚æŒæ¡ GPU æ’åºï¼Œå°±æŒæ¡äº†è¿™äº›åŸºç¡€åŸè¯­çš„å®æˆ˜åº”ç”¨ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li>Satish, N., Harris, M., &amp; Garland, M. (2009). <em>Designing efficient sorting algorithms for manycore GPUs</em>. IPDPS.</li><li><a href="https://nvlabs.github.io/cub/structcub_1_1_device_radix_sort.html">NVIDIA CUB Library - Radix Sort</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot; id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å‰ä¸¤ç« å­¦äº†å½’çº¦å’Œå½’å¹¶ï¼Œè¿™ç« å­¦&lt;strong&gt;æ’åº&lt;/strong&gt;â€”â€”æŠŠæ— åºæ•°æ®å˜æˆæœ‰åºæ•°æ®ã€‚æ’åºæ˜¯æœ€åŸºç¡€çš„ç®—æ³•ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰é¢†åŸŸéƒ½ç”¨å¾—åˆ°ã€‚GPU</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="æ’åº" scheme="https://smarter.xin/tags/sort/"/>
    
    <category term="åŸºæ•°æ’åº" scheme="https://smarter.xin/tags/radix-sort/"/>
    
    <category term="å½’å¹¶æ’åº" scheme="https://smarter.xin/tags/merge-sort/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬åäºŒç« ï¼šå½’å¹¶</title>
    <link href="https://smarter.xin/posts/31928809/"/>
    <id>https://smarter.xin/posts/31928809/</id>
    <published>2026-01-18T13:42:06.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬åä¸€ç« å­¦äº†å‰ç¼€å’Œï¼Œè¿™ç« å­¦<strong>å½’å¹¶ï¼ˆMergeï¼‰</strong>â€”â€”æŠŠä¸¤ä¸ªæœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚å½’å¹¶æ˜¯æ’åºç®—æ³•çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå½’å¹¶æ’åºï¼‰ï¼Œä¹Ÿæ˜¯æ•°æ®åº“æ“ä½œçš„åŸºç¡€ï¼ˆJOINï¼‰ã€‚å¹¶è¡Œå½’å¹¶çš„æŒ‘æˆ˜åœ¨äºï¼š<strong>è¾“å‡ºä½ç½®å–å†³äºä¸¤ä¸ªæ•°ç»„çš„æ•°æ®å†…å®¹</strong>ï¼Œä¸åƒçŸ©é˜µä¹˜æ³•é‚£æ ·ä½ç½®å›ºå®šã€‚ç¬¬åäºŒç« è®²è§£å¦‚ä½•ç”¨**ååŒæ’åï¼ˆCo-Rankï¼‰**æŠ€æœ¯è§£å†³è¿™ä¸ª&quot;åŠ¨æ€è¾“å…¥æ•°æ®è¯†åˆ«&quot;é—®é¢˜ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="gui-bing-ji-chu" tabindex="-1" id="å½’å¹¶åŸºç¡€">å½’å¹¶åŸºç¡€</h2><h3 id="shi-yao-shi-gui-bing" tabindex="-1" id="ä»€ä¹ˆæ˜¯å½’å¹¶">ä»€ä¹ˆæ˜¯å½’å¹¶</h3><p><strong>å½’å¹¶</strong>ï¼šç»™å®šä¸¤ä¸ª<strong>å·²æ’åº</strong>çš„æ•°ç»„ A å’Œ Bï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å…ƒç´ çš„<strong>æœ‰åº</strong>æ•°ç»„ Cã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = [1, 3, 5, 7, 9]</span><br><span class="line">B = [2, 4, 6, 8, 10]</span><br><span class="line">C = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br></pre></td></tr></table></figure><h3 id="chuan-xing-gui-bing" tabindex="-1" id="ä¸²è¡Œå½’å¹¶">ä¸²è¡Œå½’å¹¶</h3><p>ç»å…¸çš„åŒæŒ‡é’ˆç®—æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">merge_sequential</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> m, <span class="type">int</span> *B, <span class="type">int</span> n, <span class="type">int</span> *C)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (i &lt; m &amp;&amp; j &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (A[i] &lt;= B[j]) &#123;</span><br><span class="line">            C[k++] = A[i++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            C[k++] = B[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å‰©ä½™å…ƒç´ </span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; m) C[k++] = A[i++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt; n) C[k++] = B[j++];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ O(m+n)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ï¼ˆä¸è®¡è¾“å‡ºï¼‰ã€‚</p><h3 id="bing-xing-hua-de-tiao-zhan" tabindex="-1" id="å¹¶è¡ŒåŒ–çš„æŒ‘æˆ˜">å¹¶è¡ŒåŒ–çš„æŒ‘æˆ˜</h3><p><strong>é—®é¢˜</strong>ï¼šè¾“å‡ºä½ç½® k å¯¹åº”çš„è¾“å…¥ä½ç½® (i, j) å–å†³äºæ•°æ®å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¦å¡«å…… C[5]ï¼Œéœ€è¦çŸ¥é“ï¼š</span><br><span class="line">- A å’Œ B ä¸­æœ‰å¤šå°‘å…ƒç´  â‰¤ C[5] çš„å€¼</span><br><span class="line">- è¿™å–å†³äº A å’Œ B çš„å…·ä½“å†…å®¹</span><br></pre></td></tr></table></figure><p>ä¸åƒçŸ©é˜µä¹˜æ³•é‚£æ ·å¯ä»¥æ ¹æ®çº¿ç¨‹ ID ç›´æ¥è®¡ç®—è¾“å…¥ä½ç½®ã€‚</p><p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šå¦‚ä½•è®©æ¯ä¸ªçº¿ç¨‹çŸ¥é“è‡ªå·±åº”è¯¥å¤„ç† A å’Œ B çš„å“ªä¸€æ®µï¼Ÿ</p><h2 id="xie-tong-pai-ming-co-rank" tabindex="-1" id="ååŒæ’åï¼ˆCo-Rankï¼‰">ååŒæ’åï¼ˆCo-Rankï¼‰</h2><h3 id="he-xin-dong-cha" tabindex="-1" id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h3><p>å¯¹äºè¾“å‡ºä½ç½® kï¼Œå‡è®¾å®ƒå¯¹åº” A ä¸­çš„å‰ i ä¸ªå…ƒç´ å’Œ B ä¸­çš„å‰ j ä¸ªå…ƒç´ ï¼Œåˆ™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i + j = k</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯<strong>ååŒæ’å</strong>çº¦æŸã€‚</p><p><strong>é—®é¢˜è½¬åŒ–</strong>ï¼šç»™å®š kï¼Œæ‰¾åˆ°æ»¡è¶³çº¦æŸä¸”ä¿æŒæœ‰åºæ€§çš„ (i, j)ã€‚</p><h3 id="er-fen-sou-suo-jie-fa" tabindex="-1" id="äºŒåˆ†æœç´¢è§£æ³•">äºŒåˆ†æœç´¢è§£æ³•</h3><p><strong>æœ‰åºæ€§æ¡ä»¶</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A[i-1] â‰¤ B[j]  ä¸”  B[j-1] â‰¤ A[i]</span><br></pre></td></tr></table></figure><p>å³ï¼šA ä¸­ç¬¬ i ä¸ªå…ƒç´ åº”è¯¥æ’åœ¨ B çš„ç¬¬ j ä¸ªå…ƒç´ ä¹‹å‰æˆ–ç›¸ç­‰ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p><strong>ç®—æ³•</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">co_rank</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> *A, <span class="type">int</span> m, <span class="type">int</span> *B, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// i çš„èŒƒå›´</span></span><br><span class="line">    <span class="type">int</span> i_low = max(<span class="number">0</span>, k - n);</span><br><span class="line">    <span class="type">int</span> i_high = min(k, m);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (i_low &lt; i_high) &#123;</span><br><span class="line">        <span class="type">int</span> i = (i_low + i_high) / <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> j = k - i;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; j &lt; n &amp;&amp; A[i<span class="number">-1</span>] &gt; B[j]) &#123;</span><br><span class="line">            <span class="comment">// A[i-1] å¤ªå¤§ï¼Œi éœ€è¦å‡å°</span></span><br><span class="line">            i_high = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; <span class="number">0</span> &amp;&amp; i &lt; m &amp;&amp; B[j<span class="number">-1</span>] &gt; A[i]) &#123;</span><br><span class="line">            <span class="comment">// B[j-1] å¤ªå¤§ï¼Œi éœ€è¦å¢å¤§</span></span><br><span class="line">            i_low = i + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°äº†</span></span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i_low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log(min(k, m, n)))</p><h3 id="shi-li" tabindex="-1" id="ç¤ºä¾‹">ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">A = [1, 3, 5, 7, 9]  (m=5)</span><br><span class="line">B = [2, 4, 6, 8, 10] (n=5)</span><br><span class="line">k = 6ï¼ˆè¾“å‡ºä½ç½® 6ï¼‰</span><br><span class="line"></span><br><span class="line">i + j = 6</span><br><span class="line"></span><br><span class="line">å°è¯• i=3: j=3</span><br><span class="line">  A[2]=5 â‰¤ B[3]=8? âœ“</span><br><span class="line">  B[2]=6 â‰¤ A[3]=7? âœ“</span><br><span class="line">  æ‰¾åˆ°ï¼</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ C[0..5] æ¥è‡ª A[0..2] å’Œ B[0..2]</span><br><span class="line">C[6..9] æ¥è‡ª A[3..4] å’Œ B[3..4]</span><br></pre></td></tr></table></figure><h2 id="ji-chu-bing-xing-gui-bing" tabindex="-1" id="åŸºç¡€å¹¶è¡Œå½’å¹¶">åŸºç¡€å¹¶è¡Œå½’å¹¶</h2><h3 id="mei-xian-cheng-yi-ge-yuan-su" tabindex="-1" id="æ¯çº¿ç¨‹ä¸€ä¸ªå…ƒç´ ">æ¯çº¿ç¨‹ä¸€ä¸ªå…ƒç´ </h3><p>æœ€ç®€å•çš„å¹¶è¡ŒåŒ–ï¼šæ¯ä¸ªçº¿ç¨‹è´Ÿè´£è®¡ç®—ä¸€ä¸ªè¾“å‡ºå…ƒç´ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__global__ void merge_basic(int *A, int m, int *B, int n, int *C) &#123;</span><br><span class="line">    int k = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    if (k &lt; m + n) &#123;</span><br><span class="line">        int i = co_rank(k, A, m, B, n);</span><br><span class="line">        int j = k - i;</span><br><span class="line">        </span><br><span class="line">        int i_next = co_rank(k + 1, A, m, B, n);</span><br><span class="line">        int j_next = k + 1 - i_next;</span><br><span class="line">        </span><br><span class="line">        // ç¡®å®šè¿™ä¸ªä½ç½®çš„å€¼</span><br><span class="line">        if (i_next &gt; i) &#123;</span><br><span class="line">            C[k] = A[i];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            C[k] = B[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wen-ti" tabindex="-1" id="é—®é¢˜">é—®é¢˜</h3><p><strong>æ•ˆç‡ä½</strong>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½åšä¸€æ¬¡äºŒåˆ†æœç´¢ï¼ˆO(log n)ï¼‰ï¼Œæ€»å·¥ä½œé‡ O(n log n)ã€‚</p><p>ä¸²è¡Œåªéœ€ O(n)ï¼Œå¹¶è¡Œåè€Œåšäº†æ›´å¤šå·¥ä½œï¼</p><h2 id="fen-kuai-bing-xing-gui-bing" tabindex="-1" id="åˆ†å—å¹¶è¡Œå½’å¹¶">åˆ†å—å¹¶è¡Œå½’å¹¶</h2><h3 id="si-lu" tabindex="-1" id="æ€è·¯">æ€è·¯</h3><p>ä¸è¦æ¯ä¸ªå…ƒç´ éƒ½äºŒåˆ†æœç´¢ï¼Œè€Œæ˜¯ï¼š</p><ol><li>æŠŠè¾“å‡ºåˆ†æˆè‹¥å¹²å—ï¼ˆTileï¼‰</li><li>æ¯ä¸ª Tile åšä¸€æ¬¡ Co-Rank æ‰¾åˆ°è¾¹ç•Œ</li><li>Tile å†…éƒ¨ç”¨ä¸²è¡Œå½’å¹¶</li></ol><h3 id="suan-fa" tabindex="-1" id="ç®—æ³•">ç®—æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºå¤§å°ï¼šm + n</span><br><span class="line">Tile å¤§å°ï¼šT</span><br><span class="line">Tile æ•°é‡ï¼š(m + n + T - 1) / T</span><br><span class="line"></span><br><span class="line">å¯¹äº Tile kï¼š</span><br><span class="line">  èµ·å§‹ä½ç½®ï¼šk * T</span><br><span class="line">  ç»“æŸä½ç½®ï¼šmin((k+1) * T, m+n)</span><br><span class="line">  </span><br><span class="line">  Co-Rank æ‰¾åˆ° (i_start, j_start) å’Œ (i_end, j_end)</span><br><span class="line">  </span><br><span class="line">  å½’å¹¶ A[i_start..i_end] å’Œ B[j_start..j_end]</span><br></pre></td></tr></table></figure><h3 id="cuda-shi-xian" tabindex="-1" id="CUDA-å®ç°">CUDA å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#define TILE_SIZE 1024</span><br><span class="line"></span><br><span class="line">__global__ void merge_tiled(int *A, int m, int *B, int n, int *C) &#123;</span><br><span class="line">    // æ¯ä¸ª Block å¤„ç†ä¸€ä¸ª Tile</span><br><span class="line">    int k_start = blockIdx.x * TILE_SIZE;</span><br><span class="line">    int k_end = min(k_start + TILE_SIZE, m + n);</span><br><span class="line">    </span><br><span class="line">    // Co-Rank æ‰¾è¾¹ç•Œ</span><br><span class="line">    __shared__ int i_start, j_start, i_end, j_end;</span><br><span class="line">    </span><br><span class="line">    if (threadIdx.x == 0) &#123;</span><br><span class="line">        i_start = co_rank(k_start, A, m, B, n);</span><br><span class="line">        j_start = k_start - i_start;</span><br><span class="line">        i_end = co_rank(k_end, A, m, B, n);</span><br><span class="line">        j_end = k_end - i_end;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // æ¯ä¸ªçº¿ç¨‹å¤„ç† Tile ä¸­çš„ä¸€éƒ¨åˆ†</span><br><span class="line">    int tile_size = k_end - k_start;</span><br><span class="line">    int elements_per_thread = (tile_size + blockDim.x - 1) / blockDim.x;</span><br><span class="line">    </span><br><span class="line">    int local_k = threadIdx.x * elements_per_thread;</span><br><span class="line">    int local_k_end = min(local_k + elements_per_thread, tile_size);</span><br><span class="line">    </span><br><span class="line">    // çº¿ç¨‹å†… Co-Rank</span><br><span class="line">    int A_seg_size = i_end - i_start;</span><br><span class="line">    int B_seg_size = j_end - j_start;</span><br><span class="line">    </span><br><span class="line">    int local_i = co_rank(local_k, A + i_start, A_seg_size, </span><br><span class="line">                                   B + j_start, B_seg_size);</span><br><span class="line">    int local_j = local_k - local_i;</span><br><span class="line">    </span><br><span class="line">    int local_i_end = co_rank(local_k_end, A + i_start, A_seg_size,</span><br><span class="line">                                           B + j_start, B_seg_size);</span><br><span class="line">    int local_j_end = local_k_end - local_i_end;</span><br><span class="line">    </span><br><span class="line">    // ä¸²è¡Œå½’å¹¶</span><br><span class="line">    merge_sequential(A + i_start + local_i, local_i_end - local_i,</span><br><span class="line">                     B + j_start + local_j, local_j_end - local_j,</span><br><span class="line">                     C + k_start + local_k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gong-zuo-liang-fen-xi" tabindex="-1" id="å·¥ä½œé‡åˆ†æ">å·¥ä½œé‡åˆ†æ</h3><table><thead><tr><th>æ“ä½œ</th><th>æ¬¡æ•°</th><th>å•æ¬¡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>Block Co-Rank</td><td>(m+n)/T</td><td>O(log(m+n))</td></tr><tr><td>çº¿ç¨‹ Co-Rank</td><td>(m+n)/T Ã— blockDim</td><td>O(log T)</td></tr><tr><td>ä¸²è¡Œå½’å¹¶</td><td>(m+n)/T Ã— blockDim</td><td>O(T/blockDim)</td></tr></tbody></table><p>æ€»å·¥ä½œé‡ â‰ˆ O(m+n)ï¼Œæ¥è¿‘ä¸²è¡Œï¼</p><h2 id="gong-xiang-nei-cun-you-hua" tabindex="-1" id="å…±äº«å†…å­˜ä¼˜åŒ–">å…±äº«å†…å­˜ä¼˜åŒ–</h2><h3 id="dong-ji" tabindex="-1" id="åŠ¨æœº">åŠ¨æœº</h3><p>å‰é¢çš„å®ç°æ¯ä¸ªçº¿ç¨‹éƒ½è®¿é—®å…¨å±€å†…å­˜åšä¸²è¡Œå½’å¹¶ã€‚å¦‚æœæŠŠ Tile æ•°æ®åŠ è½½åˆ°å…±äº«å†…å­˜ï¼Œå¯ä»¥å¤§å¹…å‡å°‘å…¨å±€å†…å­˜è®¿é—®ã€‚</p><h3 id="shi-xian" tabindex="-1" id="å®ç°">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#define TILE_SIZE 1024</span><br><span class="line"></span><br><span class="line">__global__ void merge_shared(int *A, int m, int *B, int n, int *C) &#123;</span><br><span class="line">    __shared__ int A_s[TILE_SIZE];</span><br><span class="line">    __shared__ int B_s[TILE_SIZE];</span><br><span class="line">    __shared__ int C_s[TILE_SIZE];</span><br><span class="line">    </span><br><span class="line">    int k_start = blockIdx.x * TILE_SIZE;</span><br><span class="line">    int k_end = min(k_start + TILE_SIZE, m + n);</span><br><span class="line">    int tile_size = k_end - k_start;</span><br><span class="line">    </span><br><span class="line">    // Co-Rank æ‰¾è¾¹ç•Œ</span><br><span class="line">    __shared__ int i_start, j_start, i_end, j_end;</span><br><span class="line">    </span><br><span class="line">    if (threadIdx.x == 0) &#123;</span><br><span class="line">        i_start = co_rank(k_start, A, m, B, n);</span><br><span class="line">        j_start = k_start - i_start;</span><br><span class="line">        i_end = co_rank(k_end, A, m, B, n);</span><br><span class="line">        j_end = k_end - i_end;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    int A_size = i_end - i_start;</span><br><span class="line">    int B_size = j_end - j_start;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½åˆ°å…±äº«å†…å­˜</span><br><span class="line">    for (int i = threadIdx.x; i &lt; A_size; i += blockDim.x) &#123;</span><br><span class="line">        A_s[i] = A[i_start + i];</span><br><span class="line">    &#125;</span><br><span class="line">    for (int i = threadIdx.x; i &lt; B_size; i += blockDim.x) &#123;</span><br><span class="line">        B_s[i] = B[j_start + i];</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // çº¿ç¨‹å†… Co-Rankï¼ˆä½¿ç”¨å…±äº«å†…å­˜ï¼‰</span><br><span class="line">    int elements_per_thread = (tile_size + blockDim.x - 1) / blockDim.x;</span><br><span class="line">    int local_k = threadIdx.x * elements_per_thread;</span><br><span class="line">    int local_k_end = min(local_k + elements_per_thread, tile_size);</span><br><span class="line">    </span><br><span class="line">    int local_i = co_rank(local_k, A_s, A_size, B_s, B_size);</span><br><span class="line">    int local_j = local_k - local_i;</span><br><span class="line">    </span><br><span class="line">    int local_i_end = co_rank(local_k_end, A_s, A_size, B_s, B_size);</span><br><span class="line">    int local_j_end = local_k_end - local_i_end;</span><br><span class="line">    </span><br><span class="line">    // å½’å¹¶åˆ°å…±äº«å†…å­˜</span><br><span class="line">    merge_sequential(A_s + local_i, local_i_end - local_i,</span><br><span class="line">                     B_s + local_j, local_j_end - local_j,</span><br><span class="line">                     C_s + local_k);</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å†™å›å…¨å±€å†…å­˜</span><br><span class="line">    for (int i = threadIdx.x; i &lt; tile_size; i += blockDim.x) &#123;</span><br><span class="line">        C[k_start + i] = C_s[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xing-neng-ti-sheng" tabindex="-1" id="æ€§èƒ½æå‡">æ€§èƒ½æå‡</h3><table><thead><tr><th>ç‰ˆæœ¬</th><th>å…¨å±€å†…å­˜è®¿é—®</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>åŸºç¡€</td><td>O(m+n) æ¬¡</td><td>1Ã—</td></tr><tr><td>åˆ†å—</td><td>O(m+n) æ¬¡</td><td>~5Ã—</td></tr><tr><td>å…±äº«å†…å­˜</td><td>O(m+n)/T æ¬¡</td><td>~10Ã—</td></tr></tbody></table><h2 id="xun-huan-huan-chong-qu-you-hua" tabindex="-1" id="å¾ªç¯ç¼“å†²åŒºä¼˜åŒ–">å¾ªç¯ç¼“å†²åŒºä¼˜åŒ–</h2><h3 id="wen-ti-1" tabindex="-1" id="é—®é¢˜-2">é—®é¢˜</h3><p>å…±äº«å†…å­˜æœ‰é™ï¼Œå¦‚æœ A_size + B_size &gt; å…±äº«å†…å­˜å®¹é‡æ€ä¹ˆåŠï¼Ÿ</p><h3 id="si-lu-liu-shi-chu-li" tabindex="-1" id="æ€è·¯ï¼šæµå¼å¤„ç†">æ€è·¯ï¼šæµå¼å¤„ç†</h3><p>ç”¨<strong>å¾ªç¯ç¼“å†²åŒº</strong>é€å—å¤„ç†ï¼š</p><ol><li>åŠ è½½ A å’Œ B çš„ä¸€å°å—åˆ°å…±äº«å†…å­˜</li><li>å½’å¹¶èƒ½å½’å¹¶çš„éƒ¨åˆ†</li><li>åŠ è½½ä¸‹ä¸€å—ï¼Œç»§ç»­å½’å¹¶</li><li>é‡å¤ç›´åˆ°å®Œæˆ</li></ol><h3 id="guan-jian-dian" tabindex="-1" id="å…³é”®ç‚¹">å…³é”®ç‚¹</h3><p><strong>æ¶ˆè´¹è·Ÿè¸ª</strong>ï¼šè®°å½• A å’Œ B å„æ¶ˆè´¹äº†å¤šå°‘å…ƒç´ ã€‚</p><p><strong>ç¼“å†²åŒºç®¡ç†</strong>ï¼šå¾ªç¯ä½¿ç”¨ç¼“å†²åŒºç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__global__ void merge_circular(int *A, int m, int *B, int n, int *C) &#123;</span><br><span class="line">    __shared__ int buffer_A[BUFFER_SIZE];</span><br><span class="line">    __shared__ int buffer_B[BUFFER_SIZE];</span><br><span class="line">    </span><br><span class="line">    // ... åˆå§‹åŒ– ...</span><br><span class="line">    </span><br><span class="line">    int a_consumed = 0, b_consumed = 0;</span><br><span class="line">    int a_loaded = 0, b_loaded = 0;</span><br><span class="line">    int c_produced = 0;</span><br><span class="line">    </span><br><span class="line">    while (c_produced &lt; tile_size) &#123;</span><br><span class="line">        // å¡«å……ç¼“å†²åŒº</span><br><span class="line">        while (a_loaded - a_consumed &lt; BUFFER_SIZE &amp;&amp; a_loaded &lt; A_size) &#123;</span><br><span class="line">            buffer_A[a_loaded % BUFFER_SIZE] = A_s[a_loaded];</span><br><span class="line">            a_loaded++;</span><br><span class="line">        &#125;</span><br><span class="line">        while (b_loaded - b_consumed &lt; BUFFER_SIZE &amp;&amp; b_loaded &lt; B_size) &#123;</span><br><span class="line">            buffer_B[b_loaded % BUFFER_SIZE] = B_s[b_loaded];</span><br><span class="line">            b_loaded++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // å½’å¹¶ä¸€æ‰¹</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æŠ€æœ¯åœ¨æ•°æ®é‡è¿œè¶…å…±äº«å†…å­˜æ—¶å¾ˆæœ‰ç”¨ã€‚</p><h2 id="gui-bing-lu-jing-ke-shi-hua" tabindex="-1" id="å½’å¹¶è·¯å¾„å¯è§†åŒ–">å½’å¹¶è·¯å¾„å¯è§†åŒ–</h2><h3 id="co-rank-de-ji-he-jie-shi" tabindex="-1" id="Co-Rank-çš„å‡ ä½•è§£é‡Š">Co-Rank çš„å‡ ä½•è§£é‡Š</h3><p>æŠŠå½’å¹¶è¿‡ç¨‹å¯è§†åŒ–ä¸º 2D ç½‘æ ¼ä¸­çš„è·¯å¾„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  B: 0   1   2   3   4</span><br><span class="line">     +---+---+---+---+</span><br><span class="line">A:0  |   |   |   |   |</span><br><span class="line">     +---+---+---+---+</span><br><span class="line">  1  |   |   |   |   |</span><br><span class="line">     +---+---+â”€â”€â”€+â”€â”€â”€+</span><br><span class="line">  2  |   |   |\  |   |</span><br><span class="line">     +---+---+â”€\â”€+---+</span><br><span class="line">  3  |   |   |  \|   |</span><br><span class="line">     +---+---+---+\--+</span><br><span class="line">  4  |   |   |   | \ |</span><br><span class="line">     +---+---+---+---+</span><br></pre></td></tr></table></figure><p><strong>è·¯å¾„è§„åˆ™</strong>ï¼š</p><ul><li>ä» (0,0) åˆ° (m,n)</li><li>æ¯æ­¥å‘å³ï¼ˆå– A å…ƒç´ ï¼‰æˆ–å‘ä¸‹ï¼ˆå– B å…ƒç´ ï¼‰</li><li>é€‰æ‹©è¾ƒå°çš„å…ƒç´ å†³å®šæ–¹å‘</li></ul><p><strong>Co-Rank(k)</strong>ï¼šè·¯å¾„ä¸Šç¬¬ k æ­¥çš„ä½ç½®ã€‚</p><h3 id="bing-xing-hua-shi-jiao" tabindex="-1" id="å¹¶è¡ŒåŒ–è§†è§’">å¹¶è¡ŒåŒ–è§†è§’</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŠŠè¾“å‡ºåˆ†æˆ T æ®µï¼š</span><br><span class="line">  æ®µ 0: è·¯å¾„ [0, T)</span><br><span class="line">  æ®µ 1: è·¯å¾„ [T, 2T)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">æ¯æ®µçš„èµ·ç‚¹ç”± Co-Rank ç¡®å®šã€‚</span><br></pre></td></tr></table></figure><h2 id="gui-bing-pai-xu" tabindex="-1" id="å½’å¹¶æ’åº">å½’å¹¶æ’åº</h2><h3 id="fen-zhi-jie-gou" tabindex="-1" id="åˆ†æ²»ç»“æ„">åˆ†æ²»ç»“æ„</h3><p>å½’å¹¶æ’åº = é€’å½’æ‹†åˆ† + å½’å¹¶åˆå¹¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[3,1,7,4,5,2,6,8]</span><br><span class="line">       â†“ æ‹†åˆ†</span><br><span class="line">[3,1,7,4] [5,2,6,8]</span><br><span class="line">    â†“ æ‹†åˆ†</span><br><span class="line">[3,1] [7,4] [5,2] [6,8]</span><br><span class="line">  â†“ æ‹†åˆ†</span><br><span class="line">[3][1] [7][4] [5][2] [6][8]</span><br><span class="line">  â†“ å½’å¹¶</span><br><span class="line">[1,3] [4,7] [2,5] [6,8]</span><br><span class="line">    â†“ å½’å¹¶</span><br><span class="line">[1,3,4,7] [2,5,6,8]</span><br><span class="line">       â†“ å½’å¹¶</span><br><span class="line">[1,2,3,4,5,6,7,8]</span><br></pre></td></tr></table></figure><h3 id="bing-xing-gui-bing-pai-xu" tabindex="-1" id="å¹¶è¡Œå½’å¹¶æ’åº">å¹¶è¡Œå½’å¹¶æ’åº</h3><p>æ¯å±‚å½’å¹¶å¯ä»¥å¹¶è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">void parallel_merge_sort(int *data, int n) &#123;</span><br><span class="line">    // ä»å•å…ƒç´ å¼€å§‹ï¼Œé€å±‚å½’å¹¶</span><br><span class="line">    for (int width = 1; width &lt; n; width *= 2) &#123;</span><br><span class="line">        int num_merges = (n + 2 * width - 1) / (2 * width);</span><br><span class="line">        </span><br><span class="line">        // å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰å½’å¹¶</span><br><span class="line">        merge_kernel&lt;&lt;&lt;num_merges, BLOCK_SIZE&gt;&gt;&gt;(</span><br><span class="line">            data, n, width</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__global__ void merge_kernel(int *data, int n, int width) &#123;</span><br><span class="line">    int merge_id = blockIdx.x;</span><br><span class="line">    int left = merge_id * 2 * width;</span><br><span class="line">    int mid = min(left + width, n);</span><br><span class="line">    int right = min(left + 2 * width, n);</span><br><span class="line">    </span><br><span class="line">    // å½’å¹¶ [left, mid) å’Œ [mid, right)</span><br><span class="line">    merge_shared(data + left, mid - left, </span><br><span class="line">                 data + mid, right - mid, </span><br><span class="line">                 temp + left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fu-za-du" tabindex="-1" id="å¤æ‚åº¦">å¤æ‚åº¦</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>ä¸²è¡Œå½’å¹¶æ’åº</th><th>å¹¶è¡Œå½’å¹¶æ’åº</th></tr></thead><tbody><tr><td>å±‚æ•°</td><td>logâ‚‚N</td><td>logâ‚‚N</td></tr><tr><td>æ¯å±‚å·¥ä½œ</td><td>O(N)</td><td>O(N)</td></tr><tr><td>æ€»å·¥ä½œ</td><td>O(N log N)</td><td>O(N log N)</td></tr><tr><td>å¹¶è¡Œæ—¶é—´</td><td>O(N log N)</td><td>O(logÂ²N)*</td></tr></tbody></table><p>*å‡è®¾æœ‰è¶³å¤Ÿå¤šçš„å¤„ç†å™¨ï¼Œæ¯å±‚å½’å¹¶å¹¶è¡Œå®Œæˆã€‚</p><h2 id="yu-qi-ta-suan-fa-de-guan-xi" tabindex="-1" id="ä¸å…¶ä»–ç®—æ³•çš„å…³ç³»">ä¸å…¶ä»–ç®—æ³•çš„å…³ç³»</h2><h3 id="gui-bing-vs-ji-shu-pai-xu" tabindex="-1" id="å½’å¹¶-vs-åŸºæ•°æ’åº">å½’å¹¶ vs åŸºæ•°æ’åº</h3><table><thead><tr><th>ç‰¹æ€§</th><th>å½’å¹¶æ’åº</th><th>åŸºæ•°æ’åº</th></tr></thead><tbody><tr><td>æ¯”è¾ƒæ¬¡æ•°</td><td>O(N log N)</td><td>O(N Ã— ä½æ•°)</td></tr><tr><td>ç¨³å®šæ€§</td><td>ç¨³å®š</td><td>ç¨³å®š</td></tr><tr><td>é€‚ç”¨ç±»å‹</td><td>é€šç”¨</td><td>æ•´æ•°/å®šé•¿é”®</td></tr><tr><td>GPU å‹å¥½åº¦</td><td>ä¸­ç­‰</td><td>é«˜</td></tr></tbody></table><p>åŸºæ•°æ’åºåœ¨ GPU ä¸Šé€šå¸¸æ›´å¿«ï¼Œä½†å½’å¹¶æ’åºé€‚ç”¨èŒƒå›´æ›´å¹¿ã€‚</p><h3 id="gui-bing-vs-kuai-su-pai-xu" tabindex="-1" id="å½’å¹¶-vs-å¿«é€Ÿæ’åº">å½’å¹¶ vs å¿«é€Ÿæ’åº</h3><table><thead><tr><th>ç‰¹æ€§</th><th>å½’å¹¶æ’åº</th><th>å¿«é€Ÿæ’åº</th></tr></thead><tbody><tr><td>æœ€åå¤æ‚åº¦</td><td>O(N log N)</td><td>O(NÂ²)</td></tr><tr><td>ç©ºé—´</td><td>O(N)</td><td>O(log N)</td></tr><tr><td>å¹¶è¡ŒåŒ–</td><td>å®¹æ˜“</td><td>è¾ƒéš¾</td></tr><tr><td>ç¨³å®šæ€§</td><td>ç¨³å®š</td><td>ä¸ç¨³å®š</td></tr></tbody></table><p>å½’å¹¶æ’åºçš„ç¡®å®šæ€§å’Œç¨³å®šæ€§ä½¿å…¶åœ¨å¹¶è¡Œè®¡ç®—ä¸­æ›´å—æ¬¢è¿ã€‚</p><h2 id="cub-thrust-ku" tabindex="-1" id="CUB-Thrust-åº“">CUB/Thrust åº“</h2><h3 id="shi-yong-thrust" tabindex="-1" id="ä½¿ç”¨-Thrust">ä½¿ç”¨ Thrust</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;thrust/merge.h&gt;</span><br><span class="line">#include &lt;thrust/device_vector.h&gt;</span><br><span class="line"></span><br><span class="line">void mergeWithThrust(int *A, int m, int *B, int n, int *C) &#123;</span><br><span class="line">    thrust::device_ptr&lt;int&gt; d_A(A);</span><br><span class="line">    thrust::device_ptr&lt;int&gt; d_B(B);</span><br><span class="line">    thrust::device_ptr&lt;int&gt; d_C(C);</span><br><span class="line">    </span><br><span class="line">    thrust::merge(d_A, d_A + m, d_B, d_B + n, d_C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shi-yong-cub" tabindex="-1" id="ä½¿ç”¨-CUB">ä½¿ç”¨ CUB</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cub/cub.cuh&gt;</span><br><span class="line"></span><br><span class="line">void mergeWithCub(int *d_A, int m, int *d_B, int n, int *d_C) &#123;</span><br><span class="line">    void *d_temp = nullptr;</span><br><span class="line">    size_t temp_bytes = 0;</span><br><span class="line">    </span><br><span class="line">    cub::DeviceMerge::Merge(d_temp, temp_bytes, </span><br><span class="line">                            d_A, m, d_B, n, d_C);</span><br><span class="line">    </span><br><span class="line">    cudaMalloc(&amp;d_temp, temp_bytes);</span><br><span class="line">    </span><br><span class="line">    cub::DeviceMerge::Merge(d_temp, temp_bytes,</span><br><span class="line">                            d_A, m, d_B, n, d_C);</span><br><span class="line">    </span><br><span class="line">    cudaFree(d_temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬åäºŒç« æ·±å…¥è®²è§£å¹¶è¡Œå½’å¹¶ï¼š</p><p><strong>æ ¸å¿ƒæŒ‘æˆ˜</strong>ï¼šè¾“å‡ºä½ç½®å–å†³äºè¾“å…¥æ•°æ®å†…å®¹ï¼ˆåŠ¨æ€æ•°æ®è¯†åˆ«ï¼‰ï¼Œä¸èƒ½ç®€å•æ ¹æ®çº¿ç¨‹ ID ç¡®å®šã€‚</p><p><strong>Co-Rank æŠ€æœ¯</strong>ï¼šç»™å®šè¾“å‡ºä½ç½® kï¼Œç”¨äºŒåˆ†æœç´¢æ‰¾åˆ°å¯¹åº”çš„è¾“å…¥ä½ç½® (i, j)ï¼Œæ»¡è¶³ i + j = kã€‚è¿™æ˜¯å¹¶è¡Œå½’å¹¶çš„å…³é”®ã€‚</p><p><strong>åˆ†å—å½’å¹¶</strong>ï¼šæŠŠè¾“å‡ºåˆ†æˆ Tileï¼Œæ¯ä¸ª Tile åšä¸€æ¬¡ Co-Rank æ‰¾è¾¹ç•Œï¼ŒTile å†…ä¸²è¡Œå½’å¹¶ã€‚å¹³è¡¡äº†å¹¶è¡Œå¼€é”€å’Œå·¥ä½œæ•ˆç‡ã€‚</p><p><strong>å…±äº«å†…å­˜ä¼˜åŒ–</strong>ï¼šæŠŠ Tile æ•°æ®åŠ è½½åˆ°å…±äº«å†…å­˜ï¼Œå‡å°‘å…¨å±€å†…å­˜è®¿é—®ã€‚å¾ªç¯ç¼“å†²åŒºå¤„ç†å¤§ Tileã€‚</p><p><strong>å½’å¹¶è·¯å¾„</strong>ï¼šå½’å¹¶è¿‡ç¨‹å¯è§†åŒ–ä¸º 2D ç½‘æ ¼ä¸­çš„è·¯å¾„ï¼ŒCo-Rank æ‰¾çš„æ˜¯è·¯å¾„ä¸Šçš„ç‚¹ã€‚</p><p><strong>å½’å¹¶æ’åº</strong>ï¼šlog N å±‚å½’å¹¶ï¼Œæ¯å±‚å¯ä»¥å¹¶è¡Œã€‚æ€»å·¥ä½œé‡ O(N log N)ï¼Œå¹¶è¡Œæ—¶é—´å¯è¾¾ O(logÂ² N)ã€‚</p><p>å½’å¹¶æ˜¯æ’åºã€æ•°æ®åº“æ“ä½œçš„åŸºç¡€ã€‚æŒæ¡ Co-Rank æŠ€æœ¯ï¼Œå°±èƒ½å¤„ç†å„ç§&quot;è¾“å‡ºä½ç½®ä¾èµ–è¾“å…¥æ•°æ®&quot;çš„é—®é¢˜ã€‚ä¸‹ä¸€ç« å­¦ä¹ æ’åºâ€”â€”å½’å¹¶çš„ç›´æ¥åº”ç”¨ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li>Odeh, S., Green, O., Miklau, Z., Rupnow, K., &amp; Hwu, W. (2012). <em>Merge Path - A Visually Intuitive Approach to Parallel Merging</em>. IPDPS.</li><li><a href="https://nvlabs.github.io/cub/">NVIDIA CUB Library</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å½’å¹¶" scheme="https://smarter.xin/tags/merge/"/>
    
    <category term="Merge" scheme="https://smarter.xin/tags/Merge/"/>
    
    <category term="åŠ¨æ€æ•°æ®è¯†åˆ«" scheme="https://smarter.xin/tags/dynamic-data-identification/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬åä¸€ç« ï¼šå‰ç¼€å’Œ</title>
    <link href="https://smarter.xin/posts/a6fc4cf6/"/>
    <id>https://smarter.xin/posts/a6fc4cf6/</id>
    <published>2026-01-18T07:51:17.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬åç« å­¦äº†å½’çº¦â€”â€”æŠŠ N ä¸ªæ•°å˜æˆ 1 ä¸ªæ•°ã€‚è¿™ç« å­¦<strong>å‰ç¼€å’Œï¼ˆPrefix Sumï¼‰</strong>ï¼Œä¹Ÿå« <strong>Scan</strong>â€”â€”æŠŠ N ä¸ªæ•°å˜æˆ N ä¸ªæ•°ï¼Œæ¯ä¸ªä½ç½®å­˜å‚¨ä¹‹å‰æ‰€æœ‰å…ƒç´ çš„ç´¯è®¡ç»“æœã€‚çœ‹èµ·æ¥è®¡ç®—é‡æ›´å¤§ï¼Œä½†å‰ç¼€å’Œæ˜¯å¹¶è¡Œè®¡ç®—çš„&quot;ç‘å£«å†›åˆ€&quot;ï¼Œèƒ½è§£å†³å¾ˆå¤šçœ‹ä¼¼ä¸å¯å¹¶è¡Œçš„é—®é¢˜ï¼šæµå‹ç¼©ã€åŸºæ•°æ’åºã€ç¨€ç–çŸ©é˜µè¿ç®—ç­‰ã€‚ç¬¬åä¸€ç« é‡ç‚¹è®²è§£<strong>å·¥ä½œæ•ˆç‡</strong>â€”â€”å¦‚ä½•è®©å¹¶è¡Œç®—æ³•åšçš„æ€»å·¥ä½œé‡ä¸è¶…è¿‡ä¸²è¡Œç®—æ³•å¤ªå¤šã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="qian-zhui-he-ji-chu" tabindex="-1" id="å‰ç¼€å’ŒåŸºç¡€">å‰ç¼€å’ŒåŸºç¡€</h2><h3 id="shi-yao-shi-qian-zhui-he" tabindex="-1" id="ä»€ä¹ˆæ˜¯å‰ç¼€å’Œ">ä»€ä¹ˆæ˜¯å‰ç¼€å’Œ</h3><p><strong>å‰ç¼€å’Œ</strong>ï¼šå¯¹äºè¾“å…¥æ•°ç»„ <code>[aâ‚€, aâ‚, aâ‚‚, ..., aâ‚™â‚‹â‚]</code>ï¼Œè¾“å‡ºæ¯ä¸ªä½ç½®ä¹‹å‰æ‰€æœ‰å…ƒç´ çš„ç´¯è®¡å€¼ã€‚</p><p>æœ‰ä¸¤ç§å˜ä½“ï¼š</p><p><strong>åŒ…å«å¼æ‰«æï¼ˆInclusive Scanï¼‰</strong>ï¼šåŒ…å«å½“å‰å…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:  [3, 1, 7, 0, 4, 1, 6, 3]</span><br><span class="line">è¾“å‡º:  [3, 4, 11, 11, 15, 16, 22, 25]</span><br><span class="line">       3  3+1  4+7  11+0  ...</span><br></pre></td></tr></table></figure><p><strong>æ’é™¤å¼æ‰«æï¼ˆExclusive Scanï¼‰</strong>ï¼šä¸åŒ…å«å½“å‰å…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:  [3, 1, 7, 0, 4, 1, 6, 3]</span><br><span class="line">è¾“å‡º:  [0, 3, 4, 11, 11, 15, 16, 22]</span><br><span class="line">       0  å‰ç¼€  å‰ç¼€+1  å‰ç¼€+7  ...</span><br></pre></td></tr></table></figure><p><strong>å…³ç³»</strong>ï¼š<code>exclusive[i] = inclusive[i-1]</code>ï¼Œ<code>exclusive[0] = 0</code></p><h3 id="shu-xue-ding-yi" tabindex="-1" id="æ•°å­¦å®šä¹‰">æ•°å­¦å®šä¹‰</h3><p>å¯¹äºäºŒå…ƒç»“åˆè¿ç®— âŠ•ï¼š</p><p><strong>Inclusive Scan</strong>:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>â¨</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>i</mi></munderover><msub><mi>x</mi><mi>j</mi></msub><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>âŠ•</mo><msub><mi>x</mi><mn>1</mn></msub><mo>âŠ•</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>âŠ•</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i = \bigoplus_{j=0}^{i} x_j = x_0 \oplus x_1 \oplus ... \oplus x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.2254em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">â¨</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><strong>Exclusive Scan</strong>:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>â¨</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></munderover><msub><mi>x</mi><mi>j</mi></msub><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub><mo>âŠ•</mo><msub><mi>x</mi><mn>1</mn></msub><mo>âŠ•</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>âŠ•</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">y_i = \bigoplus_{j=0}^{i-1} x_j = x_0 \oplus x_1 \oplus ... \oplus x_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.2254em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">â¨</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ <code>yâ‚€ = identity</code>ï¼ˆå•ä½å…ƒï¼‰ã€‚</p><h3 id="ying-yong-chang-jing" tabindex="-1" id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3><p>å‰ç¼€å’Œç”¨é€”æå¹¿ï¼š</p><table><thead><tr><th>åº”ç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æµå‹ç¼©</strong></td><td>æ ¹æ®æ¡ä»¶ç­›é€‰å…ƒç´ </td></tr><tr><td><strong>åŸºæ•°æ’åº</strong></td><td>è®¡ç®—æ¯ä¸ªæ¡¶çš„èµ·å§‹ä½ç½®</td></tr><tr><td><strong>ç¨€ç–çŸ©é˜µ</strong></td><td>CSR æ ¼å¼çš„è¡ŒæŒ‡é’ˆæ•°ç»„</td></tr><tr><td><strong>å¤šé¡¹å¼æ±‚å€¼</strong></td><td>Horner æ³•åˆ™çš„å¹¶è¡ŒåŒ–</td></tr><tr><td><strong>æ±‚è§£ä¸‰å¯¹è§’æ–¹ç¨‹</strong></td><td>å¾ªç¯å½’çº¦</td></tr><tr><td><strong>ç›´æ–¹å›¾å‡è¡¡åŒ–</strong></td><td>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</td></tr></tbody></table><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå‰ç¼€å’ŒæŠŠ&quot;ä¾èµ–å‰é¢ç»“æœ&quot;çš„é—®é¢˜è½¬åŒ–ä¸ºå¯å¹¶è¡Œçš„å½¢å¼ã€‚</p><h3 id="chuan-xing-shi-xian" tabindex="-1" id="ä¸²è¡Œå®ç°">ä¸²è¡Œå®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">inclusive_scan_sequential</span><span class="params">(<span class="type">float</span> *x, <span class="type">float</span> *y, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    y[<span class="number">0</span>] = x[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        y[i] = y[i<span class="number">-1</span>] + x[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œå­˜åœ¨ä¸¥æ ¼çš„æ•°æ®ä¾èµ–ï¼š<code>y[i]</code> ä¾èµ– <code>y[i-1]</code>ã€‚</p><p>çœ‹ä¼¼æ— æ³•å¹¶è¡Œï¼Ÿå…¶å®å¯ä»¥ï¼</p><h2 id="kogge-stone-suan-fa" tabindex="-1" id="Kogge-Stone-ç®—æ³•">Kogge-Stone ç®—æ³•</h2><h3 id="he-xin-si-xiang" tabindex="-1" id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3><p>åˆ©ç”¨ç»“åˆå¾‹ï¼Œä¸éœ€è¦æŒ‰é¡ºåºè®¡ç®—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y[i] = x[0] + x[1] + ... + x[i]</span><br><span class="line">     = (x[0] + x[1] + ... + x[i-k]) + (x[i-k+1] + ... + x[i])</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong>ï¼šæ¯ä¸€æ­¥è®©æ¯ä¸ªå…ƒç´ ä¸è·ç¦»ä¸º 2^k çš„å…ƒç´ ç›¸åŠ ã€‚</p><h3 id="suan-fa-guo-cheng" tabindex="-1" id="ç®—æ³•è¿‡ç¨‹">ç®—æ³•è¿‡ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹:     [3, 1, 7, 0, 4, 1, 6, 3]</span><br><span class="line"></span><br><span class="line">Step 1 (stride=1):</span><br><span class="line">  y[i] = x[i] + x[i-1]</span><br><span class="line">  ç»“æœ: [3, 4, 8, 7, 4, 5, 7, 9]</span><br><span class="line"></span><br><span class="line">Step 2 (stride=2):</span><br><span class="line">  y[i] = y[i] + y[i-2]</span><br><span class="line">  ç»“æœ: [3, 4, 11, 11, 12, 12, 11, 14]</span><br><span class="line"></span><br><span class="line">Step 3 (stride=4):</span><br><span class="line">  y[i] = y[i] + y[i-4]</span><br><span class="line">  ç»“æœ: [3, 4, 11, 11, 15, 16, 22, 25]</span><br><span class="line"></span><br><span class="line">å®Œæˆï¼</span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ­¥ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å¹¶è¡Œæ›´æ–°ã€‚logâ‚‚N æ­¥åå®Œæˆã€‚</p><h3 id="cuda-shi-xian" tabindex="-1" id="CUDA-å®ç°">CUDA å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__global__ void kogge_stone_scan(float *X, float *Y, int n) &#123;</span><br><span class="line">    __shared__ float XY[SECTION_SIZE];</span><br><span class="line">    </span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½åˆ°å…±äº«å†…å­˜</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        XY[threadIdx.x] = X[i];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        XY[threadIdx.x] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Kogge-Stone æ‰«æ</span><br><span class="line">    for (unsigned int stride = 1; stride &lt; blockDim.x; stride *= 2) &#123;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        float temp;</span><br><span class="line">        if (threadIdx.x &gt;= stride) &#123;</span><br><span class="line">            temp = XY[threadIdx.x] + XY[threadIdx.x - stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        if (threadIdx.x &gt;= stride) &#123;</span><br><span class="line">            XY[threadIdx.x] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å†™å›</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        Y[i] = XY[threadIdx.x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wei-shi-yao-xu-yao-liang-ci-tong-bu" tabindex="-1" id="ä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ¬¡åŒæ­¥ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ¬¡åŒæ­¥ï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__syncthreads();  // ç¬¬ä¸€æ¬¡ï¼šç¡®ä¿æ‰€æœ‰çº¿ç¨‹è¯»å®Œ</span><br><span class="line">temp = XY[...] + XY[...];  // è¯»å–</span><br><span class="line">__syncthreads();  // ç¬¬äºŒæ¬¡ï¼šç¡®ä¿æ‰€æœ‰çº¿ç¨‹è¯»å®Œå†å†™</span><br><span class="line">XY[...] = temp;  // å†™å…¥</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ç”¨ä¸´æ—¶å˜é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// é”™è¯¯ï¼</span><br><span class="line">XY[i] = XY[i] + XY[i-stride];  // å¦‚æœé‚»å±…è¿˜æ²¡è¯»å®Œå°±è¢«è¦†ç›–</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šè¯»å’Œå†™å¿…é¡»åˆ†ç¦»ï¼Œç”¨åŒæ­¥ä¿è¯ã€‚</p><h3 id="gong-zuo-liang-fen-xi" tabindex="-1" id="å·¥ä½œé‡åˆ†æ">å·¥ä½œé‡åˆ†æ</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>ä¸²è¡Œç®—æ³•</th><th>Kogge-Stone</th></tr></thead><tbody><tr><td>æ­¥æ•°</td><td>N</td><td>logâ‚‚N</td></tr><tr><td>æ¯æ­¥æ“ä½œ</td><td>1</td><td>~N</td></tr><tr><td>æ€»æ“ä½œ</td><td>N</td><td>NÂ·logâ‚‚N</td></tr></tbody></table><p><strong>é—®é¢˜</strong>ï¼šKogge-Stone åšäº†æ›´å¤šçš„å·¥ä½œï¼</p><p>å¯¹äº N=1024ï¼š</p><ul><li>ä¸²è¡Œï¼š1024 æ¬¡æ“ä½œ</li><li>Kogge-Stoneï¼š1024 Ã— 10 = 10240 æ¬¡æ“ä½œ</li></ul><p>è¿™å°±æ˜¯**å·¥ä½œæ•ˆç‡ï¼ˆWork Efficiencyï¼‰**é—®é¢˜ã€‚</p><h2 id="brent-kung-suan-fa" tabindex="-1" id="Brent-Kung-ç®—æ³•">Brent-Kung ç®—æ³•</h2><h3 id="gong-zuo-xiao-lu-you-hua" tabindex="-1" id="å·¥ä½œæ•ˆç‡ä¼˜åŒ–">å·¥ä½œæ•ˆç‡ä¼˜åŒ–</h3><p><strong>æ€è·¯</strong>ï¼šå‡å°‘å†—ä½™è®¡ç®—ï¼Œåˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>å½’çº¦é˜¶æ®µï¼ˆReduceï¼‰</strong>ï¼šè‡ªåº•å‘ä¸Šï¼Œæ„å»ºéƒ¨åˆ†å’Œ</li><li><strong>åˆ†å‘é˜¶æ®µï¼ˆDownsweepï¼‰</strong>ï¼šè‡ªé¡¶å‘ä¸‹ï¼Œåˆ†å‘ç»“æœ</li></ol><h3 id="suan-fa-guo-cheng-1" tabindex="-1" id="ç®—æ³•è¿‡ç¨‹-2">ç®—æ³•è¿‡ç¨‹</h3><p><strong>é˜¶æ®µ 1ï¼šå½’çº¦</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹:     [3, 1, 7, 0, 4, 1, 6, 3]</span><br><span class="line"></span><br><span class="line">Step 1 (stride=1): ç›¸é‚»å…ƒç´ é…å¯¹æ±‚å’Œ</span><br><span class="line">          [3, 4, 7, 7, 4, 5, 6, 9]</span><br><span class="line">              â†‘     â†‘     â†‘     â†‘</span><br><span class="line">             1+3   0+7   1+4   3+6</span><br><span class="line"></span><br><span class="line">Step 2 (stride=2): éš”ä¸€ä¸ªé…å¯¹</span><br><span class="line">          [3, 4, 7, 11, 4, 5, 6, 14]</span><br><span class="line">                   â†‘           â†‘</span><br><span class="line">                  4+7         5+9</span><br><span class="line"></span><br><span class="line">Step 3 (stride=4): éš”ä¸‰ä¸ªé…å¯¹</span><br><span class="line">          [3, 4, 7, 11, 4, 5, 6, 25]</span><br><span class="line">                               â†‘</span><br><span class="line">                             11+14</span><br></pre></td></tr></table></figure><p>ç°åœ¨ <code>XY[7] = 25 = å…¨éƒ¨å…ƒç´ ä¹‹å’Œ</code>ã€‚</p><p><strong>é˜¶æ®µ 2ï¼šåˆ†å‘ï¼ˆDownsweepï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ä»å³åˆ°å·¦ï¼ŒæŠŠéƒ¨åˆ†å’Œ&quot;ä¼ æ’­&quot;ä¸‹å»ï¼š</span><br><span class="line"></span><br><span class="line">Step 1 (stride=2):</span><br><span class="line">  XY[5] = XY[5] + XY[3] = 5 + 11 = 16</span><br><span class="line">          [3, 4, 7, 11, 4, 16, 6, 25]</span><br><span class="line"></span><br><span class="line">Step 2 (stride=1):</span><br><span class="line">  XY[2] = XY[2] + XY[1] = 7 + 4 = 11</span><br><span class="line">  XY[4] = XY[4] + XY[3] = 4 + 11 = 15</span><br><span class="line">  XY[6] = XY[6] + XY[5] = 6 + 16 = 22</span><br><span class="line">          [3, 4, 11, 11, 15, 16, 22, 25]</span><br><span class="line"></span><br><span class="line">å®Œæˆï¼</span><br></pre></td></tr></table></figure><h3 id="cuda-shi-xian-1" tabindex="-1" id="CUDA-å®ç°-2">CUDA å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">__global__ void brent_kung_scan(float *X, float *Y, int n) &#123;</span><br><span class="line">    __shared__ float XY[SECTION_SIZE];</span><br><span class="line">    </span><br><span class="line">    int i = 2 * blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ï¼ˆæ¯çº¿ç¨‹ä¸¤ä¸ªå…ƒç´ ï¼‰</span><br><span class="line">    if (i &lt; n) XY[threadIdx.x] = X[i];</span><br><span class="line">    if (i + blockDim.x &lt; n) XY[threadIdx.x + blockDim.x] = X[i + blockDim.x];</span><br><span class="line">    </span><br><span class="line">    // ========== å½’çº¦é˜¶æ®µ ==========</span><br><span class="line">    for (unsigned int stride = 1; stride &lt;= blockDim.x; stride *= 2) &#123;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        int index = (threadIdx.x + 1) * 2 * stride - 1;</span><br><span class="line">        if (index &lt; SECTION_SIZE) &#123;</span><br><span class="line">            XY[index] += XY[index - stride];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ========== åˆ†å‘é˜¶æ®µ ==========</span><br><span class="line">    for (unsigned int stride = SECTION_SIZE / 4; stride &gt; 0; stride /= 2) &#123;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        int index = (threadIdx.x + 1) * 2 * stride - 1;</span><br><span class="line">        if (index + stride &lt; SECTION_SIZE) &#123;</span><br><span class="line">            XY[index + stride] += XY[index];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å†™å›</span><br><span class="line">    if (i &lt; n) Y[i] = XY[threadIdx.x];</span><br><span class="line">    if (i + blockDim.x &lt; n) Y[i + blockDim.x] = XY[threadIdx.x + blockDim.x];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gong-zuo-liang-fen-xi-1" tabindex="-1" id="å·¥ä½œé‡åˆ†æ-2">å·¥ä½œé‡åˆ†æ</h3><table><thead><tr><th>é˜¶æ®µ</th><th>æ­¥æ•°</th><th>æ¯æ­¥æ“ä½œ</th><th>æ€»æ“ä½œ</th></tr></thead><tbody><tr><td>å½’çº¦</td><td>logâ‚‚N</td><td>N/2^k</td><td>N-1</td></tr><tr><td>åˆ†å‘</td><td>logâ‚‚N - 1</td><td>N/2^k</td><td>N-1-logâ‚‚N</td></tr><tr><td><strong>æ€»è®¡</strong></td><td></td><td></td><td><strong>2N-2-logâ‚‚N</strong></td></tr></tbody></table><p>å¯¹äº N=1024ï¼š</p><ul><li>Kogge-Stoneï¼š10240 æ¬¡æ“ä½œ</li><li>Brent-Kungï¼š~2046 æ¬¡æ“ä½œ</li></ul><p><strong>å·¥ä½œæ•ˆç‡æå‡ 5 å€ï¼</strong></p><h3 id="wei-shi-yao-mei-xian-cheng-chu-li-liang-ge-yuan-su" tabindex="-1" id="ä¸ºä»€ä¹ˆæ¯çº¿ç¨‹å¤„ç†ä¸¤ä¸ªå…ƒç´ ï¼Ÿ">ä¸ºä»€ä¹ˆæ¯çº¿ç¨‹å¤„ç†ä¸¤ä¸ªå…ƒç´ ï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int i = 2 * blockIdx.x * blockDim.x + threadIdx.x;</span><br></pre></td></tr></table></figure><p>å¦‚æœ Section æœ‰ 1024 ä¸ªå…ƒç´ ï¼Œåªéœ€è¦ 512 ä¸ªçº¿ç¨‹ã€‚æ¯çº¿ç¨‹åŠ è½½ä¸¤ä¸ªå…ƒç´ ï¼Œå‡å°‘äº†çº¿ç¨‹å¼€é”€ã€‚</p><h2 id="kogge-stone-vs-brent-kung" tabindex="-1" id="Kogge-Stone-vs-Brent-Kung">Kogge-Stone vs Brent-Kung</h2><h3 id="dui-bi" tabindex="-1" id="å¯¹æ¯”">å¯¹æ¯”</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>Kogge-Stone</th><th>Brent-Kung</th></tr></thead><tbody><tr><td>æ€»æ“ä½œæ•°</td><td>NÂ·logâ‚‚N</td><td>2N - 2 - logâ‚‚N</td></tr><tr><td>æ­¥æ•°</td><td>logâ‚‚N</td><td>2Â·logâ‚‚N - 1</td></tr><tr><td>å¹¶è¡Œåº¦ï¼ˆæ¯æ­¥ï¼‰</td><td>N</td><td>é€’å‡/é€’å¢</td></tr><tr><td>æ§åˆ¶é€»è¾‘</td><td>ç®€å•</td><td>å¤æ‚</td></tr><tr><td>å·¥ä½œæ•ˆç‡</td><td>ä½</td><td>é«˜ï¼ˆ~ä¸²è¡Œï¼‰</td></tr></tbody></table><h3 id="xuan-ze-ce-lue" tabindex="-1" id="é€‰æ‹©ç­–ç•¥">é€‰æ‹©ç­–ç•¥</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èç®—æ³•</th><th>åŸå› </th></tr></thead><tbody><tr><td>å°æ•°ç»„ï¼ˆ&lt;1Kï¼‰</td><td>Kogge-Stone</td><td>ç®€å•ï¼Œæ­¥æ•°å°‘</td></tr><tr><td>å¤§æ•°ç»„</td><td>Brent-Kung</td><td>å·¥ä½œé‡å°</td></tr><tr><td>å¸¦å®½å—é™</td><td>Kogge-Stone</td><td>æ›´å¤šå¹¶è¡Œéšè—å»¶è¿Ÿ</td></tr><tr><td>è®¡ç®—å—é™</td><td>Brent-Kung</td><td>æ€»æ“ä½œå°‘</td></tr></tbody></table><p>å®é™…ä¸­ï¼Œæ··åˆç­–ç•¥æœ€å¸¸è§ï¼šå¤§éƒ¨åˆ†ç”¨ Brent-Kungï¼Œæœ€åå‡ å±‚ç”¨ Kogge-Stoneã€‚</p><h2 id="san-jie-duan-fen-ceng-sao-miao" tabindex="-1" id="ä¸‰é˜¶æ®µåˆ†å±‚æ‰«æ">ä¸‰é˜¶æ®µåˆ†å±‚æ‰«æ</h2><h3 id="wen-ti-chao-chu-dan-block" tabindex="-1" id="é—®é¢˜ï¼šè¶…å‡ºå•-Block">é—®é¢˜ï¼šè¶…å‡ºå• Block</h3><p>å½“æ•°æ®é‡è¶…è¿‡å…±äº«å†…å­˜å®¹é‡æ—¶ï¼Œéœ€è¦<strong>å¤š Block åä½œ</strong>ã€‚</p><h3 id="san-jie-duan-suan-fa" tabindex="-1" id="ä¸‰é˜¶æ®µç®—æ³•">ä¸‰é˜¶æ®µç®—æ³•</h3><p><strong>é˜¶æ®µ 1ï¼šBlock å†…æ‰«æ</strong></p><p>æ¯ä¸ª Block ç‹¬ç«‹æ‰«æè‡ªå·±çš„ Sectionï¼Œä¿å­˜æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆSection Sumï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Block 0: [3,4,11,11]  â†’ sum[0] = 11</span><br><span class="line">Block 1: [4,5,11,14]  â†’ sum[1] = 14</span><br><span class="line">Block 2: [5,6,12,15]  â†’ sum[2] = 15</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ 2ï¼šæ‰«æ Section Sums</strong></p><p>å¯¹æ‰€æœ‰ Block çš„ sum åšæ‰«æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sum: [11, 14, 15, ...]</span><br><span class="line">æ‰«æå: [0, 11, 25, 40, ...]  // Exclusive</span><br></pre></td></tr></table></figure><p>è¿™ç»™å‡ºäº†æ¯ä¸ª Block çš„&quot;èµ·å§‹åç§»&quot;ã€‚</p><p><strong>é˜¶æ®µ 3ï¼šåŠ ä¸Šåç§»</strong></p><p>æ¯ä¸ª Block çš„æ‰€æœ‰å…ƒç´ åŠ ä¸Šå¯¹åº”çš„åç§»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Block 0: [3,4,11,11] + 0  â†’ [3,4,11,11]</span><br><span class="line">Block 1: [4,5,11,14] + 11 â†’ [15,16,22,25]</span><br><span class="line">Block 2: [5,6,12,15] + 25 â†’ [30,31,37,40]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="shi-xian" tabindex="-1" id="å®ç°">å®ç°</h3><p><strong>Kernel 1ï¼šBlock å†…æ‰«æ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__global__ void scan_phase1(float *X, float *Y, float *S, int n) &#123;</span><br><span class="line">    __shared__ float XY[SECTION_SIZE];</span><br><span class="line">    </span><br><span class="line">    // Block å†…æ‰«æï¼ˆBrent-Kungï¼‰</span><br><span class="line">    // ...</span><br><span class="line">    </span><br><span class="line">    // ä¿å­˜ Section Sum</span><br><span class="line">    if (threadIdx.x == blockDim.x - 1) &#123;</span><br><span class="line">        S[blockIdx.x] = XY[SECTION_SIZE - 1];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å†™å›</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Kernel 2ï¼šæ‰«æ Section Sums</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// é€šå¸¸åªæœ‰ä¸€ä¸ª Blockï¼Œå› ä¸º Section æ•°é‡ä¸å¤š</span><br><span class="line">scan_single_block&lt;&lt;&lt;1, numSections&gt;&gt;&gt;(S, S, numSections);</span><br></pre></td></tr></table></figure><p><strong>Kernel 3ï¼šåŠ åç§»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__global__ void scan_phase3(float *Y, float *S, int n) &#123;</span><br><span class="line">    int i = blockIdx.x * SECTION_SIZE + threadIdx.x;</span><br><span class="line">    if (blockIdx.x &gt; 0 &amp;&amp; i &lt; n) &#123;</span><br><span class="line">        Y[i] += S[blockIdx.x - 1];  // Exclusive æ‰«æçš„ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="di-gui-chu-li" tabindex="-1" id="é€’å½’å¤„ç†">é€’å½’å¤„ç†</h3><p>å¦‚æœ Section æ•°é‡ä¹Ÿå¾ˆå¤§ï¼Œå¯¹ S çš„æ‰«ææœ¬èº«éœ€è¦åˆ†å±‚ã€‚å½¢æˆ<strong>é€’å½’ç»“æ„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Level 0: æ‰«æåŸå§‹æ•°æ® â†’ Section Sums</span><br><span class="line">Level 1: æ‰«æ Section Sums â†’ Super Section Sums</span><br><span class="line">Level 2: æ‰«æ Super Section Sums</span><br><span class="line">...</span><br><span class="line">Level K: å• Block å®Œæˆ</span><br><span class="line"></span><br><span class="line">ç„¶åé€†å‘åŠ åç§»ï¼š</span><br><span class="line">Level K â†’ Level K-1 â†’ ... â†’ Level 0</span><br></pre></td></tr></table></figure><p><strong>å±‚æ•°</strong>ï¼šlog(N/SECTION_SIZE)</p><h2 id="dan-bian-sao-miao-single-pass-scan" tabindex="-1" id="å•éæ‰«æï¼ˆSingle-Pass-Scanï¼‰">å•éæ‰«æï¼ˆSingle-Pass Scanï¼‰</h2><h3 id="dong-ji" tabindex="-1" id="åŠ¨æœº">åŠ¨æœº</h3><p>ä¸‰é˜¶æ®µæ‰«æéœ€è¦å¤šæ¬¡ Kernel å¯åŠ¨ï¼Œæœ‰å¼€é”€ã€‚èƒ½å¦ä¸€éå®Œæˆï¼Ÿ</p><h3 id="si-lu" tabindex="-1" id="æ€è·¯">æ€è·¯</h3><p>ç”¨<strong>åŸå­æ“ä½œ + å†…å­˜æ ‡å¿—</strong>å®ç° Block é—´é€šä¿¡ï¼š</p><ol><li>æ¯ä¸ª Block å®Œæˆæ‰«æåï¼Œå‘å¸ƒè‡ªå·±çš„ Section Sum</li><li>ç­‰å¾…å‰ä¸€ä¸ª Block çš„ç»“æœ</li><li>åŠ ä¸Šå‰ç¼€å¹¶ç»§ç»­</li></ol><h3 id="shi-xian-1" tabindex="-1" id="å®ç°-2">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">__global__ void single_pass_scan(float *X, float *Y, float *flags, </span><br><span class="line">                                  float *sums, int n) &#123;</span><br><span class="line">    __shared__ float XY[SECTION_SIZE];</span><br><span class="line">    __shared__ float prefix;</span><br><span class="line">    </span><br><span class="line">    int bid = blockIdx.x;</span><br><span class="line">    </span><br><span class="line">    // Phase 1: Block å†…æ‰«æ</span><br><span class="line">    // ... æ ‡å‡† Brent-Kung ...</span><br><span class="line">    </span><br><span class="line">    // Phase 2: ç­‰å¾…å‰ä¸€ä¸ª Block</span><br><span class="line">    if (threadIdx.x == 0) &#123;</span><br><span class="line">        // å‘å¸ƒè‡ªå·±çš„å’Œ</span><br><span class="line">        sums[bid] = XY[SECTION_SIZE - 1];</span><br><span class="line">        __threadfence();  // ç¡®ä¿å†™å…¥å¯¹å…¶ä»– Block å¯è§</span><br><span class="line">        atomicExch(&amp;flags[bid], 1);  // æ ‡è®°å®Œæˆ</span><br><span class="line">        </span><br><span class="line">        // ç­‰å¾…å‰ç¼€</span><br><span class="line">        if (bid &gt; 0) &#123;</span><br><span class="line">            // ç­‰å¾… Block bid-1</span><br><span class="line">            while (atomicAdd(&amp;flags[bid - 1], 0) == 0);</span><br><span class="line">            __threadfence();</span><br><span class="line">            </span><br><span class="line">            // ç´¯åŠ æ‰€æœ‰å‰ç¼€ï¼ˆå¯ä¼˜åŒ–ä¸º Kogge-Stone é£æ ¼ï¼‰</span><br><span class="line">            float pre = 0;</span><br><span class="line">            for (int i = 0; i &lt; bid; i++) &#123;</span><br><span class="line">                pre += sums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            prefix = pre;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            prefix = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // Phase 3: åŠ åç§»å¹¶å†™å›</span><br><span class="line">    int i = bid * SECTION_SIZE + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        Y[i] = XY[threadIdx.x] + prefix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wen-ti" tabindex="-1" id="é—®é¢˜">é—®é¢˜</h3><p><strong>é¡ºåºä¾èµ–</strong>ï¼šBlock å¿…é¡»æŒ‰é¡ºåºå®Œæˆï¼Œå¯èƒ½å¯¼è‡´<strong>ä¸²è¡ŒåŒ–</strong>ã€‚</p><p><strong>æ”¹è¿›</strong>ï¼šä½¿ç”¨ <strong>Decoupled Look-back</strong>ï¼ˆåˆ†ç¦»å›æº¯ï¼‰ç®—æ³•ï¼Œæ¯ä¸ª Block åªæŸ¥çœ‹éƒ¨åˆ†å‰ç¼€ï¼Œé“¾å¼ä¼ æ’­ã€‚</p><h2 id="gong-zuo-xiao-lu-de-ben-zhi" tabindex="-1" id="å·¥ä½œæ•ˆç‡çš„æœ¬è´¨">å·¥ä½œæ•ˆç‡çš„æœ¬è´¨</h2><h3 id="shi-jian-vs-cao-zuo" tabindex="-1" id="æ—¶é—´-vs-æ“ä½œ">æ—¶é—´ vs æ“ä½œ</h3><p><strong>å¹¶è¡Œæ—¶é—´</strong>ï¼šæ‰€æœ‰å¤„ç†å™¨åŒæ—¶å·¥ä½œéœ€è¦çš„æ—¶é—´æ­¥æ•°</p><p><strong>æ€»æ“ä½œæ•°</strong>ï¼šæ‰€æœ‰å¤„ç†å™¨æ‰§è¡Œçš„æ“ä½œæ€»å’Œ</p><p><strong>å·¥ä½œæ•ˆç‡ = ä¸²è¡Œæ“ä½œæ•° / å¹¶è¡Œæ“ä½œæ•°</strong></p><table><thead><tr><th>ç®—æ³•</th><th>å¹¶è¡Œæ—¶é—´</th><th>æ€»æ“ä½œ</th><th>å·¥ä½œæ•ˆç‡</th></tr></thead><tbody><tr><td>ä¸²è¡Œ</td><td>N</td><td>N</td><td>100%</td></tr><tr><td>Kogge-Stone</td><td>log N</td><td>NÂ·log N</td><td>1/log N</td></tr><tr><td>Brent-Kung</td><td>2Â·log N</td><td>2N</td><td>~50%</td></tr></tbody></table><h3 id="he-shi-zhui-qiu-gong-zuo-xiao-lu" tabindex="-1" id="ä½•æ—¶è¿½æ±‚å·¥ä½œæ•ˆç‡ï¼Ÿ">ä½•æ—¶è¿½æ±‚å·¥ä½œæ•ˆç‡ï¼Ÿ</h3><p><strong>å¤„ç†å™¨å……è¶³æ—¶</strong>ï¼š</p><ul><li>æ“ä½œæ•°ä¸»å¯¼æ—¶é—´</li><li>åº”è¯¥è¿½æ±‚å·¥ä½œæ•ˆç‡</li></ul><p><strong>å¤„ç†å™¨ä¸è¶³æ—¶</strong>ï¼š</p><ul><li>æ­¥æ•°ä¸»å¯¼æ—¶é—´</li><li>å¯ä»¥ç‰ºç‰²å·¥ä½œæ•ˆç‡æ¢å–æ›´å°‘æ­¥æ•°</li></ul><p>GPU é€šå¸¸å¤„ç†å™¨&quot;è¶³å¤Ÿå¤š&quot;ï¼Œæ‰€ä»¥å·¥ä½œæ•ˆç‡å¾ˆé‡è¦ã€‚</p><h2 id="qian-zhui-he-de-ying-yong" tabindex="-1" id="å‰ç¼€å’Œçš„åº”ç”¨">å‰ç¼€å’Œçš„åº”ç”¨</h2><h3 id="liu-ya-suo-stream-compaction" tabindex="-1" id="æµå‹ç¼©ï¼ˆStream-Compactionï¼‰">æµå‹ç¼©ï¼ˆStream Compactionï¼‰</h3><p>ç­›é€‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:    [3, 1, 7, 0, 4, 1, 6, 3]</span><br><span class="line">æ¡ä»¶:    x &gt; 2</span><br><span class="line">æ ‡å¿—:    [1, 0, 1, 0, 1, 0, 1, 1]</span><br><span class="line">å‰ç¼€å’Œ:  [0, 1, 1, 2, 2, 3, 3, 4]  // Exclusive</span><br><span class="line">è¾“å‡ºä½ç½®: 0, -, 1, -, 2, -, 3, 4</span><br><span class="line">è¾“å‡º:    [3, 7, 4, 6, 3]</span><br></pre></td></tr></table></figure><p><strong>Exclusive å‰ç¼€å’Œç»™å‡ºæ¯ä¸ªæ»¡è¶³æ¡ä»¶å…ƒç´ çš„è¾“å‡ºä½ç½®ï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__global__ void compact(int *flags, int *positions, </span><br><span class="line">                        float *in, float *out, int n) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n &amp;&amp; flags[i]) &#123;</span><br><span class="line">        out[positions[i]] = in[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ji-shu-pai-xu" tabindex="-1" id="åŸºæ•°æ’åº">åŸºæ•°æ’åº</h3><p>æŒ‰ä½æ’åºï¼Œæ¯ä¸€ä½ç”¨å‰ç¼€å’Œç¡®å®šä½ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ 0 ä½ = 0 çš„å…ƒç´ : å‰ç¼€å’Œç¡®å®šä½ç½®</span><br><span class="line">ç¬¬ 0 ä½ = 1 çš„å…ƒç´ : ç´§éšå…¶å</span><br></pre></td></tr></table></figure><h3 id="fen-pei-gong-zuo" tabindex="-1" id="åˆ†é…å·¥ä½œ">åˆ†é…å·¥ä½œ</h3><p>æ ¹æ®è´Ÿè½½åˆ†é…ä»»åŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä»»åŠ¡å¤§å°:  [5, 3, 8, 2, 4]</span><br><span class="line">å‰ç¼€å’Œ:    [0, 5, 8, 16, 18]</span><br><span class="line"></span><br><span class="line">çº¿ç¨‹ 7 åº”è¯¥å¤„ç†å“ªä¸ªä»»åŠ¡ï¼Ÿ</span><br><span class="line">â†’ äºŒåˆ†æŸ¥æ‰¾å‰ç¼€å’Œæ•°ç»„</span><br><span class="line">â†’ ä»»åŠ¡ 1ï¼ˆå› ä¸º 5 â‰¤ 7 &lt; 8ï¼‰</span><br></pre></td></tr></table></figure><h2 id="cub-ku" tabindex="-1" id="CUB-åº“">CUB åº“</h2><h3 id="shi-yong-cub-shi-xian-sao-miao" tabindex="-1" id="ä½¿ç”¨-CUB-å®ç°æ‰«æ">ä½¿ç”¨ CUB å®ç°æ‰«æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cub/cub.cuh&gt;</span><br><span class="line"></span><br><span class="line">void scanWithCub(float *d_in, float *d_out, int n) &#123;</span><br><span class="line">    void *d_temp = nullptr;</span><br><span class="line">    size_t temp_bytes = 0;</span><br><span class="line">    </span><br><span class="line">    // ç¡®å®šä¸´æ—¶å­˜å‚¨å¤§å°</span><br><span class="line">    cub::DeviceScan::InclusiveSum(d_temp, temp_bytes, d_in, d_out, n);</span><br><span class="line">    </span><br><span class="line">    cudaMalloc(&amp;d_temp, temp_bytes);</span><br><span class="line">    </span><br><span class="line">    // æ‰§è¡Œæ‰«æ</span><br><span class="line">    cub::DeviceScan::InclusiveSum(d_temp, temp_bytes, d_in, d_out, n);</span><br><span class="line">    </span><br><span class="line">    cudaFree(d_temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cub-ti-gong-de-sao-miao" tabindex="-1" id="CUB-æä¾›çš„æ‰«æ">CUB æä¾›çš„æ‰«æ</h3><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>DeviceScan::InclusiveSum</code></td><td>åŒ…å«å¼æ±‚å’Œ</td></tr><tr><td><code>DeviceScan::ExclusiveSum</code></td><td>æ’é™¤å¼æ±‚å’Œ</td></tr><tr><td><code>DeviceScan::InclusiveScan</code></td><td>åŒ…å«å¼è‡ªå®šä¹‰</td></tr><tr><td><code>DeviceScan::ExclusiveScan</code></td><td>æ’é™¤å¼è‡ªå®šä¹‰</td></tr></tbody></table><h3 id="zi-ding-yi-cao-zuo" tabindex="-1" id="è‡ªå®šä¹‰æ“ä½œ">è‡ªå®šä¹‰æ“ä½œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct MaxOp &#123;</span><br><span class="line">    __device__ float operator()(float a, float b) &#123;</span><br><span class="line">        return (a &gt; b) ? a : b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MaxOp max_op;</span><br><span class="line">cub::DeviceScan::InclusiveScan(d_temp, temp_bytes, </span><br><span class="line">                                d_in, d_out, max_op, n);</span><br></pre></td></tr></table></figure><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬åä¸€ç« æ·±å…¥è®²è§£å‰ç¼€å’Œï¼š</p><p><strong>ä¸¤ç§å˜ä½“</strong>ï¼šInclusiveï¼ˆå«å½“å‰ï¼‰vs Exclusiveï¼ˆä¸å«å½“å‰ï¼‰ã€‚Exclusive çš„åº”ç”¨æ›´å¹¿ï¼Œç‰¹åˆ«æ˜¯ç¡®å®šè¾“å‡ºä½ç½®ã€‚</p><p><strong>Kogge-Stone</strong>ï¼šç®€å•ç›´æ¥ï¼Œlog N æ­¥ï¼Œä½†å·¥ä½œé‡ NÂ·log Nï¼Œå·¥ä½œæ•ˆç‡ä½ã€‚</p><p><strong>Brent-Kung</strong>ï¼šåˆ†å½’çº¦å’Œåˆ†å‘ä¸¤é˜¶æ®µï¼Œå·¥ä½œé‡ ~2Nï¼Œæ¥è¿‘ä¸²è¡Œã€‚æ­¥æ•°ç•¥å¤šä½†æ›´é«˜æ•ˆã€‚</p><p><strong>åˆ†å±‚æ‰«æ</strong>ï¼šå¤§æ•°æ®éœ€è¦å¤š Block åä½œã€‚ä¸‰é˜¶æ®µï¼šBlock å†…æ‰«æ â†’ æ‰«æ Section Sums â†’ åŠ åç§»ã€‚å¯é€’å½’å¤„ç†è¶…å¤§æ•°æ®ã€‚</p><p><strong>å·¥ä½œæ•ˆç‡</strong>ï¼šå¹¶è¡Œç®—æ³•çš„æ€»æ“ä½œæ•°ä¸åº”è¿œè¶…ä¸²è¡Œã€‚GPU å¤„ç†å™¨å¤šï¼Œå·¥ä½œæ•ˆç‡æ¯”æ­¥æ•°æ›´é‡è¦ã€‚</p><p><strong>æ ¸å¿ƒåº”ç”¨</strong>ï¼šæµå‹ç¼©ã€åŸºæ•°æ’åºã€è´Ÿè½½åˆ†é…ã€‚å‰ç¼€å’ŒæŠŠ&quot;è¾“å‡ºä½ç½®&quot;é—®é¢˜å˜æˆå¹¶è¡Œå¯è§£ã€‚</p><p>å‰ç¼€å’Œæ˜¯å¹¶è¡Œè®¡ç®—çš„åŸºç¡€åŸè¯­ï¼Œç†è§£å®ƒå¯¹äºå®ç°å¤æ‚å¹¶è¡Œç®—æ³•è‡³å…³é‡è¦ã€‚ä¸‹ä¸€ç« å­¦ä¹ åˆå¹¶ï¼ˆMergeï¼‰â€”â€”å¦ä¸€ä¸ªé‡è¦çš„å¹¶è¡ŒåŸè¯­ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li>Blelloch, G. E. (1990). <em>Prefix Sums and Their Applications</em>. CMU Technical Report.</li><li><a href="https://nvlabs.github.io/cub/structcub_1_1_device_scan.html">NVIDIA CUB Library - Scan</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot; id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç¬¬åç« å­¦äº†å½’çº¦â€”â€”æŠŠ N ä¸ªæ•°å˜æˆ 1 ä¸ªæ•°ã€‚è¿™ç« å­¦&lt;strong&gt;å‰ç¼€å’Œï¼ˆPrefix Sumï¼‰&lt;/strong&gt;ï¼Œä¹Ÿå« &lt;strong&gt;Scan&lt;/strong&gt;â€”â€”æŠŠ N</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å‰ç¼€å’Œ" scheme="https://smarter.xin/tags/prefix-sum/"/>
    
    <category term="Scan" scheme="https://smarter.xin/tags/Scan/"/>
    
    <category term="å·¥ä½œæ•ˆç‡" scheme="https://smarter.xin/tags/work-efficiency/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬åç« ï¼šå½’çº¦å’Œæœ€å°åŒ–å‘æ•£</title>
    <link href="https://smarter.xin/posts/43b40d12/"/>
    <id>https://smarter.xin/posts/43b40d12/</id>
    <published>2026-01-18T02:14:18.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬ä¹ç« å­¦äº†ç›´æ–¹å›¾ï¼Œç”¨åŸå­æ“ä½œå¤„ç†è¾“å‡ºå†²çªã€‚è¿™ç« å­¦<strong>å½’çº¦ï¼ˆReductionï¼‰</strong>â€”â€”æŠŠä¸€ç»„æ•°æ®&quot;å½’çº¦&quot;æˆä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚æ±‚å’Œã€æ±‚æœ€å¤§å€¼ã€‚çœ‹ä¼¼ç®€å•ï¼Œå®é™…æ¶‰åŠå¹¶è¡Œç®—æ³•çš„æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•é«˜æ•ˆåœ°åˆå¹¶éƒ¨åˆ†ç»“æœï¼Ÿå¦‚ä½•é¿å…åˆ†æ”¯å‘æ•£ï¼Ÿå¦‚ä½•æœ€å¤§åŒ–ç¡¬ä»¶åˆ©ç”¨ç‡ï¼Ÿç¬¬åç« ç³»ç»Ÿè®²è§£è¿™äº›æŠ€æœ¯ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="gui-yue-ji-chu" tabindex="-1" id="å½’çº¦åŸºç¡€">å½’çº¦åŸºç¡€</h2><h3 id="shi-yao-shi-gui-yue" tabindex="-1" id="ä»€ä¹ˆæ˜¯å½’çº¦">ä»€ä¹ˆæ˜¯å½’çº¦</h3><p><strong>å½’çº¦</strong>ï¼šç”¨ä¸€ä¸ª<strong>äºŒå…ƒç»“åˆè¿ç®—</strong>æŠŠ N ä¸ªå…ƒç´ åˆå¹¶æˆ 1 ä¸ªå€¼ã€‚</p><p><strong>å¸¸è§å½’çº¦æ“ä½œ</strong>ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>è¿ç®—ç¬¦</th><th>å•ä½å…ƒ</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ±‚å’Œ</td><td>+</td><td>0</td><td>1+2+3+4 = 10</td></tr><tr><td>æ±‚ç§¯</td><td>Ã—</td><td>1</td><td>1Ã—2Ã—3Ã—4 = 24</td></tr><tr><td>æœ€å¤§å€¼</td><td>max</td><td>-âˆ</td><td>max(1,5,3,2) = 5</td></tr><tr><td>æœ€å°å€¼</td><td>min</td><td>+âˆ</td><td>min(1,5,3,2) = 1</td></tr><tr><td>é€»è¾‘ä¸</td><td>&amp;&amp;</td><td>true</td><td>true &amp;&amp; false = false</td></tr><tr><td>é€»è¾‘æˆ–</td><td>||</td><td>false</td><td>true || false = true</td></tr><tr><td>ä½ä¸</td><td>&amp;</td><td>~0</td><td>0b1100 &amp; 0b1010 = 0b1000</td></tr><tr><td>ä½æˆ–</td><td>|</td><td>0</td><td>0b1100 | 0b1010 = 0b1110</td></tr></tbody></table><p><strong>ç»“åˆå¾‹</strong>æ˜¯å…³é”®ï¼š<code>(a âŠ• b) âŠ• c = a âŠ• (b âŠ• c)</code></p><p>æœ‰äº†ç»“åˆå¾‹ï¼Œå°±èƒ½ä»»æ„åˆ†ç»„å¹¶è¡Œè®¡ç®—ã€‚</p><h3 id="chuan-xing-gui-yue" tabindex="-1" id="ä¸²è¡Œå½’çº¦">ä¸²è¡Œå½’çº¦</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">sum_sequential</span><span class="params">(<span class="type">float</span> *data, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">float</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        sum += data[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œæ— æ³•åˆ©ç”¨å¹¶è¡Œæ€§ã€‚</p><h3 id="bing-xing-gui-yue-de-si-lu" tabindex="-1" id="å¹¶è¡Œå½’çº¦çš„æ€è·¯">å¹¶è¡Œå½’çº¦çš„æ€è·¯</h3><p><strong>æ ‘å½¢å½’çº¦</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Level 0: [a0, a1, a2, a3, a4, a5, a6, a7]</span><br><span class="line">Level 1: [a0+a1, a2+a3, a4+a5, a6+a7]</span><br><span class="line">Level 2: [a0+a1+a2+a3, a4+a5+a6+a7]</span><br><span class="line">Level 3: [a0+a1+a2+a3+a4+a5+a6+a7]</span><br></pre></td></tr></table></figure><p>æ¯å±‚æŠŠå…ƒç´ æ•°å‡åŠï¼Œlogâ‚‚N å±‚åå¾—åˆ°ç»“æœã€‚</p><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log N) æ­¥ï¼Œæ¯æ­¥ O(N/2^k) æ¬¡æ“ä½œ</p><p><strong>å·¥ä½œé‡</strong>ï¼šæ€»æ“ä½œæ•° = N/2 + N/4 + â€¦ + 1 = N - 1ï¼ˆä¸ä¸²è¡Œç›¸åŒï¼‰</p><p><strong>å¹¶è¡Œåº¦</strong>ï¼šç¬¬ k å±‚éœ€è¦ N/2^k ä¸ªå¹¶è¡Œæ“ä½œ</p><h2 id="po-su-bing-xing-gui-yue" tabindex="-1" id="æœ´ç´ å¹¶è¡Œå½’çº¦">æœ´ç´ å¹¶è¡Œå½’çº¦</h2><h3 id="xiang-lin-pei-dui" tabindex="-1" id="ç›¸é‚»é…å¯¹">ç›¸é‚»é…å¯¹</h3><p>æœ€ç›´è§‚çš„å¹¶è¡ŒåŒ–ï¼šç›¸é‚»å…ƒç´ é…å¯¹æ±‚å’Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_naive(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½åˆ°å…±äº«å†…å­˜</span><br><span class="line">    sdata[tid] = (i &lt; n) ? g_data[i] : 0;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // æ ‘å½¢å½’çº¦</span><br><span class="line">    for (int stride = 1; stride &lt; blockDim.x; stride *= 2) &#123;</span><br><span class="line">        if (tid % (2 * stride) == 0) &#123;</span><br><span class="line">            sdata[tid] += sdata[tid + stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å†™å›ç»“æœ</span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wen-ti-fen-zhi-fa-san" tabindex="-1" id="é—®é¢˜ï¼šåˆ†æ”¯å‘æ•£">é—®é¢˜ï¼šåˆ†æ”¯å‘æ•£</h3><p>çœ‹è¿™ä¸ªæ¡ä»¶ï¼š<code>if (tid % (2 * stride) == 0)</code></p><p><strong>Level 0</strong> (stride=1)ï¼šçº¿ç¨‹ 0,2,4,6â€¦ æ´»è·ƒï¼Œ1,3,5,7â€¦ ç©ºé—²<br><strong>Level 1</strong> (stride=2)ï¼šçº¿ç¨‹ 0,4,8â€¦ æ´»è·ƒ<br><strong>Level 2</strong> (stride=4)ï¼šçº¿ç¨‹ 0,8â€¦ æ´»è·ƒ</p><p>Warp å†…æœ‰çš„çº¿ç¨‹æ´»è·ƒã€æœ‰çš„ç©ºé—² = <strong>åˆ†æ”¯å‘æ•£</strong>ï¼</p><p>Warp å¿…é¡»ä¸²è¡Œæ‰§è¡Œä¸¤ä¸ªåˆ†æ”¯ï¼Œæ•ˆç‡å‡åŠã€‚</p><h3 id="wen-ti-bank-chong-tu" tabindex="-1" id="é—®é¢˜ï¼šBank-å†²çª">é—®é¢˜ï¼šBank å†²çª</h3><p><code>sdata[tid]</code> å’Œ <code>sdata[tid + stride]</code> çš„è®¿é—®æ¨¡å¼ï¼š</p><ul><li>stride=1ï¼šçº¿ç¨‹ 0 è®¿é—® [0,1]ï¼Œçº¿ç¨‹ 2 è®¿é—® [2,3]â€¦ï¼ˆæ— å†²çªï¼‰</li><li>stride=16ï¼šçº¿ç¨‹ 0 è®¿é—® [0,16]ï¼Œçº¿ç¨‹ 32 è®¿é—® [32,48]â€¦</li></ul><p>stride æ˜¯ 2 çš„å¹‚æ—¶ï¼Œå¯èƒ½äº§ç”Ÿ Bank å†²çªã€‚</p><h2 id="you-hua-1-jiao-cuo-pei-dui" tabindex="-1" id="ä¼˜åŒ–-1ï¼šäº¤é”™é…å¯¹">ä¼˜åŒ– 1ï¼šäº¤é”™é…å¯¹</h2><h3 id="gai-jin-si-lu" tabindex="-1" id="æ”¹è¿›æ€è·¯">æ”¹è¿›æ€è·¯</h3><p>æŠŠ&quot;ç©ºé—²çº¿ç¨‹åœ¨å³è¾¹&quot;æ”¹æˆ&quot;ç©ºé—²çº¿ç¨‹åœ¨åé¢&quot;ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æœ´ç´ ï¼šçº¿ç¨‹ 0,2,4,6 æ´»è·ƒï¼Œ1,3,5,7 ç©ºé—²</span><br><span class="line">äº¤é”™ï¼šçº¿ç¨‹ 0,1,2,3 æ´»è·ƒï¼Œ4,5,6,7 ç©ºé—²</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæ´»è·ƒçº¿ç¨‹æ˜¯è¿ç»­çš„ï¼Œå‰å‡ ä¸ª Warp æ»¡è½½ï¼Œæœ€åçš„ Warp æ‰é€æ¸ç©ºé—²ã€‚</p><h3 id="shi-xian" tabindex="-1" id="å®ç°">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_interleaved(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    sdata[tid] = (i &lt; n) ? g_data[i] : 0;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // äº¤é”™å½’çº¦</span><br><span class="line">    for (int stride = blockDim.x / 2; stride &gt; 0; stride &gt;&gt;= 1) &#123;</span><br><span class="line">        if (tid &lt; stride) &#123;</span><br><span class="line">            sdata[tid] += sdata[tid + stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fen-xi" tabindex="-1" id="åˆ†æ">åˆ†æ</h3><p><strong>Level 0</strong> (stride=128)ï¼šçº¿ç¨‹ 0-127 æ´»è·ƒ<br><strong>Level 1</strong> (stride=64)ï¼šçº¿ç¨‹ 0-63 æ´»è·ƒ<br><strong>Level 2</strong> (stride=32)ï¼šçº¿ç¨‹ 0-31 æ´»è·ƒï¼ˆæ°å¥½ä¸€ä¸ª Warpï¼‰</p><p>å‰å‡ å±‚æœ‰å¤šä¸ªå®Œæ•´ Warp åŒæ—¶å·¥ä½œï¼Œåˆ†æ”¯å‘æ•£åªåœ¨æœ€åå‡ å±‚å‡ºç°ã€‚</p><p><strong>æ€§èƒ½æå‡</strong>ï¼šçº¦ 2Ã— ç›¸æ¯”æœ´ç´ ç‰ˆæœ¬ã€‚</p><h2 id="you-hua-2-shou-ci-jia-zai-shi-gui-yue" tabindex="-1" id="ä¼˜åŒ–-2ï¼šé¦–æ¬¡åŠ è½½æ—¶å½’çº¦">ä¼˜åŒ– 2ï¼šé¦–æ¬¡åŠ è½½æ—¶å½’çº¦</h2><h3 id="guan-cha" tabindex="-1" id="è§‚å¯Ÿ">è§‚å¯Ÿ</h3><p>æ¯ä¸ªçº¿ç¨‹åªåŠ è½½ä¸€ä¸ªå…ƒç´ ï¼Œä½† Block æ•°å¯èƒ½è¿œå¤šäº SM æ•°ã€‚å¦‚æœè®©æ¯ä¸ªçº¿ç¨‹åŠ è½½å¤šä¸ªå…ƒç´ å¹¶åœ¨åŠ è½½æ—¶æ±‚å’Œï¼Œå¯ä»¥å‡å°‘ Block æ•°ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="shi-xian-1" tabindex="-1" id="å®ç°-2">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_first_add(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * (blockDim.x * 2) + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // é¦–æ¬¡åŠ è½½æ—¶å°±æ±‚å’Œä¸¤ä¸ªå…ƒç´ </span><br><span class="line">    float sum = 0;</span><br><span class="line">    if (i &lt; n) sum += g_data[i];</span><br><span class="line">    if (i + blockDim.x &lt; n) sum += g_data[i + blockDim.x];</span><br><span class="line">    sdata[tid] = sum;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åç»­å½’çº¦</span><br><span class="line">    for (int stride = blockDim.x / 2; stride &gt; 0; stride &gt;&gt;= 1) &#123;</span><br><span class="line">        if (tid &lt; stride) &#123;</span><br><span class="line">            sdata[tid] += sdata[tid + stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kuo-zhan-grid-stride-jia-zai" tabindex="-1" id="æ‰©å±•ï¼šGrid-Stride-åŠ è½½">æ‰©å±•ï¼šGrid-Stride åŠ è½½</h3><p>è®©æ¯ä¸ªçº¿ç¨‹åŠ è½½å¤šä¸ªå…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_grid_stride(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int gridSize = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    // Grid-stride ç´¯åŠ </span><br><span class="line">    float sum = 0;</span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        sum += g_data[i];</span><br><span class="line">        i += gridSize;</span><br><span class="line">    &#125;</span><br><span class="line">    sdata[tid] = sum;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // æ ‘å½¢å½’çº¦</span><br><span class="line">    for (int stride = blockDim.x / 2; stride &gt; 0; stride &gt;&gt;= 1) &#123;</span><br><span class="line">        if (tid &lt; stride) &#123;</span><br><span class="line">            sdata[tid] += sdata[tid + stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ol><li>Block æ•°é‡å¯ä»¥å›ºå®šï¼ˆå¦‚ 256ï¼‰ï¼Œä¸éšæ•°æ®é‡å˜åŒ–</li><li>æ¯çº¿ç¨‹åšæ›´å¤šæœ‰æ•ˆå·¥ä½œï¼Œåˆ†æ‘ŠåŒæ­¥å¼€é”€</li><li>æ›´å¥½çš„æŒ‡ä»¤çº§å¹¶è¡Œ</li></ol><h2 id="you-hua-3-zhan-kai-zui-hou-warp" tabindex="-1" id="ä¼˜åŒ–-3ï¼šå±•å¼€æœ€å-Warp">ä¼˜åŒ– 3ï¼šå±•å¼€æœ€å Warp</h2><h3 id="guan-cha-1" tabindex="-1" id="è§‚å¯Ÿ-2">è§‚å¯Ÿ</h3><p>å½“ stride &lt; 32 æ—¶ï¼Œåªæœ‰ä¸€ä¸ª Warp åœ¨å·¥ä½œã€‚Warp å†…çº¿ç¨‹è‡ªåŠ¨åŒæ­¥ï¼ˆSIMTï¼‰ï¼Œä¸éœ€è¦ <code>__syncthreads()</code>ï¼</p><h3 id="shi-xian-2" tabindex="-1" id="å®ç°-3">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">__device__ void warpReduce(volatile float *sdata, int tid) &#123;</span><br><span class="line">    sdata[tid] += sdata[tid + 32];</span><br><span class="line">    sdata[tid] += sdata[tid + 16];</span><br><span class="line">    sdata[tid] += sdata[tid + 8];</span><br><span class="line">    sdata[tid] += sdata[tid + 4];</span><br><span class="line">    sdata[tid] += sdata[tid + 2];</span><br><span class="line">    sdata[tid] += sdata[tid + 1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__global__ void reduce_warp_unroll(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x * 2 + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    sdata[tid] = 0;</span><br><span class="line">    if (i &lt; n) sdata[tid] += g_data[i];</span><br><span class="line">    if (i + blockDim.x &lt; n) sdata[tid] += g_data[i + blockDim.x];</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å¸¸è§„å½’çº¦ï¼ˆstride &gt;= 64ï¼‰</span><br><span class="line">    for (int stride = blockDim.x / 2; stride &gt; 32; stride &gt;&gt;= 1) &#123;</span><br><span class="line">        if (tid &lt; stride) &#123;</span><br><span class="line">            sdata[tid] += sdata[tid + stride];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Warp å†…å±•å¼€ï¼ˆstride &lt; 32ï¼‰</span><br><span class="line">    if (tid &lt; 32) &#123;</span><br><span class="line">        warpReduce(sdata, tid);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="guan-jian-dian" tabindex="-1" id="å…³é”®ç‚¹">å…³é”®ç‚¹</h3><p><strong>volatile</strong>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦ä¼˜åŒ–æ‰å¯¹ sdata çš„è¯»å†™ï¼Œç¡®ä¿æ¯æ¬¡éƒ½è®¿é—®å…±äº«å†…å­˜ã€‚</p><p><strong>éšå¼åŒæ­¥</strong>ï¼šWarp å†…çš„ 32 ä¸ªçº¿ç¨‹æ‰§è¡Œç›¸åŒæŒ‡ä»¤ï¼Œè‡ªåŠ¨ä¿æŒåŒæ­¥ã€‚</p><p><strong>æ€§èƒ½æå‡</strong>ï¼šå‡å°‘ 5 æ¬¡ <code>__syncthreads()</code> è°ƒç”¨ã€‚</p><h2 id="you-hua-4-wan-quan-zhan-kai" tabindex="-1" id="ä¼˜åŒ–-4ï¼šå®Œå…¨å±•å¼€">ä¼˜åŒ– 4ï¼šå®Œå…¨å±•å¼€</h2><h3 id="dang-block-da-xiao-yi-zhi-shi" tabindex="-1" id="å½“-Block-å¤§å°å·²çŸ¥æ—¶">å½“ Block å¤§å°å·²çŸ¥æ—¶</h3><p>å¦‚æœ Block å¤§å°æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼ˆå¦‚ 256ï¼‰ï¼Œå¯ä»¥å®Œå…¨å±•å¼€å¾ªç¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">template &lt;unsigned int blockSize&gt;</span><br><span class="line">__global__ void reduce_complete_unroll(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockSize * 2 + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    sdata[tid] = 0;</span><br><span class="line">    if (i &lt; n) sdata[tid] += g_data[i];</span><br><span class="line">    if (i + blockSize &lt; n) sdata[tid] += g_data[i + blockSize];</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ç¼–è¯‘æ—¶å±•å¼€</span><br><span class="line">    if (blockSize &gt;= 512) &#123;</span><br><span class="line">        if (tid &lt; 256) sdata[tid] += sdata[tid + 256];</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    if (blockSize &gt;= 256) &#123;</span><br><span class="line">        if (tid &lt; 128) sdata[tid] += sdata[tid + 128];</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    if (blockSize &gt;= 128) &#123;</span><br><span class="line">        if (tid &lt; 64) sdata[tid] += sdata[tid + 64];</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Warp å†…å±•å¼€</span><br><span class="line">    if (tid &lt; 32) &#123;</span><br><span class="line">        volatile float *smem = sdata;</span><br><span class="line">        if (blockSize &gt;= 64) smem[tid] += smem[tid + 32];</span><br><span class="line">        if (blockSize &gt;= 32) smem[tid] += smem[tid + 16];</span><br><span class="line">        if (blockSize &gt;= 16) smem[tid] += smem[tid + 8];</span><br><span class="line">        if (blockSize &gt;= 8)  smem[tid] += smem[tid + 4];</span><br><span class="line">        if (blockSize &gt;= 4)  smem[tid] += smem[tid + 2];</span><br><span class="line">        if (blockSize &gt;= 2)  smem[tid] += smem[tid + 1];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        g_result[blockIdx.x] = sdata[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="qi-dong" tabindex="-1" id="å¯åŠ¨">å¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// æ ¹æ® Block å¤§å°é€‰æ‹©æ¨¡æ¿å®ä¾‹</span><br><span class="line">switch (blockSize) &#123;</span><br><span class="line">    case 512: reduce_complete_unroll&lt;512&gt;&lt;&lt;&lt;grid, 512, 512*sizeof(float)&gt;&gt;&gt;(...); break;</span><br><span class="line">    case 256: reduce_complete_unroll&lt;256&gt;&lt;&lt;&lt;grid, 256, 256*sizeof(float)&gt;&gt;&gt;(...); break;</span><br><span class="line">    case 128: reduce_complete_unroll&lt;128&gt;&lt;&lt;&lt;grid, 128, 128*sizeof(float)&gt;&gt;&gt;(...); break;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šç¼–è¯‘å™¨å¯ä»¥å®Œå…¨å±•å¼€å¾ªç¯ï¼Œæ¶ˆé™¤å¾ªç¯å¼€é”€å’Œåˆ†æ”¯ã€‚</p><h2 id="you-hua-5-warp-shuffle" tabindex="-1" id="ä¼˜åŒ–-5ï¼šWarp-Shuffle">ä¼˜åŒ– 5ï¼šWarp Shuffle</h2><h3 id="xian-dai-fang-fa" tabindex="-1" id="ç°ä»£æ–¹æ³•">ç°ä»£æ–¹æ³•</h3><p>ä» Kepler æ¶æ„å¼€å§‹ï¼ŒCUDA æä¾› <strong>Warp Shuffle</strong> æŒ‡ä»¤ï¼Œçº¿ç¨‹å¯ä»¥ç›´æ¥äº¤æ¢å¯„å­˜å™¨å€¼ï¼Œæ— éœ€å…±äº«å†…å­˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__device__ float warpReduceSum(float val) &#123;</span><br><span class="line">    for (int offset = 16; offset &gt; 0; offset /= 2) &#123;</span><br><span class="line">        val += __shfl_down_sync(0xffffffff, val, offset);</span><br><span class="line">    &#125;</span><br><span class="line">    return val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wan-zheng-shi-xian" tabindex="-1" id="å®Œæ•´å®ç°">å®Œæ•´å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_shuffle(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int gridSize = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    // Grid-stride ç´¯åŠ </span><br><span class="line">    float sum = 0;</span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        sum += g_data[i];</span><br><span class="line">        i += gridSize;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Warp å†…å½’çº¦ï¼ˆshuffleï¼‰</span><br><span class="line">    sum = warpReduceSum(sum);</span><br><span class="line">    </span><br><span class="line">    // Warp é—´å½’çº¦</span><br><span class="line">    __shared__ float warpSums[32];  // æœ€å¤š 32 ä¸ª Warp</span><br><span class="line">    int lane = tid % 32;</span><br><span class="line">    int wid = tid / 32;</span><br><span class="line">    </span><br><span class="line">    if (lane == 0) &#123;</span><br><span class="line">        warpSums[wid] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ç¬¬ä¸€ä¸ª Warp åšæœ€ç»ˆå½’çº¦</span><br><span class="line">    if (wid == 0) &#123;</span><br><span class="line">        sum = (tid &lt; blockDim.x / 32) ? warpSums[lane] : 0;</span><br><span class="line">        sum = warpReduceSum(sum);</span><br><span class="line">        </span><br><span class="line">        if (tid == 0) &#123;</span><br><span class="line">            g_result[blockIdx.x] = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shuffle-han-shu" tabindex="-1" id="Shuffle-å‡½æ•°">Shuffle å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>__shfl_sync</code></td><td>ä»æŒ‡å®š lane è·å–å€¼</td></tr><tr><td><code>__shfl_up_sync</code></td><td>ä»ä½ lane è·å–å€¼</td></tr><tr><td><code>__shfl_down_sync</code></td><td>ä»é«˜ lane è·å–å€¼</td></tr><tr><td><code>__shfl_xor_sync</code></td><td>ä¸ XOR åç§»çš„ lane äº¤æ¢</td></tr></tbody></table><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ol><li>ä¸éœ€è¦å…±äº«å†…å­˜</li><li>å»¶è¿Ÿæ¯”å…±äº«å†…å­˜ä½</li><li>æ—  Bank å†²çª</li></ol><h2 id="duo-ji-gui-yue" tabindex="-1" id="å¤šçº§å½’çº¦">å¤šçº§å½’çº¦</h2><h3 id="dan-block-bu-gou" tabindex="-1" id="å•-Block-ä¸å¤Ÿ">å• Block ä¸å¤Ÿ</h3><p>å¦‚æœæ•°æ®é‡è¶…è¿‡å• Block èƒ½å¤„ç†çš„èŒƒå›´ï¼Œéœ€è¦å¤šçº§å½’çº¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Level 1: æ¯ä¸ª Block å½’çº¦è‡ªå·±çš„éƒ¨åˆ† â†’ gridDim ä¸ªéƒ¨åˆ†å’Œ</span><br><span class="line">Level 2: å†å¯åŠ¨ä¸€ä¸ª Kernel å½’çº¦è¿™äº›éƒ¨åˆ†å’Œ</span><br><span class="line">...</span><br><span class="line">é‡å¤ç›´åˆ°åªå‰©ä¸€ä¸ªå€¼</span><br></pre></td></tr></table></figure><h3 id="shi-xian-3" tabindex="-1" id="å®ç°-4">å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">void reduce_multi_level(float *d_data, float *d_result, int n) &#123;</span><br><span class="line">    int blockSize = 256;</span><br><span class="line">    int numBlocks = (n + blockSize * 2 - 1) / (blockSize * 2);</span><br><span class="line">    </span><br><span class="line">    float *d_partial;</span><br><span class="line">    cudaMalloc(&amp;d_partial, numBlocks * sizeof(float));</span><br><span class="line">    </span><br><span class="line">    // Level 1</span><br><span class="line">    reduce_kernel&lt;&lt;&lt;numBlocks, blockSize, blockSize * sizeof(float)&gt;&gt;&gt;</span><br><span class="line">        (d_data, d_partial, n);</span><br><span class="line">    </span><br><span class="line">    // åç»­ Level</span><br><span class="line">    while (numBlocks &gt; 1) &#123;</span><br><span class="line">        int n_next = numBlocks;</span><br><span class="line">        numBlocks = (n_next + blockSize * 2 - 1) / (blockSize * 2);</span><br><span class="line">        </span><br><span class="line">        reduce_kernel&lt;&lt;&lt;numBlocks, blockSize, blockSize * sizeof(float)&gt;&gt;&gt;</span><br><span class="line">            (d_partial, d_partial, n_next);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ‹·è´æœ€ç»ˆç»“æœ</span><br><span class="line">    cudaMemcpy(d_result, d_partial, sizeof(float), cudaMemcpyDeviceToHost);</span><br><span class="line">    cudaFree(d_partial);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="you-hua-yuan-zi-lei-jia" tabindex="-1" id="ä¼˜åŒ–ï¼šåŸå­ç´¯åŠ ">ä¼˜åŒ–ï¼šåŸå­ç´¯åŠ </h3><p>å¦‚æœåªéœ€è¦æœ€ç»ˆå’Œï¼Œå¯ä»¥ç”¨åŸå­æ“ä½œé¿å…å¤šçº§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__global__ void reduce_atomic(float *g_data, float *g_result, int n) &#123;</span><br><span class="line">    // ... å¸¸è§„ Block å†…å½’çº¦ ...</span><br><span class="line">    </span><br><span class="line">    if (tid == 0) &#123;</span><br><span class="line">        atomicAdd(g_result, sdata[0]);  // ç›´æ¥ç´¯åŠ åˆ°ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šéœ€è¦å…ˆå°† <code>g_result</code> åˆå§‹åŒ–ä¸º 0ã€‚</p><h2 id="fen-zhi-fa-san-shen-ru-fen-xi" tabindex="-1" id="åˆ†æ”¯å‘æ•£æ·±å…¥åˆ†æ">åˆ†æ”¯å‘æ•£æ·±å…¥åˆ†æ</h2><h3 id="fa-san-de-dai-jie" tabindex="-1" id="å‘æ•£çš„ä»£ä»·">å‘æ•£çš„ä»£ä»·</h3><p>å½“ Warp å†…çº¿ç¨‹èµ°ä¸åŒåˆ†æ”¯æ—¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (condition) &#123;</span><br><span class="line">    doA();  // éƒ¨åˆ†çº¿ç¨‹</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    doB();  // å…¶ä»–çº¿ç¨‹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¡¬ä»¶æ‰§è¡Œï¼š</p><ol><li>æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œ doA()ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹ç»“æœè¢«ä¸¢å¼ƒ</li><li>æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œ doB()ï¼Œæ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹ç»“æœè¢«ä¸¢å¼ƒ</li><li>æ€»æ—¶é—´ = doA() + doB()</li></ol><p><strong>å‘æ•£ç¨‹åº¦</strong>å½±å“æ€§èƒ½ï¼š</p><table><thead><tr><th>å‘æ•£æ¯”ä¾‹</th><th>æ€§èƒ½å½±å“</th></tr></thead><tbody><tr><td>0/32</td><td>æ— å½±å“</td></tr><tr><td>1/32</td><td>å‡ ä¹æ— å½±å“</td></tr><tr><td>16/32</td><td>çº¦ 50% æ€§èƒ½</td></tr><tr><td>æŒ‰ Warp è¾¹ç•Œ</td><td>æ— å‘æ•£</td></tr></tbody></table><h3 id="zui-xiao-hua-fa-san-de-ce-lue" tabindex="-1" id="æœ€å°åŒ–å‘æ•£çš„ç­–ç•¥">æœ€å°åŒ–å‘æ•£çš„ç­–ç•¥</h3><p><strong>1. è®©æ¡ä»¶æŒ‰ Warp å¯¹é½</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å·®ï¼šæ··åˆå‘æ•£</span><br><span class="line">if (tid % 2 == 0) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">// å¥½ï¼šWarp å†…æ— å‘æ•£</span><br><span class="line">if (tid &lt; 128) &#123; ... &#125;  // å‰ 4 ä¸ª Warp vs å 4 ä¸ª Warp</span><br></pre></td></tr></table></figure><p><strong>2. ç”¨ç®—æœ¯æ›¿ä»£åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// æœ‰åˆ†æ”¯</span><br><span class="line">if (a &gt; b) result = a;</span><br><span class="line">else result = b;</span><br><span class="line"></span><br><span class="line">// æ— åˆ†æ”¯</span><br><span class="line">result = (a &gt; b) * a + (a &lt;= b) * b;</span><br><span class="line"></span><br><span class="line">// æ›´å¥½ï¼šç”¨å†…ç½®å‡½æ•°</span><br><span class="line">result = max(a, b);</span><br></pre></td></tr></table></figure><p><strong>3. é¢„å…ˆåˆ†ç¦»æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// å·®ï¼šè¿è¡Œæ—¶åˆ†æ”¯</span><br><span class="line">if (data[i] &gt; threshold) processA();</span><br><span class="line">else processB();</span><br><span class="line"></span><br><span class="line">// å¥½ï¼šé¢„å¤„ç†åˆ†ç¦»</span><br><span class="line">// Kernel 1: åˆ†ç¦»æ•°æ®</span><br><span class="line">// Kernel 2: æ‰¹é‡å¤„ç† A ç±»</span><br><span class="line">// Kernel 3: æ‰¹é‡å¤„ç† B ç±»</span><br></pre></td></tr></table></figure><h3 id="gui-yue-zhong-de-fa-san-kong-zhi" tabindex="-1" id="å½’çº¦ä¸­çš„å‘æ•£æ§åˆ¶">å½’çº¦ä¸­çš„å‘æ•£æ§åˆ¶</h3><p>æœ´ç´  vs äº¤é”™çš„å¯¹æ¯”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æœ´ç´  (stride=1):</span><br><span class="line">  Warp 0: threads 0,2,4,...,30 æ´»è·ƒï¼ˆ16ä¸ªï¼‰</span><br><span class="line">  â†ª æ¯ä¸ª Warp éƒ½æœ‰ 50% å‘æ•£</span><br><span class="line"></span><br><span class="line">äº¤é”™ (stride=128):</span><br><span class="line">  Warp 0-3: å…¨éƒ¨æ´»è·ƒ</span><br><span class="line">  Warp 4-7: å…¨éƒ¨ç©ºé—²</span><br><span class="line">  â†ª æ²¡æœ‰ Warp å†…å‘æ•£ï¼</span><br></pre></td></tr></table></figure><h2 id="xing-neng-dui-bi" tabindex="-1" id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h2><p>ä»¥ 2Â²â´ï¼ˆçº¦ 1600 ä¸‡ï¼‰ä¸ª float æ±‚å’Œä¸ºä¾‹ï¼š</p><table><thead><tr><th>ä¼˜åŒ–ç‰ˆæœ¬</th><th>å¸¦å®½åˆ©ç”¨ç‡</th><th>ç›¸å¯¹æ€§èƒ½</th></tr></thead><tbody><tr><td>æœ´ç´ ç›¸é‚»é…å¯¹</td><td>4%</td><td>1Ã—</td></tr><tr><td>äº¤é”™é…å¯¹</td><td>8%</td><td>2Ã—</td></tr><tr><td>é¦–æ¬¡åŠ è½½å½’çº¦</td><td>16%</td><td>4Ã—</td></tr><tr><td>å±•å¼€æœ€å Warp</td><td>25%</td><td>6Ã—</td></tr><tr><td>å®Œå…¨å±•å¼€</td><td>40%</td><td>10Ã—</td></tr><tr><td>+ Warp Shuffle</td><td>60%</td><td>15Ã—</td></tr></tbody></table><p>å¸¦å®½åˆ©ç”¨ç‡ 60% å·²ç»å¾ˆé«˜â€”â€”å‰©ä½™å¼€é”€æ¥è‡ª Kernel å¯åŠ¨ã€åŒæ­¥ç­‰ä¸å¯é¿å…çš„å¼€é”€ã€‚</p><h2 id="qi-ta-gui-yue-cao-zuo" tabindex="-1" id="å…¶ä»–å½’çº¦æ“ä½œ">å…¶ä»–å½’çº¦æ“ä½œ</h2><h3 id="zui-da-zhi-zui-xiao-zhi" tabindex="-1" id="æœ€å¤§å€¼-æœ€å°å€¼">æœ€å¤§å€¼/æœ€å°å€¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__device__ float warpReduceMax(float val) &#123;</span><br><span class="line">    for (int offset = 16; offset &gt; 0; offset /= 2) &#123;</span><br><span class="line">        val = max(val, __shfl_down_sync(0xffffffff, val, offset));</span><br><span class="line">    &#125;</span><br><span class="line">    return val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="dai-suo-yin-de-zui-da-zhi" tabindex="-1" id="å¸¦ç´¢å¼•çš„æœ€å¤§å€¼">å¸¦ç´¢å¼•çš„æœ€å¤§å€¼</h3><p>è¿”å›æœ€å¤§å€¼åŠå…¶ä½ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__device__ void warpReduceArgMax(float &amp;val, int &amp;idx) &#123;</span><br><span class="line">    for (int offset = 16; offset &gt; 0; offset /= 2) &#123;</span><br><span class="line">        float other_val = __shfl_down_sync(0xffffffff, val, offset);</span><br><span class="line">        int other_idx = __shfl_down_sync(0xffffffff, idx, offset);</span><br><span class="line">        if (other_val &gt; val) &#123;</span><br><span class="line">            val = other_val;</span><br><span class="line">            idx = other_idx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="dian-ji" tabindex="-1" id="ç‚¹ç§¯">ç‚¹ç§¯</h3><p>ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯ = é€å…ƒç´ ä¹˜æ³• + æ±‚å’Œå½’çº¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__global__ void dotProduct(float *a, float *b, float *result, int n) &#123;</span><br><span class="line">    extern __shared__ float sdata[];</span><br><span class="line">    </span><br><span class="line">    int tid = threadIdx.x;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    float sum = 0;</span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        sum += a[i] * b[i];</span><br><span class="line">        i += blockDim.x * gridDim.x;</span><br><span class="line">    &#125;</span><br><span class="line">    sdata[tid] = sum;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å½’çº¦</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="cub-ku" tabindex="-1" id="CUB-åº“">CUB åº“</h2><h3 id="wei-shi-yao-yong-ku" tabindex="-1" id="ä¸ºä»€ä¹ˆç”¨åº“">ä¸ºä»€ä¹ˆç”¨åº“</h3><p>æ‰‹å†™å½’çº¦å®¹æ˜“å‡ºé”™ï¼Œä¸”éš¾ä»¥è¦†ç›–æ‰€æœ‰ä¼˜åŒ–ã€‚NVIDIA çš„ CUB åº“æä¾›é«˜åº¦ä¼˜åŒ–çš„å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cub/cub.cuh&gt;</span><br><span class="line"></span><br><span class="line">void reduceWithCub(float *d_data, float *d_result, int n) &#123;</span><br><span class="line">    // ç¡®å®šä¸´æ—¶å­˜å‚¨å¤§å°</span><br><span class="line">    void *d_temp = nullptr;</span><br><span class="line">    size_t temp_bytes = 0;</span><br><span class="line">    cub::DeviceReduce::Sum(d_temp, temp_bytes, d_data, d_result, n);</span><br><span class="line">    </span><br><span class="line">    // åˆ†é…ä¸´æ—¶å­˜å‚¨</span><br><span class="line">    cudaMalloc(&amp;d_temp, temp_bytes);</span><br><span class="line">    </span><br><span class="line">    // æ‰§è¡Œå½’çº¦</span><br><span class="line">    cub::DeviceReduce::Sum(d_temp, temp_bytes, d_data, d_result, n);</span><br><span class="line">    </span><br><span class="line">    cudaFree(d_temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cub-ti-gong-de-gui-yue" tabindex="-1" id="CUB-æä¾›çš„å½’çº¦">CUB æä¾›çš„å½’çº¦</h3><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>DeviceReduce::Sum</code></td><td>æ±‚å’Œ</td></tr><tr><td><code>DeviceReduce::Max</code></td><td>æœ€å¤§å€¼</td></tr><tr><td><code>DeviceReduce::Min</code></td><td>æœ€å°å€¼</td></tr><tr><td><code>DeviceReduce::ArgMax</code></td><td>æœ€å¤§å€¼åŠç´¢å¼•</td></tr><tr><td><code>DeviceReduce::ArgMin</code></td><td>æœ€å°å€¼åŠç´¢å¼•</td></tr><tr><td><code>DeviceReduce::Reduce</code></td><td>è‡ªå®šä¹‰æ“ä½œç¬¦</td></tr></tbody></table><h3 id="block-ji-gui-yue" tabindex="-1" id="Block-çº§å½’çº¦">Block çº§å½’çº¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cub/cub.cuh&gt;</span><br><span class="line"></span><br><span class="line">__global__ void myKernel(float *data, float *result) &#123;</span><br><span class="line">    typedef cub::BlockReduce&lt;float, 256&gt; BlockReduce;</span><br><span class="line">    __shared__ typename BlockReduce::TempStorage temp_storage;</span><br><span class="line">    </span><br><span class="line">    float val = data[threadIdx.x];</span><br><span class="line">    float sum = BlockReduce(temp_storage).Sum(val);</span><br><span class="line">    </span><br><span class="line">    if (threadIdx.x == 0) &#123;</span><br><span class="line">        result[blockIdx.x] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬åç« ç³»ç»Ÿè®²è§£äº†å¹¶è¡Œå½’çº¦ï¼š</p><p><strong>æ ‘å½¢å½’çº¦</strong>ï¼šlog N æ­¥å®Œæˆï¼Œä½†æœ´ç´ å®ç°æœ‰ä¸¥é‡çš„åˆ†æ”¯å‘æ•£å’Œ Bank å†²çªã€‚</p><p><strong>äº¤é”™é…å¯¹</strong>ï¼šè®©æ´»è·ƒçº¿ç¨‹è¿ç»­ï¼Œæ¶ˆé™¤ Warp å†…å‘æ•£ã€‚è¿™æ˜¯æœ€å…³é”®çš„ä¼˜åŒ–ã€‚</p><p><strong>é¦–æ¬¡åŠ è½½å½’çº¦</strong>ï¼šGrid-stride loop è®©æ¯çº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ ï¼Œå‡å°‘ Block æ•°å’ŒåŒæ­¥å¼€é”€ã€‚</p><p><strong>å±•å¼€ä¼˜åŒ–</strong>ï¼šåˆ©ç”¨ Warp å†…éšå¼åŒæ­¥ï¼Œæ¶ˆé™¤æœ€åå‡ å±‚çš„ <code>__syncthreads()</code>ã€‚å®Œå…¨å±•å¼€è¿›ä¸€æ­¥æ¶ˆé™¤å¾ªç¯å¼€é”€ã€‚</p><p><strong>Warp Shuffle</strong>ï¼šç°ä»£ GPU çš„åˆ©å™¨ï¼Œç›´æ¥äº¤æ¢å¯„å­˜å™¨ï¼Œæ— éœ€å…±äº«å†…å­˜ã€‚</p><p><strong>åˆ†æ”¯å‘æ•£</strong>ï¼šæŒ‰ Warp è¾¹ç•Œåˆ’åˆ†æ¡ä»¶ï¼Œç”¨ç®—æœ¯æ›¿ä»£åˆ†æ”¯ï¼Œæ˜¯é€šç”¨çš„å‘æ•£æœ€å°åŒ–æŠ€æœ¯ã€‚</p><p><strong>CUB åº“</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¼˜å…ˆä½¿ç”¨åº“ï¼Œå®ƒé›†æˆäº†æ‰€æœ‰ä¼˜åŒ–ä¸”ç»è¿‡å……åˆ†æµ‹è¯•ã€‚</p><p>å½’çº¦æ˜¯å¹¶è¡Œè®¡ç®—çš„åŸºç¡€æ¨¡å¼ï¼Œå·ç§¯çš„è¾¹ç•Œå¤„ç†ã€ç›´æ–¹å›¾çš„æœ€ç»ˆåˆå¹¶ã€ç¥ç»ç½‘ç»œçš„ Softmax éƒ½ç”¨åˆ°ã€‚ä¸‹ä¸€ç« å­¦ä¹ å‰ç¼€å’Œâ€”â€”å¦ä¸€ä¸ªåŸºç¡€ä¸”å¼ºå¤§çš„å¹¶è¡ŒåŸè¯­ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://nvlabs.github.io/cub/">NVIDIA CUB Library</a></li><li>Harris, M. (2007). <em>Optimizing Parallel Reduction in CUDA</em>. NVIDIA Developer Technology.</li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å½’çº¦" scheme="https://smarter.xin/tags/reduction/"/>
    
    <category term="åˆ†æ”¯å‘æ•£" scheme="https://smarter.xin/tags/divergence/"/>
    
    <category term="å¹¶è¡Œç®—æ³•" scheme="https://smarter.xin/tags/parallel-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬ä¹ç« ï¼šå¹¶è¡Œç›´æ–¹å›¾</title>
    <link href="https://smarter.xin/posts/d29973f1/"/>
    <id>https://smarter.xin/posts/d29973f1/</id>
    <published>2026-01-17T12:54:04.000Z</published>
    <updated>2026-01-18T14:12:10.555Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>å‰å‡ ç« å­¦çš„å·ç§¯ã€æ¨¡æ¿éƒ½æ˜¯&quot;è§„åˆ™&quot;çš„å¹¶è¡Œæ¨¡å¼â€”â€”è¾“å‡ºä½ç½®å›ºå®šï¼Œæ¯ä¸ªçº¿ç¨‹çŸ¥é“è‡ªå·±å†™å“ªé‡Œã€‚ä½†å¾ˆå¤šå®é™…é—®é¢˜ä¸æ˜¯è¿™æ ·çš„ï¼Œæ¯”å¦‚<strong>ç›´æ–¹å›¾</strong>ï¼šæ¯ä¸ªè¾“å…¥å…ƒç´ å†³å®šæ›´æ–°å“ªä¸ªè¾“å‡ºæ¡¶ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶æ›´æ–°åŒä¸€ä¸ªæ¡¶ã€‚è¿™å°±æ˜¯<strong>è¾“å‡ºå†²çª</strong>é—®é¢˜ã€‚ç¬¬ä¹ç« è®²è§£å¦‚ä½•ç”¨<strong>åŸå­æ“ä½œ</strong>å’Œ<strong>ç§æœ‰åŒ–</strong>æŠ€æœ¯è§£å†³è¿™ç±»é—®é¢˜ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="zhi-fang-tu-ji-chu" tabindex="-1" id="ç›´æ–¹å›¾åŸºç¡€">ç›´æ–¹å›¾åŸºç¡€</h2><h3 id="shi-yao-shi-zhi-fang-tu" tabindex="-1" id="ä»€ä¹ˆæ˜¯ç›´æ–¹å›¾">ä»€ä¹ˆæ˜¯ç›´æ–¹å›¾</h3><p>ç›´æ–¹å›¾ç»Ÿè®¡æ•°æ®çš„åˆ†å¸ƒã€‚ç»™å®šä¸€ç»„æ•°æ®ï¼Œè®¡ç®—æ¯ä¸ªå€¼ï¼ˆæˆ–åŒºé—´ï¼‰å‡ºç°çš„æ¬¡æ•°ã€‚</p><p><strong>ä¾‹å­</strong>ï¼šç»Ÿè®¡æ–‡æœ¬ä¸­æ¯ä¸ªå­—æ¯çš„å‡ºç°æ¬¡æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;hello world&quot;</span><br><span class="line">è¾“å‡º: h:1, e:1, l:3, o:2, w:1, r:1, d:1, ç©ºæ ¼:1</span><br></pre></td></tr></table></figure><p><strong>å›¾åƒç›´æ–¹å›¾</strong>ï¼šç»Ÿè®¡æ¯ä¸ªç°åº¦å€¼ï¼ˆ0-255ï¼‰çš„åƒç´ æ•°é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 256Ã—256 å›¾åƒ</span><br><span class="line">è¾“å‡º: histogram[256]ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯è¯¥ç°åº¦å€¼çš„åƒç´ è®¡æ•°</span><br></pre></td></tr></table></figure><h3 id="chuan-xing-shi-xian" tabindex="-1" id="ä¸²è¡Œå®ç°">ä¸²è¡Œå®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">histogram_sequential</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *data, <span class="type">int</span> *histogram, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        histogram[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»Ÿè®¡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        histogram[data[i]]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(æ¡¶æ•°)ã€‚</p><h3 id="bing-xing-hua-de-tiao-zhan" tabindex="-1" id="å¹¶è¡ŒåŒ–çš„æŒ‘æˆ˜">å¹¶è¡ŒåŒ–çš„æŒ‘æˆ˜</h3><p>å°è¯•ç›´æ¥å¹¶è¡ŒåŒ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_naive(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        histogram[data[i]]++;  // å±é™©ï¼è¯»-æ”¹-å†™ç«äº‰</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å–åŒä¸€ä¸ª <code>histogram[k]</code>ï¼Œå„è‡ªåŠ  1ï¼Œç„¶åå†™å›ã€‚ç»“æœåªåŠ äº† 1 æ¬¡è€Œä¸æ˜¯å¤šæ¬¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ A: è¯» histogram[5] = 10</span><br><span class="line">çº¿ç¨‹ B: è¯» histogram[5] = 10</span><br><span class="line">çº¿ç¨‹ A: å†™ histogram[5] = 11</span><br><span class="line">çº¿ç¨‹ B: å†™ histogram[5] = 11  // åº”è¯¥æ˜¯ 12ï¼</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯<strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong>ã€‚</p><h2 id="yuan-zi-cao-zuo" tabindex="-1" id="åŸå­æ“ä½œ">åŸå­æ“ä½œ</h2><h3 id="shi-yao-shi-yuan-zi-cao-zuo" tabindex="-1" id="ä»€ä¹ˆæ˜¯åŸå­æ“ä½œ">ä»€ä¹ˆæ˜¯åŸå­æ“ä½œ</h3><p><strong>åŸå­æ“ä½œ</strong>ï¼šä¸å¯åˆ†å‰²çš„æ“ä½œã€‚æ•´ä¸ª&quot;è¯»-æ”¹-å†™&quot;è¿‡ç¨‹è¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ã€‚</p><p>CUDA æä¾›çš„åŸå­å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>æ“ä½œ</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>atomicAdd</code></td><td><code>*addr += val</code></td><td>æ—§å€¼</td></tr><tr><td><code>atomicSub</code></td><td><code>*addr -= val</code></td><td>æ—§å€¼</td></tr><tr><td><code>atomicMax</code></td><td><code>*addr = max()</code></td><td>æ—§å€¼</td></tr><tr><td><code>atomicMin</code></td><td><code>*addr = min()</code></td><td>æ—§å€¼</td></tr><tr><td><code>atomicExch</code></td><td><code>*addr = val</code></td><td>æ—§å€¼</td></tr><tr><td><code>atomicCAS</code></td><td>compare-and-swap</td><td>æ—§å€¼</td></tr><tr><td><code>atomicAnd/Or/Xor</code></td><td>ä½æ“ä½œ</td><td>æ—§å€¼</td></tr></tbody></table><h3 id="shi-yong-yuan-zi-cao-zuo-de-zhi-fang-tu" tabindex="-1" id="ä½¿ç”¨åŸå­æ“ä½œçš„ç›´æ–¹å›¾">ä½¿ç”¨åŸå­æ“ä½œçš„ç›´æ–¹å›¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_atomic(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        atomicAdd(&amp;histogram[data[i]], 1);  // åŸå­åŠ </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­£ç¡®æ€§ä¿è¯</strong>ï¼š<code>atomicAdd</code> ç¡®ä¿æ¯æ¬¡å¢é‡éƒ½è¢«æ­£ç¡®è®¡å…¥ã€‚</p><h3 id="yuan-zi-cao-zuo-de-kai-xiao" tabindex="-1" id="åŸå­æ“ä½œçš„å¼€é”€">åŸå­æ“ä½œçš„å¼€é”€</h3><p>åŸå­æ“ä½œæ¯”æ™®é€šæ“ä½œæ…¢å¾—å¤šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ™®é€šå†™å…¥ï¼š~4 å‘¨æœŸ</span><br><span class="line">åŸå­æ“ä½œï¼š~æ•°ç™¾å‘¨æœŸï¼ˆå–å†³äºäº‰ç”¨ç¨‹åº¦ï¼‰</span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼š</p><ol><li><strong>ä¸²è¡ŒåŒ–</strong>ï¼šåŒä¸€åœ°å€çš„åŸå­æ“ä½œå¿…é¡»æ’é˜Ÿæ‰§è¡Œ</li><li><strong>ç¼“å­˜ä¸€è‡´æ€§</strong>ï¼šéœ€è¦åè°ƒå¤šä¸ª SM çš„ç¼“å­˜</li><li><strong>å†…å­˜äº‹åŠ¡</strong>ï¼šéœ€è¦å¾€è¿”å…¨å±€å†…å­˜</li></ol><p><strong>äº‰ç”¨ç¨‹åº¦</strong>å½±å“å¾ˆå¤§ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>æ¡¶æ•°</th><th>äº‰ç”¨ç¨‹åº¦</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>å­—æ¯ç»Ÿè®¡</td><td>26</td><td>æé«˜</td><td>å¾ˆæ…¢</td></tr><tr><td>ç°åº¦ç›´æ–¹å›¾</td><td>256</td><td>é«˜</td><td>è¾ƒæ…¢</td></tr><tr><td>é¢œè‰²ç›´æ–¹å›¾</td><td>16M</td><td>ä½</td><td>æ¥è¿‘å³°å€¼</td></tr></tbody></table><p>æ¡¶è¶Šå¤šï¼Œäº‰ç”¨è¶Šä½ï¼Œæ€§èƒ½è¶Šå¥½ã€‚</p><h2 id="si-you-hua-privatization" tabindex="-1" id="ç§æœ‰åŒ–ï¼ˆPrivatizationï¼‰">ç§æœ‰åŒ–ï¼ˆPrivatizationï¼‰</h2><h3 id="he-xin-si-xiang" tabindex="-1" id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3><p><strong>ç§æœ‰åŒ–</strong>ï¼šæ¯ä¸ªçº¿ç¨‹/å—ç»´æŠ¤è‡ªå·±çš„ç§æœ‰ç›´æ–¹å›¾ï¼Œæœ€ååˆå¹¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸæœ¬ï¼šæ‰€æœ‰çº¿ç¨‹ â†’ å…¨å±€ç›´æ–¹å›¾ï¼ˆé«˜äº‰ç”¨ï¼‰</span><br><span class="line">ç§æœ‰åŒ–ï¼š</span><br><span class="line">  çº¿ç¨‹/å— â†’ ç§æœ‰ç›´æ–¹å›¾ï¼ˆæ— äº‰ç”¨ï¼‰</span><br><span class="line">  æœ€åï¼šç§æœ‰ç›´æ–¹å›¾ â†’ å…¨å±€ç›´æ–¹å›¾ï¼ˆä¸€æ¬¡æ€§åˆå¹¶ï¼‰</span><br></pre></td></tr></table></figure><h3 id="gong-xiang-nei-cun-si-you-hua" tabindex="-1" id="å…±äº«å†…å­˜ç§æœ‰åŒ–">å…±äº«å†…å­˜ç§æœ‰åŒ–</h3><p>æ¯ä¸ª Block ç”¨å…±äº«å†…å­˜ç»´æŠ¤ç§æœ‰ç›´æ–¹å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#define NUM_BINS 256</span><br><span class="line"></span><br><span class="line">__global__ void histogram_privatized(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    // ç§æœ‰ç›´æ–¹å›¾ï¼ˆå…±äº«å†…å­˜ï¼‰</span><br><span class="line">    __shared__ int private_hist[NUM_BINS];</span><br><span class="line">    </span><br><span class="line">    // åˆå§‹åŒ–ç§æœ‰ç›´æ–¹å›¾</span><br><span class="line">    if (threadIdx.x &lt; NUM_BINS) &#123;</span><br><span class="line">        private_hist[threadIdx.x] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ç»Ÿè®¡åˆ°ç§æœ‰ç›´æ–¹å›¾</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int stride = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        atomicAdd(&amp;private_hist[data[i]], 1);  // å…±äº«å†…å­˜åŸå­æ“ä½œ</span><br><span class="line">        i += stride;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶åˆ°å…¨å±€ç›´æ–¹å›¾</span><br><span class="line">    if (threadIdx.x &lt; NUM_BINS) &#123;</span><br><span class="line">        atomicAdd(&amp;histogram[threadIdx.x], private_hist[threadIdx.x]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wei-shi-yao-geng-kuai" tabindex="-1" id="ä¸ºä»€ä¹ˆæ›´å¿«">ä¸ºä»€ä¹ˆæ›´å¿«</h3><p><strong>å…±äº«å†…å­˜åŸå­æ“ä½œæ¯”å…¨å±€å†…å­˜å¿«å¾—å¤š</strong>ï¼š</p><table><thead><tr><th>æ“ä½œä½ç½®</th><th>å»¶è¿Ÿ</th><th>å¸¦å®½</th></tr></thead><tbody><tr><td>å…¨å±€å†…å­˜</td><td>~400 å‘¨æœŸ</td><td>~500 GB/s</td></tr><tr><td>å…±äº«å†…å­˜</td><td>~20 å‘¨æœŸ</td><td>~10 TB/s</td></tr></tbody></table><p>åŠ é€Ÿæ¯”çº¦ 20 å€ï¼ˆç†æƒ³æƒ…å†µï¼‰ã€‚</p><p><strong>äº‰ç”¨ä¹Ÿå‡å°‘</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸæœ¬ï¼šæ‰€æœ‰çº¿ç¨‹äº‰ç”¨åŒä¸€ä¸ªå…¨å±€ç›´æ–¹å›¾</span><br><span class="line">ç§æœ‰åŒ–ï¼š</span><br><span class="line">  - Block å†…çº¿ç¨‹äº‰ç”¨ç§æœ‰ç›´æ–¹å›¾ï¼ˆå…±äº«å†…å­˜ï¼Œå¿«ï¼‰</span><br><span class="line">  - Block é—´åˆå¹¶æ—¶äº‰ç”¨å…¨å±€ç›´æ–¹å›¾ï¼ˆä½†åªæœ‰ gridDim æ¬¡ï¼‰</span><br></pre></td></tr></table></figure><h3 id="fen-jie-duan-fen-xi" tabindex="-1" id="åˆ†é˜¶æ®µåˆ†æ">åˆ†é˜¶æ®µåˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é˜¶æ®µ 1ï¼ˆåˆå§‹åŒ–ï¼‰ï¼šNUM_BINS æ¬¡å†™å…¥å…±äº«å†…å­˜</span><br><span class="line">é˜¶æ®µ 2ï¼ˆç§æœ‰ç»Ÿè®¡ï¼‰ï¼šn/gridDim æ¬¡å…±äº«å†…å­˜åŸå­æ“ä½œ</span><br><span class="line">é˜¶æ®µ 3ï¼ˆåˆå¹¶ï¼‰ï¼šNUM_BINS æ¬¡å…¨å±€å†…å­˜åŸå­æ“ä½œ</span><br></pre></td></tr></table></figure><p>å…¨å±€åŸå­æ“ä½œä» n æ¬¡é™åˆ° NUM_BINS Ã— gridDim æ¬¡ï¼Œå¤§å¹…å‡å°‘ã€‚</p><h2 id="xian-cheng-cu-hua" tabindex="-1" id="çº¿ç¨‹ç²—åŒ–">çº¿ç¨‹ç²—åŒ–</h2><h3 id="grid-stride-loop" tabindex="-1" id="Grid-Stride-Loop">Grid-Stride Loop</h3><p>ä¹‹å‰ä»£ç å·²ç»ç”¨äº† grid-stride loopï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">int stride = blockDim.x * gridDim.x;</span><br><span class="line"></span><br><span class="line">while (i &lt; n) &#123;</span><br><span class="line">    // å¤„ç†å…ƒç´  i</span><br><span class="line">    i += stride;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ol><li>æ¯ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ ï¼Œåˆ†æ‘Šå¼€é”€</li><li>Grid å¤§å°å¯ä»¥å›ºå®šï¼Œä¸éšæ•°æ®é‡å˜åŒ–</li><li>æ›´å¥½çš„ç¼“å­˜åˆ©ç”¨</li></ol><h3 id="lian-xu-fang-wen-you-hua" tabindex="-1" id="è¿ç»­è®¿é—®ä¼˜åŒ–">è¿ç»­è®¿é—®ä¼˜åŒ–</h3><p>è®©æ¯ä¸ªçº¿ç¨‹å¤„ç†è¿ç»­çš„ä¸€æ®µæ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_coarsened(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    __shared__ int private_hist[NUM_BINS];</span><br><span class="line">    </span><br><span class="line">    // åˆå§‹åŒ–</span><br><span class="line">    for (int i = threadIdx.x; i &lt; NUM_BINS; i += blockDim.x) &#123;</span><br><span class="line">        private_hist[i] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // æ¯çº¿ç¨‹å¤„ç†è¿ç»­çš„ COARSEN_FACTOR ä¸ªå…ƒç´ </span><br><span class="line">    int base = (blockIdx.x * blockDim.x + threadIdx.x) * COARSEN_FACTOR;</span><br><span class="line">    </span><br><span class="line">    for (int k = 0; k &lt; COARSEN_FACTOR; k++) &#123;</span><br><span class="line">        int idx = base + k;</span><br><span class="line">        if (idx &lt; n) &#123;</span><br><span class="line">            atomicAdd(&amp;private_hist[data[idx]], 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶</span><br><span class="line">    for (int i = threadIdx.x; i &lt; NUM_BINS; i += blockDim.x) &#123;</span><br><span class="line">        atomicAdd(&amp;histogram[i], private_hist[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šè¿ç»­è®¿é—®åˆ©äºå†…å­˜åˆå¹¶ã€‚</p><h2 id="ju-he-aggregation" tabindex="-1" id="èšåˆï¼ˆAggregationï¼‰">èšåˆï¼ˆAggregationï¼‰</h2><h3 id="wen-ti" tabindex="-1" id="é—®é¢˜">é—®é¢˜</h3><p>å³ä½¿ç”¨äº†å…±äº«å†…å­˜ç§æœ‰åŒ–ï¼ŒåŒä¸€ Warp å†…çš„çº¿ç¨‹å¯èƒ½é¢‘ç¹äº‰ç”¨åŒä¸€ä¸ªæ¡¶ã€‚</p><p><strong>ä¾‹å­</strong>ï¼šå¤„ç†å…¨é»‘å›¾åƒï¼ˆæ‰€æœ‰åƒç´ å€¼éƒ½æ˜¯ 0ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">32 ä¸ªçº¿ç¨‹åŒæ—¶ atomicAdd(&amp;private_hist[0], 1)</span><br><span class="line">â†’ 32 æ¬¡ä¸²è¡ŒåŒ–çš„åŸå­æ“ä½œ</span><br></pre></td></tr></table></figure><h3 id="jie-jue-fang-an-warp-ji-ju-he" tabindex="-1" id="è§£å†³æ–¹æ¡ˆï¼šWarp-çº§èšåˆ">è§£å†³æ–¹æ¡ˆï¼šWarp çº§èšåˆ</h3><p>å…ˆåœ¨ Warp å†…ç»Ÿè®¡æ¯ä¸ªå€¼å‡ºç°å¤šå°‘æ¬¡ï¼Œå†åšä¸€æ¬¡åŸå­æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_aggregated(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    __shared__ int private_hist[NUM_BINS];</span><br><span class="line">    </span><br><span class="line">    // åˆå§‹åŒ–</span><br><span class="line">    if (threadIdx.x &lt; NUM_BINS) &#123;</span><br><span class="line">        private_hist[threadIdx.x] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        unsigned char value = data[i];</span><br><span class="line">        </span><br><span class="line">        // Warp çº§æŠ•ç¥¨ï¼šæ‰¾å‡ºåŒå€¼çº¿ç¨‹</span><br><span class="line">        unsigned int mask = __match_any_sync(__activemask(), value);</span><br><span class="line">        </span><br><span class="line">        // åªæœ‰ç»„å†…ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŸå­æ“ä½œ</span><br><span class="line">        if (__ffs(mask) - 1 == (threadIdx.x % 32)) &#123;</span><br><span class="line">            atomicAdd(&amp;private_hist[value], __popc(mask));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶åˆ°å…¨å±€</span><br><span class="line">    if (threadIdx.x &lt; NUM_BINS) &#123;</span><br><span class="line">        atomicAdd(&amp;histogram[threadIdx.x], private_hist[threadIdx.x]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="warp-ji-yuan-yu" tabindex="-1" id="Warp-çº§åŸè¯­">Warp çº§åŸè¯­</h3><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>__match_any_sync</code></td><td>è¿”å›å€¼ç›¸åŒçš„çº¿ç¨‹æ©ç </td></tr><tr><td><code>__ffs</code></td><td>æ‰¾ç¬¬ä¸€ä¸ªç½®ä½çš„ä½ï¼ˆfind first setï¼‰</td></tr><tr><td><code>__popc</code></td><td>ç»Ÿè®¡ç½®ä½çš„ä½æ•°ï¼ˆpopulation countï¼‰</td></tr><tr><td><code>__activemask</code></td><td>å½“å‰æ´»è·ƒçº¿ç¨‹æ©ç </td></tr></tbody></table><p><strong><code>__match_any_sync</code> ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ 0-7 çš„å€¼ï¼š[5, 3, 5, 5, 2, 3, 5, 2]</span><br><span class="line">__match_any_sync è¿”å›ï¼š</span><br><span class="line">  çº¿ç¨‹ 0,2,3,6 è¿”å› 0b01001101ï¼ˆå€¼=5 çš„æ©ç ï¼‰</span><br><span class="line">  çº¿ç¨‹ 1,5 è¿”å› 0b00100010ï¼ˆå€¼=3 çš„æ©ç ï¼‰</span><br><span class="line">  çº¿ç¨‹ 4,7 è¿”å› 0b10010000ï¼ˆå€¼=2 çš„æ©ç ï¼‰</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœ</strong>ï¼šåŸå­æ“ä½œæ¬¡æ•°ä» 32 æ¬¡é™åˆ° 3 æ¬¡ï¼ˆä¸åŒå€¼çš„æ•°é‡ï¼‰ã€‚</p><h2 id="wan-zheng-you-hua-ban-ben" tabindex="-1" id="å®Œæ•´ä¼˜åŒ–ç‰ˆæœ¬">å®Œæ•´ä¼˜åŒ–ç‰ˆæœ¬</h2><h3 id="zong-he-suo-you-you-hua" tabindex="-1" id="ç»¼åˆæ‰€æœ‰ä¼˜åŒ–">ç»¼åˆæ‰€æœ‰ä¼˜åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#define BLOCK_SIZE 256</span><br><span class="line">#define NUM_BINS 256</span><br><span class="line">#define COARSEN_FACTOR 4</span><br><span class="line"></span><br><span class="line">__global__ void histogram_optimized(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    // å…±äº«å†…å­˜ç§æœ‰ç›´æ–¹å›¾</span><br><span class="line">    __shared__ int private_hist[NUM_BINS];</span><br><span class="line">    </span><br><span class="line">    // åä½œåˆå§‹åŒ–</span><br><span class="line">    for (int i = threadIdx.x; i &lt; NUM_BINS; i += blockDim.x) &#123;</span><br><span class="line">        private_hist[i] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // Grid-stride loop + ç²—åŒ–</span><br><span class="line">    int tid = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int stride = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    for (int base = tid * COARSEN_FACTOR; base &lt; n; base += stride * COARSEN_FACTOR) &#123;</span><br><span class="line">        // åŠ è½½è¿ç»­çš„ COARSEN_FACTOR ä¸ªå…ƒç´ </span><br><span class="line">        unsigned char values[COARSEN_FACTOR];</span><br><span class="line">        </span><br><span class="line">        #pragma unroll</span><br><span class="line">        for (int k = 0; k &lt; COARSEN_FACTOR; k++) &#123;</span><br><span class="line">            int idx = base + k;</span><br><span class="line">            values[k] = (idx &lt; n) ? data[idx] : 0xFF;  // 0xFF ä½œä¸ºæ— æ•ˆæ ‡è®°</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // é€ä¸ªå¤„ç†ï¼Œä½¿ç”¨ warp èšåˆ</span><br><span class="line">        #pragma unroll</span><br><span class="line">        for (int k = 0; k &lt; COARSEN_FACTOR; k++) &#123;</span><br><span class="line">            if (values[k] != 0xFF) &#123;</span><br><span class="line">                unsigned int mask = __match_any_sync(__activemask(), values[k]);</span><br><span class="line">                if (__ffs(mask) - 1 == (threadIdx.x % 32)) &#123;</span><br><span class="line">                    atomicAdd(&amp;private_hist[values[k]], __popc(mask));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶åˆ°å…¨å±€ç›´æ–¹å›¾</span><br><span class="line">    for (int i = threadIdx.x; i &lt; NUM_BINS; i += blockDim.x) &#123;</span><br><span class="line">        if (private_hist[i] &gt; 0) &#123;</span><br><span class="line">            atomicAdd(&amp;histogram[i], private_hist[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="qi-dong-pei-zhi" tabindex="-1" id="å¯åŠ¨é…ç½®">å¯åŠ¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int numBlocks = (n + BLOCK_SIZE * COARSEN_FACTOR - 1) / (BLOCK_SIZE * COARSEN_FACTOR);</span><br><span class="line">numBlocks = min(numBlocks, 256);  // é™åˆ¶ block æ•°é‡</span><br><span class="line"></span><br><span class="line">histogram_optimized&lt;&lt;&lt;numBlocks, BLOCK_SIZE&gt;&gt;&gt;(d_data, d_histogram, n);</span><br></pre></td></tr></table></figure><h3 id="xing-neng-dui-bi" tabindex="-1" id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h3><p>ä»¥ 1920Ã—1080 å›¾åƒï¼ˆ~200 ä¸‡åƒç´ ï¼‰ä¸ºä¾‹ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>ç›¸å¯¹æ€§èƒ½</th><th>ç“¶é¢ˆ</th></tr></thead><tbody><tr><td>æœ´ç´ å…¨å±€åŸå­</td><td>1Ã—</td><td>å…¨å±€å†…å­˜äº‰ç”¨</td></tr><tr><td>ç§æœ‰åŒ–</td><td>10Ã—</td><td>å…±äº«å†…å­˜åŸå­</td></tr><tr><td>+ ç²—åŒ–</td><td>15Ã—</td><td>åŸå­æ“ä½œ</td></tr><tr><td>+ èšåˆ</td><td>25Ã—</td><td>æ¥è¿‘å¸¦å®½ä¸Šé™</td></tr></tbody></table><h2 id="qi-ta-si-you-hua-ce-lue" tabindex="-1" id="å…¶ä»–ç§æœ‰åŒ–ç­–ç•¥">å…¶ä»–ç§æœ‰åŒ–ç­–ç•¥</h2><h3 id="xian-cheng-ji-si-you-hua" tabindex="-1" id="çº¿ç¨‹çº§ç§æœ‰åŒ–">çº¿ç¨‹çº§ç§æœ‰åŒ–</h3><p>å¦‚æœæ¡¶æ•°å¾ˆå°‘ï¼ˆå¦‚ 8 ä¸ªï¼‰ï¼Œå¯ä»¥ç”¨å¯„å­˜å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_register(unsigned char *data, int *histogram, int n) &#123;</span><br><span class="line">    // æ¯çº¿ç¨‹ç§æœ‰ç›´æ–¹å›¾ï¼ˆå¯„å­˜å™¨ï¼‰</span><br><span class="line">    int local_hist[8] = &#123;0&#125;;</span><br><span class="line">    </span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int stride = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        int bin = data[i] % 8;  // å‡è®¾åªæœ‰ 8 ä¸ªæ¡¶</span><br><span class="line">        local_hist[bin]++;</span><br><span class="line">        i += stride;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶åˆ°å…¨å±€</span><br><span class="line">    for (int b = 0; b &lt; 8; b++) &#123;</span><br><span class="line">        atomicAdd(&amp;histogram[b], local_hist[b]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šå¯„å­˜å™¨æœ€å¿«ï¼Œæ— äº‰ç”¨ã€‚</p><p><strong>é™åˆ¶</strong>ï¼šæ¡¶æ•°å¿…é¡»å¾ˆå°‘ï¼ˆå¯„å­˜å™¨æ•°é‡æœ‰é™ï¼‰ã€‚</p><h3 id="duo-ji-si-you-hua" tabindex="-1" id="å¤šçº§ç§æœ‰åŒ–">å¤šçº§ç§æœ‰åŒ–</h3><p>å¯¹äºå¤§æ¡¶æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯„å­˜å™¨ï¼ˆæå°‘æ¡¶ï¼‰â†’ å…±äº«å†…å­˜ï¼ˆä¸­ç­‰æ¡¶ï¼‰â†’ å…¨å±€å†…å­˜ï¼ˆå¤§æ¡¶æ•°ï¼‰</span><br></pre></td></tr></table></figure><p>æ¯çº§å®¹é‡é€’å¢ï¼Œé€Ÿåº¦é€’å‡ã€‚</p><h2 id="yuan-zi-cao-zuo-de-ying-jian-zhi-chi" tabindex="-1" id="åŸå­æ“ä½œçš„ç¡¬ä»¶æ”¯æŒ">åŸå­æ“ä½œçš„ç¡¬ä»¶æ”¯æŒ</h2><h3 id="zhi-chi-de-shu-ju-lei-xing" tabindex="-1" id="æ”¯æŒçš„æ•°æ®ç±»å‹">æ”¯æŒçš„æ•°æ®ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>åŸå­æ“ä½œæ”¯æŒ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>int</td><td>å…¨éƒ¨</td><td>æœ€å¸¸ç”¨</td></tr><tr><td>unsigned</td><td>å…¨éƒ¨</td><td></td></tr><tr><td>float</td><td>atomicAdd</td><td>Kepler+ (CC 3.0)</td></tr><tr><td>double</td><td>atomicAdd</td><td>Pascal+ (CC 6.0)</td></tr><tr><td>half</td><td>atomicAdd</td><td>Volta+ (CC 7.0)</td></tr></tbody></table><h3 id="gong-xiang-nei-cun-vs-quan-ju-nei-cun-yuan-zi" tabindex="-1" id="å…±äº«å†…å­˜-vs-å…¨å±€å†…å­˜åŸå­">å…±äº«å†…å­˜ vs å…¨å±€å†…å­˜åŸå­</h3><table><thead><tr><th>ç‰¹æ€§</th><th>å…±äº«å†…å­˜åŸå­</th><th>å…¨å±€å†…å­˜åŸå­</th></tr></thead><tbody><tr><td>å»¶è¿Ÿ</td><td>~20 å‘¨æœŸ</td><td>~400 å‘¨æœŸ</td></tr><tr><td>å¸¦å®½</td><td>é«˜</td><td>ä½</td></tr><tr><td>äº‰ç”¨èŒƒå›´</td><td>Block å†…</td><td>å…¨è®¾å¤‡</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¸­é—´ç»“æœ</td><td>æœ€ç»ˆç»“æœ</td></tr></tbody></table><h3 id="yuan-zi-cao-zuo-shi-xian-yuan-li" tabindex="-1" id="åŸå­æ“ä½œå®ç°åŸç†">åŸå­æ“ä½œå®ç°åŸç†</h3><p><strong>Compare-And-Swap (CAS)</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// atomicAdd çš„æœ¬è´¨å®ç°</span><br><span class="line">__device__ int atomicAdd_manual(int *addr, int val) &#123;</span><br><span class="line">    int old = *addr, assumed;</span><br><span class="line">    do &#123;</span><br><span class="line">        assumed = old;</span><br><span class="line">        old = atomicCAS(addr, assumed, assumed + val);</span><br><span class="line">    &#125; while (old != assumed);</span><br><span class="line">    return old;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ªç¯ç›´åˆ°æˆåŠŸâ€”â€”é«˜äº‰ç”¨æ—¶å¯èƒ½å¾ªç¯å¾ˆå¤šæ¬¡ã€‚</p><h2 id="ying-yong-kuo-zhan" tabindex="-1" id="åº”ç”¨æ‰©å±•">åº”ç”¨æ‰©å±•</h2><h3 id="duo-tong-dao-zhi-fang-tu" tabindex="-1" id="å¤šé€šé“ç›´æ–¹å›¾">å¤šé€šé“ç›´æ–¹å›¾</h3><p>RGB å›¾åƒçš„ä¸‰é€šé“ç›´æ–¹å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__global__ void histogram_rgb(unsigned char *image, int *hist_r, int *hist_g, int *hist_b, int n) &#123;</span><br><span class="line">    __shared__ int priv_r[256], priv_g[256], priv_b[256];</span><br><span class="line">    </span><br><span class="line">    // åˆå§‹åŒ–</span><br><span class="line">    // ...</span><br><span class="line">    </span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        atomicAdd(&amp;priv_r[image[3*i + 0]], 1);</span><br><span class="line">        atomicAdd(&amp;priv_g[image[3*i + 1]], 1);</span><br><span class="line">        atomicAdd(&amp;priv_b[image[3*i + 2]], 1);</span><br><span class="line">    &#125;</span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="jia-quan-zhi-fang-tu" tabindex="-1" id="åŠ æƒç›´æ–¹å›¾">åŠ æƒç›´æ–¹å›¾</h3><p>æ¯ä¸ªæ•°æ®ç‚¹æœ‰æƒé‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atomicAdd(&amp;histogram[data[i]], weight[i]);</span><br></pre></td></tr></table></figure><p>ç”¨äºç›´æ–¹å›¾å‡è¡¡åŒ–ç­‰åœºæ™¯ã€‚</p><h3 id="er-wei-zhi-fang-tu" tabindex="-1" id="äºŒç»´ç›´æ–¹å›¾">äºŒç»´ç›´æ–¹å›¾</h3><p>ç»Ÿè®¡ä¸¤ä¸ªå˜é‡çš„è”åˆåˆ†å¸ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int bin_x = data_x[i] / bin_width_x;</span><br><span class="line">int bin_y = data_y[i] / bin_width_y;</span><br><span class="line">int bin = bin_y * num_bins_x + bin_x;</span><br><span class="line">atomicAdd(&amp;histogram_2d[bin], 1);</span><br></pre></td></tr></table></figure><h2 id="xing-neng-diao-you-jian-yi" tabindex="-1" id="æ€§èƒ½è°ƒä¼˜å»ºè®®">æ€§èƒ½è°ƒä¼˜å»ºè®®</h2><h3 id="xuan-ze-ce-lue" tabindex="-1" id="é€‰æ‹©ç­–ç•¥">é€‰æ‹©ç­–ç•¥</h3><table><thead><tr><th>æ¡¶æ•°</th><th>æ¨èç­–ç•¥</th></tr></thead><tbody><tr><td>&lt; 16</td><td>å¯„å­˜å™¨ç§æœ‰åŒ–</td></tr><tr><td>16 - 1024</td><td>å…±äº«å†…å­˜ç§æœ‰åŒ– + èšåˆ</td></tr><tr><td>&gt; 1024</td><td>ç›´æ¥å…¨å±€åŸå­ï¼ˆäº‰ç”¨ä½ï¼‰</td></tr></tbody></table><h3 id="guan-jian-can-shu" tabindex="-1" id="å…³é”®å‚æ•°">å…³é”®å‚æ•°</h3><p><strong>Block å¤§å°</strong>ï¼š256 æˆ– 512ï¼Œä¿è¯è¶³å¤Ÿçš„å¹¶è¡Œåº¦ã€‚</p><p><strong>ç²—åŒ–å› å­</strong>ï¼š4-16ï¼Œå¹³è¡¡å¯„å­˜å™¨å‹åŠ›å’Œè®¡ç®—ç²’åº¦ã€‚</p><p><strong>Grid å¤§å°</strong>ï¼šä¸è¦å¤ªå¤§ï¼Œå¦åˆ™åˆå¹¶é˜¶æ®µå¼€é”€å¢åŠ ã€‚</p><h3 id="nsight-zhi-biao" tabindex="-1" id="Nsight-æŒ‡æ ‡">Nsight æŒ‡æ ‡</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th><th>ç›®æ ‡</th></tr></thead><tbody><tr><td>Atomic Operations</td><td>åŸå­æ“ä½œæ•°</td><td>è¶Šå°‘è¶Šå¥½</td></tr><tr><td>Shared Memory Bandwidth</td><td>å…±äº«å†…å­˜å¸¦å®½</td><td>æ¥è¿‘å³°å€¼</td></tr><tr><td>Warp Efficiency</td><td>Warp åˆ©ç”¨ç‡</td><td>&gt; 90%</td></tr></tbody></table><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬ä¹ç« è§£å†³äº†&quot;è¾“å‡ºå†²çª&quot;é—®é¢˜ï¼š</p><p><strong>åŸå­æ“ä½œ</strong>ï¼šä¿è¯&quot;è¯»-æ”¹-å†™&quot;çš„åŸå­æ€§ï¼Œè§£å†³ç«æ€æ¡ä»¶ã€‚ä½†å…¨å±€å†…å­˜åŸå­æ“ä½œå¾ˆæ…¢ï¼Œå°¤å…¶åœ¨é«˜äº‰ç”¨æ—¶ã€‚</p><p><strong>ç§æœ‰åŒ–</strong>ï¼šæ¯ä¸ª Block ç”¨å…±äº«å†…å­˜ç»´æŠ¤ç§æœ‰å‰¯æœ¬ï¼Œæœ€ååˆå¹¶ã€‚å…±äº«å†…å­˜åŸå­æ¯”å…¨å±€å¿« 20 å€ï¼Œäº‰ç”¨ä¹Ÿè¢«é™åˆ¶åœ¨ Block å†…ã€‚</p><p><strong>çº¿ç¨‹ç²—åŒ–</strong>ï¼šæ¯çº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ ï¼Œåˆ†æ‘Šåˆå§‹åŒ–å’Œåˆå¹¶å¼€é”€ã€‚Grid-stride loop æ˜¯é€šç”¨æ¨¡å¼ã€‚</p><p><strong>Warp èšåˆ</strong>ï¼šç”¨ <code>__match_any_sync</code> æ‰¾åŒå€¼çº¿ç¨‹ï¼Œåªåšä¸€æ¬¡åŸå­æ“ä½œã€‚åœ¨æ•°æ®é‡å¤ç‡é«˜æ—¶æ•ˆæœæ˜¾è‘—ã€‚</p><p><strong>ç­–ç•¥é€‰æ‹©</strong>ï¼šæ¡¶æ•°å†³å®šç­–ç•¥â€”â€”å°‘æ¡¶ç”¨å¯„å­˜å™¨ï¼Œä¸­æ¡¶ç”¨å…±äº«å†…å­˜ï¼Œå¤šæ¡¶ç›´æ¥å…¨å±€åŸå­ã€‚</p><p>ç›´æ–¹å›¾æ˜¯&quot;å½’çº¦åˆ°å¤šä¸ªç›®æ ‡&quot;çš„å…¸å‹ä»£è¡¨ã€‚åŸå­æ“ä½œå’Œç§æœ‰åŒ–æŠ€æœ¯ä¹Ÿé€‚ç”¨äºå…¶ä»–ç±»ä¼¼é—®é¢˜ï¼šæ•£å°„ï¼ˆscatterï¼‰ã€åˆ†ç»„èšåˆã€å“ˆå¸Œè¡¨æ„å»ºç­‰ã€‚ä¸‹ä¸€ç« å°†å­¦ä¹ å¦ä¸€ä¸ªé‡è¦æ¨¡å¼â€”â€”å½’çº¦ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#atomic-functions">CUDA C++ Programming Guide - Atomic Functions</a></li><li><a href="https://developer.nvidia.com/blog/faster-parallel-reductions-kepler/">NVIDIA Developer Blog - Faster Parallel Reductions</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="ç›´æ–¹å›¾" scheme="https://smarter.xin/tags/histogram/"/>
    
    <category term="åŸå­æ“ä½œ" scheme="https://smarter.xin/tags/atomic-operations/"/>
    
    <category term="ç§æœ‰åŒ–" scheme="https://smarter.xin/tags/privatization/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬å…«ç« ï¼šæ¨¡æ¿</title>
    <link href="https://smarter.xin/posts/93c68d7a/"/>
    <id>https://smarter.xin/posts/93c68d7a/</id>
    <published>2026-01-17T09:15:06.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬ä¸ƒç« å­¦äº†å·ç§¯ï¼Œè¿™ç« å­¦æ¨¡æ¿ï¼ˆStencilï¼‰ã€‚ä½ å¯èƒ½ä¼šé—®ï¼šè¿™ä¿©ä¸æ˜¯å·®ä¸å¤šå—ï¼Ÿç¡®å®å¾ˆåƒï¼Œä½†æœ‰å¾®å¦™åŒºåˆ«ã€‚<strong>å·ç§¯</strong>å¼ºè°ƒçš„æ˜¯ä¿¡å·å¤„ç†ä¸­çš„æ»‘åŠ¨åŠ æƒå’Œï¼Œæƒé‡æ¥è‡ªæ»¤æ³¢å™¨ï¼›<strong>æ¨¡æ¿</strong>å¼ºè°ƒçš„æ˜¯ç§‘å­¦è®¡ç®—ä¸­çš„é‚»åŸŸæ›´æ–°ï¼Œæ¯”å¦‚ PDE æ±‚è§£ã€ç‰©ç†ä»¿çœŸã€‚ä» CUDA ä¼˜åŒ–è§’åº¦çœ‹ï¼ŒæŠ€æœ¯æ˜¯ç›¸é€šçš„ï¼Œä½†æ¨¡æ¿è®¡ç®—æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼šé€šå¸¸æ˜¯<strong>å¤šæ¬¡è¿­ä»£</strong>çš„ï¼Œéœ€è¦å¤„ç†<strong>æ—¶é—´æ­¥è¿›</strong>å’Œ<strong>æ•°æ®äº¤æ¢</strong>ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="mo-ban-ji-suan-ji-chu" tabindex="-1" id="æ¨¡æ¿è®¡ç®—åŸºç¡€">æ¨¡æ¿è®¡ç®—åŸºç¡€</h2><h3 id="shi-yao-shi-mo-ban-ji-suan" tabindex="-1" id="ä»€ä¹ˆæ˜¯æ¨¡æ¿è®¡ç®—">ä»€ä¹ˆæ˜¯æ¨¡æ¿è®¡ç®—</h3><p>æ¨¡æ¿è®¡ç®—ï¼ˆStencil Computationï¼‰ï¼šç”¨<strong>å›ºå®šçš„é‚»åŸŸæ¨¡å¼</strong>æ›´æ–°ç½‘æ ¼ä¸­çš„æ¯ä¸ªç‚¹ã€‚</p><p><strong>ä¸€ç»´çƒ­ä¼ å¯¼</strong>ï¼ˆæœ€ç®€å•çš„ä¾‹å­ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é—´ t:    [..., A, B, C, ...]</span><br><span class="line">æ—¶é—´ t+1:       B&#x27; = (A + B + C) / 3</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªç‚¹çš„æ–°å€¼æ˜¯è‡ªå·±å’Œé‚»å±…çš„åŠ æƒå¹³å‡ã€‚è¿™å°±æ˜¯æ¨¡æ¿ï¼šä¸€ä¸ªæè¿°&quot;å¦‚ä½•ä»é‚»å±…è®¡ç®—è‡ªå·±&quot;çš„æ¨¡å¼ã€‚</p><h3 id="mo-ban-de-xing-zhuang" tabindex="-1" id="æ¨¡æ¿çš„å½¢çŠ¶">æ¨¡æ¿çš„å½¢çŠ¶</h3><p>å¸¸è§çš„æ¨¡æ¿å½¢çŠ¶ï¼š</p><p><strong>1D ä¸‰ç‚¹æ¨¡æ¿</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ -1  0  +1 ]</span><br><span class="line">   â†“  â†“  â†“</span><br><span class="line">   A  B  C</span><br></pre></td></tr></table></figure><p><strong>2D äº”ç‚¹æ¨¡æ¿ï¼ˆå†¯Â·è¯ºä¾æ›¼é‚»åŸŸï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       [0,-1]</span><br><span class="line">         â†‘</span><br><span class="line">[-1,0] â† [0,0] â†’ [+1,0]</span><br><span class="line">         â†“</span><br><span class="line">       [0,+1]</span><br></pre></td></tr></table></figure><p><strong>2D ä¹ç‚¹æ¨¡æ¿ï¼ˆæ‘©å°”é‚»åŸŸï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[-1,-1] [0,-1] [+1,-1]</span><br><span class="line">[-1, 0] [0, 0] [+1, 0]</span><br><span class="line">[-1,+1] [0,+1] [+1,+1]</span><br></pre></td></tr></table></figure><p><strong>3D ä¸ƒç‚¹æ¨¡æ¿</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šä¸‹å‰åå·¦å³ + è‡ªå·±</span><br></pre></td></tr></table></figure><h3 id="mo-ban-vs-juan-ji" tabindex="-1" id="æ¨¡æ¿-vs-å·ç§¯">æ¨¡æ¿ vs å·ç§¯</h3><table><thead><tr><th>ç‰¹æ€§</th><th>å·ç§¯</th><th>æ¨¡æ¿</th></tr></thead><tbody><tr><td>æƒé‡</td><td>æ¥è‡ªæ»¤æ³¢å™¨ï¼Œä»»æ„å€¼</td><td>é€šå¸¸æ˜¯å›ºå®šç³»æ•°</td></tr><tr><td>è¿­ä»£</td><td>é€šå¸¸å•æ¬¡</td><td>å¤šæ¬¡æ—¶é—´æ­¥è¿›</td></tr><tr><td>è¾¹ç•Œ</td><td>é›¶å¡«å……å¸¸è§</td><td>å‘¨æœŸ/å›ºå®šè¾¹ç•Œæ›´å¸¸è§</td></tr><tr><td>åº”ç”¨</td><td>ä¿¡å·/å›¾åƒå¤„ç†</td><td>PDE/ç‰©ç†ä»¿çœŸ</td></tr><tr><td>è¯»å†™æ¨¡å¼</td><td>åªè¯»è¾“å…¥ï¼Œå†™è¾“å‡º</td><td>è¯»æ—§å€¼ï¼Œå†™æ–°å€¼</td></tr></tbody></table><p>ä» GPU ä¼˜åŒ–è§’åº¦ï¼Œä¸¤è€…çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ç›¸åŒçš„ï¼š<strong>å¸¸é‡å†…å­˜</strong>å­˜ç³»æ•°ï¼Œ<strong>å…±äº«å†…å­˜</strong> Tiling å‡å°‘å…¨å±€å†…å­˜è®¿é—®ã€‚</p><h2 id="2-d-mo-ban-re-chuan-dao-fang-cheng" tabindex="-1" id="2D-æ¨¡æ¿ï¼šçƒ­ä¼ å¯¼æ–¹ç¨‹">2D æ¨¡æ¿ï¼šçƒ­ä¼ å¯¼æ–¹ç¨‹</h2><h3 id="wu-li-bei-jing" tabindex="-1" id="ç‰©ç†èƒŒæ™¯">ç‰©ç†èƒŒæ™¯</h3><p>äºŒç»´çƒ­ä¼ å¯¼æ–¹ç¨‹ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>T</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>Î±</mi><mrow><mo fence="true">(</mo><mfrac><mrow><msup><mi mathvariant="normal">âˆ‚</mi><mn>2</mn></msup><mi>T</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><msup><mi mathvariant="normal">âˆ‚</mi><mn>2</mn></msup><mi>T</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{\partial T}{\partial t} = \alpha \left( \frac{\partial^2 T}{\partial x^2} + \frac{\partial^2 T}{\partial y^2} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>ç”¨æœ‰é™å·®åˆ†ç¦»æ•£åŒ–åï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>T</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mo>=</mo><msubsup><mi>T</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mi>n</mi></msubsup><mo>+</mo><mi>Î±</mi><mi mathvariant="normal">Î”</mi><mi>t</mi><mrow><mo fence="true">(</mo><mfrac><mrow><msubsup><mi>T</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi></mrow><mi>n</mi></msubsup><mo>+</mo><msubsup><mi>T</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi></mrow><mi>n</mi></msubsup><mo>+</mo><msubsup><mi>T</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo>+</mo><msubsup><mi>T</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo>âˆ’</mo><mn>4</mn><msubsup><mi>T</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mi>n</mi></msubsup></mrow><mrow><mi mathvariant="normal">Î”</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">T_{i,j}^{n+1} = T_{i,j}^n + \alpha \Delta t \left( \frac{T_{i+1,j}^n + T_{i-1,j}^n + T_{i,j+1}^n + T_{i,j-1}^n - 4T_{i,j}^n}{\Delta x^2} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2672em;vertical-align:-0.4031em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.433em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4031em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0975em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4181em;vertical-align:-0.95em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mord">Î”</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4681em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Î”</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7848em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>ç®€åŒ–ä¸ºäº”ç‚¹æ¨¡æ¿ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T_new[i][j] = c0 * T[i][j] + c1 * (T[i-1][j] + T[i+1][j] + T[i][j-1] + T[i][j+1])</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>c0 = 1 - 4*alpha*dt/dxÂ²</code>ï¼Œ<code>c1 = alpha*dt/dxÂ²</code>ã€‚</p><h3 id="po-su-shi-xian" tabindex="-1" id="æœ´ç´ å®ç°">æœ´ç´ å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__global__ void stencil_2d_basic(float *in, float *out, int N) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int j = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    if (i &gt; 0 &amp;&amp; i &lt; N-1 &amp;&amp; j &gt; 0 &amp;&amp; j &lt; N-1) &#123;</span><br><span class="line">        out[i*N + j] = C0 * in[i*N + j] +</span><br><span class="line">                       C1 * (in[(i-1)*N + j] + in[(i+1)*N + j] +</span><br><span class="line">                             in[i*N + (j-1)] + in[i*N + (j+1)]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼šæ¯ä¸ªç‚¹è¯»å– 5 æ¬¡å…¨å±€å†…å­˜ï¼Œç›¸é‚»ç‚¹çš„è®¿é—®æœ‰å¤§é‡é‡å ã€‚</p><h3 id="shu-ju-fu-yong-fen-xi" tabindex="-1" id="æ•°æ®å¤ç”¨åˆ†æ">æ•°æ®å¤ç”¨åˆ†æ</h3><p>è€ƒè™‘ä¸€è¡Œçº¿ç¨‹è®¡ç®—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ j:   è¯»å– T[i][j-1], T[i][j], T[i][j+1], T[i-1][j], T[i+1][j]</span><br><span class="line">çº¿ç¨‹ j+1: è¯»å– T[i][j], T[i][j+1], T[i][j+2], T[i-1][j+1], T[i+1][j+1]</span><br><span class="line">                â†‘           â†‘ å…±äº«</span><br></pre></td></tr></table></figure><p>ç›¸é‚»çº¿ç¨‹å…±äº«äº† <code>T[i][j]</code> å’Œ <code>T[i][j+1]</code>ã€‚å¦‚æœæŠŠä¸€ä¸ª Tile çš„æ•°æ®åŠ è½½åˆ°å…±äº«å†…å­˜ï¼Œè¿™äº›å…±äº«è®¿é—®éƒ½å˜æˆå¿«é€Ÿçš„ç‰‡ä¸Šè®¿é—®ã€‚</p><h2 id="tiled-mo-ban-shi-xian" tabindex="-1" id="Tiled-æ¨¡æ¿å®ç°">Tiled æ¨¡æ¿å®ç°</h2><h3 id="shu-ru-shu-chu-tile-guan-xi" tabindex="-1" id="è¾“å…¥è¾“å‡º-Tile-å…³ç³»">è¾“å…¥è¾“å‡º Tile å…³ç³»</h3><p>ä¸å·ç§¯ç±»ä¼¼ï¼Œè®¡ç®— <code>OUT_TILE_SIZE Ã— OUT_TILE_SIZE</code> çš„è¾“å‡ºï¼Œéœ€è¦ <code>(OUT_TILE_SIZE + 2*r) Ã— (OUT_TILE_SIZE + 2*r)</code> çš„è¾“å…¥ã€‚</p><p>å¯¹äºäº”ç‚¹æ¨¡æ¿ï¼ˆr=1ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ Tileï¼š(T + 2) Ã— (T + 2)</span><br><span class="line">è¾“å‡º Tileï¼šT Ã— T</span><br></pre></td></tr></table></figure><h3 id="xian-cheng-yu-shu-ju-ying-she" tabindex="-1" id="çº¿ç¨‹ä¸æ•°æ®æ˜ å°„">çº¿ç¨‹ä¸æ•°æ®æ˜ å°„</h3><p>æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p><p><strong>ç­–ç•¥ 1ï¼šçº¿ç¨‹æ•° = è¾“å…¥ Tile å¤§å°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Block: (T+2) Ã— (T+2) çº¿ç¨‹</span><br><span class="line">æ¯çº¿ç¨‹åŠ è½½ 1 ä¸ªè¾“å…¥å…ƒç´ </span><br><span class="line">åªæœ‰å†…éƒ¨ T Ã— T çº¿ç¨‹è®¡ç®—è¾“å‡º</span><br></pre></td></tr></table></figure><p><strong>ç­–ç•¥ 2ï¼šçº¿ç¨‹æ•° = è¾“å‡º Tile å¤§å°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Block: T Ã— T çº¿ç¨‹</span><br><span class="line">éƒ¨åˆ†çº¿ç¨‹è´Ÿè´£åŠ è½½ Halo å…ƒç´ </span><br><span class="line">æ‰€æœ‰çº¿ç¨‹éƒ½è®¡ç®—è¾“å‡º</span><br></pre></td></tr></table></figure><p>ä¹¦ä¸­æ¨è<strong>ç­–ç•¥ 1</strong>ï¼Œå› ä¸ºåŠ è½½æ›´ç®€å•ï¼Œä¸”è¾¹ç•Œçº¿ç¨‹è™½ä¸è®¡ç®—ä½†ä»èƒ½å¹¶è¡Œæ‰§è¡Œã€‚</p><h3 id="wan-zheng-shi-xian" tabindex="-1" id="å®Œæ•´å®ç°">å®Œæ•´å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#define IN_TILE_SIZE 18  // 16 + 2</span><br><span class="line">#define OUT_TILE_SIZE 16</span><br><span class="line"></span><br><span class="line">__global__ void stencil_2d_tiled(float *in, float *out, int N) &#123;</span><br><span class="line">    __shared__ float tile[IN_TILE_SIZE][IN_TILE_SIZE];</span><br><span class="line">    </span><br><span class="line">    // çº¿ç¨‹åœ¨è¾“å…¥ Tile ä¸­çš„ä½ç½®</span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // å¯¹åº”çš„å…¨å±€è¾“å…¥ä½ç½®</span><br><span class="line">    int in_row = blockIdx.y * OUT_TILE_SIZE + ty - 1;  // -1 æ˜¯å› ä¸º Halo</span><br><span class="line">    int in_col = blockIdx.x * OUT_TILE_SIZE + tx - 1;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ï¼ˆå«è¾¹ç•Œæ£€æŸ¥ï¼‰</span><br><span class="line">    if (in_row &gt;= 0 &amp;&amp; in_row &lt; N &amp;&amp; in_col &gt;= 0 &amp;&amp; in_col &lt; N) &#123;</span><br><span class="line">        tile[ty][tx] = in[in_row * N + in_col];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        tile[ty][tx] = 0.0f;  // è¾¹ç•Œå¤–å¡« 0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // åªæœ‰å†…éƒ¨çº¿ç¨‹è®¡ç®—è¾“å‡º</span><br><span class="line">    if (tx &gt; 0 &amp;&amp; tx &lt; IN_TILE_SIZE - 1 &amp;&amp; </span><br><span class="line">        ty &gt; 0 &amp;&amp; ty &lt; IN_TILE_SIZE - 1) &#123;</span><br><span class="line">        </span><br><span class="line">        int out_row = blockIdx.y * OUT_TILE_SIZE + ty - 1;</span><br><span class="line">        int out_col = blockIdx.x * OUT_TILE_SIZE + tx - 1;</span><br><span class="line">        </span><br><span class="line">        if (out_row &lt; N &amp;&amp; out_col &lt; N) &#123;</span><br><span class="line">            out[out_row * N + out_col] = </span><br><span class="line">                C0 * tile[ty][tx] +</span><br><span class="line">                C1 * (tile[ty-1][tx] + tile[ty+1][tx] +</span><br><span class="line">                      tile[ty][tx-1] + tile[ty][tx+1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="qi-dong-pei-zhi" tabindex="-1" id="å¯åŠ¨é…ç½®">å¯åŠ¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(IN_TILE_SIZE, IN_TILE_SIZE);  // 18Ã—18 = 324 çº¿ç¨‹</span><br><span class="line">dim3 grid((N + OUT_TILE_SIZE - 1) / OUT_TILE_SIZE,</span><br><span class="line">          (N + OUT_TILE_SIZE - 1) / OUT_TILE_SIZE);</span><br><span class="line"></span><br><span class="line">stencil_2d_tiled&lt;&lt;&lt;grid, block&gt;&gt;&gt;(d_in, d_out, N);</span><br></pre></td></tr></table></figure><h3 id="xing-neng-fen-xi" tabindex="-1" id="æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>æœ´ç´ å®ç°</th><th>Tiled å®ç°</th></tr></thead><tbody><tr><td>æ¯è¾“å‡ºå…ƒç´ </td><td>5 æ¬¡å…¨å±€è¯»å–</td><td>18Â²/16Â² â‰ˆ 1.27 æ¬¡</td></tr><tr><td>åŠ é€Ÿæ¯”</td><td>1Ã—</td><td>~4Ã—</td></tr><tr><td>å…±äº«å†…å­˜</td><td>0</td><td>18Ã—18Ã—4 = 1.3 KB</td></tr></tbody></table><h2 id="xian-cheng-cu-hua-thread-coarsening" tabindex="-1" id="çº¿ç¨‹ç²—åŒ–ï¼ˆThread-Coarseningï¼‰">çº¿ç¨‹ç²—åŒ–ï¼ˆThread Coarseningï¼‰</h2><h3 id="wei-shi-yao-cu-hua" tabindex="-1" id="ä¸ºä»€ä¹ˆç²—åŒ–">ä¸ºä»€ä¹ˆç²—åŒ–</h3><p>Tiled æ¨¡æ¿æœ‰ä¸ªé—®é¢˜ï¼šè¾¹ç•Œçº¿ç¨‹åªåŠ è½½ä¸è®¡ç®—ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Block çº¿ç¨‹æ•°ï¼š18Ã—18 = 324</span><br><span class="line">è®¡ç®—çº¿ç¨‹æ•°ï¼š16Ã—16 = 256</span><br><span class="line">åˆ©ç”¨ç‡ï¼š256/324 = 79%</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¨¡æ¿åŠå¾„æ›´å¤§ï¼Œåˆ©ç”¨ç‡æ›´ä½ã€‚</p><p><strong>çº¿ç¨‹ç²—åŒ–</strong>çš„æ€è·¯ï¼šè®©æ¯ä¸ªçº¿ç¨‹è®¡ç®—å¤šä¸ªè¾“å‡ºå…ƒç´ ï¼Œåˆ†æ‘Šè¾¹ç•Œå¼€é”€ã€‚</p><h3 id="z-fang-xiang-cu-hua" tabindex="-1" id="Z-æ–¹å‘ç²—åŒ–">Z æ–¹å‘ç²—åŒ–</h3><p>å¯¹äº 3D æ¨¡æ¿ï¼Œå¸¸ç”¨çš„æŠ€å·§æ˜¯åœ¨ Z æ–¹å‘å±•å¼€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#define IN_TILE_SIZE 18</span><br><span class="line">#define OUT_TILE_SIZE 16</span><br><span class="line">#define Z_COARSEN 8  // æ¯çº¿ç¨‹å¤„ç† 8 å±‚</span><br><span class="line"></span><br><span class="line">__global__ void stencil_3d_coarsened(float *in, float *out, </span><br><span class="line">                                      int Nx, int Ny, int Nz) &#123;</span><br><span class="line">    __shared__ float tile[3][IN_TILE_SIZE][IN_TILE_SIZE];  // åªéœ€ 3 å±‚</span><br><span class="line">    </span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    int ox = blockIdx.x * OUT_TILE_SIZE + tx - 1;</span><br><span class="line">    int oy = blockIdx.y * OUT_TILE_SIZE + ty - 1;</span><br><span class="line">    </span><br><span class="line">    // é¢„åŠ è½½å‰ä¸¤å±‚</span><br><span class="line">    load_layer(tile[0], in, ox, oy, 0, Nx, Ny, Nz);</span><br><span class="line">    load_layer(tile[1], in, ox, oy, 1, Nx, Ny, Nz);</span><br><span class="line">    </span><br><span class="line">    // æ»‘åŠ¨çª—å£éå† Z æ–¹å‘</span><br><span class="line">    for (int z = 1; z &lt; Nz - 1; z++) &#123;</span><br><span class="line">        // åŠ è½½ä¸‹ä¸€å±‚</span><br><span class="line">        load_layer(tile[(z+1) % 3], in, ox, oy, z+1, Nx, Ny, Nz);</span><br><span class="line">        __syncthreads();</span><br><span class="line">        </span><br><span class="line">        // è®¡ç®—å½“å‰å±‚</span><br><span class="line">        if (tx &gt; 0 &amp;&amp; tx &lt; IN_TILE_SIZE - 1 &amp;&amp; </span><br><span class="line">            ty &gt; 0 &amp;&amp; ty &lt; IN_TILE_SIZE - 1) &#123;</span><br><span class="line">            int idx = z * Nx * Ny + oy * Nx + ox;</span><br><span class="line">            out[idx] = compute_stencil(tile, tx, ty, z);</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ji-cun-qi-cu-hua" tabindex="-1" id="å¯„å­˜å™¨ç²—åŒ–">å¯„å­˜å™¨ç²—åŒ–</h3><p>æ›´æ¿€è¿›çš„åšæ³•ï¼šæŠŠæ»‘åŠ¨çª—å£å­˜åœ¨å¯„å­˜å™¨é‡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__global__ void stencil_3d_register(float *in, float *out, </span><br><span class="line">                                     int Nx, int Ny, int Nz) &#123;</span><br><span class="line">    __shared__ float tile[IN_TILE_SIZE][IN_TILE_SIZE];</span><br><span class="line">    </span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    int ox = blockIdx.x * OUT_TILE_SIZE + tx - 1;</span><br><span class="line">    int oy = blockIdx.y * OUT_TILE_SIZE + ty - 1;</span><br><span class="line">    </span><br><span class="line">    // å¯„å­˜å™¨å­˜ Z æ–¹å‘çš„ä¸‰ä¸ªå€¼</span><br><span class="line">    float z_prev, z_curr, z_next;</span><br><span class="line">    </span><br><span class="line">    z_prev = load_element(in, ox, oy, 0, Nx, Ny, Nz);</span><br><span class="line">    z_curr = load_element(in, ox, oy, 1, Nx, Ny, Nz);</span><br><span class="line">    </span><br><span class="line">    for (int z = 1; z &lt; Nz - 1; z++) &#123;</span><br><span class="line">        z_next = load_element(in, ox, oy, z+1, Nx, Ny, Nz);</span><br><span class="line">        </span><br><span class="line">        // åŠ è½½ XY å¹³é¢åˆ°å…±äº«å†…å­˜</span><br><span class="line">        tile[ty][tx] = z_curr;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        </span><br><span class="line">        // è®¡ç®—</span><br><span class="line">        if (valid_output_thread) &#123;</span><br><span class="line">            out[idx] = C0 * tile[ty][tx] +</span><br><span class="line">                       C1 * (tile[ty-1][tx] + tile[ty+1][tx] +</span><br><span class="line">                             tile[ty][tx-1] + tile[ty][tx+1]) +</span><br><span class="line">                       C2 * (z_prev + z_next);  // Z æ–¹å‘ç”¨å¯„å­˜å™¨</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // æ»‘åŠ¨çª—å£</span><br><span class="line">        z_prev = z_curr;</span><br><span class="line">        z_curr = z_next;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šZ æ–¹å‘çš„è®¿é—®å®Œå…¨åœ¨å¯„å­˜å™¨ï¼Œæ— éœ€å…±äº«å†…å­˜ã€‚</p><h2 id="bian-jie-tiao-jian-chu-li" tabindex="-1" id="è¾¹ç•Œæ¡ä»¶å¤„ç†">è¾¹ç•Œæ¡ä»¶å¤„ç†</h2><h3 id="chang-jian-bian-jie-tiao-jian" tabindex="-1" id="å¸¸è§è¾¹ç•Œæ¡ä»¶">å¸¸è§è¾¹ç•Œæ¡ä»¶</h3><p><strong>1. å›ºå®šè¾¹ç•Œï¼ˆDirichletï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (is_boundary) &#123;</span><br><span class="line">    out[idx] = BOUNDARY_VALUE;  // å›ºå®šå€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. å‘¨æœŸè¾¹ç•Œï¼ˆPeriodicï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int wrapped_x = (x + N) % N;  // ç¯ç»•</span><br><span class="line">int wrapped_y = (y + N) % N;</span><br></pre></td></tr></table></figure><p><strong>3. é›¶æ¢¯åº¦è¾¹ç•Œï¼ˆNeumannï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// è¾¹ç•Œå¤„ç”¨ç›¸é‚»å†…éƒ¨å€¼</span><br><span class="line">if (x == 0) x = 1;</span><br><span class="line">if (x == N-1) x = N-2;</span><br></pre></td></tr></table></figure><h3 id="bian-jie-chu-li-ce-lue" tabindex="-1" id="è¾¹ç•Œå¤„ç†ç­–ç•¥">è¾¹ç•Œå¤„ç†ç­–ç•¥</h3><p><strong>æ–¹æ³• 1ï¼šæ¡ä»¶åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (i &gt; 0 &amp;&amp; i &lt; N-1 &amp;&amp; j &gt; 0 &amp;&amp; j &lt; N-1) &#123;</span><br><span class="line">    // å†…éƒ¨ç‚¹è®¡ç®—</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // è¾¹ç•Œå¤„ç†</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼šåˆ†æ”¯å‘æ•£ã€‚</p><p><strong>æ–¹æ³• 2ï¼šPadding</strong></p><p>é¢„å…ˆåœ¨æ•°æ®å‘¨å›´åŠ ä¸€åœˆè¾¹ç•Œå€¼ï¼Œkernel å†…éƒ¨æ— éœ€åˆ¤æ–­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹æ•°æ® NÃ—N â†’ å¡«å……å (N+2)Ã—(N+2)</span><br><span class="line">æ‰€æœ‰è®¡ç®—éƒ½åœ¨ [1, N] èŒƒå›´å†…</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³• 3ï¼šåˆ†ç¦»è¾¹ç•Œ Kernel</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å…ˆå¤„ç†å†…éƒ¨</span><br><span class="line">stencil_interior&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(in, out, N);</span><br><span class="line"></span><br><span class="line">// å†å¤„ç†è¾¹ç•Œ</span><br><span class="line">stencil_boundary&lt;&lt;&lt;1, boundary_threads&gt;&gt;&gt;(in, out, N);</span><br></pre></td></tr></table></figure><p>å†…éƒ¨ kernel æ— åˆ†æ”¯ï¼Œè¾¹ç•Œ kernel çº¿ç¨‹å°‘ä½†é€»è¾‘å¤æ‚ã€‚</p><h2 id="shi-jian-bu-jin-yu-shuang-huan-chong" tabindex="-1" id="æ—¶é—´æ­¥è¿›ä¸åŒç¼“å†²">æ—¶é—´æ­¥è¿›ä¸åŒç¼“å†²</h2><h3 id="die-dai-mo-shi" tabindex="-1" id="è¿­ä»£æ¨¡å¼">è¿­ä»£æ¨¡å¼</h3><p>æ¨¡æ¿è®¡ç®—é€šå¸¸éœ€è¦å¤šæ¬¡è¿­ä»£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (int t = 0; t &lt; num_steps; t++) &#123;</span><br><span class="line">    stencil_kernel&lt;&lt;&lt;grid, block&gt;&gt;&gt;(d_in, d_out, N);</span><br><span class="line">    cudaDeviceSynchronize();</span><br><span class="line">    swap(d_in, d_out);  // äº¤æ¢è¾“å…¥è¾“å‡º</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šä¸èƒ½åŸåœ°æ›´æ–°ï¼è¯»å–é‚»å±…æ—¶å¯èƒ½è¯»åˆ°å·²æ›´æ–°çš„å€¼ï¼Œå¯¼è‡´é”™è¯¯ã€‚æ‰€ä»¥éœ€è¦<strong>åŒç¼“å†²</strong>ï¼šè¯»æ—§å†™æ–°ï¼Œç„¶åäº¤æ¢ã€‚</p><h3 id="shi-jian-zu-sai-temporal-blocking" tabindex="-1" id="æ—¶é—´é˜»å¡ï¼ˆTemporal-Blockingï¼‰">æ—¶é—´é˜»å¡ï¼ˆTemporal Blockingï¼‰</h3><p>æ¯æ¬¡ kernel å¯åŠ¨æœ‰å¼€é”€ã€‚å¦‚æœèƒ½åœ¨ä¸€æ¬¡ kernel ä¸­è®¡ç®—å¤šä¸ªæ—¶é—´æ­¥ï¼Œå°±èƒ½å‡å°‘å¯åŠ¨å¼€é”€ã€‚</p><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ Tile è®¡ç®— T ä¸ªæ—¶é—´æ­¥ï¼š</span><br><span class="line">æ—¶é—´ 0ï¼šéœ€è¦ (OUT + 2r*T) çš„è¾“å…¥</span><br><span class="line">æ—¶é—´ 1ï¼šéœ€è¦ (OUT + 2r*(T-1)) çš„è¾“å…¥</span><br><span class="line">...</span><br><span class="line">æ—¶é—´ Tï¼šè¾“å‡º OUT çš„ç»“æœ</span><br></pre></td></tr></table></figure><p>éšç€æ—¶é—´æ¨è¿›ï¼Œæœ‰æ•ˆæ•°æ®åŒºåŸŸå‘å†…æ”¶ç¼©ã€‚</p><p><strong>å®ç°å¤æ‚åº¦é«˜</strong>ï¼Œé€šå¸¸åœ¨é«˜æ€§èƒ½è®¡ç®—åº“ä¸­ä½¿ç”¨ï¼Œæ‰‹å†™è¾ƒéš¾ã€‚</p><h2 id="3-d-mo-ban-you-hua" tabindex="-1" id="3D-æ¨¡æ¿ä¼˜åŒ–">3D æ¨¡æ¿ä¼˜åŒ–</h2><h3 id="tiao-zhan" tabindex="-1" id="æŒ‘æˆ˜">æŒ‘æˆ˜</h3><p>3D æ¨¡æ¿çš„å…±äº«å†…å­˜éœ€æ±‚æ›´å¤§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2D: (T+2)Â² Ã— 4 = 324 Ã— 4 = 1.3 KB</span><br><span class="line">3D: (T+2)Â³ Ã— 4 = 8000 Ã— 4 = 32 KB  // å¯èƒ½è¶…é™ï¼</span><br></pre></td></tr></table></figure><h3 id="jie-jue-fang-an" tabindex="-1" id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3><p><strong>1. å‡å° Tile å¤§å°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define TILE_3D 8</span><br><span class="line">// (8+2)Â³ = 1000 å…ƒç´ ï¼Œ4 KB</span><br></pre></td></tr></table></figure><p>ä»£ä»·ï¼šé™ä½æ•°æ®å¤ç”¨ç‡ã€‚</p><p><strong>2. 2.5D åˆ†è§£</strong></p><p>åªåŠ è½½ XY å¹³é¢çš„ Tileï¼ŒZ æ–¹å‘é€å±‚å¤„ç†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float tile[TILE_Y][TILE_X];  // åªå­˜ä¸€å±‚ XY</span><br><span class="line"></span><br><span class="line">for (int z = 0; z &lt; Nz; z++) &#123;</span><br><span class="line">    // åŠ è½½å½“å‰å±‚</span><br><span class="line">    // è®¡ç®—ï¼ˆZ æ–¹å‘é‚»å±…ä»å…¨å±€å†…å­˜è¯»ï¼‰</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Z æ–¹å‘çš„è®¿é—®ä»èµ°å…¨å±€å†…å­˜ï¼Œä½† XY æ–¹å‘åˆ©ç”¨å…±äº«å†…å­˜ã€‚</p><p><strong>3. å¯„å­˜å™¨æ»‘åŠ¨çª—å£</strong></p><p>å¦‚å‰æ‰€è¿°ï¼ŒZ æ–¹å‘ 3 ä¸ªå€¼å­˜å¯„å­˜å™¨ï¼ŒXY å¹³é¢å­˜å…±äº«å†…å­˜ã€‚</p><h2 id="zhi-ling-ji-you-hua" tabindex="-1" id="æŒ‡ä»¤çº§ä¼˜åŒ–">æŒ‡ä»¤çº§ä¼˜åŒ–</h2><h3 id="xun-huan-zhan-kai" tabindex="-1" id="å¾ªç¯å±•å¼€">å¾ªç¯å±•å¼€</h3><p>å¯¹äºå°æ¨¡æ¿ï¼Œæ‰‹åŠ¨å±•å¼€æ¶ˆé™¤å¾ªç¯å¼€é”€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// å±•å¼€å‰</span><br><span class="line">for (int di = -1; di &lt;= 1; di++) &#123;</span><br><span class="line">    for (int dj = -1; dj &lt;= 1; dj++) &#123;</span><br><span class="line">        sum += tile[ty+di][tx+dj] * weight[di+1][dj+1];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å±•å¼€å</span><br><span class="line">sum = tile[ty-1][tx-1] * W00 + tile[ty-1][tx] * W01 + tile[ty-1][tx+1] * W02 +</span><br><span class="line">      tile[ty  ][tx-1] * W10 + tile[ty  ][tx] * W11 + tile[ty  ][tx+1] * W12 +</span><br><span class="line">      tile[ty+1][tx-1] * W20 + tile[ty+1][tx] * W21 + tile[ty+1][tx+1] * W22;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨é€šå¸¸ä¼šè‡ªåŠ¨å±•å¼€ï¼Œä½†æ˜¾å¼å±•å¼€ä¿è¯æ•ˆæœã€‚</p><h3 id="chang-liang-yu-ji-suan" tabindex="-1" id="å¸¸é‡é¢„è®¡ç®—">å¸¸é‡é¢„è®¡ç®—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ç¼–è¯‘æ—¶å¸¸é‡</span><br><span class="line">#define C0 0.25f</span><br><span class="line">#define C1 0.125f</span><br><span class="line"></span><br><span class="line">// æˆ–ä½¿ç”¨ constexprï¼ˆC++11ï¼‰</span><br><span class="line">__device__ constexpr float c0 = 0.25f;</span><br></pre></td></tr></table></figure><p>é¿å…è¿è¡Œæ—¶è®¡ç®—ç³»æ•°ã€‚</p><h3 id="xiang-liang-hua-jia-zai" tabindex="-1" id="å‘é‡åŒ–åŠ è½½">å‘é‡åŒ–åŠ è½½</h3><p>å¯¹äºå¯¹é½çš„è®¿é—®æ¨¡å¼ï¼Œä½¿ç”¨å‘é‡ç±»å‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float4 data = *reinterpret_cast&lt;float4*&gt;(&amp;in[idx]);</span><br><span class="line">// ä¸€æ¬¡åŠ è½½ 4 ä¸ª float</span><br></pre></td></tr></table></figure><p>éœ€è¦æ•°æ®å¯¹é½ï¼ˆ16 å­—èŠ‚è¾¹ç•Œï¼‰ã€‚</p><h2 id="shi-zhan-jacobi-die-dai-qiu-jie-qi" tabindex="-1" id="å®æˆ˜ï¼šJacobi-è¿­ä»£æ±‚è§£å™¨">å®æˆ˜ï¼šJacobi è¿­ä»£æ±‚è§£å™¨</h2><h3 id="wen-ti-she-zhi" tabindex="-1" id="é—®é¢˜è®¾ç½®">é—®é¢˜è®¾ç½®</h3><p>æ±‚è§£æ³Šæ¾æ–¹ç¨‹ âˆ‡Â²u = fï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// Jacobi è¿­ä»£ï¼šu_new = (u_left + u_right + u_up + u_down - hÂ²f) / 4</span><br></pre></td></tr></table></figure><h3 id="cuda-shi-xian" tabindex="-1" id="CUDA-å®ç°">CUDA å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#define BLOCK_SIZE 16</span><br><span class="line">#define TILE_SIZE 18  // BLOCK_SIZE + 2</span><br><span class="line"></span><br><span class="line">__global__ void jacobi_iteration(float *u, float *u_new, float *f,</span><br><span class="line">                                  int N, float h2) &#123;</span><br><span class="line">    __shared__ float tile[TILE_SIZE][TILE_SIZE];</span><br><span class="line">    </span><br><span class="line">    int tx = threadIdx.x + 1;  // åç§» 1ï¼Œç•™å‡º Halo</span><br><span class="line">    int ty = threadIdx.y + 1;</span><br><span class="line">    int gx = blockIdx.x * BLOCK_SIZE + threadIdx.x;</span><br><span class="line">    int gy = blockIdx.y * BLOCK_SIZE + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ä¸­å¿ƒ</span><br><span class="line">    if (gx &lt; N &amp;&amp; gy &lt; N) &#123;</span><br><span class="line">        tile[ty][tx] = u[gy * N + gx];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ Halo</span><br><span class="line">    if (threadIdx.x == 0 &amp;&amp; gx &gt; 0) &#123;</span><br><span class="line">        tile[ty][0] = u[gy * N + gx - 1];</span><br><span class="line">    &#125;</span><br><span class="line">    if (threadIdx.x == BLOCK_SIZE - 1 &amp;&amp; gx &lt; N - 1) &#123;</span><br><span class="line">        tile[ty][TILE_SIZE - 1] = u[gy * N + gx + 1];</span><br><span class="line">    &#125;</span><br><span class="line">    if (threadIdx.y == 0 &amp;&amp; gy &gt; 0) &#123;</span><br><span class="line">        tile[0][tx] = u[(gy - 1) * N + gx];</span><br><span class="line">    &#125;</span><br><span class="line">    if (threadIdx.y == BLOCK_SIZE - 1 &amp;&amp; gy &lt; N - 1) &#123;</span><br><span class="line">        tile[TILE_SIZE - 1][tx] = u[(gy + 1) * N + gx];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // è®¡ç®—ï¼ˆè·³è¿‡è¾¹ç•Œï¼‰</span><br><span class="line">    if (gx &gt; 0 &amp;&amp; gx &lt; N - 1 &amp;&amp; gy &gt; 0 &amp;&amp; gy &lt; N - 1) &#123;</span><br><span class="line">        float f_val = f[gy * N + gx];</span><br><span class="line">        u_new[gy * N + gx] = 0.25f * (tile[ty-1][tx] + tile[ty+1][tx] +</span><br><span class="line">                                       tile[ty][tx-1] + tile[ty][tx+1] -</span><br><span class="line">                                       h2 * f_val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Host ç«¯è¿­ä»£</span><br><span class="line">void jacobi_solve(float *u, float *f, int N, int max_iter, float tol) &#123;</span><br><span class="line">    float *d_u, *d_u_new, *d_f;</span><br><span class="line">    // ... åˆ†é…å†…å­˜ ...</span><br><span class="line">    </span><br><span class="line">    dim3 block(BLOCK_SIZE, BLOCK_SIZE);</span><br><span class="line">    dim3 grid((N + BLOCK_SIZE - 1) / BLOCK_SIZE,</span><br><span class="line">              (N + BLOCK_SIZE - 1) / BLOCK_SIZE);</span><br><span class="line">    </span><br><span class="line">    for (int iter = 0; iter &lt; max_iter; iter++) &#123;</span><br><span class="line">        jacobi_iteration&lt;&lt;&lt;grid, block&gt;&gt;&gt;(d_u, d_u_new, d_f, N, h*h);</span><br><span class="line">        cudaDeviceSynchronize();</span><br><span class="line">        </span><br><span class="line">        // äº¤æ¢æŒ‡é’ˆ</span><br><span class="line">        float *temp = d_u;</span><br><span class="line">        d_u = d_u_new;</span><br><span class="line">        d_u_new = temp;</span><br><span class="line">        </span><br><span class="line">        // å¯é€‰ï¼šæ£€æŸ¥æ”¶æ•›</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shou-lian-jian-cha" tabindex="-1" id="æ”¶æ•›æ£€æŸ¥">æ”¶æ•›æ£€æŸ¥</h3><p>æ¯éš”å‡ æ­¥æ£€æŸ¥æ®‹å·®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__global__ void compute_residual(float *u, float *f, float *residual,</span><br><span class="line">                                  int N, float h2) &#123;</span><br><span class="line">    // è®¡ç®— ||âˆ‡Â²u - f||</span><br><span class="line">    // ä½¿ç”¨è§„çº¦æ±‚å’Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦æ¯æ­¥éƒ½æ£€æŸ¥ï¼Œå¼€é”€å¤ªå¤§ã€‚</p><h2 id="xing-neng-diao-you-jian-yi" tabindex="-1" id="æ€§èƒ½è°ƒä¼˜å»ºè®®">æ€§èƒ½è°ƒä¼˜å»ºè®®</h2><h3 id="tile-da-xiao-xuan-ze" tabindex="-1" id="Tile-å¤§å°é€‰æ‹©">Tile å¤§å°é€‰æ‹©</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å…±äº«å†…å­˜é™åˆ¶ï¼š96 KB / SMï¼ˆAmpereï¼‰</span><br><span class="line">æ¯ Block å¯ç”¨ï¼š~48 KB</span><br><span class="line"></span><br><span class="line">2D Tile: sqrt(48K/4) â‰ˆ 110 â†’ å®é™…ç”¨ 32ã€48ã€64</span><br><span class="line">3D Tile: cbrt(48K/4) â‰ˆ 23  â†’ å®é™…ç”¨ 8ã€12ã€16</span><br></pre></td></tr></table></figure><p>éœ€è¦è€ƒè™‘å ç”¨ç‡ï¼šTile å¤ªå¤§å¯¼è‡´æ¯ SM çš„ Block æ•°å‡å°‘ã€‚</p><h3 id="nsight-zhi-biao" tabindex="-1" id="Nsight-æŒ‡æ ‡">Nsight æŒ‡æ ‡</h3><p>å…³æ³¨ï¼š</p><table><thead><tr><th>æŒ‡æ ‡</th><th>æ„ä¹‰</th><th>ç›®æ ‡</th></tr></thead><tbody><tr><td>Memory Throughput</td><td>å¸¦å®½åˆ©ç”¨</td><td>æ¥è¿‘å³°å€¼</td></tr><tr><td>Compute Throughput</td><td>è®¡ç®—åˆ©ç”¨</td><td>è¶Šé«˜è¶Šå¥½</td></tr><tr><td>Shared Memory Usage</td><td>å…±äº«å†…å­˜</td><td>ä¸è¶…é™</td></tr><tr><td>Warp Occupancy</td><td>å ç”¨ç‡</td><td>&gt;50%</td></tr></tbody></table><h3 id="chang-jian-ping-jing" tabindex="-1" id="å¸¸è§ç“¶é¢ˆ">å¸¸è§ç“¶é¢ˆ</h3><p><strong>å¸¦å®½å—é™</strong>ï¼šTiling ä¼˜åŒ–ã€å¯„å­˜å™¨ç¼“å­˜<br><strong>è®¡ç®—å—é™</strong>ï¼šå‘é‡åŒ–ã€æŒ‡ä»¤çº§å¹¶è¡Œ<br><strong>å»¶è¿Ÿå—é™</strong>ï¼šå¢åŠ å ç”¨ç‡ã€é¢„å–</p><h2 id="mo-ban-you-hua-zong-jie" tabindex="-1" id="æ¨¡æ¿ä¼˜åŒ–æ€»ç»“">æ¨¡æ¿ä¼˜åŒ–æ€»ç»“</h2><h3 id="he-xin-ji-zhu" tabindex="-1" id="æ ¸å¿ƒæŠ€æœ¯">æ ¸å¿ƒæŠ€æœ¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ Level 3: é«˜çº§ä¼˜åŒ–                                            â”‚</span><br><span class="line">â”‚   - æ—¶é—´é˜»å¡ï¼ˆå¤šæ­¥åˆå¹¶ï¼‰                                      â”‚</span><br><span class="line">â”‚   - è‡ªåŠ¨è°ƒä¼˜ï¼ˆæœç´¢æœ€ä¼˜å‚æ•°ï¼‰                                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 2: æ•°æ®å±€éƒ¨æ€§                                          â”‚</span><br><span class="line">â”‚   - å…±äº«å†…å­˜ Tiling                                          â”‚</span><br><span class="line">â”‚   - å¯„å­˜å™¨æ»‘åŠ¨çª—å£                                           â”‚</span><br><span class="line">â”‚   - çº¿ç¨‹ç²—åŒ–                                                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 1: åŸºç¡€ä¼˜åŒ–                                            â”‚</span><br><span class="line">â”‚   - åŒç¼“å†²é¿å…ç«äº‰                                           â”‚</span><br><span class="line">â”‚   - è¾¹ç•Œæ¡ä»¶å¤„ç†                                             â”‚</span><br><span class="line">â”‚   - åˆå¹¶å†…å­˜è®¿é—®                                             â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="mo-ban-vs-juan-ji-jue-ce" tabindex="-1" id="æ¨¡æ¿-vs-å·ç§¯å†³ç­–">æ¨¡æ¿ vs å·ç§¯å†³ç­–</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæŠ€æœ¯</th></tr></thead><tbody><tr><td>å•æ¬¡æ»¤æ³¢</td><td>å·ç§¯ + å¸¸é‡å†…å­˜</td></tr><tr><td>è¿­ä»£æ±‚è§£</td><td>æ¨¡æ¿ + åŒç¼“å†²</td></tr><tr><td>å¤§åŠå¾„æ¨¡æ¿</td><td>æ—¶é—´é˜»å¡</td></tr><tr><td>3D + å¤§è§„æ¨¡</td><td>2.5D + å¯„å­˜å™¨æ»‘åŠ¨</td></tr></tbody></table><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬å…«ç« å›´ç»•æ¨¡æ¿è®¡ç®—ï¼Œåœ¨ç¬¬ä¸ƒç« å·ç§¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ï¼š</p><p><strong>è¿­ä»£ç»“æ„</strong>ï¼šæ¨¡æ¿è®¡ç®—é€šå¸¸æ˜¯å¤šæ­¥è¿­ä»£çš„ã€‚åŒç¼“å†²æ˜¯åŸºæœ¬æŠ€å·§â€”â€”è¯»æ—§å†™æ–°ï¼Œç„¶åäº¤æ¢ã€‚</p><p><strong>çº¿ç¨‹ç²—åŒ–</strong>ï¼šè®©æ¯ä¸ªçº¿ç¨‹è®¡ç®—å¤šä¸ªè¾“å‡ºï¼Œåˆ†æ‘Šè¾¹ç•Œçº¿ç¨‹çš„å¼€é”€ã€‚Z æ–¹å‘ç²—åŒ–æ˜¯ 3D æ¨¡æ¿çš„å¸¸ç”¨æŠ€å·§ã€‚</p><p><strong>å¯„å­˜å™¨ä¼˜åŒ–</strong>ï¼šå¯¹äºæ»‘åŠ¨çª—å£æ¨¡å¼ï¼ŒæŠŠæ—¶é—´ç»´åº¦æˆ–ç©ºé—´ç»´åº¦çš„å°é‚»åŸŸå­˜å¯„å­˜å™¨ï¼Œæ¯”å…±äº«å†…å­˜æ›´å¿«ã€‚</p><p><strong>è¾¹ç•Œå¤„ç†</strong>ï¼šDirichletã€Neumannã€å‘¨æœŸè¾¹ç•Œå„æœ‰ç­–ç•¥ã€‚Padding é¢„å¤„ç†èƒ½ç®€åŒ– kernel é€»è¾‘ï¼Œä½†éœ€è¦é¢å¤–å†…å­˜ã€‚</p><p><strong>3D æŒ‘æˆ˜</strong>ï¼šå…±äº«å†…å­˜éœ€æ±‚çˆ†ç‚¸ã€‚2.5D åˆ†è§£ã€å¯„å­˜å™¨æ»‘åŠ¨æ˜¯è§£å†³æ–¹æ¡ˆã€‚</p><p>æ¨¡æ¿è®¡ç®—æ˜¯ç§‘å­¦è®¡ç®—çš„æ ¸å¿ƒï¼Œçƒ­ä¼ å¯¼ã€æµä½“åŠ›å­¦ã€ç”µç£ä»¿çœŸéƒ½ç”¨åˆ°ã€‚æŒæ¡è¿™å¥—ä¼˜åŒ–æŠ€æœ¯ï¼Œå°±èƒ½é«˜æ•ˆå®ç°å„ç§ PDE æ±‚è§£å™¨ã€‚ä¸‹ä¸€ç« è¿›å…¥å¦ä¸€ä¸ªé‡è¦æ¨¡å¼â€”â€”å¹¶è¡Œç›´æ–¹å›¾ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#shared-memory">CUDA C++ Programming Guide - Shared Memory</a></li><li>Datta, K., et al. (2008). <em>Stencil computation optimization and auto-tuning on state-of-the-art multicore architectures</em>. SC08.</li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å…±äº«å†…å­˜" scheme="https://smarter.xin/tags/shared-memory/"/>
    
    <category term="æ¨¡æ¿è®¡ç®—" scheme="https://smarter.xin/tags/template-computation/"/>
    
    <category term="Stencil" scheme="https://smarter.xin/tags/Stencil/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬ä¸ƒç« ï¼šå·ç§¯</title>
    <link href="https://smarter.xin/posts/1c778456/"/>
    <id>https://smarter.xin/posts/1c778456/</id>
    <published>2026-01-16T13:58:04.000Z</published>
    <updated>2026-01-18T14:12:10.555Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬å…­ç« è®²äº†æ€§èƒ½ä¼˜åŒ–çš„æ–¹æ–¹é¢é¢ï¼Œç°åœ¨å¼€å§‹å­¦ä¹ å…·ä½“çš„å¹¶è¡Œæ¨¡å¼ã€‚ç¬¬ä¸ƒç« çš„ä¸»è§’æ˜¯<strong>å·ç§¯ï¼ˆConvolutionï¼‰</strong>â€”â€”ä¿¡å·å¤„ç†å’Œæ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒç®—å­ã€‚å·ç§¯çœ‹ä¼¼ç®€å•ï¼Œä½†è¦é«˜æ•ˆå®ç°å´æ¶‰åŠå¤šä¸ªå†…å­˜å±‚æ¬¡çš„é…åˆï¼šå¸¸é‡å†…å­˜å­˜å·ç§¯æ ¸ã€å…±äº«å†…å­˜åš Tilingã€å…¨å±€å†…å­˜è¾“å…¥è¾“å‡ºã€‚è¿™ç« å°±æ˜¯æ•™ä½ å¦‚ä½•æŠŠè¿™äº›æŠ€æœ¯ç»„åˆèµ·æ¥ï¼Œå†™å‡ºå·¥ä¸šçº§çš„å·ç§¯ Kernelã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="juan-ji-ji-chu" tabindex="-1" id="å·ç§¯åŸºç¡€">å·ç§¯åŸºç¡€</h2><h3 id="shi-yao-shi-juan-ji" tabindex="-1" id="ä»€ä¹ˆæ˜¯å·ç§¯">ä»€ä¹ˆæ˜¯å·ç§¯</h3><p>å·ç§¯æ˜¯ä¸€ç§æ•°å­¦è¿ç®—ï¼Œç”¨ä¸€ä¸ªå°çŸ©é˜µï¼ˆ<strong>å·ç§¯æ ¸/æ»¤æ³¢å™¨</strong>ï¼‰åœ¨è¾“å…¥æ•°æ®ä¸Šæ»‘åŠ¨ï¼Œåœ¨æ¯ä¸ªä½ç½®è®¡ç®—åŠ æƒå’Œã€‚</p><p><strong>1D å·ç§¯</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š  [1, 2, 3, 4, 5, 6, 7]</span><br><span class="line">å·ç§¯æ ¸ï¼š[1, 2, 1]</span><br><span class="line">è¾“å‡ºï¼š  [_, 8, 12, 16, 20, 24, _]</span><br><span class="line"></span><br><span class="line">è®¡ç®— Output[3]ï¼š</span><br><span class="line">= Input[2]*Kernel[0] + Input[3]*Kernel[1] + Input[4]*Kernel[2]</span><br><span class="line">= 3*1 + 4*2 + 5*1 = 12</span><br></pre></td></tr></table></figure><p><strong>2D å·ç§¯</strong>ï¼ˆå›¾åƒå¤„ç†å¸¸ç”¨ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥å›¾åƒ                    å·ç§¯æ ¸ (3Ã—3)</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 1 2 3 4 5     â”‚           â”‚ 1 0 1 â”‚</span><br><span class="line">â”‚ 5 6 7 8 9     â”‚     *     â”‚ 0 1 0 â”‚</span><br><span class="line">â”‚ 9 0 1 2 3     â”‚           â”‚ 1 0 1 â”‚</span><br><span class="line">â”‚ 4 5 6 7 8     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="juan-ji-de-ying-yong" tabindex="-1" id="å·ç§¯çš„åº”ç”¨">å·ç§¯çš„åº”ç”¨</h3><p>å·ç§¯æ— å¤„ä¸åœ¨ï¼š</p><table><thead><tr><th>é¢†åŸŸ</th><th>åº”ç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>å›¾åƒå¤„ç†</td><td>è¾¹ç¼˜æ£€æµ‹ã€æ¨¡ç³Šã€é”åŒ–</td><td>Sobelã€Gaussian Blur</td></tr><tr><td>éŸ³é¢‘å¤„ç†</td><td>å›å£°ã€å‡è¡¡å™¨ã€é™å™ª</td><td>FIR æ»¤æ³¢å™¨</td></tr><tr><td>æ·±åº¦å­¦ä¹ </td><td>ç‰¹å¾æå–</td><td>CNN çš„æ ¸å¿ƒæ“ä½œ</td></tr><tr><td>ç‰©ç†ä»¿çœŸ</td><td>æ‰©æ•£æ–¹ç¨‹ã€æœ‰é™å·®åˆ†</td><td>çƒ­ä¼ å¯¼ã€æ³¢åŠ¨æ–¹ç¨‹</td></tr></tbody></table><h3 id="juan-ji-de-shu-xue-ding-yi" tabindex="-1" id="å·ç§¯çš„æ•°å­¦å®šä¹‰">å·ç§¯çš„æ•°å­¦å®šä¹‰</h3><p><strong>1D ç¦»æ•£å·ç§¯</strong>ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>O</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mo>âˆ’</mo><mi>r</mi></mrow><mi>r</mi></munderover><mi>I</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo stretchy="false">]</mo><mo>Ã—</mo><mi>K</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>e</mi><mi>l</mi><mo stretchy="false">[</mo><mi>j</mi><mo>+</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Output[i] = \sum_{j=-r}^{r} Input[i+j] \times Kernel[j+r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">u</span><span class="mord mathnormal">tp</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0652em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Ker</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span></span></p><p>å…¶ä¸­ r æ˜¯å·ç§¯æ ¸çš„&quot;åŠå¾„&quot;ï¼Œå·ç§¯æ ¸å¤§å°ä¸º 2r+1ã€‚</p><p><strong>2D ç¦»æ•£å·ç§¯</strong>ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>O</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>y</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>d</mi><mi>y</mi><mo>=</mo><mo>âˆ’</mo><mi>r</mi></mrow><mi>r</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>d</mi><mi>x</mi><mo>=</mo><mo>âˆ’</mo><mi>r</mi></mrow><mi>r</mi></munderover><mi>I</mi><mi>n</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mi>y</mi><mo>+</mo><mi>d</mi><mi>y</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>x</mi><mo>+</mo><mi>d</mi><mi>x</mi><mo stretchy="false">]</mo><mo>Ã—</mo><mi>K</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>e</mi><mi>l</mi><mo stretchy="false">[</mo><mi>d</mi><mi>y</mi><mo>+</mo><mi>r</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>d</mi><mi>x</mi><mo>+</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Output[y][x] = \sum_{dy=-r}^{r} \sum_{dx=-r}^{r} Input[y+dy][x+dx] \times Kernel[dy+r][dx+r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">u</span><span class="mord mathnormal">tp</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0896em;vertical-align:-1.4382em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mrel mtight">=</span><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4382em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">x</span><span class="mrel mtight">=</span><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3604em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Ker</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">[</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span></span></p><h3 id="bian-jie-chu-li" tabindex="-1" id="è¾¹ç•Œå¤„ç†">è¾¹ç•Œå¤„ç†</h3><p>å½“å·ç§¯çª—å£è¶…å‡ºè¾“å…¥è¾¹ç•Œæ—¶ï¼Œæœ‰å‡ ç§å¤„ç†ç­–ç•¥ï¼š</p><p><strong>1. é›¶å¡«å……ï¼ˆZero Paddingï¼‰</strong>ï¼šè¾¹ç•Œå¤–çš„å…ƒç´ è§†ä¸º 0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Padding å‰ï¼š[1, 2, 3, 4, 5]</span><br><span class="line">Padding åï¼š[0, 0, 1, 2, 3, 4, 5, 0, 0]</span><br></pre></td></tr></table></figure><p><strong>2. å¤åˆ¶å¡«å……ï¼ˆReplicate Paddingï¼‰</strong>ï¼šç”¨è¾¹ç•Œå€¼å¡«å……</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Padding åï¼š[1, 1, 1, 2, 3, 4, 5, 5, 5]</span><br></pre></td></tr></table></figure><p><strong>3. é•œåƒå¡«å……ï¼ˆReflect Paddingï¼‰</strong>ï¼šé•œåƒè¾¹ç•Œå…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Padding åï¼š[3, 2, 1, 2, 3, 4, 5, 4, 3]</span><br></pre></td></tr></table></figure><p>åœ¨ CUDA å®ç°ä¸­ï¼Œé›¶å¡«å……æœ€ç®€å•â€”â€”åªéœ€åœ¨è¾¹ç•Œåˆ¤æ–­æ—¶è¿”å› 0ã€‚</p><h2 id="po-su-1-d-juan-ji-shi-xian" tabindex="-1" id="æœ´ç´ -1D-å·ç§¯å®ç°">æœ´ç´  1D å·ç§¯å®ç°</h2><h3 id="ji-ben-si-lu" tabindex="-1" id="åŸºæœ¬æ€è·¯">åŸºæœ¬æ€è·¯</h3><p>æ¯ä¸ªçº¿ç¨‹è´Ÿè´£è®¡ç®—ä¸€ä¸ªè¾“å‡ºå…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__global__ void conv1d_basic(float *input, float *kernel, float *output,</span><br><span class="line">                              int n, int kernel_size) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int r = kernel_size / 2;  // å·ç§¯æ ¸åŠå¾„</span><br><span class="line">    </span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int j = -r; j &lt;= r; j++) &#123;</span><br><span class="line">            int idx = i + j;</span><br><span class="line">            if (idx &gt;= 0 &amp;&amp; idx &lt; n) &#123;</span><br><span class="line">                sum += input[idx] * kernel[j + r];</span><br><span class="line">            &#125;</span><br><span class="line">            // è¾¹ç•Œå¤–éšå¼ä¸º 0ï¼ˆé›¶å¡«å……ï¼‰</span><br><span class="line">        &#125;</span><br><span class="line">        output[i] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xing-neng-wen-ti" tabindex="-1" id="æ€§èƒ½é—®é¢˜">æ€§èƒ½é—®é¢˜</h3><p>è¿™ä¸ªæœ´ç´ å®ç°æœ‰ä¸¤ä¸ªç“¶é¢ˆï¼š</p><p><strong>1. å·ç§¯æ ¸é‡å¤è¯»å–</strong></p><p>æ¯ä¸ªçº¿ç¨‹éƒ½è¦è¯»å–æ•´ä¸ªå·ç§¯æ ¸ã€‚å¦‚æœæœ‰ 10 ä¸‡ä¸ªçº¿ç¨‹ï¼Œå·ç§¯æ ¸å°±è¢«è¯»å– 10 ä¸‡æ¬¡ã€‚ä½†å·ç§¯æ ¸å¯¹æ‰€æœ‰çº¿ç¨‹æ˜¯ç›¸åŒçš„ï¼</p><p><strong>2. è¾“å…¥æ•°æ®é‡å¤è¯»å–</strong></p><p>ç›¸é‚»çº¿ç¨‹çš„å·ç§¯çª—å£é«˜åº¦é‡å ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ i   è¯»å–ï¼šinput[i-1], input[i], input[i+1]</span><br><span class="line">çº¿ç¨‹ i+1 è¯»å–ï¼šinput[i], input[i+1], input[i+2]</span><br><span class="line">                â†‘ å…±äº«å…ƒç´ </span><br></pre></td></tr></table></figure><p>å·ç§¯æ ¸å¤§å°ä¸º 2r+1 æ—¶ï¼Œæ¯ä¸ªè¾“å…¥å…ƒç´ å¹³å‡è¢«è¯»å– 2r+1 æ¬¡ã€‚</p><h2 id="chang-liang-nei-cun-you-hua" tabindex="-1" id="å¸¸é‡å†…å­˜ä¼˜åŒ–">å¸¸é‡å†…å­˜ä¼˜åŒ–</h2><h3 id="chang-liang-nei-cun-te-xing" tabindex="-1" id="å¸¸é‡å†…å­˜ç‰¹æ€§">å¸¸é‡å†…å­˜ç‰¹æ€§</h3><p>ç¬¬äº”ç« æè¿‡å¸¸é‡å†…å­˜ï¼Œè¿™é‡Œæ·±å…¥è®²è§£ï¼š</p><p><strong>ç¡¬ä»¶ç»“æ„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚           å¸¸é‡å†…å­˜ (64 KB)            â”‚</span><br><span class="line">â”‚           Device DRAM                â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">               â”‚ å¹¿æ’­</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚        å¸¸é‡ç¼“å­˜ (æ¯ SM ~8 KB)         â”‚</span><br><span class="line">â”‚           On-chip Cache              â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">               â”‚ æä½å»¶è¿Ÿ</span><br><span class="line">               â†“</span><br><span class="line">         Warp ä¸­çš„çº¿ç¨‹</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ol><li><strong>åªè¯»</strong>ï¼šKernel æ‰§è¡ŒæœŸé—´ä¸èƒ½ä¿®æ”¹</li><li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šæœ‰ä¸“ç”¨ç¼“å­˜ï¼Œå‘½ä¸­æ—¶å»¶è¿Ÿæä½</li><li><strong>å¹¿æ’­é«˜æ•ˆ</strong>ï¼šåŒä¸€ Warp è¯»ç›¸åŒåœ°å€æ—¶ï¼Œåªéœ€ä¸€æ¬¡è®¿é—®</li></ol><p><strong>ä¸ºä»€ä¹ˆé€‚åˆå·ç§¯æ ¸</strong>ï¼š</p><ul><li>å·ç§¯æ ¸å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯ç›¸åŒçš„å¸¸é‡</li><li>æ¯æ¬¡å·ç§¯æ“ä½œï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è¯»ç›¸åŒçš„ kernel[j]</li><li>å®Œç¾åŒ¹é…å¸¸é‡å†…å­˜çš„&quot;å¹¿æ’­&quot;ç‰¹æ€§</li></ul><h3 id="shi-yong-chang-liang-nei-cun" tabindex="-1" id="ä½¿ç”¨å¸¸é‡å†…å­˜">ä½¿ç”¨å¸¸é‡å†…å­˜</h3><p><strong>å£°æ˜</strong>ï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define MAX_KERNEL_SIZE 1025</span><br><span class="line">__constant__ float d_kernel[MAX_KERNEL_SIZE];</span><br></pre></td></tr></table></figure><p><strong>Host ç«¯åˆå§‹åŒ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">float h_kernel[kernel_size];</span><br><span class="line">// ... å¡«å……å·ç§¯æ ¸æ•°æ® ...</span><br><span class="line"></span><br><span class="line">cudaMemcpyToSymbol(d_kernel, h_kernel, kernel_size * sizeof(float));</span><br></pre></td></tr></table></figure><p><strong>Kernel ä¸­ä½¿ç”¨</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__global__ void conv1d_const(float *input, float *output, </span><br><span class="line">                              int n, int kernel_size) &#123;</span><br><span class="line">    int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int r = kernel_size / 2;</span><br><span class="line">    </span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int j = -r; j &lt;= r; j++) &#123;</span><br><span class="line">            int idx = i + j;</span><br><span class="line">            if (idx &gt;= 0 &amp;&amp; idx &lt; n) &#123;</span><br><span class="line">                sum += input[idx] * d_kernel[j + r];  // ç›´æ¥ä½¿ç”¨</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        output[i] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xing-neng-ti-sheng" tabindex="-1" id="æ€§èƒ½æå‡">æ€§èƒ½æå‡</h3><p>å¸¸é‡å†…å­˜è§£å†³äº†<strong>å·ç§¯æ ¸é‡å¤è¯»å–</strong>çš„é—®é¢˜ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>å·ç§¯æ ¸è¯»å–</th><th>å¸¦å®½æ¶ˆè€—</th></tr></thead><tbody><tr><td>æœ´ç´ </td><td>NÃ—K æ¬¡</td><td>é«˜</td></tr><tr><td>å¸¸é‡å†…å­˜</td><td>K æ¬¡ + ç¼“å­˜</td><td>æä½ï¼ˆå¹¿æ’­ï¼‰</td></tr></tbody></table><p>å…¶ä¸­ N æ˜¯è¾“å‡ºå…ƒç´ æ•°ï¼ŒK æ˜¯å·ç§¯æ ¸å¤§å°ã€‚</p><p>ä½†è¾“å…¥æ•°æ®çš„é‡å¤è¯»å–é—®é¢˜è¿˜æ²¡è§£å†³â€”â€”è¿™éœ€è¦ Tilingã€‚</p><h2 id="tiled-juan-ji" tabindex="-1" id="Tiled-å·ç§¯">Tiled å·ç§¯</h2><h3 id="wei-shi-yao-xu-yao-tiling" tabindex="-1" id="ä¸ºä»€ä¹ˆéœ€è¦-Tiling">ä¸ºä»€ä¹ˆéœ€è¦ Tiling</h3><p>å›é¡¾è¾“å…¥æ•°æ®è®¿é—®æ¨¡å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Block å†…çš„çº¿ç¨‹è®¿é—®ï¼š</span><br><span class="line">çº¿ç¨‹ 0:   input[0], input[1], ..., input[k-1]</span><br><span class="line">çº¿ç¨‹ 1:   input[1], input[2], ..., input[k]</span><br><span class="line">...</span><br><span class="line">çº¿ç¨‹ 255: input[255], input[256], ..., input[255+k-1]</span><br></pre></td></tr></table></figure><p>Block å†…çš„çº¿ç¨‹è®¿é—®èŒƒå›´æ˜¯è¿ç»­çš„ï¼Œæœ‰å¤§é‡é‡å ã€‚æŠŠè¿™éƒ¨åˆ†æ•°æ®åŠ è½½åˆ°å…±äº«å†…å­˜ï¼Œå°±èƒ½é¿å…é‡å¤çš„å…¨å±€å†…å­˜è®¿é—®ã€‚</p><h3 id="shu-ru-tile-she-ji" tabindex="-1" id="è¾“å…¥-Tile-è®¾è®¡">è¾“å…¥ Tile è®¾è®¡</h3><p>å…³é”®é—®é¢˜ï¼š<strong>ä¸€ä¸ª Block çš„çº¿ç¨‹éœ€è¦å¤šå¤§çš„è¾“å…¥ Tileï¼Ÿ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Block å¤§å°ï¼šBLOCK_SIZE</span><br><span class="line">å·ç§¯æ ¸åŠå¾„ï¼šr</span><br><span class="line">å·ç§¯æ ¸å¤§å°ï¼š2r + 1</span><br><span class="line"></span><br><span class="line">è¾“å‡ºèŒƒå›´ï¼š[block_start, block_start + BLOCK_SIZE - 1]</span><br><span class="line">è¾“å…¥èŒƒå›´ï¼š[block_start - r, block_start + BLOCK_SIZE - 1 + r]</span><br><span class="line">         = block_start - r, block_start + BLOCK_SIZE + r - 1]</span><br><span class="line"></span><br><span class="line">è¾“å…¥ Tile å¤§å° = BLOCK_SIZE + 2r</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦è®¡ç®— BLOCK_SIZE ä¸ªè¾“å‡ºï¼Œéœ€è¦è¯»å– BLOCK_SIZE + 2r ä¸ªè¾“å…¥å…ƒç´ ã€‚</p><h3 id="halo-yuan-su" tabindex="-1" id="Halo-å…ƒç´ ">Halo å…ƒç´ </h3><p>è¾“å…¥ Tile æ¯”è¾“å‡º Tile å¤§ï¼Œå¤šå‡ºæ¥çš„éƒ¨åˆ†å«åš <strong>Haloï¼ˆå…‰æ™•ï¼‰å…ƒç´ </strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">                    Halo                 ä¸»ä½“                  Halo</span><br><span class="line">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">è¾“å…¥ Tile:  â”‚ r ä¸ªå…ƒç´        â”‚ BLOCK_SIZE ä¸ªå…ƒç´         â”‚ r ä¸ªå…ƒç´        â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                    â†‘                                           â†‘</span><br><span class="line">                å·¦ Halo                                      å³ Halo</span><br></pre></td></tr></table></figure><p>Halo å…ƒç´ æ˜¯ç›¸é‚» Block è¾¹ç•Œçš„é‡å éƒ¨åˆ†ï¼Œä¹Ÿå« <strong>Ghost Cells</strong>ã€‚</p><h3 id="shi-xian-ce-lue" tabindex="-1" id="å®ç°ç­–ç•¥">å®ç°ç­–ç•¥</h3><p>æœ‰ä¸¤ç§åŠ è½½æ–¹å¼ï¼š</p><p><strong>ç­–ç•¥ 1ï¼šç»Ÿä¸€åŠ è½½</strong></p><p>æ‰€æœ‰å…ƒç´ ç”± BLOCK_SIZE ä¸ªçº¿ç¨‹åˆ†å·¥åŠ è½½ï¼Œæ¯çº¿ç¨‹å¯èƒ½åŠ è½½å¤šä¸ªå…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float tile[BLOCK_SIZE + 2 * MAX_R];</span><br><span class="line"></span><br><span class="line">int tile_size = BLOCK_SIZE + 2 * r;</span><br><span class="line">int loads_per_thread = (tile_size + BLOCK_SIZE - 1) / BLOCK_SIZE;</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; loads_per_thread; i++) &#123;</span><br><span class="line">    int tile_idx = threadIdx.x + i * BLOCK_SIZE;</span><br><span class="line">    if (tile_idx &lt; tile_size) &#123;</span><br><span class="line">        int global_idx = block_start - r + tile_idx;</span><br><span class="line">        tile[tile_idx] = (global_idx &gt;= 0 &amp;&amp; global_idx &lt; n) ? </span><br><span class="line">                          input[global_idx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç­–ç•¥ 2ï¼šåˆ†åŒºåŠ è½½ï¼ˆæ›´é«˜æ•ˆï¼‰</strong></p><p>å·¦ Haloã€ä¸»ä½“ã€å³ Halo åˆ†åˆ«ç”±ä¸åŒçº¿ç¨‹åŠ è½½ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float tile[BLOCK_SIZE + 2 * MAX_R];</span><br><span class="line"></span><br><span class="line">int halo_left = r;</span><br><span class="line">int block_start = blockIdx.x * BLOCK_SIZE;</span><br><span class="line"></span><br><span class="line">// å·¦ Haloï¼šå‰ r ä¸ªçº¿ç¨‹è´Ÿè´£</span><br><span class="line">if (threadIdx.x &lt; r) &#123;</span><br><span class="line">    int idx = block_start - r + threadIdx.x;</span><br><span class="line">    tile[threadIdx.x] = (idx &gt;= 0) ? input[idx] : 0.0f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸»ä½“ï¼šæ‰€æœ‰çº¿ç¨‹å„è´Ÿè´£ä¸€ä¸ª</span><br><span class="line">int main_idx = block_start + threadIdx.x;</span><br><span class="line">tile[r + threadIdx.x] = (main_idx &lt; n) ? input[main_idx] : 0.0f;</span><br><span class="line"></span><br><span class="line">// å³ Haloï¼šå‰ r ä¸ªçº¿ç¨‹è´Ÿè´£</span><br><span class="line">if (threadIdx.x &lt; r) &#123;</span><br><span class="line">    int idx = block_start + BLOCK_SIZE + threadIdx.x;</span><br><span class="line">    tile[BLOCK_SIZE + r + threadIdx.x] = (idx &lt; n) ? input[idx] : 0.0f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__syncthreads();</span><br></pre></td></tr></table></figure><h3 id="wan-zheng-de-tiled-1-d-juan-ji" tabindex="-1" id="å®Œæ•´çš„-Tiled-1D-å·ç§¯">å®Œæ•´çš„ Tiled 1D å·ç§¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#define BLOCK_SIZE 256</span><br><span class="line">#define MAX_R 512</span><br><span class="line"></span><br><span class="line">__constant__ float d_kernel[2 * MAX_R + 1];</span><br><span class="line"></span><br><span class="line">__global__ void conv1d_tiled(float *input, float *output, </span><br><span class="line">                              int n, int r) &#123;</span><br><span class="line">    // å…±äº«å†…å­˜ Tile</span><br><span class="line">    __shared__ float tile[BLOCK_SIZE + 2 * MAX_R];</span><br><span class="line">    </span><br><span class="line">    int block_start = blockIdx.x * BLOCK_SIZE;</span><br><span class="line">    int global_idx = block_start + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    // ========== åä½œåŠ è½½ ==========</span><br><span class="line">    </span><br><span class="line">    // å·¦ Halo</span><br><span class="line">    if (threadIdx.x &lt; r) &#123;</span><br><span class="line">        int idx = block_start - r + threadIdx.x;</span><br><span class="line">        tile[threadIdx.x] = (idx &gt;= 0) ? input[idx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä¸»ä½“å…ƒç´ </span><br><span class="line">    tile[r + threadIdx.x] = (global_idx &lt; n) ? input[global_idx] : 0.0f;</span><br><span class="line">    </span><br><span class="line">    // å³ Halo</span><br><span class="line">    if (threadIdx.x &lt; r) &#123;</span><br><span class="line">        int idx = block_start + BLOCK_SIZE + threadIdx.x;</span><br><span class="line">        tile[BLOCK_SIZE + r + threadIdx.x] = (idx &lt; n) ? input[idx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ========== è®¡ç®—å·ç§¯ ==========</span><br><span class="line">    </span><br><span class="line">    if (global_idx &lt; n) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int j = 0; j &lt; 2 * r + 1; j++) &#123;</span><br><span class="line">            sum += tile[threadIdx.x + j] * d_kernel[j];</span><br><span class="line">        &#125;</span><br><span class="line">        output[global_idx] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xing-neng-fen-xi" tabindex="-1" id="æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</h3><p><strong>å…¨å±€å†…å­˜è®¿é—®</strong>ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>æ¯å…ƒç´ è¯»å–æ¬¡æ•°</th><th>æ€»è¯»å–é‡</th></tr></thead><tbody><tr><td>æœ´ç´ </td><td>2r + 1</td><td>N Ã— (2r + 1)</td></tr><tr><td>Tiled</td><td>1 + 2r/BLOCK_SIZE</td><td>N Ã— (1 + 2r/B)</td></tr></tbody></table><p>å½“ BLOCK_SIZE = 256, r = 5 æ—¶ï¼š</p><ul><li>æœ´ç´ ï¼šæ¯å…ƒç´  11 æ¬¡</li><li>Tiledï¼šæ¯å…ƒç´  1.04 æ¬¡</li></ul><p>å…¨å±€å†…å­˜è®¿é—®å‡å°‘çº¦ <strong>10 å€</strong>ï¼</p><h2 id="2-d-juan-ji" tabindex="-1" id="2D-å·ç§¯">2D å·ç§¯</h2><h3 id="kuo-zhan-dao-er-wei" tabindex="-1" id="æ‰©å±•åˆ°äºŒç»´">æ‰©å±•åˆ°äºŒç»´</h3><p>2D å·ç§¯æ›´å¸¸è§ï¼Œæ€è·¯ç±»ä¼¼ä½†æ›´å¤æ‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ Tile å¤§å°ï¼š(BLOCK_Y + 2ry) Ã— (BLOCK_X + 2rx)</span><br><span class="line">Halo å…ƒç´ åœ¨å››ä¸ªè¾¹å’Œå››ä¸ªè§’</span><br></pre></td></tr></table></figure><h3 id="2-d-tile-jie-gou" tabindex="-1" id="2D-Tile-ç»“æ„">2D Tile ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  å·¦ä¸Šè§’     â”‚        ä¸Š Halo            â”‚  å³ä¸Šè§’     â”‚</span><br><span class="line">â”‚  (ryÃ—rx)    â”‚      (ryÃ—BLOCK_X)         â”‚  (ryÃ—rx)    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚             â”‚                           â”‚             â”‚</span><br><span class="line">â”‚  å·¦ Halo    â”‚       ä¸»ä½“                â”‚  å³ Halo    â”‚</span><br><span class="line">â”‚ (BLOCK_YÃ—rx)â”‚   (BLOCK_YÃ—BLOCK_X)       â”‚(BLOCK_YÃ—rx) â”‚</span><br><span class="line">â”‚             â”‚                           â”‚             â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  å·¦ä¸‹è§’     â”‚        ä¸‹ Halo            â”‚  å³ä¸‹è§’     â”‚</span><br><span class="line">â”‚  (ryÃ—rx)    â”‚      (ryÃ—BLOCK_X)         â”‚  (ryÃ—rx)    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="jian-hua-de-2-d-shi-xian" tabindex="-1" id="ç®€åŒ–çš„-2D-å®ç°">ç®€åŒ–çš„ 2D å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#define TILE_X 16</span><br><span class="line">#define TILE_Y 16</span><br><span class="line">#define R 1  // 3Ã—3 å·ç§¯æ ¸çš„åŠå¾„</span><br><span class="line"></span><br><span class="line">__constant__ float d_kernel2d[(2*R+1) * (2*R+1)];</span><br><span class="line"></span><br><span class="line">__global__ void conv2d_tiled(float *input, float *output,</span><br><span class="line">                              int width, int height) &#123;</span><br><span class="line">    // å…±äº«å†…å­˜</span><br><span class="line">    __shared__ float tile[TILE_Y + 2*R][TILE_X + 2*R];</span><br><span class="line">    </span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    int bx = blockIdx.x * TILE_X, by = blockIdx.y * TILE_Y;</span><br><span class="line">    int gx = bx + tx, gy = by + ty;</span><br><span class="line">    </span><br><span class="line">    // ========== åŠ è½½ä¸»ä½“ ==========</span><br><span class="line">    int tile_x = tx + R, tile_y = ty + R;</span><br><span class="line">    tile[tile_y][tile_x] = (gx &lt; width &amp;&amp; gy &lt; height) ? </span><br><span class="line">                            input[gy * width + gx] : 0.0f;</span><br><span class="line">    </span><br><span class="line">    // ========== åŠ è½½ Haloï¼ˆè¾¹ç•Œçº¿ç¨‹è´Ÿè´£ï¼‰==========</span><br><span class="line">    </span><br><span class="line">    // ä¸Šè¾¹ç•Œ</span><br><span class="line">    if (ty &lt; R) &#123;</span><br><span class="line">        int src_y = gy - R;</span><br><span class="line">        tile[ty][tile_x] = (gx &lt; width &amp;&amp; src_y &gt;= 0) ? </span><br><span class="line">                            input[src_y * width + gx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    // ä¸‹è¾¹ç•Œ</span><br><span class="line">    if (ty &gt;= TILE_Y - R) &#123;</span><br><span class="line">        int src_y = gy + R;</span><br><span class="line">        tile[tile_y + R][tile_x] = (gx &lt; width &amp;&amp; src_y &lt; height) ? </span><br><span class="line">                                    input[src_y * width + gx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    // å·¦è¾¹ç•Œ</span><br><span class="line">    if (tx &lt; R) &#123;</span><br><span class="line">        int src_x = gx - R;</span><br><span class="line">        tile[tile_y][tx] = (src_x &gt;= 0 &amp;&amp; gy &lt; height) ? </span><br><span class="line">                            input[gy * width + src_x] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    // å³è¾¹ç•Œ</span><br><span class="line">    if (tx &gt;= TILE_X - R) &#123;</span><br><span class="line">        int src_x = gx + R;</span><br><span class="line">        tile[tile_y][tile_x + R] = (src_x &lt; width &amp;&amp; gy &lt; height) ? </span><br><span class="line">                                    input[gy * width + src_x] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å››ä¸ªè§’ï¼ˆè§’è½çº¿ç¨‹è´Ÿè´£ï¼‰</span><br><span class="line">    if (tx &lt; R &amp;&amp; ty &lt; R) &#123;  // å·¦ä¸Š</span><br><span class="line">        int sx = gx - R, sy = gy - R;</span><br><span class="line">        tile[ty][tx] = (sx &gt;= 0 &amp;&amp; sy &gt;= 0) ? input[sy * width + sx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    if (tx &gt;= TILE_X - R &amp;&amp; ty &lt; R) &#123;  // å³ä¸Š</span><br><span class="line">        int sx = gx + R, sy = gy - R;</span><br><span class="line">        tile[ty][tile_x + R] = (sx &lt; width &amp;&amp; sy &gt;= 0) ? </span><br><span class="line">                                input[sy * width + sx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    if (tx &lt; R &amp;&amp; ty &gt;= TILE_Y - R) &#123;  // å·¦ä¸‹</span><br><span class="line">        int sx = gx - R, sy = gy + R;</span><br><span class="line">        tile[tile_y + R][tx] = (sx &gt;= 0 &amp;&amp; sy &lt; height) ? </span><br><span class="line">                                input[sy * width + sx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    if (tx &gt;= TILE_X - R &amp;&amp; ty &gt;= TILE_Y - R) &#123;  // å³ä¸‹</span><br><span class="line">        int sx = gx + R, sy = gy + R;</span><br><span class="line">        tile[tile_y + R][tile_x + R] = (sx &lt; width &amp;&amp; sy &lt; height) ?</span><br><span class="line">                                        input[sy * width + sx] : 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // ========== è®¡ç®—å·ç§¯ ==========</span><br><span class="line">    if (gx &lt; width &amp;&amp; gy &lt; height) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int dy = -R; dy &lt;= R; dy++) &#123;</span><br><span class="line">            for (int dx = -R; dx &lt;= R; dx++) &#123;</span><br><span class="line">                sum += tile[ty + R + dy][tx + R + dx] * </span><br><span class="line">                       d_kernel2d[(dy + R) * (2*R + 1) + (dx + R)];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        output[gy * width + gx] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="qi-dong-pei-zhi" tabindex="-1" id="å¯åŠ¨é…ç½®">å¯åŠ¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(TILE_X, TILE_Y);  // 16Ã—16 = 256 çº¿ç¨‹</span><br><span class="line">dim3 grid((width + TILE_X - 1) / TILE_X, </span><br><span class="line">          (height + TILE_Y - 1) / TILE_Y);</span><br><span class="line"></span><br><span class="line">conv2d_tiled&lt;&lt;&lt;grid, block&gt;&gt;&gt;(d_input, d_output, width, height);</span><br></pre></td></tr></table></figure><h2 id="huan-cun-ji-zhi" tabindex="-1" id="ç¼“å­˜æœºåˆ¶">ç¼“å­˜æœºåˆ¶</h2><h3 id="l-1-l-2-huan-cun-yu-tiling-de-guan-xi" tabindex="-1" id="L1-L2-ç¼“å­˜ä¸-Tiling-çš„å…³ç³»">L1/L2 ç¼“å­˜ä¸ Tiling çš„å…³ç³»</h3><p>å‰é¢æˆ‘ä»¬æ‰‹åŠ¨ç”¨å…±äº«å†…å­˜å®ç°äº† Tilingã€‚ä½† GPU è¿˜æœ‰è‡ªåŠ¨çš„ç¼“å­˜æœºåˆ¶ï¼š</p><p><strong>L1 ç¼“å­˜</strong>ï¼ˆæ¯ SMï¼‰ï¼š</p><ul><li>Ampere æ¶æ„ï¼š128 KBï¼ˆå¯é…ç½®ä¸å…±äº«å†…å­˜åˆ†å‰²ï¼‰</li><li>è‡ªåŠ¨ç¼“å­˜å…¨å±€å†…å­˜è®¿é—®</li><li>å¯¹äºå°å·ç§¯æ ¸ï¼Œå¯èƒ½&quot;å…è´¹&quot;è·å¾—æ•°æ®å¤ç”¨</li></ul><p><strong>L2 ç¼“å­˜</strong>ï¼ˆå…¨å±€å…±äº«ï¼‰ï¼š</p><ul><li>å‡  MB å®¹é‡</li><li>æ‰€æœ‰ SM å…±äº«</li><li>è·¨ Block çš„æ•°æ®è®¿é—®å¯èƒ½å‘½ä¸­</li></ul><h3 id="he-shi-yi-lai-huan-cun-vs-xian-shi-tiling" tabindex="-1" id="ä½•æ—¶ä¾èµ–ç¼“å­˜-vs-æ˜¾å¼-Tiling">ä½•æ—¶ä¾èµ–ç¼“å­˜ vs æ˜¾å¼ Tiling</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹å¼</th><th>åŸå› </th></tr></thead><tbody><tr><td>å°å·ç§¯æ ¸ï¼ˆ3Ã—3ï¼‰</td><td>å¯èƒ½åªç”¨ç¼“å­˜</td><td>L1 å¤Ÿç”¨ï¼Œä»£ç ç®€å•</td></tr><tr><td>å¤§å·ç§¯æ ¸ï¼ˆ11Ã—11+ï¼‰</td><td>æ˜¾å¼ Tiling</td><td>æ•°æ®é‡å¤§ï¼Œéœ€ç²¾ç¡®æ§åˆ¶</td></tr><tr><td>å¤§å›¾åƒã€å° kernel</td><td>æ˜¾å¼ Tiling</td><td>æœ€å¤§åŒ–å†…å­˜å¸¦å®½åˆ©ç”¨</td></tr><tr><td>è°ƒè¯•/åŸå‹</td><td>å…ˆç”¨ç¼“å­˜</td><td>å¿«é€ŸéªŒè¯æ­£ç¡®æ€§</td></tr></tbody></table><h3 id="xian-dai-gpu-de-you-hua-jian-yi" tabindex="-1" id="ç°ä»£-GPU-çš„ä¼˜åŒ–å»ºè®®">ç°ä»£ GPU çš„ä¼˜åŒ–å»ºè®®</h3><ol><li><strong>å…ˆå†™ç®€å•ç‰ˆæœ¬</strong>ï¼Œä¾èµ– L1/L2 ç¼“å­˜</li><li><strong>ç”¨ Nsight Compute åˆ†æ</strong>ï¼Œçœ‹å†…å­˜ååæ˜¯å¦æˆä¸ºç“¶é¢ˆ</li><li><strong>å¦‚æœå—é™äºå†…å­˜å¸¦å®½</strong>ï¼Œå†æ·»åŠ å…±äº«å†…å­˜ Tiling</li><li><strong>å¸¸é‡å†…å­˜å§‹ç»ˆæ˜¯å¥½é€‰æ‹©</strong>ï¼ˆå¯¹äºå·ç§¯æ ¸ï¼‰</li></ol><h2 id="juan-ji-you-hua-zong-jie" tabindex="-1" id="å·ç§¯ä¼˜åŒ–æ€»ç»“">å·ç§¯ä¼˜åŒ–æ€»ç»“</h2><h3 id="you-hua-shou-duan-ceng-ci" tabindex="-1" id="ä¼˜åŒ–æ‰‹æ®µå±‚æ¬¡">ä¼˜åŒ–æ‰‹æ®µå±‚æ¬¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ Level 4: ç®—æ³•çº§ä¼˜åŒ–                                              â”‚</span><br><span class="line">â”‚   - FFT å·ç§¯ï¼ˆå¤§å·ç§¯æ ¸ï¼‰                                          â”‚</span><br><span class="line">â”‚   - Winograd ç®—æ³•ï¼ˆç‰¹å®šå°ºå¯¸ï¼‰                                     â”‚</span><br><span class="line">â”‚   - Im2col + GEMMï¼ˆcuDNN æ–¹å¼ï¼‰                                   â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 3: æ•°æ®å¤ç”¨                                                 â”‚</span><br><span class="line">â”‚   - å…±äº«å†…å­˜ Tiling                                               â”‚</span><br><span class="line">â”‚   - å¸¸é‡å†…å­˜å­˜å‚¨å·ç§¯æ ¸                                            â”‚</span><br><span class="line">â”‚   - å¯„å­˜å™¨ç¼“å­˜å±€éƒ¨ç»“æœ                                            â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 2: å†…å­˜è®¿é—®æ¨¡å¼                                             â”‚</span><br><span class="line">â”‚   - åˆå¹¶è®¿é—®å…¨å±€å†…å­˜                                              â”‚</span><br><span class="line">â”‚   - é¿å… Bank å†²çª                                                â”‚</span><br><span class="line">â”‚   - é¢„å–å’ŒåŒç¼“å†²                                                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ Level 1: åŸºç¡€æ­£ç¡®å®ç°                                             â”‚</span><br><span class="line">â”‚   - è¾¹ç•Œæ£€æŸ¥                                                      â”‚</span><br><span class="line">â”‚   - æ­£ç¡®çš„ç´¢å¼•è®¡ç®—                                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="xuan-ze-ce-lue" tabindex="-1" id="é€‰æ‹©ç­–ç•¥">é€‰æ‹©ç­–ç•¥</h3><table><thead><tr><th>å·ç§¯æ ¸å¤§å°</th><th>æ¨èæ–¹æ³•</th></tr></thead><tbody><tr><td>3Ã—3</td><td>Tiled + å¸¸é‡å†…å­˜</td></tr><tr><td>5Ã—5 ~ 11Ã—11</td><td>Tiled + å¸¸é‡å†…å­˜</td></tr><tr><td>å¤§äº 11Ã—11</td><td>è€ƒè™‘ FFT æˆ– cuDNN</td></tr></tbody></table><h3 id="cu-dnn-gong-ye-ji-xuan-ze" tabindex="-1" id="cuDNNï¼šå·¥ä¸šçº§é€‰æ‹©">cuDNNï¼šå·¥ä¸šçº§é€‰æ‹©</h3><p>å®é™…ç”Ÿäº§ä¸­ï¼Œå·ç§¯é€šå¸¸ç”¨ cuDNNï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cudnnConvolutionForward</span>(handle,</span><br><span class="line">    &amp;alpha,</span><br><span class="line">    inputDesc, d_input,</span><br><span class="line">    filterDesc, d_filter,</span><br><span class="line">    convDesc,</span><br><span class="line">    algo,  <span class="comment">// è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç®—æ³•</span></span><br><span class="line">    workspace, workspaceSize,</span><br><span class="line">    &amp;beta,</span><br><span class="line">    outputDesc, d_output);</span><br></pre></td></tr></table></figure><p>cuDNN ä¼šæ ¹æ®è¾“å…¥å°ºå¯¸ã€å·ç§¯æ ¸å¤§å°ã€GPU æ¶æ„ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å®ç°ï¼ˆç›´æ¥å·ç§¯ã€FFTã€Winogradã€Im2col+GEMM ç­‰ï¼‰ã€‚</p><p>ä½†ç†è§£åº•å±‚åŸç†ä»ç„¶é‡è¦â€”â€”çŸ¥é“ cuDNN åœ¨åšä»€ä¹ˆï¼Œæ‰èƒ½æ­£ç¡®è°ƒç”¨å’Œè°ƒä¼˜ã€‚</p><h2 id="shi-zhan-tu-xiang-rui-hua" tabindex="-1" id="å®æˆ˜ï¼šå›¾åƒé”åŒ–">å®æˆ˜ï¼šå›¾åƒé”åŒ–</h2><h3 id="rui-hua-juan-ji-he" tabindex="-1" id="é”åŒ–å·ç§¯æ ¸">é”åŒ–å·ç§¯æ ¸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  0  â”‚ -1  â”‚  0  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ -1  â”‚  5  â”‚ -1  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  0  â”‚ -1  â”‚  0  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="wan-zheng-shi-li" tabindex="-1" id="å®Œæ•´ç¤ºä¾‹">å®Œæ•´ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cuda_runtime.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define TILE_SIZE 16</span><br><span class="line">#define R 1</span><br><span class="line"></span><br><span class="line">__constant__ float d_sharpen_kernel[9] = &#123;</span><br><span class="line">    0, -1,  0,</span><br><span class="line">   -1,  5, -1,</span><br><span class="line">    0, -1,  0</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">__global__ void sharpen_image(unsigned char *input, unsigned char *output,</span><br><span class="line">                               int width, int height) &#123;</span><br><span class="line">    __shared__ float tile[TILE_SIZE + 2][TILE_SIZE + 2];</span><br><span class="line">    </span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    int gx = blockIdx.x * TILE_SIZE + tx;</span><br><span class="line">    int gy = blockIdx.y * TILE_SIZE + ty;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ï¼ˆç®€åŒ–ç‰ˆï¼Œå‡è®¾è¾¹ç•Œå†…ï¼‰</span><br><span class="line">    if (gx &lt; width &amp;&amp; gy &lt; height) &#123;</span><br><span class="line">        tile[ty + 1][tx + 1] = (float)input[gy * width + gx];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        tile[ty + 1][tx + 1] = 0.0f;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // åŠ è½½ Haloï¼ˆç®€åŒ–ï¼Œä»…ç¤ºæ„ï¼‰</span><br><span class="line">    if (tx == 0 &amp;&amp; gx &gt; 0) </span><br><span class="line">        tile[ty + 1][0] = input[gy * width + gx - 1];</span><br><span class="line">    if (tx == TILE_SIZE - 1 &amp;&amp; gx &lt; width - 1) </span><br><span class="line">        tile[ty + 1][TILE_SIZE + 1] = input[gy * width + gx + 1];</span><br><span class="line">    if (ty == 0 &amp;&amp; gy &gt; 0) </span><br><span class="line">        tile[0][tx + 1] = input[(gy - 1) * width + gx];</span><br><span class="line">    if (ty == TILE_SIZE - 1 &amp;&amp; gy &lt; height - 1) </span><br><span class="line">        tile[TILE_SIZE + 1][tx + 1] = input[(gy + 1) * width + gx];</span><br><span class="line">    </span><br><span class="line">    // è§’è½å¤„ç†çœç•¥...</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // å·ç§¯è®¡ç®—</span><br><span class="line">    if (gx &lt; width &amp;&amp; gy &lt; height) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int dy = -1; dy &lt;= 1; dy++) &#123;</span><br><span class="line">            for (int dx = -1; dx &lt;= 1; dx++) &#123;</span><br><span class="line">                sum += tile[ty + 1 + dy][tx + 1 + dx] * </span><br><span class="line">                       d_sharpen_kernel[(dy + 1) * 3 + (dx + 1)];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // é’³åˆ¶åˆ° [0, 255]</span><br><span class="line">        sum = fminf(fmaxf(sum, 0.0f), 255.0f);</span><br><span class="line">        output[gy * width + gx] = (unsigned char)sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-d-vs-2-d-juan-ji-de-ke-fen-chi-xing" tabindex="-1" id="1D-vs-2D-å·ç§¯çš„å¯åˆ†ç¦»æ€§">1D vs 2D å·ç§¯çš„å¯åˆ†ç¦»æ€§</h2><h3 id="ke-fen-chi-juan-ji" tabindex="-1" id="å¯åˆ†ç¦»å·ç§¯">å¯åˆ†ç¦»å·ç§¯</h3><p>æœ‰äº› 2D å·ç§¯æ ¸å¯ä»¥åˆ†è§£ä¸ºä¸¤ä¸ª 1D å·ç§¯æ ¸çš„å¤–ç§¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                       â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ 1 â”‚   â”‚             â”‚</span><br><span class="line">â”‚ 1  4  6  4  1 â”‚      â”‚ 4 â”‚ Ã— â”‚ 1 4 6 4 1   â”‚</span><br><span class="line">â”‚ 4 16 24 16 4 â”‚  =    â”‚ 6 â”‚   â”‚             â”‚</span><br><span class="line">â”‚ 6 24 36 24 6 â”‚       â”‚ 4 â”‚   â”‚             â”‚</span><br><span class="line">â”‚ 4 16 24 16 4 â”‚       â”‚ 1 â”‚   â”‚             â”‚</span><br><span class="line">â”‚ 1  4  6  4  1 â”‚      â””â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        å‚ç›´ 1D     æ°´å¹³ 1D</span><br><span class="line">   5Ã—5 é«˜æ–¯</span><br></pre></td></tr></table></figure><h3 id="ke-fen-chi-juan-ji-de-you-shi" tabindex="-1" id="å¯åˆ†ç¦»å·ç§¯çš„ä¼˜åŠ¿">å¯åˆ†ç¦»å·ç§¯çš„ä¼˜åŠ¿</h3><p>åŸå§‹ 2Dï¼šæ¯åƒç´  5Ã—5 = 25 æ¬¡ä¹˜æ³•<br>å¯åˆ†ç¦»ï¼šæ¯åƒç´  5 + 5 = 10 æ¬¡ä¹˜æ³•</p><p><strong>è®¡ç®—é‡å‡å°‘ 60%ï¼</strong></p><h3 id="cuda-shi-xian-si-lu" tabindex="-1" id="CUDA-å®ç°æ€è·¯">CUDA å®ç°æ€è·¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç¬¬ä¸€æ­¥ï¼šæ°´å¹³å·ç§¯ï¼ˆæ¯è¡Œï¼‰</span><br><span class="line">conv1d_horizontal&lt;&lt;&lt;gridH, blockH&gt;&gt;&gt;(input, temp, width, height, kernel_h);</span><br><span class="line"></span><br><span class="line">// ç¬¬äºŒæ­¥ï¼šå‚ç›´å·ç§¯ï¼ˆæ¯åˆ—ï¼‰</span><br><span class="line">conv1d_vertical&lt;&lt;&lt;gridV, blockV&gt;&gt;&gt;(temp, output, width, height, kernel_v);</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„é«˜æ–¯æ¨¡ç³Šã€ç›’çŠ¶æ¨¡ç³Šéƒ½æ˜¯å¯åˆ†ç¦»çš„ï¼Œè¿™æ˜¯å®é™…ä¼˜åŒ–ä¸­çš„é‡è¦æŠ€å·§ã€‚</p><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬ä¸ƒç« å›´ç»•å·ç§¯ï¼Œæ•´åˆäº†å¤šé¡¹å†…å­˜ä¼˜åŒ–æŠ€æœ¯ï¼š</p><p><strong>å¸¸é‡å†…å­˜</strong>ï¼šå·ç§¯æ ¸å¯¹æ‰€æœ‰çº¿ç¨‹ç›¸åŒï¼Œæ”¾å¸¸é‡å†…å­˜æ˜¯è‡ªç„¶é€‰æ‹©ã€‚å¹¿æ’­è®¿é—®è®©å¸¦å®½æ¶ˆè€—è¶‹è¿‘äºé›¶ã€‚</p><p><strong>Tiled å…±äº«å†…å­˜</strong>ï¼šè¾“å…¥æ•°æ®æœ‰å¤§é‡é‡å è®¿é—®ã€‚ç”¨å…±äº«å†…å­˜ç¼“å­˜ Tileï¼Œå…¨å±€å†…å­˜è®¿é—®é™ä½åˆ°æ¥è¿‘ 1 æ¬¡/å…ƒç´ ã€‚</p><p><strong>Halo å¤„ç†</strong>ï¼š2D Tiling çš„å…³é”®éš¾ç‚¹ã€‚è¾¹ç•Œã€è§’è½éœ€è¦ç»†å¿ƒå¤„ç†ã€‚å»ºè®®åˆ†åŒºåŠ è½½â€”â€”ä¸åŒåŒºåŸŸç”±ä¸åŒçº¿ç¨‹è´Ÿè´£ã€‚</p><p><strong>ç¼“å­˜åˆ©ç”¨</strong>ï¼šç°ä»£ GPU çš„ L1/L2 ç¼“å­˜èƒ½è‡ªåŠ¨è¦†ç›–éƒ¨åˆ†æ•°æ®å¤ç”¨ã€‚å°å·ç§¯æ ¸ã€è°ƒè¯•é˜¶æ®µå¯ä»¥ä¾èµ–ç¼“å­˜ï¼Œæ­£å¼ä¼˜åŒ–å†åŠ  Tilingã€‚</p><p><strong>å¯åˆ†ç¦»å·ç§¯</strong>ï¼šé«˜æ–¯ç­‰å¯åˆ†ç¦»æ ¸ï¼Œåˆ†è§£æˆä¸¤æ¬¡ 1D å·ç§¯ï¼Œè®¡ç®—é‡ç›´æ¥å‡åŠã€‚</p><p>å·ç§¯æ˜¯æ·±åº¦å­¦ä¹ å’Œå›¾åƒå¤„ç†çš„æ ¸å¿ƒç®—å­ï¼Œä¼˜åŒ–å·ç§¯çš„æ€è·¯â€”â€”å¸¸é‡å†…å­˜ã€Tilingã€Halo å¤„ç†â€”â€”é€‚ç”¨äºå¾ˆå¤šç›¸ä¼¼çš„æ¨¡æ¿è®¡ç®—æ¨¡å¼ã€‚ä¸‹ä¸€ç« ä¼šå­¦ä¹ å¦ä¸€ä¸ªé‡è¦æ¨¡å¼â€”â€”Stencilï¼ˆæ¨¡æ¿è®¡ç®—ï¼‰ï¼Œæ€è·¯ç±»ä¼¼ä½†æœ‰è‡ªå·±çš„ç‰¹ç‚¹ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#constant-memory">CUDA C++ Programming Guide - Constant Memory</a></li><li><a href="https://docs.nvidia.com/deeplearning/cudnn/developer-guide/index.html">cuDNN Developer Guide</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å·ç§¯" scheme="https://smarter.xin/tags/convolution/"/>
    
    <category term="å¸¸é‡å†…å­˜" scheme="https://smarter.xin/tags/constant-memory/"/>
    
    <category term="Tiling" scheme="https://smarter.xin/tags/Tiling/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬å…­ç« ï¼šæ€§èƒ½æ–¹é¢çš„è€ƒè™‘</title>
    <link href="https://smarter.xin/posts/220818c3/"/>
    <id>https://smarter.xin/posts/220818c3/</id>
    <published>2026-01-16T09:11:58.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬äº”ç« å­¦äº†å†…å­˜å±‚æ¬¡å’Œ Tiling æŠ€æœ¯ï¼ŒçŸ©é˜µä¹˜æ³•æ€§èƒ½æå‡äº† 10 å€ã€‚ä½†è¿™åªæ˜¯å¼€å§‹â€”â€”å®é™…ä¼˜åŒ–ä¸­è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ä¼šå½±å“æ€§èƒ½ã€‚ç¬¬å…­ç« ç³»ç»Ÿæ¢³ç†è¿™äº›æ€§èƒ½å› ç´ ï¼šå†…å­˜åˆå¹¶ã€åˆ†æ”¯å‘æ•£ã€èµ„æºåˆ†é…ã€æŒ‡ä»¤æ··åˆç­‰ã€‚è¿™ç« å†…å®¹å&quot;å·¥ç¨‹å®è·µ&quot;ï¼ŒæŒæ¡è¿™äº›æŠ€å·§ï¼Œèƒ½è®©ä»£ç å†å¿«ä¸€å€ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="nei-cun-he-bing-memory-coalescing" tabindex="-1" id="å†…å­˜åˆå¹¶ï¼ˆMemory-Coalescingï¼‰">å†…å­˜åˆå¹¶ï¼ˆMemory Coalescingï¼‰</h2><h3 id="quan-ju-nei-cun-de-ying-jian-te-xing" tabindex="-1" id="å…¨å±€å†…å­˜çš„ç¡¬ä»¶ç‰¹æ€§">å…¨å±€å†…å­˜çš„ç¡¬ä»¶ç‰¹æ€§</h3><p>å…¨å±€å†…å­˜ï¼ˆDRAMï¼‰ä¸æ˜¯æŒ‰å•ä¸ªå­—èŠ‚è®¿é—®çš„ï¼Œè€Œæ˜¯æŒ‰**äº‹åŠ¡ï¼ˆTransactionï¼‰**æ‰¹é‡è®¿é—®ï¼š</p><ul><li>æ¯æ¬¡äº‹åŠ¡è¯»å–ä¸€ä¸ª<strong>å†…å­˜æ®µï¼ˆMemory Segmentï¼‰</strong></li><li>æ®µå¤§å°é€šå¸¸æ˜¯ 32 å­—èŠ‚æˆ– 128 å­—èŠ‚</li><li>æ®µå¿…é¡»å¯¹é½ï¼ˆèµ·å§‹åœ°å€æ˜¯æ®µå¤§å°çš„å€æ•°ï¼‰</li></ul><p>è¿™æ„å‘³ç€ï¼šè¯» 1 ä¸ª floatï¼ˆ4 å­—èŠ‚ï¼‰å’Œè¯» 32 ä¸ª floatï¼ˆ128 å­—èŠ‚ï¼‰ï¼Œå¦‚æœè½åœ¨åŒä¸€ä¸ªæ®µï¼Œç¡¬ä»¶å¼€é”€ç›¸åŒã€‚</p><h3 id="he-bing-fang-wen-de-tiao-jian" tabindex="-1" id="åˆå¹¶è®¿é—®çš„æ¡ä»¶">åˆå¹¶è®¿é—®çš„æ¡ä»¶</h3><p>å½“ Warp ä¸­çš„ 32 ä¸ªçº¿ç¨‹è®¿é—®<strong>è¿ç»­ä¸”å¯¹é½</strong>çš„å†…å­˜åœ°å€æ—¶ï¼Œè¿™äº›è®¿é—®å¯ä»¥åˆå¹¶æˆæœ€å°‘çš„äº‹åŠ¡ï¼š</p><p><strong>ç†æƒ³æƒ…å†µ</strong>ï¼š32 çº¿ç¨‹è®¿é—®è¿ç»­ 128 å­—èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åˆå¹¶è®¿é—®ï¼ˆ1 æ¬¡ 128B äº‹åŠ¡ï¼‰</span><br><span class="line">float val = data[threadIdx.x];</span><br><span class="line">// çº¿ç¨‹ 0 è®¿é—® data[0], çº¿ç¨‹ 1 è®¿é—® data[1], ...</span><br></pre></td></tr></table></figure><p><strong>ç³Ÿç³•æƒ…å†µ</strong>ï¼š32 çº¿ç¨‹è®¿é—®è·¨æ­¥åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// éåˆå¹¶è®¿é—®ï¼ˆå¯èƒ½ 32 æ¬¡äº‹åŠ¡ï¼ï¼‰</span><br><span class="line">float val = data[threadIdx.x * 32];</span><br><span class="line">// çº¿ç¨‹ 0 è®¿é—® data[0], çº¿ç¨‹ 1 è®¿é—® data[32], ...</span><br><span class="line">// æ¯ä¸ªè®¿é—®è½åœ¨ä¸åŒæ®µ</span><br></pre></td></tr></table></figure><h3 id="liang-hua-ying-xiang" tabindex="-1" id="é‡åŒ–å½±å“">é‡åŒ–å½±å“</h3><p>å‡è®¾æ¯æ¬¡äº‹åŠ¡å»¶è¿Ÿç›¸åŒï¼Œåˆå¹¶è®¿é—®å¸¦æ¥çš„åŠ é€Ÿï¼š</p><table><thead><tr><th>è®¿é—®æ¨¡å¼</th><th>äº‹åŠ¡æ•°</th><th>ç›¸å¯¹å¸¦å®½</th></tr></thead><tbody><tr><td>å®Œå…¨åˆå¹¶</td><td>1</td><td>100%</td></tr><tr><td>æ­¥é•¿ 2</td><td>2</td><td>50%</td></tr><tr><td>æ­¥é•¿ 4</td><td>4</td><td>25%</td></tr><tr><td>æ­¥é•¿ 32</td><td>32</td><td>3%</td></tr></tbody></table><p>æ­¥é•¿è¶Šå¤§ï¼Œå¸¦å®½åˆ©ç”¨ç‡è¶Šä½ã€‚</p><h3 id="ju-zhen-fang-wen-de-xian-jing" tabindex="-1" id="çŸ©é˜µè®¿é—®çš„é™·é˜±">çŸ©é˜µè®¿é—®çš„é™·é˜±</h3><p>è€ƒè™‘è¡Œä¸»åºçŸ©é˜µ <code>M[row][col]</code>ï¼Œä¸€ç»´ç´¢å¼•ä¸º <code>M[row * width + col]</code>ï¼š</p><p><strong>æŒ‰è¡Œéå†ï¼ˆåˆå¹¶ï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åŒä¸€ warp çš„çº¿ç¨‹ï¼Œrow ç›¸åŒï¼Œcol è¿ç»­</span><br><span class="line">int idx = row * width + threadIdx.x;</span><br><span class="line">float val = M[idx];  // è¿ç»­åœ°å€ï¼Œåˆå¹¶</span><br></pre></td></tr></table></figure><p><strong>æŒ‰åˆ—éå†ï¼ˆä¸åˆå¹¶ï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åŒä¸€ warp çš„çº¿ç¨‹ï¼Œcol ç›¸åŒï¼Œrow è¿ç»­</span><br><span class="line">int idx = threadIdx.x * width + col;</span><br><span class="line">float val = M[idx];  // æ­¥é•¿ = widthï¼Œä¸åˆå¹¶</span><br></pre></td></tr></table></figure><p>å¦‚æœ width = 1024ï¼Œæ­¥é•¿å°±æ˜¯ 1024Ã—4 = 4096 å­—èŠ‚ï¼Œè¿œè¶…æ®µå¤§å°ï¼Œæ¯ä¸ªçº¿ç¨‹è®¿é—®ä¸åŒæ®µã€‚</p><h3 id="ju-zhen-zhuan-zhi-you-hua" tabindex="-1" id="çŸ©é˜µè½¬ç½®ä¼˜åŒ–">çŸ©é˜µè½¬ç½®ä¼˜åŒ–</h3><p>çŸ©é˜µè½¬ç½® <code>B[j][i] = A[i][j]</code>ï¼Œå¿…ç„¶æœ‰ä¸€ä¸ªçŸ©é˜µæŒ‰åˆ—è®¿é—®ã€‚è§£å†³æ–¹æ¡ˆï¼š<strong>ç”¨å…±äº«å†…å­˜åšä¸­è½¬</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">__global__ void transposeCoalesced(float *A, float *B, int width) &#123;</span><br><span class="line">    __shared__ float tile[32][33];  // æ³¨æ„ padding é˜² bank å†²çª</span><br><span class="line">    </span><br><span class="line">    int x = blockIdx.x * 32 + threadIdx.x;</span><br><span class="line">    int y = blockIdx.y * 32 + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶è¯»å– Aï¼ˆæŒ‰è¡Œï¼‰</span><br><span class="line">    if (x &lt; width &amp;&amp; y &lt; width)</span><br><span class="line">        tile[threadIdx.y][threadIdx.x] = A[y * width + x];</span><br><span class="line">    </span><br><span class="line">    __syncthreads();</span><br><span class="line">    </span><br><span class="line">    // äº¤æ¢ block ç´¢å¼•</span><br><span class="line">    x = blockIdx.y * 32 + threadIdx.x;</span><br><span class="line">    y = blockIdx.x * 32 + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶å†™å…¥ Bï¼ˆæŒ‰è¡Œï¼Œä½†æ•°æ®æ¥è‡ª tile çš„åˆ—ï¼‰</span><br><span class="line">    if (x &lt; width &amp;&amp; y &lt; width)</span><br><span class="line">        B[y * width + x] = tile[threadIdx.x][threadIdx.y];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šå…±äº«å†…å­˜æ²¡æœ‰åˆå¹¶è¦æ±‚ï¼Œå¯ä»¥ä»»æ„é¡ºåºè®¿é—®ï¼ˆåªéœ€æ³¨æ„ Bank å†²çªï¼‰ã€‚é€šè¿‡å…±äº«å†…å­˜&quot;è½¬æ¢&quot;è®¿é—®æ¨¡å¼ï¼Œè®©å…¨å±€å†…å­˜è¯»å†™éƒ½æ˜¯åˆå¹¶çš„ã€‚</p><h2 id="fen-qu-lu-ying-partition-camping" tabindex="-1" id="åˆ†åŒºéœ²è¥ï¼ˆPartition-Campingï¼‰">åˆ†åŒºéœ²è¥ï¼ˆPartition Campingï¼‰</h2><h3 id="dram-de-fen-qu-jie-gou" tabindex="-1" id="DRAM-çš„åˆ†åŒºç»“æ„">DRAM çš„åˆ†åŒºç»“æ„</h3><p>å…¨å±€å†…å­˜ç”±å¤šä¸ª**åˆ†åŒºï¼ˆPartitionï¼‰**ç»„æˆï¼Œæ¯ä¸ªåˆ†åŒºæœ‰ç‹¬ç«‹çš„è®¿é—®é€šé“ã€‚åœ°å€åˆ°åˆ†åŒºçš„æ˜ å°„é€šå¸¸æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ†åŒº = (åœ°å€ / 256) % åˆ†åŒºæ•°</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰€æœ‰è®¿é—®éƒ½è½åœ¨åŒä¸€åˆ†åŒºï¼Œå…¶ä»–åˆ†åŒºç©ºé—²ï¼Œå¸¦å®½åªæœ‰ 1/Nã€‚</p><h3 id="he-shi-fa-sheng" tabindex="-1" id="ä½•æ—¶å‘ç”Ÿ">ä½•æ—¶å‘ç”Ÿ</h3><p>å½“å¤šä¸ª Warp è®¿é—®åœ°å€&quot;æ­¥è°ƒä¸€è‡´&quot;æ—¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å‡è®¾æ¯ä¸ª block å¤„ç†çŸ©é˜µçš„ä¸€åˆ—</span><br><span class="line">int col = blockIdx.x;</span><br><span class="line">for (int row = 0; row &lt; height; row++) &#123;</span><br><span class="line">    float val = M[row * width + col];  // æ‰€æœ‰ block åŒæ­¥è®¿é—®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ width æ°å¥½æ˜¯åˆ†åŒºæ•°çš„å€æ•°ï¼Œæ‰€æœ‰ block åŒæ—¶è®¿é—®åŒä¸€åˆ†åŒºã€‚</p><h3 id="jie-jue-fang-an" tabindex="-1" id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3><ol><li><strong>è°ƒæ•´æ•°æ®å¸ƒå±€</strong>ï¼šåŠ  padding æ‰“ç ´å¯¹é½</li><li><strong>è°ƒæ•´è®¿é—®é¡ºåº</strong>ï¼šè®©ä¸åŒ block è®¿é—®ä¸åŒåˆ†åŒº</li><li><strong>é€šå¸¸é—®é¢˜ä¸å¤§</strong>ï¼šç°ä»£ GPU åˆ†åŒºå¤šï¼Œè‡ªåŠ¨è°ƒåº¦èƒ½åŠ›å¼º</li></ol><p>åˆ†åŒºéœ²è¥åœ¨æ—©æœŸ GPU ä¸Šæ˜¯ä¸¥é‡é—®é¢˜ï¼Œç°ä»£æ¶æ„ï¼ˆAmpere+ï¼‰å½±å“è¾ƒå°ï¼Œä½†ä»å€¼å¾—æ³¨æ„ã€‚</p><h2 id="zhi-ling-hun-he-yu-tun-tu-liang" tabindex="-1" id="æŒ‡ä»¤æ··åˆä¸ååé‡">æŒ‡ä»¤æ··åˆä¸ååé‡</h2><h3 id="bu-tong-zhi-ling-de-tun-tu-liang" tabindex="-1" id="ä¸åŒæŒ‡ä»¤çš„ååé‡">ä¸åŒæŒ‡ä»¤çš„ååé‡</h3><p>å¹¶éæ‰€æœ‰æ“ä½œé€Ÿåº¦ç›¸åŒï¼š</p><table><thead><tr><th>æ“ä½œç±»å‹</th><th>ååé‡ï¼ˆFLOP/å‘¨æœŸ/SMï¼‰</th><th>ç›¸å¯¹é€Ÿåº¦</th></tr></thead><tbody><tr><td>FP32 åŠ æ³•/ä¹˜æ³•</td><td>128</td><td>1Ã—</td></tr><tr><td>FP32 FMA</td><td>128</td><td>1Ã—</td></tr><tr><td>FP32 é™¤æ³•</td><td>16</td><td>1/8</td></tr><tr><td>FP32 ç‰¹æ®Šå‡½æ•°</td><td>32</td><td>1/4</td></tr><tr><td>FP64 åŠ æ³•/ä¹˜æ³•</td><td>64ï¼ˆæˆ–æ›´å°‘ï¼‰</td><td>1/2</td></tr><tr><td>æ•´æ•°ä¹˜æ³•</td><td>64</td><td>1/2</td></tr></tbody></table><p><strong>æ³¨æ„</strong>ï¼šé™¤æ³•å’Œç‰¹æ®Šå‡½æ•°ï¼ˆsin/cos/expï¼‰æ…¢å¾ˆå¤šã€‚</p><h3 id="you-hua-ce-lue" tabindex="-1" id="ä¼˜åŒ–ç­–ç•¥">ä¼˜åŒ–ç­–ç•¥</h3><p><strong>ç”¨ä¹˜æ³•æ›¿ä»£é™¤æ³•</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// æ…¢</span><br><span class="line">float y = x / 3.0f;</span><br><span class="line"></span><br><span class="line">// å¿«ï¼ˆé¢„è®¡ç®—å€’æ•°ï¼‰</span><br><span class="line">float inv3 = 1.0f / 3.0f;  // å¸¸é‡ï¼Œç¼–è¯‘æ—¶è®¡ç®—</span><br><span class="line">float y = x * inv3;</span><br></pre></td></tr></table></figure><p><strong>ç”¨è¿‘ä¼¼å‡½æ•°</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç²¾ç¡®ä½†æ…¢</span><br><span class="line">float y = sinf(x);</span><br><span class="line"></span><br><span class="line">// å¿«é€Ÿè¿‘ä¼¼ï¼ˆè¯¯å·®ç•¥å¤§ï¼‰</span><br><span class="line">float y = __sinf(x);  // å†…ç½®å¿«é€Ÿç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><strong>å‡å°‘ç‰¹æ®Šå‡½æ•°è°ƒç”¨</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// å·®ï¼š3 æ¬¡ç‰¹æ®Šå‡½æ•°</span><br><span class="line">float a = expf(x);</span><br><span class="line">float b = expf(y);</span><br><span class="line">float c = expf(z);</span><br><span class="line"></span><br><span class="line">// å¥½ï¼šåˆ©ç”¨æ•°å­¦æ€§è´¨</span><br><span class="line">float abc = expf(x + y + z);</span><br></pre></td></tr></table></figure><h3 id="hun-he-jing-du" tabindex="-1" id="æ··åˆç²¾åº¦">æ··åˆç²¾åº¦</h3><p>å¦‚æœç²¾åº¦å…è®¸ï¼Œç”¨ FP16 æˆ– TF32ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ half ç²¾åº¦ï¼ˆéœ€è¦ include cuda_fp16.hï¼‰</span><br><span class="line">half x = __float2half(input);</span><br><span class="line">half y = __hmul(x, x);  // FP16 ä¹˜æ³•ï¼Œååé‡æ›´é«˜</span><br><span class="line">float result = __half2float(y);</span><br></pre></td></tr></table></figure><p>Tensor Core å¯ä»¥åš FP16/TF32 çŸ©é˜µä¹˜æ³•ï¼Œååé‡æ¯” FP32 CUDA æ ¸å¿ƒé«˜æ•°å€ã€‚</p><h2 id="xian-cheng-li-du" tabindex="-1" id="çº¿ç¨‹ç²’åº¦">çº¿ç¨‹ç²’åº¦</h2><h3 id="mei-xian-cheng-gong-zuo-liang" tabindex="-1" id="æ¯çº¿ç¨‹å·¥ä½œé‡">æ¯çº¿ç¨‹å·¥ä½œé‡</h3><p>çº¿ç¨‹ç²’åº¦æŒ‡æ¯ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°æ®é‡ã€‚ä¸¤ä¸ªæç«¯ï¼š</p><p><strong>ç»†ç²’åº¦</strong>ï¼šæ¯çº¿ç¨‹å¤„ç† 1 ä¸ªå…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// æ¯çº¿ç¨‹ 1 ä¸ªå…ƒç´ </span><br><span class="line">int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">C[i] = A[i] + B[i];</span><br></pre></td></tr></table></figure><p><strong>ç²—ç²’åº¦</strong>ï¼šæ¯çº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// æ¯çº¿ç¨‹ 4 ä¸ªå…ƒç´ </span><br><span class="line">int base = (blockIdx.x * blockDim.x + threadIdx.x) * 4;</span><br><span class="line">for (int i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">    C[base + i] = A[base + i] + B[base + i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cu-li-du-de-you-shi" tabindex="-1" id="ç²—ç²’åº¦çš„ä¼˜åŠ¿">ç²—ç²’åº¦çš„ä¼˜åŠ¿</h3><ol><li><strong>å‡å°‘å¯åŠ¨å¼€é”€</strong>ï¼šæ›´å°‘çš„çº¿ç¨‹æ€»æ•°</li><li><strong>å¯„å­˜å™¨å¤ç”¨</strong>ï¼šå¾ªç¯å˜é‡ã€æŒ‡é’ˆå¯å¤ç”¨</li><li><strong>æŒ‡ä»¤çº§å¹¶è¡Œ</strong>ï¼šå¾ªç¯å±•å¼€åå¤šæ¡æŒ‡ä»¤å¯æµæ°´</li><li><strong>å‡å°‘åŒæ­¥</strong>ï¼šæ¯çº¿ç¨‹æ›´å¤šç‹¬ç«‹å·¥ä½œ</li></ol><h3 id="cu-li-du-de-feng-xian" tabindex="-1" id="ç²—ç²’åº¦çš„é£é™©">ç²—ç²’åº¦çš„é£é™©</h3><ol><li><strong>è´Ÿè½½ä¸å‡è¡¡</strong>ï¼šå¦‚æœå…ƒç´ æ•°ä¸æ˜¯ç²’åº¦å€æ•°ï¼Œæœ€åä¸€æ‰¹çº¿ç¨‹å·¥ä½œé‡ä¸åŒ</li><li><strong>å ç”¨ç‡ä¸‹é™</strong>ï¼šæ¯çº¿ç¨‹æ›´å¤šå¯„å­˜å™¨ï¼Œå¯èƒ½é™ä½å¹¶è¡Œåº¦</li><li><strong>å¤æ‚è¾¹ç•Œå¤„ç†</strong>ï¼šéœ€è¦é¢å¤–æ£€æŸ¥</li></ol><h3 id="shi-jian-jian-yi" tabindex="-1" id="å®è·µå»ºè®®">å®è·µå»ºè®®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// æ¯çº¿ç¨‹å¤„ç† 4 ä¸ªå…ƒç´ ï¼Œå¸¦è¾¹ç•Œæ£€æŸ¥</span><br><span class="line">__global__ void vectorAddCoarsened(float *A, float *B, float *C, int n) &#123;</span><br><span class="line">    int tid = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int stride = blockDim.x * gridDim.x;</span><br><span class="line">    </span><br><span class="line">    // Grid-stride loop</span><br><span class="line">    for (int i = tid; i &lt; n; i += stride) &#123;</span><br><span class="line">        C[i] = A[i] + B[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Grid-stride loop</strong> æ˜¯ç»å…¸æ¨¡å¼ï¼šæ¯çº¿ç¨‹ä»è‡ªå·±çš„èµ·å§‹ä½ç½®å¼€å§‹ï¼ŒæŒ‰ grid å¤§å°æ­¥è¿›ï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰å…ƒç´ ã€‚å…¼é¡¾äº†ç²’åº¦å’Œçµæ´»æ€§ã€‚</p><h2 id="zi-yuan-ping-heng" tabindex="-1" id="èµ„æºå¹³è¡¡">èµ„æºå¹³è¡¡</h2><h3 id="zhan-yong-lu-vs-mei-xian-cheng-zi-yuan" tabindex="-1" id="å ç”¨ç‡-vs-æ¯çº¿ç¨‹èµ„æº">å ç”¨ç‡ vs æ¯çº¿ç¨‹èµ„æº</h3><p>å›é¡¾ç¬¬å››ç« çš„å ç”¨ç‡æ¦‚å¿µã€‚èµ„æºä½¿ç”¨å¢åŠ ä¼šé™ä½å ç”¨ç‡ï¼š</p><table><thead><tr><th>æ¯çº¿ç¨‹å¯„å­˜å™¨</th><th>æ¯ SM çº¿ç¨‹æ•°</th><th>å ç”¨ç‡</th></tr></thead><tbody><tr><td>32</td><td>2048</td><td>100%</td></tr><tr><td>64</td><td>1024</td><td>50%</td></tr><tr><td>128</td><td>512</td><td>25%</td></tr><tr><td>256</td><td>256</td><td>12.5%</td></tr></tbody></table><p>ç±»ä¼¼åœ°ï¼Œæ¯ Block å…±äº«å†…å­˜è¶Šå¤šï¼Œèƒ½åŒæ—¶è¿è¡Œçš„ Block è¶Šå°‘ã€‚</p><h3 id="quan-heng-an-li" tabindex="-1" id="æƒè¡¡æ¡ˆä¾‹">æƒè¡¡æ¡ˆä¾‹</h3><p><strong>åœºæ™¯</strong>ï¼šTiled çŸ©é˜µä¹˜æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// æ–¹æ¡ˆ Aï¼šå° Tile</span><br><span class="line">#define TILE 16</span><br><span class="line">__shared__ float As[16][16];  // 2 KB</span><br><span class="line">__shared__ float Bs[16][16];  // 2 KB</span><br><span class="line">// å…±äº«å†…å­˜å°‘ï¼Œå¯ä»¥å¤š Blockï¼Œé«˜å ç”¨ç‡</span><br><span class="line">// ä½† Tile å°ï¼Œç®—æœ¯å¼ºåº¦ä½</span><br><span class="line"></span><br><span class="line">// æ–¹æ¡ˆ Bï¼šå¤§ Tile</span><br><span class="line">#define TILE 32</span><br><span class="line">__shared__ float As[32][32];  // 8 KB</span><br><span class="line">__shared__ float Bs[32][32];  // 8 KB</span><br><span class="line">// å…±äº«å†…å­˜å¤šï¼ŒBlock å°‘ï¼Œä½å ç”¨ç‡</span><br><span class="line">// ä½† Tile å¤§ï¼Œç®—æœ¯å¼ºåº¦é«˜</span><br></pre></td></tr></table></figure><p><strong>é€šå¸¸å¤§ Tile æ›´ä¼˜</strong>ï¼šçŸ©é˜µä¹˜æ³•æ˜¯è®¡ç®—å¯†é›†å‹ï¼Œç®—æœ¯å¼ºåº¦æ¯”å ç”¨ç‡æ›´é‡è¦ã€‚ä½†éœ€è¦å®æµ‹éªŒè¯ã€‚</p><h3 id="shi-yong-launch-bounds" tabindex="-1" id="ä½¿ç”¨-Launch-Bounds">ä½¿ç”¨ Launch Bounds</h3><p>å‘Šè¯‰ç¼–è¯‘å™¨ä½ çš„é…ç½®ï¼Œå¸®åŠ©ä¼˜åŒ–å¯„å­˜å™¨åˆ†é…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__global__ void __launch_bounds__(256, 4) matMulKernel(...) &#123;</span><br><span class="line">    // æ¯ Block 256 çº¿ç¨‹</span><br><span class="line">    // æœŸæœ›æ¯ SM è‡³å°‘ 4 ä¸ª Block</span><br><span class="line">    // ç¼–è¯‘å™¨æ®æ­¤é™åˆ¶å¯„å­˜å™¨ä½¿ç”¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šï¼Œç¼–è¯‘å™¨å¯èƒ½è¿‡åº¦ä½¿ç”¨å¯„å­˜å™¨ï¼Œå¯¼è‡´å ç”¨ç‡ä½äºé¢„æœŸã€‚</p><h2 id="warp-zhi-xing-xiao-lu" tabindex="-1" id="Warp-æ‰§è¡Œæ•ˆç‡">Warp æ‰§è¡Œæ•ˆç‡</h2><h3 id="xian-cheng-shu-li-yong-lu" tabindex="-1" id="çº¿ç¨‹æŸåˆ©ç”¨ç‡">çº¿ç¨‹æŸåˆ©ç”¨ç‡</h3><p>å¦‚æœ Block å¤§å°ä¸æ˜¯ 32 çš„å€æ•°ï¼Œæœ€åä¸€ä¸ª Warp æœ‰çº¿ç¨‹ç©ºé—²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(100);  // 100 / 32 = 3.125 â†’ 4 ä¸ª warp</span><br><span class="line">// Warp 3 åªæœ‰ 4 ä¸ªæ´»è·ƒçº¿ç¨‹ï¼Œ28 ä¸ªç©ºé—²</span><br><span class="line">// warp åˆ©ç”¨ç‡ = 100 / 128 = 78%</span><br></pre></td></tr></table></figure><p><strong>æ°¸è¿œç”¨ 32 çš„å€æ•°ä½œä¸º Block å¤§å°</strong>ã€‚</p><h3 id="dong-tai-fen-zhi-de-e-wai-kai-xiao" tabindex="-1" id="åŠ¨æ€åˆ†æ”¯çš„é¢å¤–å¼€é”€">åŠ¨æ€åˆ†æ”¯çš„é¢å¤–å¼€é”€</h3><p>å³ä½¿æ²¡æœ‰åˆ†æ”¯å‘æ•£ï¼ŒåŠ¨æ€åˆ†æ”¯æœ¬èº«ä¹Ÿæœ‰å¼€é”€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// æœ‰åˆ†æ”¯å¼€é”€</span><br><span class="line">if (condition) &#123;</span><br><span class="line">    doWork();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ— åˆ†æ”¯ï¼ˆæ¡ä»¶æ€»ä¸º trueï¼‰</span><br><span class="line">doWork();</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨æ— æ³•çŸ¥é“ <code>condition</code> æ˜¯å¦æ€»ä¸º trueï¼Œå¿…é¡»ç”Ÿæˆåˆ†æ”¯æŒ‡ä»¤ã€‚å¦‚æœæ¡ä»¶å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œç”¨æ¨¡æ¿æˆ– constexprã€‚</p><h2 id="shu-ju-yu-qu" tabindex="-1" id="æ•°æ®é¢„å–">æ•°æ®é¢„å–</h2><h3 id="ruan-jian-liu-shui" tabindex="-1" id="è½¯ä»¶æµæ°´">è½¯ä»¶æµæ°´</h3><p>é€šè¿‡æå‰å‘èµ·å†…å­˜è¯·æ±‚ï¼Œä¸è®¡ç®—é‡å ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// æ— é¢„å–</span><br><span class="line">for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">    float data = load(i);      // ç­‰å¾…</span><br><span class="line">    process(data);             // è®¡ç®—</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æœ‰é¢„å–</span><br><span class="line">float next = load(0);</span><br><span class="line">for (int i = 0; i &lt; n - 1; i++) &#123;</span><br><span class="line">    float curr = next;</span><br><span class="line">    next = load(i + 1);        // æå‰è¯·æ±‚</span><br><span class="line">    process(curr);             // åŒæ—¶è®¡ç®—</span><br><span class="line">&#125;</span><br><span class="line">process(next);</span><br></pre></td></tr></table></figure><p>é¢„å–è®© load å’Œ compute é‡å ï¼Œéšè—éƒ¨åˆ†å»¶è¿Ÿã€‚</p><h3 id="zai-cuda-zhong-de-ying-yong" tabindex="-1" id="åœ¨-CUDA-ä¸­çš„åº”ç”¨">åœ¨ CUDA ä¸­çš„åº”ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__global__ void prefetchExample(float *in, float *out, int n) &#123;</span><br><span class="line">    __shared__ float buffer[2][TILE_SIZE];  // åŒç¼“å†²</span><br><span class="line">    </span><br><span class="line">    int tile = 0;</span><br><span class="line">    </span><br><span class="line">    // é¢„åŠ è½½ç¬¬ä¸€å—</span><br><span class="line">    buffer[0][threadIdx.x] = in[threadIdx.x];</span><br><span class="line">    </span><br><span class="line">    for (int i = TILE_SIZE; i &lt; n; i += TILE_SIZE) &#123;</span><br><span class="line">        __syncthreads();</span><br><span class="line">        </span><br><span class="line">        // åŠ è½½ä¸‹ä¸€å—åˆ°å¦ä¸€ä¸ªç¼“å†²åŒº</span><br><span class="line">        buffer[1 - tile][threadIdx.x] = in[i + threadIdx.x];</span><br><span class="line">        </span><br><span class="line">        // å¤„ç†å½“å‰å—</span><br><span class="line">        out[i - TILE_SIZE + threadIdx.x] = process(buffer[tile][threadIdx.x]);</span><br><span class="line">        </span><br><span class="line">        tile = 1 - tile;  // åˆ‡æ¢ç¼“å†²åŒº</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å¤„ç†æœ€åä¸€å—</span><br><span class="line">    out[n - TILE_SIZE + threadIdx.x] = process(buffer[tile][threadIdx.x]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç¼“å†²æ˜¯ç»å…¸æŠ€æœ¯ï¼šä¸€ä¸ªç¼“å†²åŒºå¤„ç†ï¼Œå¦ä¸€ä¸ªåŠ è½½ï¼Œäº¤æ›¿è¿›è¡Œã€‚</p><h2 id="xing-neng-fen-xi-gong-ju" tabindex="-1" id="æ€§èƒ½åˆ†æå·¥å…·">æ€§èƒ½åˆ†æå·¥å…·</h2><h3 id="nsight-compute" tabindex="-1" id="Nsight-Compute">Nsight Compute</h3><p>NVIDIA å®˜æ–¹ profilerï¼Œåˆ†æ kernel æ€§èƒ½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu --<span class="built_in">set</span> full ./myprogram</span><br></pre></td></tr></table></figure><p>å…³é”®æŒ‡æ ‡ï¼š</p><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th><th>ç›®æ ‡</th></tr></thead><tbody><tr><td>SM Throughput</td><td>è®¡ç®—å•å…ƒåˆ©ç”¨ç‡</td><td>è¶Šé«˜è¶Šå¥½</td></tr><tr><td>Memory Throughput</td><td>å†…å­˜å¸¦å®½åˆ©ç”¨ç‡</td><td>æ¥è¿‘ç¡¬ä»¶å³°å€¼</td></tr><tr><td>Occupancy</td><td>å ç”¨ç‡</td><td>è§†æƒ…å†µè€Œå®š</td></tr><tr><td>Warp Execution Efficiency</td><td>çº¿ç¨‹æŸæ•ˆç‡</td><td>æ¥è¿‘ 100%</td></tr><tr><td>Memory Coalescing</td><td>åˆå¹¶æ•ˆç‡</td><td>æ¥è¿‘ 100%</td></tr></tbody></table><h3 id="nsight-systems" tabindex="-1" id="Nsight-Systems">Nsight Systems</h3><p>åˆ†ææ•´ä½“æ‰§è¡Œæµç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nsys profile ./myprogram</span><br></pre></td></tr></table></figure><p>å¯è§†åŒ–ï¼š</p><ul><li>Kernel æ‰§è¡Œæ—¶é—´çº¿</li><li>Memory æ‹·è´æ—¶é—´</li><li>CPU/GPU äº¤äº’</li><li>æµå’Œäº‹ä»¶</li></ul><h3 id="chang-jian-xing-neng-mo-shi" tabindex="-1" id="å¸¸è§æ€§èƒ½æ¨¡å¼">å¸¸è§æ€§èƒ½æ¨¡å¼</h3><p><strong>å†…å­˜å—é™</strong>ï¼šMemory Throughput é«˜ï¼ŒSM Throughput ä½</p><ul><li>è§£å†³ï¼šæé«˜ç®—æœ¯å¼ºåº¦ã€ç”¨å…±äº«å†…å­˜</li></ul><p><strong>è®¡ç®—å—é™</strong>ï¼šSM Throughput é«˜ï¼ŒMemory Throughput ä½</p><ul><li>è§£å†³ï¼šå·²ç»å¾ˆå¥½äº†ï¼Œä¼˜åŒ–ç®—æ³•å¤æ‚åº¦</li></ul><p><strong>å»¶è¿Ÿå—é™</strong>ï¼šä¸¤ä¸ª Throughput éƒ½ä½ï¼ŒOccupancy ä¹Ÿä½</p><ul><li>è§£å†³ï¼šå¢åŠ å¹¶è¡Œåº¦ï¼Œè°ƒæ•´ Block é…ç½®</li></ul><h2 id="you-hua-jian-cha-qing-dan" tabindex="-1" id="ä¼˜åŒ–æ£€æŸ¥æ¸…å•">ä¼˜åŒ–æ£€æŸ¥æ¸…å•</h2><p>æŒ‰ä¼˜å…ˆçº§æ’åºçš„ä¼˜åŒ–æ­¥éª¤ï¼š</p><h3 id="1-zheng-que-xing-you-xian" tabindex="-1" id="1-æ­£ç¡®æ€§ä¼˜å…ˆ">1. æ­£ç¡®æ€§ä¼˜å…ˆ</h3><ul><li>[ ] è¾¹ç•Œæ£€æŸ¥å®Œæ•´</li><li>[ ] åŒæ­¥æ­£ç¡®ä½¿ç”¨</li><li>[ ] æ— ç«æ€æ¡ä»¶</li></ul><h3 id="2-nei-cun-you-hua" tabindex="-1" id="2-å†…å­˜ä¼˜åŒ–">2. å†…å­˜ä¼˜åŒ–</h3><ul><li>[ ] å…¨å±€å†…å­˜åˆå¹¶è®¿é—®</li><li>[ ] ä½¿ç”¨å…±äº«å†…å­˜å‡å°‘å…¨å±€å†…å­˜è®¿é—®</li><li>[ ] é¿å… Bank å†²çª</li><li>[ ] å¸¸é‡æ•°æ®ç”¨ <code>__constant__</code></li></ul><h3 id="3-zhi-xing-you-hua" tabindex="-1" id="3-æ‰§è¡Œä¼˜åŒ–">3. æ‰§è¡Œä¼˜åŒ–</h3><ul><li>[ ] Block å¤§å°æ˜¯ 32 çš„å€æ•°</li><li>[ ] é¿å… Warp å†…åˆ†æ”¯å‘æ•£</li><li>[ ] å‡å°‘åŒæ­¥æ¬¡æ•°</li><li>[ ] åˆç†çº¿ç¨‹ç²’åº¦</li></ul><h3 id="4-zhi-ling-you-hua" tabindex="-1" id="4-æŒ‡ä»¤ä¼˜åŒ–">4. æŒ‡ä»¤ä¼˜åŒ–</h3><ul><li>[ ] é¿å…é™¤æ³•å’Œç‰¹æ®Šå‡½æ•°</li><li>[ ] ç”¨ FMAï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨ï¼‰</li><li>[ ] è€ƒè™‘æ··åˆç²¾åº¦</li></ul><h3 id="5-zi-yuan-ping-heng" tabindex="-1" id="5-èµ„æºå¹³è¡¡">5. èµ„æºå¹³è¡¡</h3><ul><li>[ ] ç›‘æ§å¯„å­˜å™¨ä½¿ç”¨</li><li>[ ] ä½¿ç”¨ launch_bounds</li><li>[ ] å®æµ‹ä¸åŒé…ç½®</li></ul><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬å…­ç« æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å·¥ç¨‹å®è·µï¼š</p><p><strong>å†…å­˜åˆå¹¶æ ¸å¿ƒ</strong>ï¼šWarp çº¿ç¨‹è®¿é—®è¿ç»­åœ°å€ï¼Œäº‹åŠ¡æ•°æœ€å°‘ã€‚çŸ©é˜µæŒ‰è¡Œè®¿é—®å¥½ï¼ŒæŒ‰åˆ—è®¿é—®å·®ã€‚ç”¨å…±äº«å†…å­˜è½¬æ¢è®¿é—®æ¨¡å¼ã€‚</p><p><strong>åˆ†æ”¯å‘æ•£å›é¡¾</strong>ï¼šWarp å†…èµ°ä¸åŒåˆ†æ”¯ä¼šä¸²è¡ŒåŒ–ã€‚æŒ‰ Warp è¾¹ç•Œåˆ’åˆ†ä»»åŠ¡ï¼Œç”¨ç®—æœ¯æ›¿ä»£åˆ†æ”¯ã€‚</p><p><strong>æŒ‡ä»¤ååé‡</strong>ï¼šé™¤æ³•æ…¢ 8 å€ï¼Œç‰¹æ®Šå‡½æ•°æ…¢ 4 å€ã€‚é¢„è®¡ç®—å€’æ•°ï¼Œç”¨å¿«é€Ÿè¿‘ä¼¼ï¼Œè€ƒè™‘æ··åˆç²¾åº¦ã€‚</p><p><strong>çº¿ç¨‹ç²’åº¦</strong>ï¼šæ¯çº¿ç¨‹å¤„ç†å¤šä¸ªå…ƒç´ å¯æé«˜æ•ˆç‡ã€‚Grid-stride loop æ˜¯é€šç”¨æ¨¡å¼ã€‚</p><p><strong>èµ„æºå¹³è¡¡</strong>ï¼šå ç”¨ç‡ä¸æ˜¯è¶Šé«˜è¶Šå¥½ã€‚è®¡ç®—å¯†é›†å‹å¯æ¥å—ä½å ç”¨ç‡ï¼Œå†…å­˜å¯†é›†å‹éœ€è¦é«˜å ç”¨ç‡æ¥éšè—å»¶è¿Ÿã€‚</p><p><strong>å·¥å…·é©±åŠ¨ä¼˜åŒ–</strong>ï¼šç”¨ Nsight Compute åˆ†æç“¶é¢ˆï¼Œä¸è¦çŒœæµ‹ã€‚Memory Throughput å’Œ SM Throughput æŒ‡æ˜ä¼˜åŒ–æ–¹å‘ã€‚</p><p>è¿™äº›æŠ€å·§ç»„åˆä½¿ç”¨ï¼Œèƒ½è®©ä»£ç æ€§èƒ½å†æå‡æ•°å€ã€‚ä¸‹ä¸€ç« å¼€å§‹å­¦ä¹ å…·ä½“çš„å¹¶è¡Œæ¨¡å¼â€”â€”å·ç§¯ã€è§„çº¦ã€å‰ç¼€å’Œï¼Œè¿™äº›éƒ½éœ€è¦æœ¬ç« çš„ä¼˜åŒ–æŠ€æœ¯ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-best-practices-guide/">CUDA C++ Best Practices Guide</a></li><li><a href="https://docs.nvidia.com/nsight-compute/">Nsight Compute Documentation</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot; id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç¬¬äº”ç« å­¦äº†å†…å­˜å±‚æ¬¡å’Œ Tiling æŠ€æœ¯ï¼ŒçŸ©é˜µä¹˜æ³•æ€§èƒ½æå‡äº† 10</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://smarter.xin/tags/performance-optimization/"/>
    
    <category term="å†…å­˜åˆå¹¶" scheme="https://smarter.xin/tags/memory-coalescing/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬äº”ç« ï¼šå†…å­˜æ¶æ„å’Œæ•°æ®å±€éƒ¨æ€§</title>
    <link href="https://smarter.xin/posts/3bb3179b/"/>
    <id>https://smarter.xin/posts/3bb3179b/</id>
    <published>2026-01-16T02:16:08.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬å››ç« ç†è§£äº†GPUçš„è°ƒåº¦æœºåˆ¶å’Œç¡¬ä»¶æ¶æ„ï¼Œè¿™ä¸€ç« è¿›å…¥æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒâ€”â€”å†…å­˜ã€‚GPUè®¡ç®—èƒ½åŠ›å¼ºå¤§ï¼Œä½†æ•°æ®ä¾›åº”è·Ÿä¸ä¸Šå°±ç™½æ­ã€‚ç¬¬äº”ç« è®²è§£GPUçš„å†…å­˜å±‚æ¬¡ç»“æ„ï¼Œé‡ç‚¹æ˜¯Shared Memoryå’ŒTilingæŠ€æœ¯ã€‚æŒæ¡è¿™äº›ï¼ŒçŸ©é˜µä¹˜æ³•æ€§èƒ½å¯ä»¥æå‡10å€ä»¥ä¸Šã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="nei-cun-dai-kuan-xing-neng-de-tian-hua-ban" tabindex="-1" id="å†…å­˜å¸¦å®½ï¼šæ€§èƒ½çš„å¤©èŠ±æ¿">å†…å­˜å¸¦å®½ï¼šæ€§èƒ½çš„å¤©èŠ±æ¿</h2><h3 id="wen-ti-de-ben-zhi" tabindex="-1" id="é—®é¢˜çš„æœ¬è´¨">é—®é¢˜çš„æœ¬è´¨</h3><p>å›é¡¾ç¬¬ä¸‰ç« çš„çŸ©é˜µä¹˜æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__global__ void matMul(float *M, float *N, float *P, int width) &#123;</span><br><span class="line">    int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    if (row &lt; width &amp;&amp; col &lt; width) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int k = 0; k &lt; width; k++) &#123;</span><br><span class="line">            sum += M[row * width + k] * N[k * width + col];</span><br><span class="line">        &#125;</span><br><span class="line">        P[row * width + col] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¡ç®— P[row][col] éœ€è¦è¯»å– M çš„ä¸€è¡Œå’Œ N çš„ä¸€åˆ—ï¼Œå…± 2Ã—width ä¸ªå…ƒç´ ã€‚æ¯ä¸ªå…ƒç´  4 å­—èŠ‚ï¼Œwidth=1024 æ—¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ¯çº¿ç¨‹è¯»å–ï¼š2 Ã— 1024 Ã— 4 = 8192 å­—èŠ‚</span><br><span class="line">æ¯çº¿ç¨‹è®¡ç®—ï¼š2 Ã— 1024 = 2048 FLOP</span><br><span class="line">ç®—æœ¯å¼ºåº¦ï¼š2048 / 8192 = 0.25 FLOP/Byte</span><br></pre></td></tr></table></figure><p>ç°ä»£ GPU å³°å€¼ 10+ TFLOPSï¼Œå¸¦å®½ 500+ GB/sï¼Œéœ€è¦ 20 FLOP/Byte æ‰èƒ½è·‘æ»¡è®¡ç®—å•å…ƒã€‚å®é™…åªæœ‰ 0.25ï¼Œ<strong>GPU å¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰æ•°æ®</strong>ã€‚</p><h3 id="shu-ju-zhong-fu-fang-wen" tabindex="-1" id="æ•°æ®é‡å¤è®¿é—®">æ•°æ®é‡å¤è®¿é—®</h3><p>æ›´ä¸¥é‡çš„æ˜¯ï¼š<strong>åŒä¸€æ•°æ®è¢«å¤šä¸ªçº¿ç¨‹é‡å¤è¯»å–</strong>ã€‚</p><p>M[i][k] è¢«ç¬¬ i è¡Œçš„æ‰€æœ‰çº¿ç¨‹è¯»å–ï¼ŒN[k][j] è¢«ç¬¬ j åˆ—çš„æ‰€æœ‰çº¿ç¨‹è¯»å–ã€‚1024Ã—1024 çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ è¢«è¯» 1024 æ¬¡ï¼Œä½†æ¯æ¬¡éƒ½ä»å…¨å±€å†…å­˜ï¼ˆDRAMï¼‰è¯»ã€‚</p><p>è¿™å°±æ˜¯ä¼˜åŒ–çš„åˆ‡å…¥ç‚¹ï¼š<strong>è®©æ•°æ®å¤ç”¨å‘ç”Ÿåœ¨å¿«é€Ÿå­˜å‚¨ä¸Šï¼Œè€Œä¸æ˜¯å…¨å±€å†…å­˜</strong>ã€‚</p><h2 id="gpu-nei-cun-ceng-ci" tabindex="-1" id="GPU-å†…å­˜å±‚æ¬¡">GPU å†…å­˜å±‚æ¬¡</h2><h3 id="ceng-ci-jie-gou" tabindex="-1" id="å±‚æ¬¡ç»“æ„">å±‚æ¬¡ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                   Host Memory               â”‚   CPU DDR4/DDR5</span><br><span class="line">â”‚                   (GB çº§åˆ«)                  â”‚   ~50 GB/s</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚              Global Memory (DRAM)           â”‚   GPU æ˜¾å­˜</span><br><span class="line">â”‚                  (GB çº§åˆ«)                   â”‚   ~500 GB/s</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚    L2 Cache (SM å…±äº«)                        â”‚   å‡  MB</span><br><span class="line">â”‚                                              â”‚   ~1-2 TB/s</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   Shared     â”‚   Shared     â”‚   Shared      â”‚   æ¯ SM</span><br><span class="line">â”‚   Memory     â”‚   Memory     â”‚   Memory      â”‚   ~100 KB</span><br><span class="line">â”‚   L1 Cache   â”‚   L1 Cache   â”‚   L1 Cache    â”‚   ~10 TB/s</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  Registers   â”‚  Registers   â”‚  Registers    â”‚   æ¯çº¿ç¨‹</span><br><span class="line">â”‚              â”‚              â”‚               â”‚   ~å‡ å TB/s</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">     SM 0           SM 1           SM 2</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒè§„å¾‹</strong>ï¼šè¶Šé è¿‘è®¡ç®—å•å…ƒï¼Œå®¹é‡è¶Šå°ï¼Œé€Ÿåº¦è¶Šå¿«ã€‚</p><h3 id="ge-ji-cun-chu-te-dian" tabindex="-1" id="å„çº§å­˜å‚¨ç‰¹ç‚¹">å„çº§å­˜å‚¨ç‰¹ç‚¹</h3><table><thead><tr><th>å­˜å‚¨ç±»å‹</th><th>ä½œç”¨åŸŸ</th><th>å®¹é‡</th><th>å»¶è¿Ÿ</th><th>ç¨‹åºå‘˜æ§åˆ¶</th></tr></thead><tbody><tr><td>å¯„å­˜å™¨</td><td>å•çº¿ç¨‹</td><td>~255ä¸ª/çº¿ç¨‹</td><td>1å‘¨æœŸ</td><td>éšå¼ï¼ˆå˜é‡ï¼‰</td></tr><tr><td>å…±äº«å†…å­˜</td><td>Blockå†…</td><td>~100KB/SM</td><td>~20å‘¨æœŸ</td><td>æ˜¾å¼</td></tr><tr><td>L1ç¼“å­˜</td><td>SMå†…</td><td>~128KB/SM</td><td>~20å‘¨æœŸ</td><td>éƒ¨åˆ†</td></tr><tr><td>L2ç¼“å­˜</td><td>å…¨å±€</td><td>~6MB</td><td>~200å‘¨æœŸ</td><td>æ— </td></tr><tr><td>å…¨å±€å†…å­˜</td><td>å…¨å±€</td><td>~æ•°GB</td><td>~400å‘¨æœŸ</td><td>æ˜¾å¼</td></tr></tbody></table><p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š</p><ul><li><strong>å¯„å­˜å™¨</strong>æœ€å¿«ï¼Œä½†å®¹é‡æœ‰é™ï¼Œä¸”åªå±äºå•ä¸ªçº¿ç¨‹</li><li><strong>å…±äº«å†…å­˜</strong>æ˜¯ç¨‹åºå‘˜å¯æ§çš„ Block çº§ç¼“å­˜ï¼Œè¿™æ˜¯ä¼˜åŒ–çš„ä¸»æˆ˜åœº</li><li><strong>å…¨å±€å†…å­˜</strong>æ˜¯å”¯ä¸€èƒ½å®¹çº³å¤§æ•°æ®çš„åœ°æ–¹ï¼Œä½†å¤ªæ…¢</li></ul><h2 id="gong-xiang-nei-cun-shared-memory" tabindex="-1" id="å…±äº«å†…å­˜ï¼ˆShared-Memoryï¼‰">å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰</h2><h3 id="ji-ben-gai-nian" tabindex="-1" id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3><p>å…±äº«å†…å­˜æ˜¯ SM ä¸Šçš„å¯ç¼–ç¨‹ç¼“å­˜ï¼š</p><ul><li><strong>Block å†…æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼šåŒ Block çš„çº¿ç¨‹å¯ä»¥è¯»å†™åŒä¸€å—å…±äº«å†…å­˜</li><li><strong>ç”Ÿå‘½å‘¨æœŸä¸ Block ç»‘å®š</strong>ï¼šBlock ç»“æŸï¼Œå…±äº«å†…å­˜é‡Šæ”¾</li><li><strong>ä½å»¶è¿Ÿ</strong>ï¼šçº¦ 20 å‘¨æœŸï¼Œæ¯”å…¨å±€å†…å­˜å¿« 20 å€</li></ul><h3 id="sheng-ming-yu-fa" tabindex="-1" id="å£°æ˜è¯­æ³•">å£°æ˜è¯­æ³•</h3><p><strong>é™æ€åˆ†é…</strong>ï¼ˆç¼–è¯‘æ—¶ç¡®å®šå¤§å°ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__global__ void kernel() &#123;</span><br><span class="line">    __shared__ float sharedData[256];  // Block å†…å…±äº«</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŠ¨æ€åˆ†é…</strong>ï¼ˆè¿è¡Œæ—¶ç¡®å®šå¤§å°ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__global__ void kernel() &#123;</span><br><span class="line">    extern __shared__ float sharedData[];  // å¤§å°ç”±å¯åŠ¨é…ç½®æŒ‡å®š</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯åŠ¨æ—¶æŒ‡å®šå…±äº«å†…å­˜å¤§å°</span><br><span class="line">kernel&lt;&lt;&lt;grid, block, sharedMemBytes&gt;&gt;&gt;(args);</span><br></pre></td></tr></table></figure><h3 id="tong-bu-syncthreads" tabindex="-1" id="åŒæ­¥ï¼š-syncthreads">åŒæ­¥ï¼š__syncthreads()</h3><p>å…±äº«å†…å­˜æ˜¯ Block å†…å…±äº«çš„ï¼Œéœ€è¦åŒæ­¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float data[256];</span><br><span class="line"></span><br><span class="line">// é˜¶æ®µ1ï¼šæ‰€æœ‰çº¿ç¨‹å†™å…¥</span><br><span class="line">data[threadIdx.x] = input[globalIdx];</span><br><span class="line"></span><br><span class="line">__syncthreads();  // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆå†™å…¥</span><br><span class="line"></span><br><span class="line">// é˜¶æ®µ2ï¼šæ‰€æœ‰çº¿ç¨‹è¯»å–ï¼ˆæ­¤æ—¶æ•°æ®å·²å°±ç»ªï¼‰</span><br><span class="line">float val = data[(threadIdx.x + 1) % 256];</span><br></pre></td></tr></table></figure><p><strong>__syncthreads() æ˜¯æ …æ åŒæ­¥</strong>ï¼šBlock å†…æ‰€æœ‰çº¿ç¨‹å¿…é¡»åˆ°è¾¾è¿™ä¸€ç‚¹ï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p><strong>å¸¸è§é”™è¯¯</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å±é™©ï¼æ¡ä»¶å†…ä½¿ç”¨ syncthreads</span><br><span class="line">if (threadIdx.x &lt; 128) &#123;</span><br><span class="line">    data[threadIdx.x] = ...;</span><br><span class="line">    __syncthreads();  // åªæœ‰éƒ¨åˆ†çº¿ç¨‹æ‰§è¡Œï¼Œä¼šæ­»é”ï¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ­¥å¿…é¡»ä¿è¯ Block å†…æ‰€æœ‰æ´»è·ƒçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°ã€‚</p><h2 id="tiling-fen-kuai-chu-li" tabindex="-1" id="Tilingï¼šåˆ†å—å¤„ç†">Tilingï¼šåˆ†å—å¤„ç†</h2><h3 id="he-xin-si-xiang" tabindex="-1" id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3><p>æ—¢ç„¶å…¨å±€å†…å­˜æ…¢ä½†å…±äº«å†…å­˜å¿«ï¼Œç­–ç•¥å°±æ˜¯ï¼š</p><ol><li><strong>åˆ†å—åŠ è½½</strong>ï¼šå°†æ•°æ®åˆ†æˆå°å—ï¼ˆTileï¼‰ï¼Œé€å—åŠ è½½åˆ°å…±äº«å†…å­˜</li><li><strong>è®¡ç®—å¤ç”¨</strong>ï¼šåœ¨å…±äº«å†…å­˜ä¸­å®Œæˆè¯¥å—çš„æ‰€æœ‰è®¡ç®—</li><li><strong>ç§»åŠ¨çª—å£</strong>ï¼šå¤„ç†ä¸‹ä¸€å—ï¼Œç›´åˆ°å®Œæˆ</li></ol><p>è¿™æ ·ï¼Œæ¯ä¸ªæ•°æ®ä»å…¨å±€å†…å­˜åªè¯»ä¸€æ¬¡ï¼Œä½†åœ¨å…±äº«å†…å­˜ä¸­è¢«å¤šæ¬¡ä½¿ç”¨ã€‚</p><h3 id="tiled-ju-zhen-cheng-fa" tabindex="-1" id="Tiled-çŸ©é˜µä¹˜æ³•">Tiled çŸ©é˜µä¹˜æ³•</h3><p><strong>é—®é¢˜</strong>ï¼šè®¡ç®— P = M Ã— Nï¼Œæ¯ä¸ª P[i][j] = Î£ M[i][k] Ã— N[k][j]</p><p><strong>æœ´ç´ ç‰ˆæœ¬</strong>ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹è¯»å–æ•´è¡Œå’Œæ•´åˆ—ï¼ˆå¤§é‡é‡å¤è¯»å–ï¼‰</p><p><strong>Tiled ç‰ˆæœ¬</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   M çŸ©é˜µ       â”‚   â”‚   N çŸ©é˜µ       â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”        â”‚   â”‚      â”Œâ”€â”€â”€â”    â”‚</span><br><span class="line">â”‚  â”‚Tileâ”‚ â”€â”€â”€â”€â†’ â”‚   â”‚      â”‚Tileâ”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”˜        â”‚   â”‚      â””â”€â”€â”€â”˜    â”‚</span><br><span class="line">â”‚               â”‚   â”‚        â”‚      â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                             â†“</span><br><span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                    â”‚   P çŸ©é˜µ       â”‚</span><br><span class="line">                    â”‚      â”Œâ”€â”€â”€â”    â”‚</span><br><span class="line">                    â”‚      â”‚è®¡ç®—â”‚    â”‚</span><br><span class="line">                    â”‚      â””â”€â”€â”€â”˜    â”‚</span><br><span class="line">                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤</strong>ï¼š</p><ol><li>å°† M çš„ä¸€ä¸ª Tile å’Œ N çš„ä¸€ä¸ª Tile åŠ è½½åˆ°å…±äº«å†…å­˜</li><li>Block å†…æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨å…±äº«å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œéƒ¨åˆ†è®¡ç®—</li><li>åŠ è½½ä¸‹ä¸€å¯¹ Tileï¼Œç´¯åŠ ç»“æœ</li><li>é‡å¤ç›´åˆ°å®Œæˆ</li></ol><h3 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#define TILE_WIDTH 16</span><br><span class="line"></span><br><span class="line">__global__ void matMulTiled(float *M, float *N, float *P, int width) &#123;</span><br><span class="line">    // å…±äº«å†…å­˜å£°æ˜</span><br><span class="line">    __shared__ float Mds[TILE_WIDTH][TILE_WIDTH];</span><br><span class="line">    __shared__ float Nds[TILE_WIDTH][TILE_WIDTH];</span><br><span class="line">    </span><br><span class="line">    int bx = blockIdx.x, by = blockIdx.y;</span><br><span class="line">    int tx = threadIdx.x, ty = threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // è®¡ç®—è¯¥çº¿ç¨‹è´Ÿè´£çš„ P å…ƒç´ ä½ç½®</span><br><span class="line">    int row = by * TILE_WIDTH + ty;</span><br><span class="line">    int col = bx * TILE_WIDTH + tx;</span><br><span class="line">    </span><br><span class="line">    float Pvalue = 0;</span><br><span class="line">    </span><br><span class="line">    // åˆ†å—å¾ªç¯</span><br><span class="line">    for (int ph = 0; ph &lt; width / TILE_WIDTH; ++ph) &#123;</span><br><span class="line">        </span><br><span class="line">        // åä½œåŠ è½½ M çš„ Tile</span><br><span class="line">        Mds[ty][tx] = M[row * width + (ph * TILE_WIDTH + tx)];</span><br><span class="line">        </span><br><span class="line">        // åä½œåŠ è½½ N çš„ Tile</span><br><span class="line">        Nds[ty][tx] = N[(ph * TILE_WIDTH + ty) * width + col];</span><br><span class="line">        </span><br><span class="line">        __syncthreads();  // ç¡®ä¿ Tile åŠ è½½å®Œæˆ</span><br><span class="line">        </span><br><span class="line">        // ä½¿ç”¨å…±äº«å†…å­˜è®¡ç®—éƒ¨åˆ†ç‚¹ç§¯</span><br><span class="line">        for (int k = 0; k &lt; TILE_WIDTH; ++k) &#123;</span><br><span class="line">            Pvalue += Mds[ty][k] * Nds[k][tx];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        __syncthreads();  // ç¡®ä¿è®¡ç®—å®Œæˆå†åŠ è½½ä¸‹ä¸€ä¸ª Tile</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    P[row * width + col] = Pvalue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="guan-jian-dian-jie-xi" tabindex="-1" id="å…³é”®ç‚¹è§£æ">å…³é”®ç‚¹è§£æ</h3><p><strong>1. åä½œåŠ è½½</strong></p><p>Block å†…çš„çº¿ç¨‹åˆ†å·¥åŠ è½½ Tileï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mds[ty][tx] = M[row * width + (ph * TILE_WIDTH + tx)];</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªçº¿ç¨‹åŠ è½½ä¸€ä¸ªå…ƒç´ ï¼Œ16Ã—16 = 256 ä¸ªçº¿ç¨‹åŠ è½½ 256 ä¸ªå…ƒç´ ã€‚æ¯”å•çº¿ç¨‹åŠ è½½æ•´ä¸ª Tile é«˜æ•ˆå¾—å¤šã€‚</p><p><strong>2. ä¸¤æ¬¡åŒæ­¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__syncthreads();  // ç¬¬ä¸€æ¬¡ï¼šç¡®ä¿æ•°æ®åŠ è½½å®Œæˆ</span><br><span class="line">// ... è®¡ç®— ...</span><br><span class="line">__syncthreads();  // ç¬¬äºŒæ¬¡ï¼šç¡®ä¿è®¡ç®—å®Œæˆå†è¦†ç›–å…±äº«å†…å­˜</span><br></pre></td></tr></table></figure><p>ä¸¤æ¬¡åŒæ­¥éƒ½å¿…è¦ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡ï¼šé˜²æ­¢è¯»åˆ°æœªåŠ è½½çš„æ•°æ®</li><li>ç¬¬äºŒæ¬¡ï¼šé˜²æ­¢å¿«çº¿ç¨‹è¦†ç›–æ…¢çº¿ç¨‹è¿˜åœ¨ç”¨çš„æ•°æ®</li></ul><p><strong>3. å†…å±‚å¾ªç¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int k = 0; k &lt; TILE_WIDTH; ++k) &#123;</span><br><span class="line">    Pvalue += Mds[ty][k] * Nds[k][tx];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ªç¯åªè®¿é—®å…±äº«å†…å­˜ï¼Œæ²¡æœ‰å…¨å±€å†…å­˜è®¿é—®ã€‚è¿™æ˜¯æ€§èƒ½æå‡çš„æ¥æºã€‚</p><h3 id="xing-neng-fen-xi" tabindex="-1" id="æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</h3><p><strong>æœ´ç´ ç‰ˆæœ¬</strong>ï¼š</p><ul><li>æ¯çº¿ç¨‹è¯»å–å…¨å±€å†…å­˜ï¼š2 Ã— width æ¬¡</li><li>æ€»å…¨å±€å†…å­˜è®¿é—®ï¼šwidthÂ³ Ã— 2ï¼ˆè¯»ï¼‰+ widthÂ²ï¼ˆå†™ï¼‰</li></ul><p><strong>Tiled ç‰ˆæœ¬</strong>ï¼š</p><ul><li>æ¯ Tile é˜¶æ®µï¼šBlock è¯» 2 Ã— TILE_WIDTHÂ² ä¸ªå…ƒç´ </li><li>å…± width/TILE_WIDTH ä¸ªé˜¶æ®µ</li><li>æ¯çº¿ç¨‹è´¡çŒ®ï¼š2 Ã— width æ¬¡ï¼ˆä¸æœ´ç´ ç›¸åŒï¼Ÿä¸å¯¹ï¼ï¼‰</li></ul><p><strong>å…³é”®å·®å¼‚</strong>ï¼šåœ¨ Tiled ç‰ˆæœ¬ä¸­ï¼Œæ¯ä¸ªå…¨å±€å†…å­˜è¯»å–è¢« TILE_WIDTH ä¸ªçº¿ç¨‹å…±äº«ä½¿ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å…¨å±€å†…å­˜è®¿é—®å‡å°‘å€æ•° = TILE_WIDTH</span><br><span class="line">ç®—æœ¯å¼ºåº¦æå‡ = TILE_WIDTH å€</span><br></pre></td></tr></table></figure><p>TILE_WIDTH = 16 æ—¶ï¼Œç®—æœ¯å¼ºåº¦ä» 0.25 æå‡åˆ° 4 FLOP/Byteã€‚TILE_WIDTH = 32 æ—¶å¯è¾¾ 8 FLOP/Byteã€‚</p><h3 id="bian-jie-chu-li" tabindex="-1" id="è¾¹ç•Œå¤„ç†">è¾¹ç•Œå¤„ç†</h3><p>ä¸Šé¢çš„ä»£ç å‡è®¾ width æ˜¯ TILE_WIDTH çš„å€æ•°ã€‚å®é™…éœ€è¦å¤„ç†è¾¹ç•Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å¸¦è¾¹ç•Œæ£€æŸ¥çš„åŠ è½½</span><br><span class="line">if (row &lt; width &amp;&amp; (ph * TILE_WIDTH + tx) &lt; width)</span><br><span class="line">    Mds[ty][tx] = M[row * width + (ph * TILE_WIDTH + tx)];</span><br><span class="line">else</span><br><span class="line">    Mds[ty][tx] = 0;  // è¶Šç•Œå…ƒç´ å¡«0</span><br><span class="line"></span><br><span class="line">if ((ph * TILE_WIDTH + ty) &lt; width &amp;&amp; col &lt; width)</span><br><span class="line">    Nds[ty][tx] = N[(ph * TILE_WIDTH + ty) * width + col];</span><br><span class="line">else</span><br><span class="line">    Nds[ty][tx] = 0;</span><br></pre></td></tr></table></figure><p>å¡« 0 ä¸å½±å“åŠ æ³•ç»“æœï¼Œæ˜¯å¤„ç†è¾¹ç•Œçš„å¸¸ç”¨æŠ€å·§ã€‚</p><h2 id="nei-cun-fang-wen-mo-shi" tabindex="-1" id="å†…å­˜è®¿é—®æ¨¡å¼">å†…å­˜è®¿é—®æ¨¡å¼</h2><h3 id="he-bing-fang-wen-coalesced-access" tabindex="-1" id="åˆå¹¶è®¿é—®ï¼ˆCoalesced-Accessï¼‰">åˆå¹¶è®¿é—®ï¼ˆCoalesced Accessï¼‰</h3><p>GPU å†…å­˜æ§åˆ¶å™¨æŒ‰ <strong>32 å­—èŠ‚æˆ– 128 å­—èŠ‚</strong> çš„äº‹åŠ¡è¯»å†™æ•°æ®ã€‚å¦‚æœ Warp ä¸­çš„çº¿ç¨‹è®¿é—®è¿ç»­åœ°å€ï¼Œå¯ä»¥åˆå¹¶æˆä¸€æ¬¡äº‹åŠ¡ï¼š</p><p><strong>å¥½çš„è®¿é—®æ¨¡å¼</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ 0,1,2,...,31 è®¿é—®è¿ç»­åœ°å€</span><br><span class="line">data[threadIdx.x];  // ä¸€æ¬¡ 128B äº‹åŠ¡</span><br></pre></td></tr></table></figure><p><strong>å·®çš„è®¿é—®æ¨¡å¼</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// çº¿ç¨‹ 0,1,2,...,31 è®¿é—®è·¨æ­¥åœ°å€</span><br><span class="line">data[threadIdx.x * 32];  // 32 æ¬¡äº‹åŠ¡ï¼</span><br></pre></td></tr></table></figure><p><strong>çŸ©é˜µè®¿é—®çš„é™·é˜±</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// P[i][j] éå†</span><br><span class="line">// æŒ‰è¡Œéå†ï¼ˆå¥½ï¼‰ï¼šdata[row * width + col]ï¼Œcol è¿ç»­</span><br><span class="line">// æŒ‰åˆ—éå†ï¼ˆå·®ï¼‰ï¼šdata[row * width + col]ï¼Œrow è¿ç»­ï¼ˆè·¨æ­¥ = widthï¼‰</span><br></pre></td></tr></table></figure><h3 id="gong-xiang-nei-cun-bank-chong-tu" tabindex="-1" id="å…±äº«å†…å­˜-Bank-å†²çª">å…±äº«å†…å­˜ Bank å†²çª</h3><p>å…±äº«å†…å­˜åˆ†æˆ 32 ä¸ª <strong>Bank</strong>ï¼Œæ¯ä¸ª Bank å®½åº¦ 4 å­—èŠ‚ã€‚ä¸åŒ Bank å¯ä»¥åŒæ—¶è®¿é—®ï¼Œä½†åŒä¸€ Bank çš„ä¸åŒåœ°å€ä¼šä¸²è¡ŒåŒ–ã€‚</p><p><strong>Bank æ˜ å°„</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ°å€ 0,32,64,...  â†’ Bank 0</span><br><span class="line">åœ°å€ 4,36,68,...  â†’ Bank 1</span><br><span class="line">åœ°å€ 8,40,72,...  â†’ Bank 2</span><br><span class="line">...</span><br><span class="line">åœ°å€ 124,156,... â†’ Bank 31</span><br></pre></td></tr></table></figure><p><strong>æ— å†²çª</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[threadIdx.x];      // 32 çº¿ç¨‹è®¿é—® 32 ä¸ª Bank</span><br><span class="line">data[threadIdx.x * 2];  // è·¨æ­¥ 2ï¼Œè®¿é—® Bank 0,2,4,...ï¼ˆæ— å†²çªï¼‰</span><br></pre></td></tr></table></figure><p><strong>æœ‰å†²çª</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[threadIdx.x * 32]; // æ‰€æœ‰çº¿ç¨‹è®¿é—® Bank 0ï¼32-way å†²çª</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ä¾‹â€”â€”å¹¿æ’­</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[0];  // æ‰€æœ‰çº¿ç¨‹è¯»åŒä¸€åœ°å€ï¼Œç¡¬ä»¶å¹¿æ’­ï¼Œæ— å†²çª</span><br></pre></td></tr></table></figure><h3 id="ju-zhen-zhuan-zhi-de-bank-chong-tu" tabindex="-1" id="çŸ©é˜µè½¬ç½®çš„-Bank-å†²çª">çŸ©é˜µè½¬ç½®çš„ Bank å†²çª</h3><p>è€ƒè™‘å…±äº«å†…å­˜ä¸­ 16Ã—16 çš„çŸ©é˜µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float tile[16][16];</span><br><span class="line"></span><br><span class="line">// åŠ è½½ï¼ˆåˆ—è®¿é—®ï¼‰</span><br><span class="line">tile[ty][tx] = input[row * width + col];  // æ— å†²çª</span><br><span class="line"></span><br><span class="line">// å­˜å‚¨ï¼ˆè¡Œè®¿é—®ï¼‰</span><br><span class="line">output[col * width + row] = tile[tx][ty];  // æœ‰å†²çªï¼</span><br></pre></td></tr></table></figure><p><code>tile[tx][ty]</code> ä½¿å¾—çº¿ç¨‹ 0,1,2,â€¦,15 åˆ†åˆ«è®¿é—® tile[0][ty], tile[1][ty], â€¦ï¼Œè¿™äº›å…ƒç´ åœ°å€ä¸º ty, ty+16, ty+32, â€¦ï¼Œæ­¥é•¿ 16Ã—4 = 64 å­—èŠ‚ = 16 ä¸ª Bankã€‚éƒ¨åˆ†çº¿ç¨‹ä¼šè®¿é—®åŒä¸€ Bankã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆâ€”â€”Padding</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__shared__ float tile[16][17];  // å¤šåŠ ä¸€åˆ—</span><br><span class="line"></span><br><span class="line">// ç°åœ¨ tile[i][j] çš„åœ°å€æ˜¯ i*17 + j</span><br><span class="line">// æ­¥é•¿å˜æˆ 17Ã—4 = 68 å­—èŠ‚ï¼Œä¸å†å¯¹é½</span><br></pre></td></tr></table></figure><p>Padding æ‰“ç ´äº† Bank å¯¹é½ï¼Œæ¶ˆé™¤å†²çªã€‚ä»£ä»·æ˜¯æµªè´¹ä¸€ç‚¹å…±äº«å†…å­˜ã€‚</p><h2 id="chang-liang-nei-cun-constant-memory" tabindex="-1" id="å¸¸é‡å†…å­˜ï¼ˆConstant-Memoryï¼‰">å¸¸é‡å†…å­˜ï¼ˆConstant Memoryï¼‰</h2><h3 id="te-dian" tabindex="-1" id="ç‰¹ç‚¹">ç‰¹ç‚¹</h3><ul><li><strong>åªè¯»</strong>ï¼šKernel å†…ä¸èƒ½å†™</li><li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šæœ‰ä¸“ç”¨ç¼“å­˜ï¼Œå¹¿æ’­è®¿é—®æ•ˆç‡é«˜</li><li><strong>å®¹é‡æœ‰é™</strong>ï¼š64 KB</li></ul><h3 id="gua-yong-chang-jing" tabindex="-1" id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3><p>æ‰€æœ‰çº¿ç¨‹è¯»ç›¸åŒæ•°æ®ï¼ˆå¦‚å·ç§¯æ ¸ã€å˜æ¢çŸ©é˜µï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__constant__ float kernel[9];  // å£°æ˜</span><br><span class="line"></span><br><span class="line">// Host ç«¯å†™å…¥</span><br><span class="line">cudaMemcpyToSymbol(kernel, h_kernel, 9 * sizeof(float));</span><br><span class="line"></span><br><span class="line">// Kernel å†…ä½¿ç”¨</span><br><span class="line">__global__ void conv(...) &#123;</span><br><span class="line">    float sum = 0;</span><br><span class="line">    for (int i = 0; i &lt; 9; i++) &#123;</span><br><span class="line">        sum += data[i] * kernel[i];  // æ‰€æœ‰çº¿ç¨‹è¯»ç›¸åŒ kernel[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¯ä¸ªçº¿ç¨‹è¯»ä¸åŒåœ°å€ï¼Œå¸¸é‡å†…å­˜åè€Œæ›´æ…¢ï¼ˆä¸²è¡ŒåŒ–ï¼‰ã€‚</p><h2 id="ji-cun-qi-you-hua" tabindex="-1" id="å¯„å­˜å™¨ä¼˜åŒ–">å¯„å­˜å™¨ä¼˜åŒ–</h2><h3 id="ji-cun-qi-de-zhong-yao-xing" tabindex="-1" id="å¯„å­˜å™¨çš„é‡è¦æ€§">å¯„å­˜å™¨çš„é‡è¦æ€§</h3><p>å¯„å­˜å™¨æ˜¯æœ€å¿«çš„å­˜å‚¨ï¼Œå•å‘¨æœŸå»¶è¿Ÿã€‚ä½†æ•°é‡æœ‰é™ï¼ˆæ¯ SM çº¦ 64K ä¸ªï¼‰ï¼Œè¿‡åº¦ä½¿ç”¨ä¼šå¯¼è‡´ï¼š</p><ol><li><strong>å¯„å­˜å™¨æº¢å‡ºï¼ˆSpillingï¼‰</strong>ï¼šæº¢å‡ºåˆ° Local Memoryï¼ˆå®é™…æ˜¯å…¨å±€å†…å­˜ï¼‰ï¼Œææ…¢</li><li><strong>å ç”¨ç‡ä¸‹é™</strong>ï¼šæ¯çº¿ç¨‹ç”¨æ›´å¤šå¯„å­˜å™¨ï¼ŒSM èƒ½å®¹çº³çš„çº¿ç¨‹æ•°å‡å°‘</li></ol><h3 id="cha-kan-ji-cun-qi-shi-yong" tabindex="-1" id="æŸ¥çœ‹å¯„å­˜å™¨ä½¿ç”¨">æŸ¥çœ‹å¯„å­˜å™¨ä½¿ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc --ptxas-options=-v kernel.cu</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ptxas info: Used 32 registers, ...</span><br></pre></td></tr></table></figure><h3 id="kong-zhi-ce-lue" tabindex="-1" id="æ§åˆ¶ç­–ç•¥">æ§åˆ¶ç­–ç•¥</h3><p><strong>ç¼–è¯‘å™¨æç¤º</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__global__ void __launch_bounds__(256, 4) kernel(...) &#123;</span><br><span class="line">    // å‘Šè¯‰ç¼–è¯‘å™¨ï¼šæ¯ Block 256 çº¿ç¨‹ï¼Œæ¯ SM è‡³å°‘ 4 ä¸ª Block</span><br><span class="line">    // ç¼–è¯‘å™¨æ®æ­¤ä¼˜åŒ–å¯„å­˜å™¨åˆ†é…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼–è¯‘é€‰é¡¹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -maxrregcount=32 kernel.cu  <span class="comment"># é™åˆ¶æ¯çº¿ç¨‹æœ€å¤š 32 ä¸ªå¯„å­˜å™¨</span></span><br></pre></td></tr></table></figure><p><strong>æƒè¡¡</strong>ï¼šé™åˆ¶è¿‡ä¸¥å¯èƒ½å¯¼è‡´æº¢å‡ºï¼Œé™åˆ¶è¿‡æ¾å¯èƒ½é™ä½å ç”¨ç‡ã€‚éœ€è¦å®æµ‹ã€‚</p><h2 id="shu-ju-ju-bu-xing-you-hua-qing-dan" tabindex="-1" id="æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–æ¸…å•">æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–æ¸…å•</h2><h3 id="kong-jian-ju-bu-xing" tabindex="-1" id="ç©ºé—´å±€éƒ¨æ€§">ç©ºé—´å±€éƒ¨æ€§</h3><p><strong>å®šä¹‰</strong>ï¼šè®¿é—®çš„æ•°æ®åœ¨å†…å­˜ä¸­ç›¸é‚»</p><p><strong>ä¼˜åŒ–æ‰‹æ®µ</strong>ï¼š</p><ul><li>è¿ç»­è®¿é—®ï¼Œåˆ©ç”¨åˆå¹¶</li><li>æ•°æ®å¸ƒå±€ä¼˜åŒ–ï¼ˆAoS â†’ SoAï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Array of Structuresï¼ˆå·®ï¼‰</span><br><span class="line">struct Particle &#123; float x, y, z; &#125;;</span><br><span class="line">Particle particles[N];</span><br><span class="line">particles[i].x;  // è·¨æ­¥ 12 å­—èŠ‚</span><br><span class="line"></span><br><span class="line">// Structure of Arraysï¼ˆå¥½ï¼‰</span><br><span class="line">struct Particles &#123; float x[N], y[N], z[N]; &#125;;</span><br><span class="line">Particles p;</span><br><span class="line">p.x[i];  // è¿ç»­è®¿é—®</span><br></pre></td></tr></table></figure><h3 id="shi-jian-ju-bu-xing" tabindex="-1" id="æ—¶é—´å±€éƒ¨æ€§">æ—¶é—´å±€éƒ¨æ€§</h3><p><strong>å®šä¹‰</strong>ï¼šåŒä¸€æ•°æ®çŸ­æœŸå†…è¢«å¤šæ¬¡è®¿é—®</p><p><strong>ä¼˜åŒ–æ‰‹æ®µ</strong>ï¼š</p><ul><li>Tiling åˆ°å…±äº«å†…å­˜/å¯„å­˜å™¨</li><li>å¾ªç¯åˆ†å—</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// æ— æ—¶é—´å±€éƒ¨æ€§</span><br><span class="line">for (int k = 0; k &lt; N; k++) &#123;</span><br><span class="line">    C[i][j] += A[i][k] * B[k][j];  // Aã€B æ¯æ¬¡ä»å…¨å±€å†…å­˜è¯»</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æœ‰æ—¶é—´å±€éƒ¨æ€§ï¼ˆTiledï¼‰</span><br><span class="line">for (int tile = 0; tile &lt; N/TILE; tile++) &#123;</span><br><span class="line">    // åŠ è½½ tile åˆ°å…±äº«å†…å­˜</span><br><span class="line">    for (int k = 0; k &lt; TILE; k++) &#123;</span><br><span class="line">        C[i][j] += As[ty][k] * Bs[k][tx];  // ä»å…±äº«å†…å­˜è¯»ï¼Œå¤ç”¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="shi-zhan-you-hua-hou-de-ju-zhen-cheng-fa-xing-neng" tabindex="-1" id="å®æˆ˜ï¼šä¼˜åŒ–åçš„çŸ©é˜µä¹˜æ³•æ€§èƒ½">å®æˆ˜ï¼šä¼˜åŒ–åçš„çŸ©é˜µä¹˜æ³•æ€§èƒ½</h2><p>ä»¥ 1024Ã—1024 çŸ©é˜µä¸ºä¾‹ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>å…¨å±€å†…å­˜è®¿é—®</th><th>ç®—æœ¯å¼ºåº¦</th><th>ç›¸å¯¹æ€§èƒ½</th></tr></thead><tbody><tr><td>æœ´ç´ </td><td>2Ã—10â¹ æ¬¡</td><td>0.25</td><td>1Ã—</td></tr><tr><td>Tiled (16Ã—16)</td><td>1.25Ã—10â¸ æ¬¡</td><td>4</td><td>~8Ã—</td></tr><tr><td>Tiled (32Ã—32)</td><td>6.25Ã—10â· æ¬¡</td><td>8</td><td>~12Ã—</td></tr><tr><td>+ å¯„å­˜å™¨ä¼˜åŒ–</td><td>æ›´å°‘</td><td>16+</td><td>~20Ã—</td></tr></tbody></table><p>å®é™…æå‡å–å†³äºå…·ä½“ GPU å’Œé—®é¢˜è§„æ¨¡ï¼Œä½† 10Ã— ä»¥ä¸Šæ˜¯å¸¸è§çš„ã€‚</p><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬äº”ç« æ˜¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒï¼š</p><p><strong>å†…å­˜å±‚æ¬¡è®¤çŸ¥</strong>ï¼šå¯„å­˜å™¨â†’å…±äº«å†…å­˜â†’L2â†’å…¨å±€å†…å­˜ï¼Œé€Ÿåº¦å·® 100 å€ä»¥ä¸Šã€‚å†™é«˜æ€§èƒ½ä»£ç å°±æ˜¯è®©çƒ­æ•°æ®ç•™åœ¨å¿«å­˜å‚¨ã€‚</p><p><strong>å…±äº«å†…å­˜æœ¬è´¨</strong>ï¼šç¨‹åºå‘˜å¯æ§çš„ Block çº§ç¼“å­˜ã€‚å£°æ˜ç®€å•ï¼Œä½†éœ€è¦æ­£ç¡®åŒæ­¥ã€‚ä¸¤æ¬¡ __syncthreads() åˆ«å¿˜ã€‚</p><p><strong>Tiling æ ¸å¿ƒ</strong>ï¼šåˆ†å—åŠ è½½ï¼Œå—å†…å¤ç”¨ã€‚çŸ©é˜µä¹˜æ³•ä» 0.25 æå‡åˆ° 8+ FLOP/Byteï¼Œè¿™æ˜¯å®æ‰“å®çš„ 10Ã— åŠ é€Ÿã€‚</p><p><strong>è®¿é—®æ¨¡å¼</strong>ï¼š</p><ul><li>å…¨å±€å†…å­˜è¦åˆå¹¶è®¿é—®</li><li>å…±äº«å†…å­˜è¦é¿å… Bank å†²çª</li><li>å¿…è¦æ—¶ç”¨ Padding</li></ul><p><strong>å±€éƒ¨æ€§åŸåˆ™</strong>ï¼šç©ºé—´å±€éƒ¨æ€§ï¼ˆè¿ç»­è®¿é—®ï¼‰ï¼Œæ—¶é—´å±€éƒ¨æ€§ï¼ˆé‡å¤ä½¿ç”¨ï¼‰ã€‚Tiling åŒæ—¶åˆ©ç”¨äº†ä¸¤è€…ã€‚</p><p>æŒæ¡äº†å†…å­˜ä¼˜åŒ–ï¼ŒGPU çš„è®¡ç®—èƒ½åŠ›æ‰èƒ½çœŸæ­£å‘æŒ¥ã€‚ä¸‹ä¸€ç« ä¼šå­¦ä¹ æ›´å¤šè®¡ç®—æ¨¡å¼â€”â€”å·ç§¯ã€è§„çº¦ã€å‰ç¼€å’Œï¼Œè¿™äº›éƒ½éœ€è¦ç²¾å¿ƒè®¾è®¡çš„å†…å­˜è®¿é—®ç­–ç•¥ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#memory-hierarchy">CUDA C++ Programming Guide - Memory Model</a></li><li><a href="https://docs.nvidia.com/cuda/cuda-c-best-practices-guide/">CUDA Best Practices Guide</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot; id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç¬¬å››ç« ç†è§£äº†GPUçš„è°ƒåº¦æœºåˆ¶å’Œç¡¬ä»¶æ¶æ„ï¼Œè¿™ä¸€ç« è¿›å…¥æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒâ€”â€”å†…å­˜ã€‚GPUè®¡ç®—èƒ½åŠ›å¼ºå¤§ï¼Œä½†æ•°æ®ä¾›åº”è·Ÿä¸ä¸Šå°±ç™½æ­ã€‚ç¬¬äº”ç« è®²è§£GPUçš„å†…å­˜å±‚æ¬¡ç»“æ„ï¼Œé‡ç‚¹æ˜¯Shared</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="Tiling" scheme="https://smarter.xin/tags/Tiling/"/>
    
    <category term="å…±äº«å†…å­˜" scheme="https://smarter.xin/tags/shared-memory/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬å››ç« ï¼šè®¡ç®—æ¶æ„å’Œè°ƒåº¦</title>
    <link href="https://smarter.xin/posts/bd5d1d6/"/>
    <id>https://smarter.xin/posts/bd5d1d6/</id>
    <published>2026-01-15T05:08:55.000Z</published>
    <updated>2026-01-18T14:12:10.556Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>å‰ä¸‰ç« æ‰“ä¸‹äº†åŸºç¡€ï¼šç¬¬ä¸€ç« ç†è§£&quot;ä¸ºä»€ä¹ˆç”¨GPU&quot;ï¼Œç¬¬äºŒç« å­¦ä¼š&quot;æ€ä¹ˆå†™kernel&quot;ï¼Œç¬¬ä¸‰ç« æŒæ¡&quot;å¤šç»´æ•°æ®å¤„ç†&quot;ã€‚ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ä½¿ç”¨GPUï¼Œè¿˜ä¸çœŸæ­£ç†è§£å®ƒã€‚ç¬¬å››ç« å¼€å§‹æ·±å…¥GPUå†…éƒ¨â€”â€”ç¡¬ä»¶æ¶æ„å¦‚ä½•å½±å“æ€§èƒ½ï¼Œçº¿ç¨‹æ˜¯æ€ä¹ˆè¢«è°ƒåº¦æ‰§è¡Œçš„ï¼Œä¸ºä»€ä¹ˆæœ‰äº›ä»£ç å¿«æœ‰äº›æ…¢ã€‚ç†è§£è¿™äº›ï¼Œæ‰ç®—çœŸæ­£å…¥é—¨GPUç¼–ç¨‹ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="gpu-jia-gou-gai-lan" tabindex="-1" id="GPUæ¶æ„æ¦‚è§ˆ">GPUæ¶æ„æ¦‚è§ˆ</h2><h3 id="liu-shi-duo-chu-li-qi-sm" tabindex="-1" id="æµå¼å¤šå¤„ç†å™¨ï¼ˆSMï¼‰">æµå¼å¤šå¤„ç†å™¨ï¼ˆSMï¼‰</h3><p>GPUå¹¶ä¸æ˜¯ä¸€ä¸ªå·¨å¤§çš„å¤„ç†å™¨ï¼Œè€Œæ˜¯ç”±å¤šä¸ª**æµå¼å¤šå¤„ç†å™¨ï¼ˆStreaming Multiprocessor, SMï¼‰**ç»„æˆçš„é˜µåˆ—ã€‚æ¯ä¸ªSMæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„æ‰§è¡Œå•å…ƒï¼Œå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹å—ã€‚</p><p>ä»¥NVIDIA Ampereæ¶æ„ï¼ˆå¦‚RTX 3080ï¼‰ä¸ºä¾‹ï¼š</p><table><thead><tr><th>ç»„ä»¶</th><th>æ•°é‡/è§„æ ¼</th></tr></thead><tbody><tr><td>SMæ•°é‡</td><td>68</td></tr><tr><td>æ¯SM CUDAæ ¸å¿ƒ</td><td>128</td></tr><tr><td>æ¯SMæœ€å¤§çº¿ç¨‹</td><td>1536</td></tr><tr><td>æ¯SMæœ€å¤§Block</td><td>16</td></tr><tr><td>å…±äº«å†…å­˜</td><td>æ¯SM 128KBå¯é…ç½®</td></tr><tr><td>L2ç¼“å­˜</td><td>5MB</td></tr></tbody></table><p>ä¸åŒæ¶æ„å‚æ•°ä¸åŒï¼Œä½†æ ¸å¿ƒæ€æƒ³ç›¸åŒï¼š<strong>å¤§é‡å°æ ¸å¿ƒå¹¶è¡Œå·¥ä½œ</strong>ã€‚</p><h3 id="sm-nei-bu-jie-gou" tabindex="-1" id="SMå†…éƒ¨ç»“æ„">SMå†…éƒ¨ç»“æ„</h3><p>æ¯ä¸ªSMåŒ…å«ï¼š</p><ol><li><strong>CUDAæ ¸å¿ƒ</strong>ï¼šæ‰§è¡Œæ•´æ•°å’Œå•ç²¾åº¦æµ®ç‚¹è¿ç®—</li><li><strong>Tensoræ ¸å¿ƒ</strong>ï¼šä¸“ç”¨çŸ©é˜µè¿ç®—ï¼ˆæ·±åº¦å­¦ä¹ åŠ é€Ÿï¼‰</li><li><strong>ç‰¹æ®ŠåŠŸèƒ½å•å…ƒï¼ˆSFUï¼‰</strong>ï¼šæ‰§è¡Œsin/cos/expç­‰è¶…è¶Šå‡½æ•°</li><li><strong>åŠ è½½/å­˜å‚¨å•å…ƒï¼ˆLD/STï¼‰</strong>ï¼šå¤„ç†å†…å­˜è®¿é—®</li><li><strong>Warpè°ƒåº¦å™¨</strong>ï¼šè°ƒåº¦çº¿ç¨‹æ‰§è¡Œ</li><li><strong>å¯„å­˜å™¨æ–‡ä»¶</strong>ï¼šå¿«é€Ÿå­˜å‚¨ï¼Œæ¯SMçº¦64KB</li><li><strong>å…±äº«å†…å­˜</strong>ï¼šblockå†…å…±äº«çš„å¯ç¼–ç¨‹ç¼“å­˜</li></ol><p>å…³é”®è®¤è¯†ï¼šSMæ˜¯èµ„æºæ± ï¼Œå¤šä¸ªblockå…±äº«è¿™äº›èµ„æºã€‚blockåˆ†é…å¤šå°‘èµ„æºï¼Œå†³å®šäº†SMèƒ½åŒæ—¶è¿è¡Œå‡ ä¸ªblockã€‚</p><h3 id="xian-cheng-kuai-dao-sm-de-ying-she" tabindex="-1" id="çº¿ç¨‹å—åˆ°SMçš„æ˜ å°„">çº¿ç¨‹å—åˆ°SMçš„æ˜ å°„</h3><p>å¯åŠ¨kernelæ—¶ï¼Œruntimeè´Ÿè´£å°†çº¿ç¨‹å—åˆ†é…åˆ°å„SMï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kernel&lt;&lt;&lt;gridDim, blockDim&gt;&gt;&gt;(args);</span><br><span class="line">         â†“</span><br><span class="line">è¿è¡Œæ—¶åˆ†é…ï¼šBlock 0â†’SM0, Block 1â†’SM2, Block 2â†’SM1, ...</span><br></pre></td></tr></table></figure><p><strong>å…³é”®è§„åˆ™</strong>ï¼š</p><ul><li>æ¯ä¸ªblockåªåœ¨ä¸€ä¸ªSMä¸Šæ‰§è¡Œï¼Œä¸ä¼šè·¨SM</li><li>ä¸€ä¸ªSMå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªblockï¼ˆèµ„æºå…è®¸çš„è¯ï¼‰</li><li>Blockä¹‹é—´æ²¡æœ‰æ‰§è¡Œé¡ºåºä¿è¯</li><li>Blockä¸€æ—¦å¼€å§‹æ‰§è¡Œï¼Œä¼šè¿è¡Œåˆ°ç»“æŸ</li></ul><p>è¿™ç§è®¾è®¡çš„å¥½å¤„ï¼šblockå®Œå…¨ç‹¬ç«‹ï¼Œç¡¬ä»¶å¯ä»¥è‡ªç”±è°ƒåº¦ï¼Œé€‚åº”ä¸åŒè§„æ¨¡çš„GPUã€‚</p><h2 id="warp-zhi-xing-de-ji-ben-dan-wei" tabindex="-1" id="Warpï¼šæ‰§è¡Œçš„åŸºæœ¬å•ä½">Warpï¼šæ‰§è¡Œçš„åŸºæœ¬å•ä½</h2><h3 id="shi-yao-shi-warp" tabindex="-1" id="ä»€ä¹ˆæ˜¯Warp">ä»€ä¹ˆæ˜¯Warp</h3><p><strong>Warpæ˜¯32ä¸ªè¿ç»­çº¿ç¨‹ç»„æˆçš„æ‰§è¡Œå•ä½</strong>ã€‚è¿™æ˜¯NVIDIA GPUçš„æ ¸å¿ƒè®¾è®¡ï¼Œç†è§£warpå°±ç†è§£äº†GPUæ‰§è¡Œæ¨¡å‹çš„ä¸€åŠã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Block (256 threads)</span><br><span class="line">â”œâ”€â”€ Warp 0: Thread 0-31</span><br><span class="line">â”œâ”€â”€ Warp 1: Thread 32-63</span><br><span class="line">â”œâ”€â”€ Warp 2: Thread 64-95</span><br><span class="line">â”œâ”€â”€ Warp 3: Thread 96-127</span><br><span class="line">â”œâ”€â”€ Warp 4: Thread 128-159</span><br><span class="line">â”œâ”€â”€ Warp 5: Thread 160-191</span><br><span class="line">â”œâ”€â”€ Warp 6: Thread 192-223</span><br><span class="line">â””â”€â”€ Warp 7: Thread 224-255</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆæ˜¯32</strong>ï¼Ÿç¡¬ä»¶è®¾è®¡å†³å®šçš„ã€‚æ¯ä¸ªSMæœ‰ä¸€å®šæ•°é‡çš„è®¡ç®—å•å…ƒï¼Œ32æ˜¯æ•ˆç‡æœ€ä¼˜çš„åˆ†ç»„å¤§å°ã€‚</p><h3 id="simt-zhi-xing-mo-xing" tabindex="-1" id="SIMTæ‰§è¡Œæ¨¡å‹">SIMTæ‰§è¡Œæ¨¡å‹</h3><p>GPUé‡‡ç”¨**SIMTï¼ˆSingle Instruction Multiple Threadï¼‰**æ¨¡å‹ï¼š</p><ul><li>åŒä¸€warpå†…çš„32ä¸ªçº¿ç¨‹ï¼Œåœ¨åŒä¸€æ—¶é’Ÿå‘¨æœŸæ‰§è¡Œç›¸åŒæŒ‡ä»¤</li><li>ä½†æ“ä½œä¸åŒçš„æ•°æ®ï¼ˆä¸åŒçš„å¯„å­˜å™¨ï¼‰</li><li>ç±»ä¼¼SIMDï¼Œä½†æ›´çµæ´»ï¼ˆçº¿ç¨‹å¯ä»¥æœ‰ç‹¬ç«‹çŠ¶æ€ï¼‰</li></ul><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C[i] = A[i] + B[i];</span><br></pre></td></tr></table></figure><p>Warpä¸­çš„32ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ&quot;åŠ æ³•&quot;æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Warp 0æ‰§è¡Œ:</span><br><span class="line">Thread 0: C[0] = A[0] + B[0]  â”€â”</span><br><span class="line">Thread 1: C[1] = A[1] + B[1]   â”‚ åŒä¸€æ¡addæŒ‡ä»¤</span><br><span class="line">...                            â”‚ åŒä¸€æ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">Thread 31: C[31] = A[31] + B[31]â”€â”˜</span><br></pre></td></tr></table></figure><p>ç¡¬ä»¶åªéœ€å–ä¸€æ¬¡æŒ‡ä»¤ï¼Œå°±èƒ½å®Œæˆ32ä¸ªæ“ä½œã€‚è¿™å°±æ˜¯GPUé«˜ååçš„æ¥æºã€‚</p><h3 id="warp-diao-du" tabindex="-1" id="Warpè°ƒåº¦">Warpè°ƒåº¦</h3><p>æ¯ä¸ªSMæœ‰å¤šä¸ªWarpè°ƒåº¦å™¨ï¼ˆå¦‚Ampereæ˜¯4ä¸ªï¼‰ã€‚æ¯ä¸ªå‘¨æœŸï¼Œè°ƒåº¦å™¨é€‰æ‹©ä¸€ä¸ªå‡†å¤‡å¥½çš„warpå‘å°„æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å‘¨æœŸ1: Warpè°ƒåº¦å™¨0é€‰æ‹©Warp 3ï¼Œå‘å°„addæŒ‡ä»¤</span><br><span class="line">å‘¨æœŸ2: Warpè°ƒåº¦å™¨0é€‰æ‹©Warp 7ï¼Œå‘å°„loadæŒ‡ä»¤</span><br><span class="line">å‘¨æœŸ3: Warpè°ƒåº¦å™¨0é€‰æ‹©Warp 0ï¼Œå‘å°„mulæŒ‡ä»¤</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼šwarpä¹‹é—´æ˜¯ç‹¬ç«‹è°ƒåº¦çš„ã€‚å¦‚æœwarp 3åœ¨ç­‰å†…å­˜ï¼Œè°ƒåº¦å™¨åˆ‡æ¢åˆ°warp 7æ‰§è¡Œï¼Œä¸æµªè´¹æ—¶é’Ÿå‘¨æœŸã€‚</p><h2 id="kong-zhi-liu-fa-san-xing-neng-sha-shou" tabindex="-1" id="æ§åˆ¶æµå‘æ•£ï¼šæ€§èƒ½æ€æ‰‹">æ§åˆ¶æµå‘æ•£ï¼šæ€§èƒ½æ€æ‰‹</h2><h3 id="shi-yao-shi-fen-zhi-fa-san" tabindex="-1" id="ä»€ä¹ˆæ˜¯åˆ†æ”¯å‘æ•£">ä»€ä¹ˆæ˜¯åˆ†æ”¯å‘æ•£</h3><p>å½“warpå†…çš„çº¿ç¨‹èµ°ä¸åŒåˆ†æ”¯æ—¶ï¼Œå°±å‘ç”Ÿ<strong>æ§åˆ¶æµå‘æ•£ï¼ˆControl Divergenceï¼‰</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (threadIdx.x &lt; 16) &#123;</span><br><span class="line">    // åˆ†æ”¯A</span><br><span class="line">    A[i] = ...;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // åˆ†æ”¯B</span><br><span class="line">    B[i] = ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ¥äº†ï¼š32ä¸ªçº¿ç¨‹å¿…é¡»æ‰§è¡Œç›¸åŒæŒ‡ä»¤ï¼Œä½†è¿™é‡Œçº¿ç¨‹0-15éœ€è¦æ‰§è¡Œåˆ†æ”¯Aï¼Œçº¿ç¨‹16-31éœ€è¦æ‰§è¡Œåˆ†æ”¯Bã€‚æ€ä¹ˆåŠï¼Ÿ</p><h3 id="ying-jian-ru-he-chu-li" tabindex="-1" id="ç¡¬ä»¶å¦‚ä½•å¤„ç†">ç¡¬ä»¶å¦‚ä½•å¤„ç†</h3><p>GPUé‡‡ç”¨<strong>è°“è¯æ‰§è¡Œï¼ˆPredicated Executionï¼‰</strong>ï¼š</p><ol><li>æ‰€æœ‰çº¿ç¨‹å…ˆæ‰§è¡Œåˆ†æ”¯Aï¼Œä½†åªæœ‰æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹å†™å…¥ç»“æœ</li><li>å†æ‰§è¡Œåˆ†æ”¯Bï¼Œåªæœ‰ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹å†™å…¥ç»“æœ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®é™…æ‰§è¡Œåºåˆ—:</span><br><span class="line">Step 1: æ‰§è¡Œåˆ†æ”¯Aï¼ˆçº¿ç¨‹0-15æ´»è·ƒï¼Œ16-31æŠ‘åˆ¶ï¼‰</span><br><span class="line">Step 2: æ‰§è¡Œåˆ†æ”¯Bï¼ˆçº¿ç¨‹0-15æŠ‘åˆ¶ï¼Œ16-31æ´»è·ƒï¼‰</span><br></pre></td></tr></table></figure><p><strong>ä»£ä»·</strong>ï¼šä¸¤ä¸ªåˆ†æ”¯éƒ½è¢«æ‰§è¡Œï¼Œæ—¶é—´ç¿»å€ã€‚å¦‚æœæœ‰nä¸ªåˆ†æ”¯ï¼Œæœ€åæƒ…å†µæ€§èƒ½é™ä¸º1/nã€‚</p><h3 id="xing-neng-ying-xiang-liang-hua" tabindex="-1" id="æ€§èƒ½å½±å“é‡åŒ–">æ€§èƒ½å½±å“é‡åŒ–</h3><p><strong>åœºæ™¯1</strong>ï¼šæ— å‘æ•£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">C[i] = A[i] + B[i];  // æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç›¸åŒæ“ä½œ</span><br></pre></td></tr></table></figure><p>100%æ•ˆç‡ï¼Œç†æƒ³æƒ…å†µã€‚</p><p><strong>åœºæ™¯2</strong>ï¼šwarpå†…å‘æ•£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (threadIdx.x % 2 == 0) &#123;</span><br><span class="line">    C[i] = A[i] + B[i];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    C[i] = A[i] * B[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªwarpä¸€åŠæ‰§è¡ŒåŠ æ³•ï¼Œä¸€åŠæ‰§è¡Œä¹˜æ³•ã€‚æ•ˆç‡çº¦50%ã€‚</p><p><strong>åœºæ™¯3</strong>ï¼šwarpé—´æ— å‘æ•£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (threadIdx.x &lt; 32) &#123;  // warp 0æ•´ä½“èµ°è¿™è¾¹</span><br><span class="line">    C[i] = A[i] + B[i];</span><br><span class="line">&#125; else &#123;                  // warp 1-7æ•´ä½“èµ°è¿™è¾¹</span><br><span class="line">    C[i] = A[i] * B[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªwarpå†…éƒ¨ä¸å‘æ•£ï¼Œæ•ˆç‡æ¥è¿‘100%ã€‚</p><p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šåˆ†æ”¯å‘æ•£åªåœ¨warpå†…éƒ¨æœ‰å¼€é”€ã€‚è®©åŒä¸€warpçš„çº¿ç¨‹èµ°ç›¸åŒåˆ†æ”¯ï¼Œå°±ä¸æŸå¤±æ€§èƒ½ã€‚</p><h3 id="bi-mian-fa-san-de-ji-qiao" tabindex="-1" id="é¿å…å‘æ•£çš„æŠ€å·§">é¿å…å‘æ•£çš„æŠ€å·§</h3><p><strong>æŠ€å·§1</strong>ï¼šæŒ‰warpè¾¹ç•Œåˆ’åˆ†ä»»åŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// å·®ï¼šå¥‡å¶åˆ†æ”¯ï¼Œwarpå†…å‘æ•£</span><br><span class="line">if (threadIdx.x % 2 == 0) &#123; taskA(); &#125;</span><br><span class="line">else &#123; taskB(); &#125;</span><br><span class="line"></span><br><span class="line">// å¥½ï¼šæŒ‰warpåˆ’åˆ†ï¼Œwarpé—´åˆ†å·¥</span><br><span class="line">if (threadIdx.x / 32 == 0) &#123; taskA(); &#125;  // warp 0</span><br><span class="line">else &#123; taskB(); &#125;                         // å…¶ä»–warp</span><br></pre></td></tr></table></figure><p><strong>æŠ€å·§2</strong>ï¼šé‡ç»„æ•°æ®</p><p>å¦‚æœå¿…é¡»å¤„ç†ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œå¯ä»¥å…ˆæ’åºï¼Œè®©åŒç±»å…ƒç´ è½åœ¨åŒä¸€warpã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// åŸå§‹ï¼štypeåˆ†å¸ƒéšæœºï¼Œæ¯ä¸ªwarpéƒ½å‘æ•£</span><br><span class="line">if (type[i] == 0) &#123; processType0(); &#125;</span><br><span class="line">else &#123; processType1(); &#125;</span><br><span class="line"></span><br><span class="line">// ä¼˜åŒ–ï¼šæŒ‰typeæ’åºåå¤„ç†ï¼Œwarpå†…typeç›¸åŒ</span><br><span class="line">sort_by_type(data);  // é¢„å¤„ç†</span><br><span class="line">kernel&lt;&lt;&lt;...&gt;&gt;&gt;(sorted_data);</span><br></pre></td></tr></table></figure><p><strong>æŠ€å·§3</strong>ï¼šç”¨ç®—æœ¯æ›¿ä»£åˆ†æ”¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// åˆ†æ”¯ç‰ˆæœ¬</span><br><span class="line">if (x &gt; 0) &#123; y = x; &#125;</span><br><span class="line">else &#123; y = -x; &#125;</span><br><span class="line"></span><br><span class="line">// æ— åˆ†æ”¯ç‰ˆæœ¬ï¼ˆReLUå¯ä»¥è¿™æ ·ï¼‰</span><br><span class="line">y = x * (x &gt; 0);  // åˆ©ç”¨å¸ƒå°”è½¬int</span><br><span class="line">// æˆ–ç”¨å†…ç½®å‡½æ•°</span><br><span class="line">y = fabs(x);</span><br></pre></td></tr></table></figure><h2 id="yan-chi-yin-cang-gpu-de-he-xin-you-hua-ce-lue" tabindex="-1" id="å»¶è¿Ÿéšè—ï¼šGPUçš„æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥">å»¶è¿Ÿéšè—ï¼šGPUçš„æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥</h2><h3 id="shi-yao-shi-yan-chi" tabindex="-1" id="ä»€ä¹ˆæ˜¯å»¶è¿Ÿ">ä»€ä¹ˆæ˜¯å»¶è¿Ÿ</h3><p>**å»¶è¿Ÿï¼ˆLatencyï¼‰**æ˜¯æŒ‡ä»¤ä»å‘å‡ºåˆ°å®Œæˆéœ€è¦çš„æ—¶é’Ÿå‘¨æœŸï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>å…¸å‹å»¶è¿Ÿ</th></tr></thead><tbody><tr><td>ç®—æœ¯è¿ç®—</td><td>4-8å‘¨æœŸ</td></tr><tr><td>å…±äº«å†…å­˜</td><td>20-30å‘¨æœŸ</td></tr><tr><td>å…¨å±€å†…å­˜</td><td>200-400å‘¨æœŸ</td></tr><tr><td>ç‰¹æ®Šå‡½æ•°(sin/exp)</td><td>20-40å‘¨æœŸ</td></tr></tbody></table><p>å…¨å±€å†…å­˜è®¿é—®æ˜¯å¤§å¤´ï¼Œ400å‘¨æœŸæ„å‘³ç€è¯»ä¸€æ¬¡æ•°æ®çš„æ—¶é—´å¯ä»¥åš100æ¬¡è®¡ç®—ã€‚</p><h3 id="gpu-ru-he-yin-cang-yan-chi" tabindex="-1" id="GPUå¦‚ä½•éšè—å»¶è¿Ÿ">GPUå¦‚ä½•éšè—å»¶è¿Ÿ</h3><p>CPUç”¨å¤æ‚çš„ä¹±åºæ‰§è¡Œã€é¢„å–æ¥éšè—å»¶è¿Ÿã€‚GPUç”¨æ›´ç®€å•ç²—æš´çš„æ–¹æ³•ï¼š<strong>å¤§é‡çº¿ç¨‹+å¿«é€Ÿåˆ‡æ¢</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ—¶é’Ÿå‘¨æœŸæ¨æ¼”:</span><br><span class="line">å‘¨æœŸ1: Warp0å‘èµ·load A[0]ï¼ˆéœ€è¦400å‘¨æœŸè¿”å›ï¼‰</span><br><span class="line">å‘¨æœŸ2: Warp1å‘èµ·load A[32]</span><br><span class="line">å‘¨æœŸ3: Warp2å‘èµ·load A[64]</span><br><span class="line">...ï¼ˆç»§ç»­åˆ‡æ¢æ‰§è¡Œå…¶ä»–warpï¼‰</span><br><span class="line">å‘¨æœŸ400: Warp0çš„æ•°æ®åˆ°äº†ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ</span><br><span class="line">å‘¨æœŸ401: åˆ‡å›Warp0æ‰§è¡Œè®¡ç®—</span><br></pre></td></tr></table></figure><p>åªè¦æœ‰è¶³å¤Ÿå¤šçš„warpå¯ä»¥åˆ‡æ¢ï¼Œè®¡ç®—å•å…ƒå°±ä¸ä¼šç©ºé—²ã€‚è¿™å°±æ˜¯<strong>å»¶è¿Ÿéšè—</strong>ã€‚</p><h3 id="yan-chi-yin-cang-de-shu-xue" tabindex="-1" id="å»¶è¿Ÿéšè—çš„æ•°å­¦">å»¶è¿Ÿéšè—çš„æ•°å­¦</h3><p>å‡è®¾ï¼š</p><ul><li>å…¨å±€å†…å­˜å»¶è¿Ÿ400å‘¨æœŸ</li><li>ç®—æœ¯æŒ‡ä»¤ååé‡1ä¸ª/å‘¨æœŸï¼ˆæ¯ä¸ªè°ƒåº¦å™¨ï¼‰</li><li>æ¯SMæœ‰4ä¸ªè°ƒåº¦å™¨</li></ul><p>å®Œå…¨éšè—å»¶è¿Ÿéœ€è¦çš„æœ€å°warpæ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">éœ€è¦æ´»è·ƒwarpæ•° = å»¶è¿Ÿ / ååé‡ = 400 / 1 = 400ï¼ˆæ¯è°ƒåº¦å™¨ï¼‰</span><br><span class="line">æ¯SMéœ€è¦ = 400 / 4 = 100 warpï¼ˆç†è®ºæœ€å°å€¼ï¼‰</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ¯SMæœ€å¤š64 warpï¼ˆ2048çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥å…¨å±€å†…å­˜å»¶è¿Ÿå¾ˆéš¾å®Œå…¨éšè—ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å°½é‡ç”¨å…±äº«å†…å­˜å’Œå¯„å­˜å™¨ã€‚</p><h2 id="zhan-yong-lu-occupancy" tabindex="-1" id="å ç”¨ç‡ï¼ˆOccupancyï¼‰">å ç”¨ç‡ï¼ˆOccupancyï¼‰</h2><h3 id="ding-yi" tabindex="-1" id="å®šä¹‰">å®šä¹‰</h3><p>**å ç”¨ç‡ï¼ˆOccupancyï¼‰**æ˜¯&quot;SMä¸Šæ´»è·ƒwarpæ•°&quot;ä¸&quot;SMæœ€å¤§æ”¯æŒwarpæ•°&quot;çš„æ¯”å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å ç”¨ç‡ = æ´»è·ƒWarpæ•° / SMæœ€å¤§Warpæ•°</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒAmpere SMæœ€å¤šæ”¯æŒ64 warpï¼ˆ2048çº¿ç¨‹ï¼‰ã€‚å¦‚æœå®é™…æœ‰32 warpåœ¨è¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å ç”¨ç‡ = 32 / 64 = 50%</span><br></pre></td></tr></table></figure><h3 id="ying-xiang-zhan-yong-lu-de-zi-yuan" tabindex="-1" id="å½±å“å ç”¨ç‡çš„èµ„æº">å½±å“å ç”¨ç‡çš„èµ„æº</h3><p>ä¸‰å¤§é™åˆ¶å› ç´ ï¼š</p><p><strong>1. æ¯blockçº¿ç¨‹æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(1024);  // æ¯block 1024çº¿ç¨‹ = 32 warp</span><br><span class="line">// SMæœ€å¤š16 blockï¼Œä½†...</span><br><span class="line">// SMæœ€å¤š2048çº¿ç¨‹ï¼Œæ‰€ä»¥åªèƒ½æ”¾2ä¸ªè¿™æ ·çš„block</span><br><span class="line">// æ´»è·ƒ = 2 Ã— 32 = 64 warpï¼Œå ç”¨ç‡100%</span><br><span class="line"></span><br><span class="line">dim3 block(64);    // æ¯block 64çº¿ç¨‹ = 2 warp</span><br><span class="line">// SMæœ€å¤š16 blockï¼Œå¯ä»¥æ”¾16ä¸ª</span><br><span class="line">// æ´»è·ƒ = 16 Ã— 2 = 32 warpï¼Œå ç”¨ç‡50%</span><br></pre></td></tr></table></figure><p><strong>2. å¯„å­˜å™¨ä½¿ç”¨</strong></p><p>æ¯SMå¯„å­˜å™¨æ•°é‡æœ‰é™ï¼ˆå¦‚65536ä¸ªï¼‰ã€‚kernelç”¨çš„å¯„å­˜å™¨è¶Šå¤šï¼Œèƒ½åŒæ—¶è¿è¡Œçš„çº¿ç¨‹è¶Šå°‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾kernelç”¨64ä¸ªå¯„å­˜å™¨/çº¿ç¨‹</span><br><span class="line">æ¯SMå¯æ”¯æŒçº¿ç¨‹ = 65536 / 64 = 1024çº¿ç¨‹ = 32 warp</span><br><span class="line">å ç”¨ç‡ = 32 / 64 = 50%</span><br><span class="line"></span><br><span class="line">å‡è®¾kernelç”¨32ä¸ªå¯„å­˜å™¨/çº¿ç¨‹</span><br><span class="line">æ¯SMå¯æ”¯æŒçº¿ç¨‹ = 65536 / 32 = 2048çº¿ç¨‹ = 64 warp</span><br><span class="line">å ç”¨ç‡ = 100%</span><br></pre></td></tr></table></figure><p><strong>3. å…±äº«å†…å­˜ä½¿ç”¨</strong></p><p>æ¯SMå…±äº«å†…å­˜æœ‰é™ï¼ˆå¦‚96KBï¼‰ã€‚blockç”¨çš„å…±äº«å†…å­˜è¶Šå¤šï¼Œèƒ½åŒæ—¶è¿è¡Œçš„blockè¶Šå°‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾blockç”¨48KBå…±äº«å†…å­˜</span><br><span class="line">æ¯SMå¯è¿è¡Œblock = 96 / 48 = 2ä¸ª</span><br><span class="line">å‡è®¾æ¯block 256çº¿ç¨‹ = 8 warp</span><br><span class="line">æ´»è·ƒ = 2 Ã— 8 = 16 warp</span><br><span class="line">å ç”¨ç‡ = 16 / 64 = 25%</span><br></pre></td></tr></table></figure><h3 id="ji-suan-zhan-yong-lu" tabindex="-1" id="è®¡ç®—å ç”¨ç‡">è®¡ç®—å ç”¨ç‡</h3><p>ä½¿ç”¨CUDA Occupancy Calculatoræˆ–APIï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cuda_runtime.h&gt;</span><br><span class="line"></span><br><span class="line">int blockSize = 256;</span><br><span class="line">int minGridSize, gridSize;</span><br><span class="line"></span><br><span class="line">// è‡ªåŠ¨è®¡ç®—æœ€ä¼˜blockå¤§å°</span><br><span class="line">cudaOccupancyMaxPotentialBlockSize(&amp;minGridSize, &amp;blockSize, </span><br><span class="line">                                    myKernel, 0, 0);</span><br><span class="line"></span><br><span class="line">// è®¡ç®—ç»™å®šé…ç½®çš„å ç”¨ç‡</span><br><span class="line">int numBlocks;</span><br><span class="line">cudaOccupancyMaxActiveBlocksPerMultiprocessor(&amp;numBlocks, </span><br><span class="line">                                               myKernel, blockSize, 0);</span><br><span class="line">int device;</span><br><span class="line">cudaGetDevice(&amp;device);</span><br><span class="line">cudaDeviceProp prop;</span><br><span class="line">cudaGetDeviceProperties(&amp;prop, device);</span><br><span class="line">float occupancy = (float)(numBlocks * blockSize) / prop.maxThreadsPerMultiProcessor;</span><br><span class="line">printf(&quot;å ç”¨ç‡: %.2f%%\n&quot;, occupancy * 100);</span><br></pre></td></tr></table></figure><h3 id="zhan-yong-lu-yu-xing-neng" tabindex="-1" id="å ç”¨ç‡ä¸æ€§èƒ½">å ç”¨ç‡ä¸æ€§èƒ½</h3><p><strong>é«˜å ç”¨ç‡ä¸ä¸€å®šæ„å‘³ç€é«˜æ€§èƒ½</strong>ã€‚è¿™æ˜¯å¸¸è§è¯¯è§£ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åœºæ™¯1ï¼šè®¡ç®—å¯†é›†å‹kernel</span><br><span class="line">- æ¯çº¿ç¨‹ç”¨å¤§é‡å¯„å­˜å™¨åšå¤æ‚è®¡ç®—</span><br><span class="line">- å ç”¨ç‡å¯èƒ½åªæœ‰25%</span><br><span class="line">- ä½†è®¡ç®—å•å…ƒåˆ©ç”¨ç‡é«˜ï¼Œæ€§èƒ½å¥½</span><br><span class="line"></span><br><span class="line">åœºæ™¯2ï¼šå†…å­˜å¯†é›†å‹kernel</span><br><span class="line">- æ¯çº¿ç¨‹æ“ä½œç®€å•ï¼Œä¸»è¦åœ¨è¯»å†™å†…å­˜</span><br><span class="line">- éœ€è¦é«˜å ç”¨ç‡æ¥éšè—å»¶è¿Ÿ</span><br><span class="line">- 50%å ç”¨ç‡å¯èƒ½ä¸å¤Ÿ</span><br></pre></td></tr></table></figure><p><strong>åŸåˆ™</strong>ï¼š</p><ul><li>å†…å­˜å—é™kernelï¼šæé«˜å ç”¨ç‡æœ‰å¸®åŠ©</li><li>è®¡ç®—å—é™kernelï¼šå ç”¨ç‡å¤Ÿç”¨å°±è¡Œï¼Œä¼˜å…ˆåˆ©ç”¨å¥½è®¡ç®—èµ„æº</li><li>æœ€ä½³å®è·µï¼šä»åˆ†æå®é™…ç“¶é¢ˆå…¥æ‰‹ï¼Œè€Œä¸æ˜¯ç›²ç›®è¿½æ±‚å ç”¨ç‡</li></ul><h2 id="zi-yuan-xian-zhi-hui-zong" tabindex="-1" id="èµ„æºé™åˆ¶æ±‡æ€»">èµ„æºé™åˆ¶æ±‡æ€»</h2><p>ä»¥Ampereæ¶æ„ä¸ºä¾‹ï¼š</p><table><thead><tr><th>èµ„æº</th><th>æ¯SMé™åˆ¶</th><th>æ¯Blocké™åˆ¶</th></tr></thead><tbody><tr><td>çº¿ç¨‹æ•°</td><td>2048</td><td>1024</td></tr><tr><td>Blockæ•°</td><td>16</td><td>-</td></tr><tr><td>Warpæ•°</td><td>64</td><td>32</td></tr><tr><td>å¯„å­˜å™¨</td><td>65536</td><td>65536</td></tr><tr><td>å…±äº«å†…å­˜</td><td>å¯é…ç½®,æœ€å¤§164KB</td><td>å¯é…ç½®,æœ€å¤§99KB</td></tr></tbody></table><h3 id="block-da-xiao-xuan-ze" tabindex="-1" id="Blockå¤§å°é€‰æ‹©">Blockå¤§å°é€‰æ‹©</h3><p><strong>å®ç”¨å»ºè®®</strong>ï¼š</p><ol><li><strong>128-256æ˜¯å®‰å…¨èµ·ç‚¹</strong>ï¼šæ»¡è¶³warpæ•´æ•°å€ï¼Œä¸å¤ªå¤§ä¸å¤ªå°</li><li><strong>å¿…é¡»æ˜¯32çš„å€æ•°</strong>ï¼šå¦åˆ™æœ€åä¸€ä¸ªwarpæµªè´¹çº¿ç¨‹</li><li><strong>è€ƒè™‘å…±äº«å†…å­˜éœ€æ±‚</strong>ï¼šblockè¶Šå¤§ï¼Œå…±äº«å†…å­˜åˆ†æ‘Šæ•ˆç‡è¶Šé«˜</li><li><strong>å®æµ‹ä¸ºç‹</strong>ï¼šæœ€ç»ˆè¿˜æ˜¯è¦profileä¸åŒé…ç½®çš„æ€§èƒ½</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// ä¸å¥½ï¼šä¸æ˜¯32çš„å€æ•°</span><br><span class="line">dim3 block(100);  // æœ€åwarpåªæœ‰4ä¸ªæœ‰æ•ˆçº¿ç¨‹</span><br><span class="line"></span><br><span class="line">// å¥½ï¼š32çš„å€æ•°</span><br><span class="line">dim3 block(128);  // 4ä¸ªå®Œæ•´warp</span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¥½</span><br><span class="line">dim3 block(256);  // 8ä¸ªå®Œæ•´warp</span><br></pre></td></tr></table></figure><h2 id="bian-yi-qi-you-hua-yu-diao-shi" tabindex="-1" id="ç¼–è¯‘å™¨ä¼˜åŒ–ä¸è°ƒè¯•">ç¼–è¯‘å™¨ä¼˜åŒ–ä¸è°ƒè¯•</h2><h3 id="cha-kan-ji-cun-qi-shi-yong" tabindex="-1" id="æŸ¥çœ‹å¯„å­˜å™¨ä½¿ç”¨">æŸ¥çœ‹å¯„å­˜å™¨ä½¿ç”¨</h3><p>ç¼–è¯‘æ—¶åŠ <code>--ptxas-options=-v</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -O3 --ptxas-options=-v mykernel.cu -o mykernel</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ptxas info : Compiling entry function &#x27;mykernel&#x27;</span><br><span class="line">ptxas info : Function properties for mykernel</span><br><span class="line">    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads</span><br><span class="line">ptxas info : Used 32 registers, 336 bytes cmem[0]</span><br></pre></td></tr></table></figure><p>32ä¸ªå¯„å­˜å™¨/çº¿ç¨‹ï¼Œæ²¡æœ‰æº¢å‡ºåˆ°local memoryã€‚</p><h3 id="kong-zhi-ji-cun-qi-shu-liang" tabindex="-1" id="æ§åˆ¶å¯„å­˜å™¨æ•°é‡">æ§åˆ¶å¯„å­˜å™¨æ•°é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__global__ void __launch_bounds__(256, 4) myKernel(...) &#123;</span><br><span class="line">    // æç¤ºç¼–è¯‘å™¨ï¼šæ¯block 256çº¿ç¨‹ï¼Œæ¯SMè‡³å°‘4 block</span><br><span class="line">    // ç¼–è¯‘å™¨ä¼šæ®æ­¤ä¼˜åŒ–å¯„å­˜å™¨åˆ†é…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–ç¼–è¯‘é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -maxrregcount=32 mykernel.cu  <span class="comment"># é™åˆ¶æ¯çº¿ç¨‹æœ€å¤š32å¯„å­˜å™¨</span></span><br></pre></td></tr></table></figure><p><strong>æƒè¡¡</strong>ï¼šé™åˆ¶å¯„å­˜å™¨å¯èƒ½å¯¼è‡´æº¢å‡ºåˆ°local memoryï¼ˆå¾ˆæ…¢ï¼‰ï¼Œéœ€è¦å¹³è¡¡ã€‚</p><h3 id="nsight-compute-fen-xi" tabindex="-1" id="Nsight-Computeåˆ†æ">Nsight Computeåˆ†æ</h3><p>ä½¿ç”¨NVIDIAçš„profileråˆ†æå®é™…ç“¶é¢ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu --<span class="built_in">set</span> full ./mykernel</span><br></pre></td></tr></table></figure><p>å…³æ³¨ï¼š</p><ul><li>Warpæ‰§è¡Œæ•ˆç‡ï¼ˆåˆ†æ”¯å‘æ•£ï¼‰</li><li>å†…å­˜ååç‡</li><li>è®¡ç®—ååç‡</li><li>å ç”¨ç‡</li></ul><p>è¿™æ¯”çŒœæµ‹æœ‰æ•ˆå¾—å¤šã€‚</p><h2 id="shi-li-fen-xi-ju-zhen-cheng-fa-de-block-pei-zhi" tabindex="-1" id="å®ä¾‹åˆ†æï¼šçŸ©é˜µä¹˜æ³•çš„Blocké…ç½®">å®ä¾‹åˆ†æï¼šçŸ©é˜µä¹˜æ³•çš„Blocké…ç½®</h2><p>å›é¡¾ç¬¬ä¸‰ç« çš„çŸ©é˜µä¹˜æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__global__ void matMul(float *M, float *N, float *P, int width) &#123;</span><br><span class="line">    int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    if (row &lt; width &amp;&amp; col &lt; width) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int k = 0; k &lt; width; k++) &#123;</span><br><span class="line">            sum += M[row * width + k] * N[k * width + col];</span><br><span class="line">        &#125;</span><br><span class="line">        P[row * width + col] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…ç½®é€‰æ‹©</strong>ï¼š</p><table><thead><tr><th>Blockå¤§å°</th><th>Warpæ•°</th><th>åˆ†æ</th></tr></thead><tbody><tr><td>8Ã—8=64</td><td>2</td><td>å¤ªå°ï¼Œwarpå°‘ï¼Œå»¶è¿Ÿéšè—ä¸è¶³</td></tr><tr><td>16Ã—16=256</td><td>8</td><td>åˆé€‚ï¼Œæ¯SMå¯æ”¾å¤šä¸ªblock</td></tr><tr><td>32Ã—32=1024</td><td>32</td><td>æ¥è¿‘é™åˆ¶ï¼Œçµæ´»æ€§å·®</td></tr></tbody></table><p><strong>16Ã—16é€šå¸¸æ˜¯äºŒç»´é—®é¢˜çš„å¥½é€‰æ‹©</strong>ã€‚</p><p><strong>è¿›ä¸€æ­¥ä¼˜åŒ–</strong>ï¼ˆç¬¬5ç« ä¼šè¯¦ç»†è®²ï¼‰ï¼š</p><ul><li>ç”¨å…±äº«å†…å­˜åštiling</li><li>å‡å°‘å…¨å±€å†…å­˜è®¿é—®</li><li>ç®—æœ¯å¼ºåº¦ä»0.25æå‡åˆ°10+</li></ul><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬å››ç« æ­ç¤ºäº†GPUçš„å†…éƒ¨æœºåˆ¶ï¼š</p><p><strong>æ¶æ„è®¤è¯†</strong>ï¼šSMæ˜¯ç‹¬ç«‹æ‰§è¡Œå•å…ƒï¼Œå¤šä¸ªblockåˆ†é…åˆ°SMå…±äº«èµ„æºã€‚ç†è§£èµ„æºé™åˆ¶ï¼ˆå¯„å­˜å™¨ã€å…±äº«å†…å­˜ã€çº¿ç¨‹æ•°ï¼‰ï¼Œå°±ç†è§£äº†ä¸ºä»€ä¹ˆæŸäº›é…ç½®æ€§èƒ½å·®ã€‚</p><p><strong>Warpæœ¬è´¨</strong>ï¼š32çº¿ç¨‹ä¸€ç»„ï¼ŒSIMTæ‰§è¡Œã€‚æ‰€æœ‰ä¼˜åŒ–éƒ½å›´ç»•warpå±•å¼€â€”â€”è®©warpå†…çº¿ç¨‹åšç›¸åŒçš„äº‹ï¼ˆé¿å…å‘æ•£ï¼‰ï¼Œè®©è¶³å¤Ÿå¤šçš„warpå‚ä¸æ‰§è¡Œï¼ˆéšè—å»¶è¿Ÿï¼‰ã€‚</p><p><strong>å‘æ•£ä»£ä»·</strong>ï¼šæ§åˆ¶æµå‘æ•£æ˜¯æ€§èƒ½æ€æ‰‹ã€‚æŒ‰warpè¾¹ç•Œåˆ’åˆ†ä»»åŠ¡ã€ç”¨ç®—æœ¯æ›¿ä»£åˆ†æ”¯ã€é‡ç»„æ•°æ®ï¼Œè¿™äº›æŠ€å·§å¾ˆå®ç”¨ã€‚</p><p><strong>å»¶è¿Ÿä¸å ç”¨ç‡</strong>ï¼šé«˜å ç”¨ç‡å¸®åŠ©éšè—å»¶è¿Ÿï¼Œä½†ä¸æ˜¯è¶Šé«˜è¶Šå¥½ã€‚è®¡ç®—å¯†é›†å‹kernelå¯èƒ½ä¸éœ€è¦é‚£ä¹ˆé«˜å ç”¨ç‡ã€‚å…³é”®æ˜¯åˆ†æå®é™…ç“¶é¢ˆã€‚</p><p><strong>è°ƒä¼˜æ€è·¯</strong>ï¼š</p><ul><li>Blockå¤§å°é€‰128-256ï¼Œ32çš„å€æ•°</li><li>æ£€æŸ¥å¯„å­˜å™¨ä½¿ç”¨ï¼Œæ§åˆ¶æº¢å‡º</li><li>ç”¨profileråˆ†æï¼Œä¸è¦çŒœ</li></ul><p>ç†è§£äº†è¿™äº›ç¡¬ä»¶çŸ¥è¯†ï¼Œåé¢ç¬¬5ç« çš„Shared Memoryä¼˜åŒ–å°±æ°´åˆ°æ¸ æˆäº†ã€‚Tilingçš„æœ¬è´¨å°±æ˜¯åˆ©ç”¨å…±äº«å†…å­˜å‡å°‘å…¨å±€å†…å­˜è®¿é—®ï¼Œæé«˜ç®—æœ¯å¼ºåº¦ï¼Œè®©è®¡ç®—å•å…ƒä¸å†é¥¿ç€ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#hardware-implementation">CUDA C++ Programming Guide - Hardware Implementation</a></li><li><a href="https://docs.nvidia.com/nsight-compute/">NVIDIA Nsight Compute Documentation</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="GPUæ¶æ„" scheme="https://smarter.xin/tags/gpu-architecture/"/>
    
    <category term="Warp" scheme="https://smarter.xin/tags/Warp/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬ä¸‰ç« ï¼šå¤šç»´ç½‘æ ¼å’Œæ•°æ®</title>
    <link href="https://smarter.xin/posts/6b7045b6/"/>
    <id>https://smarter.xin/posts/6b7045b6/</id>
    <published>2026-01-12T07:19:16.000Z</published>
    <updated>2026-01-18T14:12:10.555Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬äºŒç« çš„å‘é‡åŠ æ³•æ˜¯ä¸€ç»´æ•°æ®ï¼Œå®é™…åº”ç”¨å¤§å¤šæ˜¯å¤šç»´çš„â€”â€”å›¾åƒæ˜¯2Dï¼ŒçŸ©é˜µæ˜¯2Dï¼Œæ·±åº¦å­¦ä¹ å¼ é‡æ˜¯3D/4Dã€‚ç¬¬ä¸‰ç« è®²è§£å¦‚ä½•ç”¨CUDAçš„å¤šç»´Grid/Blockå¤„ç†è¿™äº›æ•°æ®ï¼Œæ ¸å¿ƒæ¡ˆä¾‹æ˜¯çŸ©é˜µä¹˜æ³•å’Œå›¾åƒå¤„ç†ã€‚è™½ç„¶è¿˜æ˜¯åŸºç¡€å®ç°ï¼Œä½†å·²ç»èƒ½çœ‹å‡ºGPUç¼–ç¨‹çš„æ€ç»´å’Œä¼˜åŒ–æ–¹å‘ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="duo-wei-xian-cheng-zu-zhi" tabindex="-1" id="å¤šç»´çº¿ç¨‹ç»„ç»‡">å¤šç»´çº¿ç¨‹ç»„ç»‡</h2><h3 id="cong-1-d-dao-2-d" tabindex="-1" id="ä»1Dåˆ°2D">ä»1Dåˆ°2D</h3><p>ç¬¬äºŒç« ç”¨ä¸€ç»´ç´¢å¼•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int i = blockIdx.x * blockDim.x + threadIdx.x;</span><br></pre></td></tr></table></figure><p>å¤„ç†çŸ©é˜µè‹¥ç”¨ä¸€ç»´ï¼Œéœ€è¦è½¬æ¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int idx = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">int row = idx / width;  // é™¤æ³•</span><br><span class="line">int col = idx % width;  // å–æ¨¡</span><br></pre></td></tr></table></figure><p>é™¤æ³•å’Œå–æ¨¡åœ¨GPUä¸Šæœ‰å¼€é”€ï¼Œå¯è¯»æ€§ä¹Ÿå·®ã€‚ç”¨äºŒç»´æ›´è‡ªç„¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br></pre></td></tr></table></figure><h3 id="dim-3-lei-xing" tabindex="-1" id="dim3ç±»å‹">dim3ç±»å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim3 blockDim(16, 16);     // 256 threads: 16Ã—16</span><br><span class="line">dim3 gridDim(64, 64);      // 4096 blocks</span><br><span class="line">kernel&lt;&lt;&lt;gridDim, blockDim&gt;&gt;&gt;(args);</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æ•´æ•°ä¼šè‡ªåŠ¨è½¬ä¸º1Dï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel&lt;&lt;&lt;256, 128&gt;&gt;&gt;(args);  // ç­‰ä»·äº dim3(256,1,1), dim3(128,1,1)</span><br></pre></td></tr></table></figure><h3 id="pei-zhi-yuan-ze" tabindex="-1" id="é…ç½®åŸåˆ™">é…ç½®åŸåˆ™</h3><ul><li><strong>åŒ¹é…æ•°æ®ç»´åº¦</strong>ï¼šå›¾åƒç”¨2Dï¼Œä½“æ•°æ®ç”¨3D</li><li><strong>è€ƒè™‘å†…å­˜è®¿é—®</strong>ï¼šåŒä¸€warpçš„çº¿ç¨‹æœ€å¥½è®¿é—®è¿ç»­å†…å­˜</li><li><strong>ç¡¬ä»¶é™åˆ¶</strong>ï¼š<ul><li>æ¯blockæœ€å¤š1024 threads</li><li>Gridçš„y/zç»´æœ€å¤š65535 blocks</li></ul></li></ul><h3 id="chang-jian-cuo-wu" tabindex="-1" id="å¸¸è§é”™è¯¯">å¸¸è§é”™è¯¯</h3><p><strong>1. å‚æ•°é¡ºåº</strong>ï¼š<code>&lt;&lt;&lt;grid, block&gt;&gt;&gt;</code>ä¸è¦å</p><p><strong>2. å‘ä¸Šå–æ•´</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// é”™è¯¯ï¼šsizeæ•´é™¤æ—¶ä¼šå¤šä¸€ä¸ªblock</span><br><span class="line">int blocks = size / threads + 1;</span><br><span class="line"></span><br><span class="line">// æ­£ç¡®</span><br><span class="line">int blocks = (size + threads - 1) / threads;</span><br></pre></td></tr></table></figure><p><strong>3. è¶…è¿‡é™åˆ¶</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(32, 32, 1);   // 32*32=1024ï¼Œåˆšå¥½</span><br><span class="line">dim3 block(32, 32, 2);   // 2048ï¼Œè¶…é™ï¼</span><br></pre></td></tr></table></figure><h2 id="ju-zhen-cheng-fa" tabindex="-1" id="çŸ©é˜µä¹˜æ³•">çŸ©é˜µä¹˜æ³•</h2><h3 id="wen-ti-ding-yi" tabindex="-1" id="é—®é¢˜å®šä¹‰">é—®é¢˜å®šä¹‰</h3><p>P[i][j] = Î£(k=0â†’n-1) M[i][k] Ã— N[k][j]</p><ul><li>M: mÃ—n</li><li>N: nÃ—o</li><li>P: mÃ—o</li></ul><h3 id="ji-chu-shi-xian" tabindex="-1" id="åŸºç¡€å®ç°">åŸºç¡€å®ç°</h3><p>æ¯ä¸ªçº¿ç¨‹è®¡ç®—ä¸€ä¸ªè¾“å‡ºå…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__global__ void matMul(float *M, float *N, float *P, </span><br><span class="line">                       int m, int n, int o) &#123;</span><br><span class="line">    int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    </span><br><span class="line">    if (row &lt; m &amp;&amp; col &lt; o) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int k = 0; k &lt; n; k++) &#123;</span><br><span class="line">            sum += M[row * n + k] * N[k * o + col];</span><br><span class="line">        &#125;</span><br><span class="line">        P[row * o + col] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•å…¬å¼</strong>ï¼ˆè¡Œä¸»åºï¼‰ï¼š</p><ul><li>M[i][j] â†’ <code>i * width + j</code></li><li>ç¬¬iè¡Œç¬¬jåˆ—åœ¨ä¸€ç»´æ•°ç»„ä¸­çš„ä½ç½®</li></ul><p><strong>å¯åŠ¨é…ç½®</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim3 block(16, 16);</span><br><span class="line">dim3 grid((o + 15) / 16, (m + 15) / 16);</span><br><span class="line">matMul&lt;&lt;&lt;grid, block&gt;&gt;&gt;(d_M, d_N, d_P, m, n, o);</span><br></pre></td></tr></table></figure><p><strong>è¾¹ç•Œæ£€æŸ¥</strong>ï¼š<code>if (row &lt; m &amp;&amp; col &lt; o)</code> ä¸¤ä¸ªæ¡ä»¶éƒ½è¦ï¼ˆgridå‘ä¸Šå–æ•´ä¼šå¤šçº¿ç¨‹ï¼‰</p><h3 id="xing-neng-ping-jing" tabindex="-1" id="æ€§èƒ½ç“¶é¢ˆ">æ€§èƒ½ç“¶é¢ˆ</h3><p><strong>ç®—æœ¯å¼ºåº¦æä½</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ¯çº¿ç¨‹è¯»å–: 2nä¸ªfloat = 8n bytes</span><br><span class="line">æ¯çº¿ç¨‹è®¡ç®—: 2n FLOP</span><br><span class="line">ç®—æœ¯å¼ºåº¦ = 2n / 8n = 0.25 FLOP/Byte</span><br></pre></td></tr></table></figure><p>å¯¹äºå³°å€¼10 TFLOPSã€å¸¦å®½500 GB/sçš„GPUï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾¾åˆ°å³°å€¼éœ€è¦: 10T / 500G = 20 FLOP/Byte</span><br><span class="line">å®é™…åªæœ‰: 0.25</span><br><span class="line">åˆ©ç”¨ç‡: 1.25%</span><br></pre></td></tr></table></figure><p>GPUå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰æ•°æ®ã€‚æ›´ä¸¥é‡çš„æ˜¯æ•°æ®é‡å¤è¯»å–ï¼šM[i][k]è¢«ç¬¬iè¡Œçš„æ‰€æœ‰çº¿ç¨‹è¯»ï¼Œæ€»å…±è¢«è¯»mÃ—oæ¬¡ï¼Œä½†æ¯æ¬¡éƒ½ä»å…¨å±€å†…å­˜è¯»ï¼Œæ²¡æœ‰å¤ç”¨ã€‚</p><p><strong>ä¼˜åŒ–æ–¹å‘</strong>ï¼ˆç¬¬4-5ç« ï¼‰ï¼šç”¨Shared MemoryåšTilingï¼Œç®—æœ¯å¼ºåº¦æå‡åˆ°10+ FLOP/Byteã€‚</p><h3 id="bian-ti-dui-bi" tabindex="-1" id="å˜ä½“å¯¹æ¯”">å˜ä½“å¯¹æ¯”</h3><p><strong>æ¯çº¿ç¨‹ä¸€è¡Œ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int row = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">for (int col = 0; col &lt; size; col++) &#123;</span><br><span class="line">    // è®¡ç®—P[row][col]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¯çº¿ç¨‹ä¸€åˆ—</strong>ï¼šç±»ä¼¼ï¼Œå¤–å±‚å¾ªç¯æ”¹ä¸ºrow</p><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¹¶è¡Œåº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>æ¯çº¿ç¨‹ä¸€å…ƒç´ </td><td>mÃ—o (æœ€é«˜)</td><td>é€šç”¨</td></tr><tr><td>æ¯çº¿ç¨‹ä¸€è¡Œ</td><td>m</td><td>m &gt;&gt; o</td></tr><tr><td>æ¯çº¿ç¨‹ä¸€åˆ—</td><td>o</td><td>o &gt;&gt; m</td></tr></tbody></table><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯çº¿ç¨‹ä¸€å…ƒç´ çš„å¹¶è¡Œåº¦æœ€é«˜ã€‚</p><h2 id="ju-zhen-xiang-liang-cheng-fa" tabindex="-1" id="çŸ©é˜µ-å‘é‡ä¹˜æ³•">çŸ©é˜µ-å‘é‡ä¹˜æ³•</h2><p>A[i] = Î£ B[i][j] Ã— C[j]</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__global__ void matVecMul(float *B, float *C, float *A, </span><br><span class="line">                          int m, int n) &#123;</span><br><span class="line">    int row = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    if (row &lt; m) &#123;</span><br><span class="line">        float sum = 0.0f;</span><br><span class="line">        for (int j = 0; j &lt; n; j++) &#123;</span><br><span class="line">            sum += B[row * n + j] * C[j];</span><br><span class="line">        &#125;</span><br><span class="line">        A[row] = sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€ä¸€ç»´ï¼Œå› ä¸ºè¾“å‡ºæ˜¯å‘é‡ã€‚ç“¶é¢ˆæ˜¯å‘é‡Cè¢«æ‰€æœ‰çº¿ç¨‹é‡å¤è¯»å–ï¼Œå¯ç”¨Constant Memoryæˆ–Shared Memoryä¼˜åŒ–ã€‚</p><h2 id="tu-xiang-chu-li" tabindex="-1" id="å›¾åƒå¤„ç†">å›¾åƒå¤„ç†</h2><h3 id="rgb-zhuan-hui-du" tabindex="-1" id="RGBè½¬ç°åº¦">RGBè½¬ç°åº¦</h3><p><strong>å…¬å¼</strong>ï¼šGray = 0.299R + 0.587G + 0.114B</p><p><strong>å†…å­˜å¸ƒå±€</strong>ï¼ˆRGBäº¤é”™ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R0 G0 B0][R1 G1 B1]...[R(w-1) G(w-1) B(w-1)]</span><br><span class="line">[Rw Gw Bw]...</span><br></pre></td></tr></table></figure><p><strong>Kernel</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__global__ void rgb2gray(unsigned char *rgb, unsigned char *gray,</span><br><span class="line">                         int width, int height) &#123;</span><br><span class="line">    int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    if (row &lt; height &amp;&amp; col &lt; width) &#123;</span><br><span class="line">        int rgbIdx = (row * width + col) * 3;</span><br><span class="line">        int grayIdx = row * width + col;</span><br><span class="line">        </span><br><span class="line">        unsigned char r = rgb[rgbIdx];</span><br><span class="line">        unsigned char g = rgb[rgbIdx + 1];</span><br><span class="line">        unsigned char b = rgb[rgbIdx + 2];</span><br><span class="line">        </span><br><span class="line">        gray[grayIdx] = 0.299f*r + 0.587f*g + 0.114f*b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€§èƒ½</strong>ï¼šå¸¦å®½å—é™ï¼ˆè¯»3å­—èŠ‚ï¼Œå†™1å­—èŠ‚ï¼Œè®¡ç®—å¾ˆå°‘ï¼‰ï¼Œä½†è®¿é—®è¿ç»­ï¼Œcoalescingæ•ˆæœå¥½ã€‚</p><h3 id="gao-si-mo-hu" tabindex="-1" id="é«˜æ–¯æ¨¡ç³Š">é«˜æ–¯æ¨¡ç³Š</h3><p><strong>æ¨¡æ¿è®¡ç®—</strong>ï¼ˆStencilï¼‰ï¼šæ¯ä¸ªåƒç´ ç”±é‚»åŸŸåŠ æƒæ±‚å’Œ</p><p>3Ã—3é«˜æ–¯æ ¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1/16 * [1 2 1]</span><br><span class="line">       [2 4 2]</span><br><span class="line">       [1 2 1]</span><br></pre></td></tr></table></figure><p><strong>Kernel</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">__global__ void gaussianBlur(unsigned char *in, unsigned char *out,</span><br><span class="line">                              int width, int height) &#123;</span><br><span class="line">    int col = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    int row = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    </span><br><span class="line">    // è¾¹ç•Œç›´æ¥å¤åˆ¶</span><br><span class="line">    if (row == 0 || row == height-1 || </span><br><span class="line">        col == 0 || col == width-1) &#123;</span><br><span class="line">        if (row &lt; height &amp;&amp; col &lt; width)</span><br><span class="line">            out[row*width + col] = in[row*width + col];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (row &lt; height &amp;&amp; col &lt; width) &#123;</span><br><span class="line">        float sum = 0;</span><br><span class="line">        // 3x3é‚»åŸŸ</span><br><span class="line">        sum += in[(row-1)*width + col-1] * 1.0f;</span><br><span class="line">        sum += in[(row-1)*width + col  ] * 2.0f;</span><br><span class="line">        sum += in[(row-1)*width + col+1] * 1.0f;</span><br><span class="line">        sum += in[row*width + col-1] * 2.0f;</span><br><span class="line">        sum += in[row*width + col  ] * 4.0f;</span><br><span class="line">        sum += in[row*width + col+1] * 2.0f;</span><br><span class="line">        sum += in[(row+1)*width + col-1] * 1.0f;</span><br><span class="line">        sum += in[(row+1)*width + col  ] * 2.0f;</span><br><span class="line">        sum += in[(row+1)*width + col+1] * 1.0f;</span><br><span class="line">        </span><br><span class="line">        out[row*width + col] = sum / 16.0f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š<br>-è¾¹ç•Œå¤„ç†ï¼šè¿™é‡Œç®€åŒ–ä¸ºå¤åˆ¶ï¼Œä¹Ÿå¯padding/é•œåƒ</p><ul><li>æ•°æ®é‡ç”¨ï¼šç›¸é‚»åƒç´ çš„é‚»åŸŸé‡å ï¼Œä½†æ­¤ç‰ˆæœ¬æ²¡å¤ç”¨</li><li>ä¼˜åŒ–ï¼šç”¨Shared Memoryè®©blockåä½œåŠ è½½tile+halo</li></ul><h2 id="nei-cun-bu-ju" tabindex="-1" id="å†…å­˜å¸ƒå±€">å†…å­˜å¸ƒå±€</h2><h3 id="xing-zhu-xu-c-cuda" tabindex="-1" id="è¡Œä¸»åºï¼ˆC-CUDAï¼‰">è¡Œä¸»åºï¼ˆC/CUDAï¼‰</h3><p>å…ƒç´ [row][col]çš„ç´¢å¼•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = row * width + col</span><br></pre></td></tr></table></figure><p>ä¾‹ï¼š4Ã—3çŸ©é˜µå…ƒç´ [2][1]ï¼š<code>2*3 + 1 = 7</code></p><h3 id="lie-zhu-xu-fortran-matlab" tabindex="-1" id="åˆ—ä¸»åºï¼ˆFortran-MATLABï¼‰">åˆ—ä¸»åºï¼ˆFortran/MATLABï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = col * height + row</span><br></pre></td></tr></table></figure><p>åŒæ ·å…ƒç´ [2][1]ï¼š<code>1*4 + 2 = 6</code></p><h3 id="san-wei-zhang-liang" tabindex="-1" id="ä¸‰ç»´å¼ é‡">ä¸‰ç»´å¼ é‡</h3><p>æ·±åº¦Ã—é«˜åº¦Ã—å®½åº¦ï¼Œå…ƒç´ [z][y][x]ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index = z * (height * width) + y * width + x</span><br></pre></td></tr></table></figure><p>ä¾‹ï¼š300Ã—500Ã—400 (DÃ—HÃ—W)ï¼Œå…ƒç´ [5][20][10]ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5*(500*400) + 20*400 + 10 = 1,008,010</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šæ·±åº¦å­¦ä¹ æ¡†æ¶ç»´åº¦é¡ºåºå¯èƒ½ä¸åŒï¼ˆPyTorchç”¨NCHWï¼ŒTensorFlowç”¨NHWCï¼‰ã€‚</p><h2 id="zhi-xing-pei-zhi-shi-li" tabindex="-1" id="æ‰§è¡Œé…ç½®ç¤ºä¾‹">æ‰§è¡Œé…ç½®ç¤ºä¾‹</h2><p>ä¹¦ä¸­ä¹ é¢˜3ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim3 bd(16, 32);                      // block: 16Ã—32</span><br><span class="line">dim3 gd((300-1)/16+1, (150-1)/32+1); // grid</span><br><span class="line">// M=150, N=300</span><br></pre></td></tr></table></figure><ul><li>æ¯blockï¼š16Ã—32 = 512 threads</li><li>Gridï¼š(19, 5) = 95 blocks</li><li>æ€»çº¿ç¨‹ï¼š95Ã—512 = 48,640</li><li>æœ‰æ•ˆçº¿ç¨‹ï¼ˆrow&lt;150 &amp;&amp; col&lt;300ï¼‰ï¼š150Ã—300 = 45,000</li><li>æµªè´¹ï¼š3,640 (7.5%)ï¼Œå¯æ¥å—</li></ul><h2 id="xing-neng-fen-xi-si-lu" tabindex="-1" id="æ€§èƒ½åˆ†ææ€è·¯">æ€§èƒ½åˆ†ææ€è·¯</h2><h3 id="roofline-mo-xing" tabindex="-1" id="Rooflineæ¨¡å‹">Rooflineæ¨¡å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®é™…æ€§èƒ½ = min(è®¡ç®—å³°å€¼, å¸¦å®½ Ã— ç®—æœ¯å¼ºåº¦)</span><br></pre></td></tr></table></figure><p>è¦è¾¾åˆ°è®¡ç®—å³°å€¼éœ€è¦ï¼šç®—æœ¯å¼ºåº¦ â‰¥ å³°å€¼FLOPS / å¸¦å®½</p><p>ä¾‹å¦‚GPU 10 TFLOPS, 500 GB/sï¼šéœ€è¦ â‰¥ 20 FLOP/Byte</p><p>å½“å‰ç®—æ³•éƒ½è¿œä½äºæ­¤ï¼Œæ€§èƒ½å—å†…å­˜é™åˆ¶ã€‚</p><h3 id="ti-sheng-suan-zhu-qiang-du" tabindex="-1" id="æå‡ç®—æœ¯å¼ºåº¦">æå‡ç®—æœ¯å¼ºåº¦</h3><p>æ ¸å¿ƒï¼š<strong>æ•°æ®é‡ç”¨</strong></p><ul><li><strong>Tiling</strong>ï¼šæ•°æ®åŠ è½½åˆ°Shared Memoryé‡å¤ä½¿ç”¨</li><li><strong>å¯„å­˜å™¨å¤ç”¨</strong>ï¼šæ¯çº¿ç¨‹è®¡ç®—å¤šä¸ªå…ƒç´ </li><li><strong>Kernelèåˆ</strong>ï¼šå‡å°‘ä¸­é—´ç»“æœä¼ è¾“</li></ul><p>çŸ©é˜µä¹˜æ³•ä¼˜åŒ–ç‰ˆèƒ½è¾¾åˆ°10+ FLOP/Byteï¼Œæ€§èƒ½æå‡10å€ä»¥ä¸Šã€‚</p><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬ä¸‰ç« ä»ä¸€ç»´æ‰©å±•åˆ°å¤šç»´ï¼Œæ ¸å¿ƒæ˜¯Grid/Blockçš„çµæ´»ç»„ç»‡ï¼š</p><p><strong>å¤šç»´ç´¢å¼•</strong>ï¼š<code>row = blockIdx.y*blockDim.y + threadIdx.y</code> è¦ç†Ÿç»ƒï¼ŒäºŒç»´ã€ä¸‰ç»´æ˜¯è‡ªç„¶æ‰©å±•ã€‚</p><p><strong>å†…å­˜å¸ƒå±€</strong>ï¼šè¡Œä¸»åºå†³å®šç´¢å¼•å…¬å¼ <code>row*width + col</code>ï¼Œæé”™ä¼šè®¿é—®é”™è¯¯æ•°æ®ã€‚</p><p><strong>æ€§èƒ½è®¤çŸ¥</strong>ï¼šåŸºç¡€å®ç°éƒ½æ˜¯å†…å­˜å—é™ï¼Œç®—æœ¯å¼ºåº¦0.1-0.25 FLOP/Byteï¼Œè¿œä½äºéœ€è¦çš„20ã€‚GPUè®¡ç®—èƒ½åŠ›å¼ºï¼Œä½†æ•°æ®ä¾›åº”è·Ÿä¸ä¸Šã€‚</p><p><strong>ä¼˜åŒ–æ–¹å‘</strong>ï¼šæå‡ç®—æœ¯å¼ºåº¦ = å¢åŠ æ•°æ®é‡ç”¨ã€‚è¿™æ˜¯ç¬¬4-5ç« çš„é‡ç‚¹ã€‚</p><p><strong>ä»£ç ä¹ æƒ¯</strong>ï¼š</p><ul><li>äºŒç»´/ä¸‰ç»´éƒ½è¦ä¸¥æ ¼è¾¹ç•Œæ£€æŸ¥</li><li>ç´¢å¼•è®¡ç®—å…ˆrowåcolï¼ˆè¡Œä¸»åºï¼‰</li><li>æ€§èƒ½åˆ†æè¦é‡åŒ–ï¼ˆç®—æœ¯å¼ºåº¦ã€å¸¦å®½åˆ©ç”¨ç‡ï¼‰</li></ul><p>ç†è§£äº†naiveå®ç°çš„ç“¶é¢ˆï¼Œæ‰èƒ½æ˜ç™½Shared Memoryã€Tilingçš„ä»·å€¼ã€‚ä¸‹ä¸€ç« çš„ä¼˜åŒ–ä¼šè®©åŒæ ·çš„çŸ©é˜µä¹˜æ³•æ€§èƒ½æå‡10å€ä»¥ä¸Šã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/">CUDA C++ Programming Guide</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="çŸ©é˜µä¹˜æ³•" scheme="https://smarter.xin/tags/matrix-multiplication/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="https://smarter.xin/tags/image-processing/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬äºŒç« ï¼šå¼‚æ„æ•°æ®å¹¶è¡Œè®¡ç®—</title>
    <link href="https://smarter.xin/posts/3ee22ce5/"/>
    <id>https://smarter.xin/posts/3ee22ce5/</id>
    <published>2026-01-11T11:38:29.000Z</published>
    <updated>2026-01-18T14:12:10.555Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬ä¸€ç« è®²äº†ç†è®ºï¼Œç¬¬äºŒç« å¼€å§‹å†™ä»£ç äº†ã€‚è™½ç„¶ä¾‹å­æ˜¯ç»å…¸çš„å‘é‡åŠ æ³•ï¼Œä½†å®ƒåŒ…å«äº†CUDAç¼–ç¨‹çš„æ‰€æœ‰æ ¸å¿ƒç¯èŠ‚ï¼šå†…å­˜ç®¡ç†ã€kernelç¼–å†™ã€çº¿ç¨‹ç»„ç»‡ã€‚æŒæ¡è¿™ä¸ªç®€å•ä¾‹å­ï¼Œåé¢çš„å¤æ‚åº”ç”¨å°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šçš„æ‰©å±•ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="wei-shi-yao-cong-xiang-liang-jia-fa-kai-shi" tabindex="-1" id="ä¸ºä»€ä¹ˆä»å‘é‡åŠ æ³•å¼€å§‹">ä¸ºä»€ä¹ˆä»å‘é‡åŠ æ³•å¼€å§‹</h2><h3 id="shu-ju-bing-xing-de-dian-xing-li-zi" tabindex="-1" id="æ•°æ®å¹¶è¡Œçš„å…¸å‹ä¾‹å­">æ•°æ®å¹¶è¡Œçš„å…¸å‹ä¾‹å­</h3><p>å‘é‡åŠ æ³•æ˜¯æ•°æ®å¹¶è¡Œçš„æœ€ä½³å…¥å£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C[0] = A[0] + B[0]</span><br><span class="line">C[1] = A[1] + B[1]</span><br><span class="line">...</span><br><span class="line">C[n-1] = A[n-1] + B[n-1]</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªå…ƒç´ çš„è®¡ç®—å®Œå…¨ç‹¬ç«‹ï¼ŒC[0]ä¸éœ€è¦ç­‰C[1]ç®—å®Œã€‚è¿™ç§ç‹¬ç«‹æ€§æ­£æ˜¯å¹¶è¡Œè®¡ç®—çš„é»„é‡‘åœºæ™¯ã€‚</p><h3 id="nei-cun-shou-xian-wen-ti" tabindex="-1" id="å†…å­˜å—é™é—®é¢˜">å†…å­˜å—é™é—®é¢˜</h3><p>å‘é‡åŠ æ³•çš„ç®—æœ¯å¼ºåº¦å¾ˆä½ï¼š</p><ul><li>æ¯å…ƒç´ ï¼šè¯»2ä¸ªfloat + å†™1ä¸ªfloat = 12å­—èŠ‚</li><li>è®¡ç®—ï¼š1æ¬¡æµ®ç‚¹åŠ æ³•</li><li>ç®—æœ¯å¼ºåº¦ï¼š1 FLOP / 12 Bytes â‰ˆ 0.083 FLOP/Byte</li></ul><p>å…¸å‹å†…å­˜å—é™ï¼ˆMemory-Boundï¼‰é—®é¢˜ã€‚GPUè®¡ç®—å•å…ƒä¼šç»å¸¸ç­‰æ•°æ®ã€‚è™½ç„¶æ€§èƒ½è¾¾ä¸åˆ°å³°å€¼ï¼Œä½†ä½œä¸ºå…¥é—¨ä¾‹å­è¶³å¤Ÿç®€å•ç›´è§‚ã€‚</p><h2 id="cuda-cheng-xu-jie-gou-san-bu-zou" tabindex="-1" id="CUDAç¨‹åºç»“æ„ï¼šä¸‰æ­¥èµ°">CUDAç¨‹åºç»“æ„ï¼šä¸‰æ­¥èµ°</h2><h3 id="cpu-ban-ben-dui-bi" tabindex="-1" id="CPUç‰ˆæœ¬ï¼ˆå¯¹æ¯”ï¼‰">CPUç‰ˆæœ¬ï¼ˆå¯¹æ¯”ï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vecAddCPU</span><span class="params">(<span class="type">float</span> *A, <span class="type">float</span> *B, <span class="type">float</span> *C, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        C[i] = A[i] + B[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸²è¡Œæ‰§è¡Œï¼Œn=10000å°±è¦å¾ªç¯10000æ¬¡ã€‚</p><h3 id="cuda-ban-ben" tabindex="-1" id="CUDAç‰ˆæœ¬">CUDAç‰ˆæœ¬</h3><h4 id="1-host-duan-zhun-bei" tabindex="-1" id="1-Hostç«¯å‡†å¤‡">1. Hostç«¯å‡†å¤‡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int n = 10000;</span><br><span class="line">size_t size = n * sizeof(float);</span><br><span class="line"></span><br><span class="line">// åˆ†é…Hostå†…å­˜</span><br><span class="line">float *h_A = (float*)malloc(size);</span><br><span class="line">float *h_B = (float*)malloc(size);</span><br><span class="line">float *h_C = (float*)malloc(size);</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ–æ•°æ®</span><br><span class="line">for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">    h_A[i] = i * 1.0f;</span><br><span class="line">    h_B[i] = i * 2.0f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>h_</code>å‰ç¼€è¡¨ç¤ºHostå˜é‡ï¼Œè¿™æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</p><h4 id="2-device-duan-zhun-bei" tabindex="-1" id="2-Deviceç«¯å‡†å¤‡">2. Deviceç«¯å‡†å¤‡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// åˆ†é…Deviceå†…å­˜</span><br><span class="line">float *d_A, *d_B, *d_C;</span><br><span class="line">cudaMalloc((void**)&amp;d_A, size);</span><br><span class="line">cudaMalloc((void**)&amp;d_B, size);</span><br><span class="line">cudaMalloc((void**)&amp;d_C, size);</span><br><span class="line"></span><br><span class="line">// Host â†’ Device</span><br><span class="line">cudaMemcpy(d_A, h_A, size, cudaMemcpyHostToDevice);</span><br><span class="line">cudaMemcpy(d_B, h_B, size, cudaMemcpyHostToDevice);</span><br></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼š</p><ul><li><code>cudaMalloc</code>å‚æ•°æ˜¯äºŒçº§æŒ‡é’ˆï¼ˆéœ€è¦ä¿®æ”¹æŒ‡é’ˆå€¼ï¼‰</li><li><code>d_A</code>æ˜¯DeviceæŒ‡é’ˆï¼Œåœ¨Hostä»£ç ä¸­ä¸èƒ½ç›´æ¥è§£å¼•ç”¨<code>d_A[0]</code>ï¼ˆä¼šæ®µé”™è¯¯ï¼‰</li></ul><h4 id="3-zhi-xing-yu-hui-chuan" tabindex="-1" id="3-æ‰§è¡Œä¸å›ä¼ ">3. æ‰§è¡Œä¸å›ä¼ </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// å¯åŠ¨kernel</span><br><span class="line">int threadsPerBlock = 256;</span><br><span class="line">int blocksPerGrid = (n + threadsPerBlock - 1) / threadsPerBlock;</span><br><span class="line">vecAdd&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;(d_A, d_B, d_C, n);</span><br><span class="line"></span><br><span class="line">// Device â†’ Host</span><br><span class="line">cudaMemcpy(h_C, d_C, size, cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">// éªŒè¯</span><br><span class="line">for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">    if (fabs(h_C[i] - (h_A[i] + h_B[i])) &gt; 1e-5) &#123;</span><br><span class="line">        printf(&quot;Error at index %d\n&quot;, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ¸…ç†</span><br><span class="line">cudaFree(d_A);</span><br><span class="line">cudaFree(d_B);</span><br><span class="line">cudaFree(d_C);</span><br><span class="line">free(h_A);</span><br><span class="line">free(h_B);</span><br><span class="line">free(h_C);</span><br></pre></td></tr></table></figure><h2 id="kernel-han-shu" tabindex="-1" id="Kernelå‡½æ•°">Kernelå‡½æ•°</h2><h3 id="ji-ben-jie-gou" tabindex="-1" id="åŸºæœ¬ç»“æ„">åŸºæœ¬ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__global__ void vecAdd(float *A, float *B, float *C, int n) &#123;</span><br><span class="line">    int i = blockDim.x * blockIdx.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        C[i] = A[i] + B[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é€è¡Œè§£æ</strong>ï¼š</p><ul><li><p><code>__global__</code>ï¼šGPUä¸Šæ‰§è¡Œï¼ŒCPUè°ƒç”¨</p><ul><li><code>__device__</code>ï¼šGPUä¸Šæ‰§è¡Œï¼ŒGPUè°ƒç”¨</li><li><code>__host__</code>ï¼šCPUä¸Šæ‰§è¡Œï¼ŒCPUè°ƒç”¨ï¼ˆé»˜è®¤ï¼Œå¯çœç•¥ï¼‰</li></ul></li><li><p>çº¿ç¨‹ç´¢å¼•è®¡ç®—ï¼š<code>i = blockIdx.x * blockDim.x + threadIdx.x</code></p><ul><li><code>blockIdx.x</code>ï¼šblockåœ¨gridä¸­çš„ç´¢å¼•</li><li><code>blockDim.x</code>ï¼šblockçš„å¤§å°</li><li><code>threadIdx.x</code>ï¼šthreadåœ¨blockä¸­çš„ç´¢å¼•</li></ul></li><li><p>è¾¹ç•Œæ£€æŸ¥ï¼š<code>if (i &lt; n)</code> å¿…é¡»æœ‰ï¼ˆæ€»çº¿ç¨‹æ•°é€šå¸¸å¤šäºæ•°ç»„å…ƒç´ ï¼‰</p></li></ul><h3 id="xian-cheng-ceng-ci-jie-gou" tabindex="-1" id="çº¿ç¨‹å±‚æ¬¡ç»“æ„">çº¿ç¨‹å±‚æ¬¡ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Grid</span><br><span class="line">â”œâ”€â”€ Block 0 (256 threads)</span><br><span class="line">â”‚   â”œâ”€â”€ Thread 0   â†’ i = 0*256 + 0 = 0</span><br><span class="line">â”‚   â”œâ”€â”€ Thread 1   â†’ i = 0*256 + 1 = 1</span><br><span class="line">â”‚   â””â”€â”€ Thread 255 â†’ i = 0*256 + 255 = 255</span><br><span class="line">â”œâ”€â”€ Block 1 (256 threads)</span><br><span class="line">â”‚   â”œâ”€â”€ Thread 0   â†’ i = 1*256 + 0 = 256</span><br><span class="line">â”‚   â””â”€â”€ Thread 255 â†’ i = 1*256 + 255 = 511</span><br><span class="line">â””â”€â”€ ...</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªthreadå¾—åˆ°å”¯ä¸€ç´¢å¼•ï¼Œå¯¹åº”æ•°ç»„å…ƒç´ ã€‚</p><h3 id="wei-shi-yao-256-ge-threads" tabindex="-1" id="ä¸ºä»€ä¹ˆ256ä¸ªthreadsï¼Ÿ">ä¸ºä»€ä¹ˆ256ä¸ªthreadsï¼Ÿ</h3><p>ä¸æ˜¯éšä¾¿é€‰çš„ï¼š</p><ol><li><strong>Warpçš„å€æ•°</strong>ï¼šGPUä»¥32çº¿ç¨‹ä¸ºä¸€ç»„ï¼ˆwarpï¼‰æ‰§è¡Œï¼Œ256 = 8 Ã— 32</li><li><strong>ç¡¬ä»¶é™åˆ¶</strong>ï¼šæ¯blockæœ€å¤š1024 threads</li><li><strong>ç»éªŒå€¼</strong>ï¼š128-512é€šå¸¸æ€§èƒ½è¾ƒå¥½</li></ol><p>å…·ä½“æœ€ä¼˜å€¼éœ€è¦profilingç¡®å®šã€‚</p><h3 id="bian-jie-jian-cha-de-bi-yao-xing" tabindex="-1" id="è¾¹ç•Œæ£€æŸ¥çš„å¿…è¦æ€§">è¾¹ç•Œæ£€æŸ¥çš„å¿…è¦æ€§</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blocksPerGrid = (10000 + 255) / 256 = 40</span><br><span class="line">æ€»threads = 40 Ã— 256 = 10240</span><br></pre></td></tr></table></figure><p>å¤šå‡º240ä¸ªçº¿ç¨‹ã€‚ä¸æ£€æŸ¥è¾¹ç•Œä¼šè¶Šç•Œè®¿é—®ï¼Œå¯¼è‡´é”™è¯¯æˆ–å´©æºƒã€‚</p><h2 id="nei-cun-guan-li" tabindex="-1" id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</h2><h3 id="host-vs-device-nei-cun" tabindex="-1" id="Host-vs-Deviceå†…å­˜">Host vs Deviceå†…å­˜</h3><p><strong>å…³é”®</strong>ï¼šä¸¤ä¸ªç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥äº’è®¿ã€‚</p><ul><li><strong>Host Memory</strong>ï¼šCPUçš„DDR4/DDR5</li><li><strong>Device Memory</strong>ï¼šGPUçš„GDDR6/HBM</li></ul><p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">float *d_A;</span><br><span class="line">cudaMalloc((void**)&amp;d_A, size);</span><br><span class="line">d_A[0] = 1.0f;  // æ®µé”™è¯¯ï¼CPUä¸èƒ½ç›´æ¥è®¿é—®GPUå†…å­˜</span><br></pre></td></tr></table></figure><p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">float *h_A = (float*)malloc(size);</span><br><span class="line">h_A[0] = 1.0f;</span><br><span class="line">cudaMemcpy(d_A, h_A, size, cudaMemcpyHostToDevice);</span><br></pre></td></tr></table></figure><h3 id="shu-ju-chuan-shu-kai-xiao" tabindex="-1" id="æ•°æ®ä¼ è¾“å¼€é”€">æ•°æ®ä¼ è¾“å¼€é”€</h3><p>PCIeå¸¦å®½ï¼ˆ~32 GB/sï¼‰è¿œä½äºGPUå†…å­˜å¸¦å®½ï¼ˆ500+ GB/sï¼‰ã€‚å¯¹äºç®€å•è®¡ç®—ï¼Œä¼ è¾“æ—¶é—´å¯èƒ½æ˜¯è®¡ç®—æ—¶é—´çš„æ•°åå€ã€‚</p><p><strong>ä¼˜åŒ–åŸåˆ™</strong>ï¼š</p><ul><li>å‡å°‘ä¼ è¾“æ¬¡æ•°ï¼ˆæ‰¹é‡ä¼ è¾“ï¼‰</li><li>ä¿æŒæ•°æ®åœ¨GPUï¼ˆå¤šæ­¥è®¡ç®—ä¸å›ä¼ ï¼‰</li><li>å¼‚æ­¥ä¼ è¾“ä¸è®¡ç®—é‡å ï¼ˆé«˜çº§æŠ€å·§ï¼‰</li></ul><h3 id="unified-memory-ke-xuan" tabindex="-1" id="Unified-Memoryï¼ˆå¯é€‰ï¼‰">Unified Memoryï¼ˆå¯é€‰ï¼‰</h3><p>ä»CUDA 6.0èµ·å¯ä»¥ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">float *data;</span><br><span class="line">cudaMallocManaged(&amp;data, size);</span><br><span class="line"></span><br><span class="line">data[0] = 1.0f;              // CPUè®¿é—®</span><br><span class="line">kernel&lt;&lt;&lt;...&gt;&gt;&gt;(data);       // GPUè®¿é—®ï¼ˆè‡ªåŠ¨è¿ç§»ï¼‰</span><br><span class="line">printf(&quot;%f\n&quot;, data[0]);     // CPUè®¿é—®ï¼ˆè‡ªåŠ¨ä¼ å›ï¼‰</span><br><span class="line"></span><br><span class="line">cudaFree(data);</span><br></pre></td></tr></table></figure><p>æ–¹ä¾¿ï¼Œä½†æœ‰æ€§èƒ½å¼€é”€ã€‚å­¦ä¹ åŸå‹å¼€å‘å‹å¥½ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®æ˜¾å¼ç®¡ç†ã€‚</p><h2 id="zhi-xing-pei-zhi" tabindex="-1" id="æ‰§è¡Œé…ç½®">æ‰§è¡Œé…ç½®</h2><h3 id="qi-dong-yu-fa" tabindex="-1" id="å¯åŠ¨è¯­æ³•">å¯åŠ¨è¯­æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vecAdd&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;(d_A, d_B, d_C, n);</span><br></pre></td></tr></table></figure><p>å®Œæ•´å½¢å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel&lt;&lt;&lt;gridDim, blockDim, sharedMem, stream&gt;&gt;&gt;(args);</span><br></pre></td></tr></table></figure><ul><li><code>gridDim</code>ï¼šgridçš„ç»´åº¦ï¼ˆ1D/2D/3Dï¼‰</li><li><code>blockDim</code>ï¼šblockçš„ç»´åº¦</li><li><code>sharedMem</code>ï¼šå…±äº«å†…å­˜å¤§å°ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰</li><li><code>stream</code>ï¼šCUDAæµï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰</li></ul><h3 id="ji-suan-grid-da-xiao" tabindex="-1" id="è®¡ç®—gridå¤§å°">è®¡ç®—gridå¤§å°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int threads = 256;</span><br><span class="line">int blocks = (n + threads - 1) / threads;  // å‘ä¸Šå–æ•´</span><br></pre></td></tr></table></figure><p>æ•°å­¦ç­‰ä»·äº<code>ceil(n / threads)</code>ï¼Œä½†æ•´æ•°è¿ç®—æ›´é«˜æ•ˆã€‚</p><h2 id="cuo-wu-chu-li" tabindex="-1" id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2><p>CUDAå‡½æ•°è¿”å›<code>cudaError_t</code>ï¼Œéœ€è¦æ˜¾å¼æ£€æŸ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#define CUDA_CHECK(call) \</span><br><span class="line">do &#123; \</span><br><span class="line">    cudaError_t err = call; \</span><br><span class="line">    if (err != cudaSuccess) &#123; \</span><br><span class="line">        fprintf(stderr, &quot;CUDA Error: %s at %s:%d\n&quot;, \</span><br><span class="line">                cudaGetErrorString(err), __FILE__, __LINE__); \</span><br><span class="line">        exit(EXIT_FAILURE); \</span><br><span class="line">    &#125; \</span><br><span class="line">&#125; while(0)</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨</span><br><span class="line">CUDA_CHECK(cudaMalloc((void**)&amp;d_A, size));</span><br><span class="line">CUDA_CHECK(cudaMemcpy(d_A, h_A, size, cudaMemcpyHostToDevice));</span><br></pre></td></tr></table></figure><p>Kernelå¯åŠ¨ä¸è¿”å›é”™è¯¯ç ï¼Œéœ€è¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vecAdd&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;(d_A, d_B, d_C, n);</span><br><span class="line">CUDA_CHECK(cudaGetLastError());          // æ£€æŸ¥å¯åŠ¨é”™è¯¯</span><br><span class="line">CUDA_CHECK(cudaDeviceSynchronize());     // åŒæ­¥å¹¶æ£€æŸ¥æ‰§è¡Œé”™è¯¯</span><br></pre></td></tr></table></figure><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬äºŒç« é€šè¿‡å‘é‡åŠ æ³•å»ºç«‹äº†CUDAç¼–ç¨‹çš„åŸºæœ¬æ¡†æ¶ï¼š</p><p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼šå†…å­˜åˆ†é… â†’ æ•°æ®ä¼ è¾“ â†’ kernelå¯åŠ¨ â†’ ç»“æœå›ä¼ ï¼Œè¿™æ˜¯æ‰€æœ‰CUDAç¨‹åºçš„éª¨æ¶ã€‚</p><p><strong>çº¿ç¨‹ç»„ç»‡</strong>ï¼šGrid/Block/Threadä¸‰çº§ç»“æ„ï¼Œç´¢å¼•è®¡ç®—<code>i = blockIdx.x * blockDim.x + threadIdx.x</code>è¦çƒ‚ç†Ÿäºå¿ƒã€‚</p><p><strong>å†…å­˜æ¨¡å‹</strong>ï¼šHostå’ŒDeviceæ˜¯ç‹¬ç«‹ç©ºé—´ï¼Œå¿…é¡»æ˜¾å¼ä¼ è¾“ã€‚æ•°æ®ä¼ è¾“å¼€é”€ä¸å®¹å¿½è§†ã€‚</p><p><strong>æ€§èƒ½è®¤çŸ¥</strong>ï¼šå‘é‡åŠ æ³•è™½ç„¶èƒ½åœ¨GPUä¸Šè·‘ï¼Œä½†å—å†…å­˜å¸¦å®½é™åˆ¶ï¼Œæ€§èƒ½æå‡æœ‰é™ã€‚çœŸæ­£å‘æŒ¥GPUä¼˜åŠ¿éœ€è¦é«˜ç®—æœ¯å¼ºåº¦çš„ä»»åŠ¡ã€‚</p><p><strong>ä»£ç ä¹ æƒ¯</strong>ï¼š</p><ul><li>å˜é‡å‘½ååŒºåˆ†h_/d_</li><li>è¾¹ç•Œæ£€æŸ¥å¿…é¡»ä¸¥æ ¼</li><li>é”™è¯¯å¤„ç†ä¸èƒ½çœç•¥</li></ul><p>ä¸‹ä¸€ç« è¿›å…¥å¤šç»´æ•°æ®å¤„ç†ï¼ˆçŸ©é˜µã€å›¾åƒï¼‰ï¼Œä¼šç”¨åˆ°2D Grid/Blockç»„ç»‡ã€‚ç†è§£äº†ä¸€ç»´çš„åŸç†ï¼Œå¤šç»´åªæ˜¯è‡ªç„¶æ‰©å±•ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/">CUDA C++ Programming Guide</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
    <category term="å‘é‡åŠ æ³•" scheme="https://smarter.xin/tags/vector-addition/"/>
    
  </entry>
  
  <entry>
    <title>PMPP-ç¬¬ä¸€ç« ï¼šå¼•è¨€</title>
    <link href="https://smarter.xin/posts/10d278b0/"/>
    <id>https://smarter.xin/posts/10d278b0/</id>
    <published>2026-01-11T09:32:53.000Z</published>
    <updated>2026-01-18T14:12:10.555Z</updated>
    
    <content type="html"><![CDATA[<h2 id="qian-yan" tabindex="-1" id="å‰è¨€">å‰è¨€</h2><p>ç¬¬ä¸€ç« è™½ç„¶æ˜¯å¼•è¨€ï¼Œä½†ä¿¡æ¯é‡å¾ˆå¤§ã€‚ç³»ç»Ÿæ¢³ç†äº†å¹¶è¡Œè®¡ç®—çš„å‘å±•å†ç¨‹ã€CPUä¸GPUçš„æ¶æ„å·®å¼‚ã€CUDAçš„è¯ç”ŸèƒŒæ™¯ã€‚ç†è§£è¿™äº›å†å²å’Œè®¾è®¡æ€æƒ³ï¼Œå¯¹åç»­å­¦ä¹ GPUç¼–ç¨‹å¾ˆæœ‰å¸®åŠ©ã€‚</p><blockquote><p><strong>ğŸ“¦ é…å¥—èµ„æº</strong>ï¼šæœ¬ç³»åˆ—æ–‡ç« é…æœ‰å®Œæ•´çš„ <a href="https://github.com/psmarter/PMPP-Learning">GitHub ä»“åº“</a>ï¼ŒåŒ…å«æ¯ç« çš„ç»ƒä¹ é¢˜è§£ç­”ã€CUDA ä»£ç å®ç°å’Œè¯¦ç»†æ³¨é‡Šã€‚æ‰€æœ‰ä»£ç éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</p></blockquote><h2 id="xing-neng-ti-sheng-de-zhuan-zhe-dian-cong-pin-lu-dao-bing-xing" tabindex="-1" id="æ€§èƒ½æå‡çš„è½¬æŠ˜ç‚¹ï¼šä»é¢‘ç‡åˆ°å¹¶è¡Œ">æ€§èƒ½æå‡çš„è½¬æŠ˜ç‚¹ï¼šä»é¢‘ç‡åˆ°å¹¶è¡Œ</h2><h3 id="2004-nian-zhi-qian-pin-lu-wei-wang" tabindex="-1" id="2004å¹´ä¹‹å‰ï¼šé¢‘ç‡ä¸ºç‹">2004å¹´ä¹‹å‰ï¼šé¢‘ç‡ä¸ºç‹</h3><p>é‚£ä¸ªå¹´ä»£å¾ˆç®€å•â€”â€”æé«˜CPUé¢‘ç‡å°±èƒ½è®©ç¨‹åºè·‘å¾—æ›´å¿«ã€‚æ‘©å°”å®šå¾‹å¾ˆç›´è§‚ï¼šæ™¶ä½“ç®¡æ•°é‡æ¯18ä¸ªæœˆç¿»å€ï¼Œé¢‘ç‡æå‡ï¼Œæ€§èƒ½è‡ªç„¶å¢é•¿ã€‚ç¨‹åºå‘˜ä¸ç”¨æ“å¿ƒæ€§èƒ½ï¼Œç­‰ä¸¤å¹´æ¢å°æ–°æœºå™¨ï¼ŒåŒæ ·çš„ä»£ç å°±æ›´å¿«äº†ã€‚</p><h3 id="gong-hao-qiang-de-chu-xian" tabindex="-1" id="åŠŸè€—å¢™çš„å‡ºç°">åŠŸè€—å¢™çš„å‡ºç°</h3><p>2004å¹´å‰åé‡åˆ°äº†ç‰©ç†æé™â€”â€”åŠŸè€—å¢™ï¼ˆPower Wallï¼‰ï¼š</p><ul><li>åŠ¨æ€åŠŸè€—æ­£æ¯”äºé¢‘ç‡å’Œç”µå‹çš„å¹³æ–¹</li><li>æé«˜é¢‘ç‡éœ€è¦æé«˜ç”µå‹ä¿è¯ç¨³å®šæ€§</li><li>åŠŸè€—ä»¥è¶…çº¿æ€§é€Ÿåº¦å¢é•¿ï¼Œæ•£çƒ­æˆä¸ºç“¶é¢ˆ</li></ul><p>å½“æ—¶Pentium 4çš„TDPå·²ç»130W+ï¼Œå¦‚æœç»§ç»­æå‡é¢‘ç‡ï¼ŒåŠŸè€—ä¼šè¾¾åˆ°æ•°ç™¾ç“¦ï¼Œåœ¨æ¶ˆè´¹çº§äº§å“ä¸­ä¸ç°å®ã€‚</p><h3 id="zhuan-xiang-duo-he" tabindex="-1" id="è½¬å‘å¤šæ ¸">è½¬å‘å¤šæ ¸</h3><p>æ—¢ç„¶å•æ ¸é¢‘ç‡æ— æ³•ç»§ç»­æå‡ï¼ŒèŠ¯ç‰‡å‚å•†è½¬å‘å¤šæ ¸ï¼š</p><ul><li>å•æ ¸ä¿æŒè¾ƒä½é¢‘ç‡ï¼ˆæ§åˆ¶åŠŸè€—ï¼‰</li><li>é€šè¿‡å¹¶è¡Œæå‡æ•´ä½“æ€§èƒ½</li><li>åˆ©ç”¨ä¸æ–­å¢é•¿çš„æ™¶ä½“ç®¡æ•°é‡</li></ul><p>ä½†å¤šæ ¸CPUå—é™äºåŠŸè€—å’Œé¢ç§¯ï¼Œé€šå¸¸åªæœ‰å‡ ä¸ªåˆ°åå‡ ä¸ªæ ¸å¿ƒï¼Œå¯¹äºéœ€è¦æˆåƒä¸Šä¸‡å¹¶å‘ä»»åŠ¡çš„åº”ç”¨ï¼ˆå›¾å½¢æ¸²æŸ“ã€æ·±åº¦å­¦ä¹ ï¼‰è¿˜ä¸å¤Ÿã€‚</p><h2 id="cpu-vs-gpu-she-ji-zhe-xue-de-gen-ben-chai-yi" tabindex="-1" id="CPU-vs-GPUï¼šè®¾è®¡å“²å­¦çš„æ ¹æœ¬å·®å¼‚">CPU vs GPUï¼šè®¾è®¡å“²å­¦çš„æ ¹æœ¬å·®å¼‚</h2><h3 id="cpu-zui-xiao-hua-yan-chi" tabindex="-1" id="CPUï¼šæœ€å°åŒ–å»¶è¿Ÿ">CPUï¼šæœ€å°åŒ–å»¶è¿Ÿ</h3><p><strong>ç›®æ ‡</strong>ï¼šè®©å•ä¸ªçº¿ç¨‹å°½å¯èƒ½å¿«åœ°å®Œæˆä»»åŠ¡</p><p><strong>æ‰‹æ®µ</strong>ï¼š</p><ul><li><strong>å¤æ‚æ§åˆ¶é€»è¾‘</strong>ï¼šåˆ†æ”¯é¢„æµ‹ã€ä¹±åºæ‰§è¡Œã€å¯„å­˜å™¨é‡å‘½åã€æ¨æµ‹æ‰§è¡Œ</li><li><strong>åºå¤§ç¼“å­˜</strong>ï¼šL1(32-64KB) + L2(256KB-1MB) + L3(8-64MB)</li><li><strong>å¼ºå¤§è®¡ç®—å•å…ƒ</strong>ï¼šå®Œå¤‡çš„ALU/FPUï¼ŒSIMDæŒ‡ä»¤é›†</li></ul><p><strong>ä»£ä»·</strong>ï¼šèŠ¯ç‰‡ä¸Šåªæœ‰20-30%çš„æ™¶ä½“ç®¡ç”¨äºè®¡ç®—ï¼Œå…¶ä½™éƒ½æ˜¯æ§åˆ¶é€»è¾‘å’Œç¼“å­˜ã€‚å•æ ¸æˆæœ¬é«˜ï¼Œæ ¸å¿ƒæ•°é‡æœ‰é™ã€‚</p><p><strong>é€‚åˆ</strong>ï¼šå¤æ‚æ§åˆ¶æµã€ä¸è§„åˆ™å†…å­˜è®¿é—®ã€ä¸²è¡Œä¾èµ–å¼ºçš„ä»»åŠ¡</p><h3 id="gpu-zui-da-hua-tun-tu-liang" tabindex="-1" id="GPUï¼šæœ€å¤§åŒ–ååé‡">GPUï¼šæœ€å¤§åŒ–ååé‡</h3><p><strong>ç›®æ ‡</strong>ï¼šé€šè¿‡æµ·é‡çº¿ç¨‹æå‡æ•´ä½“ååé‡</p><p><strong>æ‰‹æ®µ</strong>ï¼š</p><ul><li><strong>å¤§é‡ç®€å•æ ¸å¿ƒ</strong>ï¼šæ•°åƒä¸ªæ ¸å¿ƒï¼Œæ¯ä¸ªéƒ½å¾ˆç®€å•ï¼ˆæ— å¤æ‚åˆ†æ”¯é¢„æµ‹/ä¹±åºæ‰§è¡Œï¼‰</li><li><strong>SIMTæ¨¡å‹</strong>ï¼š32ä¸ªçº¿ç¨‹ä¸ºä¸€ç»„(warp)ï¼Œå…±äº«æŒ‡ä»¤å•å…ƒ</li><li><strong>é«˜å¸¦å®½å†…å­˜</strong>ï¼š500-1000 GB/sï¼ˆCPUåªæœ‰50-100 GB/sï¼‰</li><li><strong>ä¸“æ³¨æµ®ç‚¹è¿ç®—</strong>ï¼šæ™¶ä½“ç®¡ä¸»è¦ç”¨äºè®¡ç®—å•å…ƒ</li></ul><p><strong>ç‰¹ç‚¹</strong>ï¼šå•æ ¸ç®€å•ï¼Œä½†æ•°é‡å¤šã€‚åœ¨æ•°æ®å¹¶è¡Œä»»åŠ¡ä¸Šï¼Œæµ®ç‚¹æ€§èƒ½å¯è¾¾CPUçš„10å€ä»¥ä¸Šã€‚</p><p><strong>é€‚åˆ</strong>ï¼šæ•°æ®å¹¶è¡Œã€è®¡ç®—å¯†é›†ã€è§„åˆ™å†…å­˜è®¿é—®çš„ä»»åŠ¡</p><h3 id="xing-xiang-lei-bi" tabindex="-1" id="å½¢è±¡ç±»æ¯”">å½¢è±¡ç±»æ¯”</h3><ul><li><strong>CPU</strong>ï¼šç»éªŒä¸°å¯Œçš„ä¸“å®¶ï¼Œå¤„ç†å¤æ‚é—®é¢˜æ•ˆç‡é«˜ï¼Œä½†ä¸€æ¬¡åªèƒ½ä¸“æ³¨ä¸€ä»¶äº‹</li><li><strong>GPU</strong>ï¼šæ•°åƒåæ–°æ‰‹ç»„æˆçš„å›¢é˜Ÿï¼Œå•ä¸ªèƒ½åŠ›æœ‰é™ï¼Œä½†é€šè¿‡å¤§è§„æ¨¡åä½œå®Œæˆç®€å•ä»»åŠ¡æ•ˆç‡æƒŠäºº</li></ul><h2 id="cuda-de-dan-sheng" tabindex="-1" id="CUDAçš„è¯ç”Ÿ">CUDAçš„è¯ç”Ÿ</h2><h3 id="cuda-zhi-qian-de-hei-an-shi-dai" tabindex="-1" id="CUDAä¹‹å‰çš„é»‘æš—æ—¶ä»£">CUDAä¹‹å‰çš„é»‘æš—æ—¶ä»£</h3><p>æ—©æœŸGPGPUå¿…é¡»é€šè¿‡å›¾å½¢APIï¼ˆOpenGL/Direct3Dï¼‰å®ç°ï¼š</p><ol><li>å°†æ•°æ®ç¼–ç æˆçº¹ç†ï¼ˆTextureï¼‰</li><li>ç¼–å†™é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</li><li>é€šè¿‡æ¸²æŸ“åˆ°çº¹ç†è·å–ç»“æœ</li><li>è¯»å›ä¸»å†…å­˜</li></ol><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>éœ€è¦æ·±å…¥ç†è§£å›¾å½¢ç®¡çº¿</li><li>æ•°æ®è¡¨ç¤ºå—é™ï¼ˆåªèƒ½ç”¨é¢œè‰²é€šé“ï¼‰</li><li>è°ƒè¯•å‡ ä¹ä¸å¯èƒ½</li><li>åªæœ‰å›¾å½¢å­¦ä¸“å®¶èƒ½ç”¨</li></ul><h3 id="cuda-de-ge-xin-2007" tabindex="-1" id="CUDAçš„é©æ–°ï¼ˆ2007ï¼‰">CUDAçš„é©æ–°ï¼ˆ2007ï¼‰</h3><p><strong>ç¡¬ä»¶æ”¹è¿›</strong>ï¼š</p><ul><li>ç»Ÿä¸€ç€è‰²å™¨æ¶æ„</li><li>æ”¯æŒä»»æ„å†…å­˜è¯»å†™ï¼ˆä¸å±€é™äºçº¹ç†ï¼‰</li><li>æä¾›å…±äº«å†…å­˜ç­‰å¯ç¼–ç¨‹å­˜å‚¨</li><li>æ”¯æŒæ•´æ•°è¿ç®—ã€ä½è¿ç®—</li></ul><p><strong>è½¯ä»¶ç”Ÿæ€</strong>ï¼š</p><ul><li>åŸºäºC/C++çš„æ‰©å±•ï¼Œå­¦ä¹ æˆæœ¬ä½</li><li>å®Œæ•´å·¥å…·é“¾ï¼ˆnvccç¼–è¯‘å™¨ï¼‰</li><li>ä¸°å¯Œçš„æ•°å­¦åº“ï¼ˆcuBLASã€cuFFTï¼‰</li><li>è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·</li></ul><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__global__ void vecAdd(float *A, float *B, float *C, int n) &#123;</span><br><span class="line">    int i = blockDim.x * blockIdx.x + threadIdx.x;</span><br><span class="line">    if (i &lt; n) &#123;</span><br><span class="line">        C[i] = A[i] + B[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”ä¹‹å‰éœ€è¦ç¼–å†™å¤æ‚ç€è‰²å™¨ï¼ŒCUDAä»£ç ç›´è§‚å¾—å¤šã€‚è¿™æ˜¯GPUé€šç”¨è®¡ç®—æ™®åŠçš„å…³é”®è½¬æŠ˜ç‚¹ã€‚</p><h2 id="yi-gou-ji-suan-cpu-yu-gpu-xie-zuo" tabindex="-1" id="å¼‚æ„è®¡ç®—ï¼šCPUä¸GPUåä½œ">å¼‚æ„è®¡ç®—ï¼šCPUä¸GPUåä½œ</h2><p>GPUè™½å¼ºå¤§ï¼Œä½†ä¸é€‚åˆæ‰€æœ‰ä»»åŠ¡ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>GPUä¼˜åŠ¿</th><th>GPUåŠ£åŠ¿</th></tr></thead><tbody><tr><td>è®¡ç®—ç±»å‹</td><td>å¤§é‡æµ®ç‚¹è¿ç®—</td><td>å¤æ‚æ§åˆ¶æµ</td></tr><tr><td>å¹¶è¡Œåº¦</td><td>æ•°æ®å¹¶è¡Œ</td><td>çº¿ç¨‹æ•°å°‘çš„ä»»åŠ¡</td></tr><tr><td>å†…å­˜è®¿é—®</td><td>è§„åˆ™è®¿é—®æ¨¡å¼</td><td>ä¸è§„åˆ™/éšæœºè®¿é—®</td></tr><tr><td>åŒæ­¥</td><td>ç‹¬ç«‹è®¡ç®—</td><td>é¢‘ç¹åŒæ­¥</td></tr></tbody></table><p>å¦‚æœç¨‹åºåªæœ‰å‡ ç™¾ä¸ªçº¿ç¨‹ï¼Œåœ¨GPUä¸Šå¯èƒ½ä¸å¦‚CPUã€‚GPUéœ€è¦æ•°åƒç”šè‡³æ•°ç™¾ä¸‡çº¿ç¨‹æ‰èƒ½å……åˆ†åˆ©ç”¨ç¡¬ä»¶ã€‚</p><h3 id="dian-xing-cuda-cheng-xu-liu-cheng" tabindex="-1" id="å…¸å‹CUDAç¨‹åºæµç¨‹">å…¸å‹CUDAç¨‹åºæµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. Hoståˆå§‹åŒ–</span><br><span class="line">   - åˆ†é…ä¸»æœºå†…å­˜</span><br><span class="line">   - åˆå§‹åŒ–æ•°æ®</span><br><span class="line"></span><br><span class="line">2. æ•°æ®ä¼ è¾“åˆ°Device</span><br><span class="line">   cudaMemcpy(..., cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line">3. å¯åŠ¨GPU kernel</span><br><span class="line">   kernel&lt;&lt;&lt;gridDim, blockDim&gt;&gt;&gt;(args);</span><br><span class="line"></span><br><span class="line">4. GPUå¹¶è¡Œæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">5. ç»“æœä¼ å›Host</span><br><span class="line">   cudaMemcpy(..., cudaMemcpyDeviceToHost);</span><br><span class="line"></span><br><span class="line">6. Hostç«¯åç»­å¤„ç†</span><br></pre></td></tr></table></figure><p>ç°ä»£æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆPyTorchã€TensorFlowï¼‰åº•å±‚éƒ½æ˜¯è¿™ä¸ªæ¨¡å¼ï¼š</p><ul><li>æ¨¡å‹æ„å»ºåœ¨CPU</li><li>å‰å‘/åå‘ä¼ æ’­åœ¨GPU</li><li>ä¼˜åŒ–å™¨æ›´æ–°å›åˆ°CPU</li></ul><h2 id="bing-xing-bian-cheng-de-tiao-zhan" tabindex="-1" id="å¹¶è¡Œç¼–ç¨‹çš„æŒ‘æˆ˜">å¹¶è¡Œç¼–ç¨‹çš„æŒ‘æˆ˜</h2><h3 id="1-suan-fa-bing-xing-hua" tabindex="-1" id="1-ç®—æ³•å¹¶è¡ŒåŒ–">1. ç®—æ³•å¹¶è¡ŒåŒ–</h3><p>ä¸æ˜¯æ‰€æœ‰ç®—æ³•éƒ½èƒ½ç›´æ¥å¹¶è¡ŒåŒ–ï¼š</p><ul><li>é€’å½’ç®—æ³•ï¼ˆå¿«é€Ÿæ’åºã€æ ‘éå†ï¼‰</li><li>åŠ¨æ€è§„åˆ’ï¼ˆè®¸å¤šDPé—®é¢˜æœ‰ä¸²è¡Œä¾èµ–ï¼‰</li><li>ç´¯ç§¯è®¡ç®—ï¼ˆå‰ç¼€å’Œã€ç´¯ç§¯ä¹˜ç§¯ï¼‰</li></ul><p>æœ‰æ—¶éœ€è¦å®Œå…¨é‡æ–°è®¾è®¡ç®—æ³•ï¼ˆå¦‚å¹¶è¡Œå‰ç¼€å’Œï¼‰ï¼Œè€Œä¸æ˜¯ç®€å•å¹¶è¡ŒåŒ–ä¸²è¡Œç‰ˆæœ¬ã€‚</p><h3 id="2-nei-cun-dai-kuan-ping-jing" tabindex="-1" id="2-å†…å­˜å¸¦å®½ç“¶é¢ˆ">2. å†…å­˜å¸¦å®½ç“¶é¢ˆ</h3><p>å‡è®¾GPUå³°å€¼10 TFLOPSï¼Œå†…å­˜å¸¦å®½500 GB/sã€‚å¦‚æœè®¡ç®—éœ€è¦è¯»2ä¸ªfloat(8B)åš1æ¬¡åŠ æ³•ï¼š</p><ul><li>è®¡ç®—éœ€æ±‚ï¼š10 TFLOPS</li><li>å†…å­˜æ”¯æ’‘ï¼š500 GB/s Ã· 8B = 62.5 GFLOPS</li><li>å®é™…æ€§èƒ½ï¼šåªèƒ½è¾¾åˆ°å³°å€¼çš„0.6%</li></ul><p>è¿™å°±æ˜¯å†…å­˜å—é™ï¼ˆMemory-Boundï¼‰é—®é¢˜ã€‚ä¼˜åŒ–æ–¹å‘ï¼š</p><ul><li>ä½¿ç”¨Shared Memoryå‡å°‘å…¨å±€å†…å­˜è®¿é—®</li><li>ä¼˜åŒ–è®¿é—®æ¨¡å¼å®ç°åˆå¹¶è®¿é—®ï¼ˆCoalesced Accessï¼‰</li><li>æé«˜ç®—æœ¯å¼ºåº¦ï¼ˆæ¯å­—èŠ‚æ•°æ®åšæ›´å¤šè®¡ç®—ï¼‰</li></ul><h3 id="3-xing-neng-bu-que-ding-xing" tabindex="-1" id="3-æ€§èƒ½ä¸ç¡®å®šæ€§">3. æ€§èƒ½ä¸ç¡®å®šæ€§</h3><p>å¹¶è¡Œç¨‹åºæ€§èƒ½é«˜åº¦ä¾èµ–è¾“å…¥æ•°æ®ã€‚ä¾‹å¦‚æ•°ç»„è¿‡æ»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (data[i] &gt; threshold) &#123;</span><br><span class="line">    output[count++] = data[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…¨éƒ¨æ»¡è¶³æ¡ä»¶ â†’ è´Ÿè½½å‡è¡¡ï¼Œæ€§èƒ½å¥½</li><li>å°‘æ•°æ»¡è¶³ â†’ å¤§éƒ¨åˆ†çº¿ç¨‹ç©ºé—²</li><li>åˆ†å¸ƒä¸å‡ â†’ warpåˆ†æ”¯å‘æ•£</li></ul><p>åŒæ ·çš„ä»£ç ï¼Œä¸åŒè¾“å…¥å¯èƒ½æœ‰æ•°å€æ€§èƒ½å·®å¼‚ã€‚</p><h3 id="4-diao-shi-fu-za-xing" tabindex="-1" id="4-è°ƒè¯•å¤æ‚æ€§">4. è°ƒè¯•å¤æ‚æ€§</h3><p>å¹¶å‘é”™è¯¯åœ¨ä¸²è¡Œç¨‹åºä¸­æ ¹æœ¬ä¸å­˜åœ¨ï¼š</p><ul><li><strong>ç«æ€æ¡ä»¶</strong>ï¼ˆRace Conditionï¼‰ï¼šå¤šçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜</li><li><strong>æ­»é”</strong>ï¼ˆDeadlockï¼‰ï¼šçº¿ç¨‹é—´ç›¸äº’ç­‰å¾…</li><li><strong>éç¡®å®šæ€§é”™è¯¯</strong>ï¼šéšæœºå‡ºç°ï¼Œéš¾ä»¥é‡ç°</li></ul><p>æ€§èƒ½ä¼˜åŒ–ä¹Ÿéœ€è¦æ·±å…¥ç†è§£ç¡¬ä»¶ç»†èŠ‚ï¼š</p><ul><li>Warpï¼ˆ32çº¿ç¨‹ä¸€ç»„ï¼‰</li><li>Occupancyï¼ˆæ´»è·ƒçº¿ç¨‹æ¯”ä¾‹ï¼‰</li><li>Bankå†²çªã€å¯„å­˜å™¨æº¢å‡ºç­‰</li></ul><h2 id="ben-shu-de-xue-xi-mu-biao" tabindex="-1" id="æœ¬ä¹¦çš„å­¦ä¹ ç›®æ ‡">æœ¬ä¹¦çš„å­¦ä¹ ç›®æ ‡</h2><h3 id="1-bing-xing-bian-cheng-ji-zhu" tabindex="-1" id="1-å¹¶è¡Œç¼–ç¨‹æŠ€æœ¯">1. å¹¶è¡Œç¼–ç¨‹æŠ€æœ¯</h3><p>ä»¥CUDAä¸ºå¹³å°ï¼Œå­¦ä¹ ï¼š</p><ul><li>åŸºæœ¬æ¦‚å¿µï¼ˆçº¿ç¨‹ã€åŒæ­¥ã€å†…å­˜æ¨¡å‹ï¼‰</li><li>CUDAè¯­æ³•å’ŒAPI</li><li>å¸¸è§å¹¶è¡Œæ¨¡å¼ï¼ˆMapã€Reduceã€Scanã€Stencilï¼‰</li><li>GPUç¡¬ä»¶æ¶æ„</li></ul><h3 id="2-bing-xing-ji-suan-si-wei" tabindex="-1" id="2-å¹¶è¡Œè®¡ç®—æ€ç»´">2. å¹¶è¡Œè®¡ç®—æ€ç»´</h3><p>æ›´æ·±å±‚æ¬¡çš„èƒ½åŠ›ï¼š</p><ul><li>è¯†åˆ«é—®é¢˜ä¸­çš„å¹¶è¡Œæ€§</li><li>è®¾è®¡é«˜æ•ˆå¹¶è¡Œç®—æ³•</li><li>æƒè¡¡å¹¶è¡Œåº¦ã€è´Ÿè½½å‡è¡¡ã€é€šä¿¡å¼€é”€</li><li>é’ˆå¯¹ç¡¬ä»¶ä¼˜åŒ–ç®—æ³•</li></ul><h3 id="3-zheng-que-xing-yu-xing-neng" tabindex="-1" id="3-æ­£ç¡®æ€§ä¸æ€§èƒ½">3. æ­£ç¡®æ€§ä¸æ€§èƒ½</h3><p>å®è·µæŠ€èƒ½ï¼š</p><ul><li>é¿å…å¹¶å‘é”™è¯¯ï¼Œæµ‹è¯•å¹¶è¡Œç¨‹åº</li><li>ä½¿ç”¨profilingå·¥å…·</li><li>ç³»ç»ŸåŒ–æ€§èƒ½è°ƒä¼˜</li><li>ç¼–å†™å¯ç§»æ¤çš„ä»£ç </li></ul><p>è¿™äº›æ–¹æ³•è®ºæ¯”å•çº¯å­¦APIæ›´æœ‰ä»·å€¼ï¼Œèƒ½è¿ç§»åˆ°å…¶ä»–å¹¶è¡Œå¹³å°ï¼ˆOpenCLã€SYCLã€HIPï¼‰ã€‚</p><h2 id="xiao-jie" tabindex="-1" id="å°ç»“">å°ç»“</h2><p>ç¬¬ä¸€ç« å»ºç«‹äº†å¹¶è¡Œè®¡ç®—çš„å¤§æ¡†æ¶ï¼š</p><p><strong>å†å²è„‰ç»œ</strong>ï¼šåŠŸè€—å¢™å¯¼è‡´ä»é¢‘ç‡æå‡è½¬å‘å¹¶è¡Œè®¡ç®—ï¼Œè¿™æ˜¯å¿…ç„¶è¶‹åŠ¿ã€‚</p><p><strong>æ¶æ„å·®å¼‚</strong>ï¼šCPUè¿½æ±‚ä½å»¶è¿Ÿï¼ˆå¤æ‚æ ¸å¿ƒã€å¤§ç¼“å­˜ï¼‰ï¼ŒGPUè¿½æ±‚é«˜ååï¼ˆç®€å•æ ¸å¿ƒã€é«˜å¸¦å®½ï¼‰ã€‚ç†è§£è¿™ç‚¹ï¼Œå°±æ˜ç™½ä¸ºä»€ä¹ˆæŸäº›ä»»åŠ¡é€‚åˆGPUï¼ŒæŸäº›ä¸é€‚åˆã€‚</p><p><strong>CUDAä»·å€¼</strong>ï¼šä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯ç”Ÿæ€ã€‚è™½ç„¶æ˜¯ä¸“æœ‰å¹³å°ï¼Œä½†å®Œæ•´çš„å·¥å…·é“¾å’Œåº“è®©å®ƒæˆä¸ºGPUç¼–ç¨‹çš„äº‹å®æ ‡å‡†ã€‚</p><p><strong>æŒ‘æˆ˜è®¤è¯†</strong>ï¼šå¹¶è¡Œç¼–ç¨‹ç¡®å®æ¯”ä¸²è¡Œå¤æ‚ï¼Œä½†æŒæ¡çš„æ€ç»´æ–¹å¼å’Œä¼˜åŒ–æ–¹æ³•å…·æœ‰é€šç”¨æ€§ã€‚</p><p>ä¸‹ä¸€ç« è¿›å…¥CUDAç¼–ç¨‹å®æˆ˜ï¼ŒæœŸå¾…çœŸæ­£åŠ¨æ‰‹å†™ä»£ç çš„è¿‡ç¨‹ã€‚</p><hr><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li>Hwu, W., Kirk, D., &amp; El Hajj, I. (2022). <em>Programming Massively Parallel Processors: A Hands-on Approach</em> (4th Edition). Morgan Kaufmann.</li><li><a href="https://docs.nvidia.com/cuda/">NVIDIA CUDAå®˜æ–¹æ–‡æ¡£</a></li></ul><hr><blockquote><p><strong>æœ¬æ–‡ GitHub ä»“åº“</strong>: <a href="https://github.com/psmarter/PMPP-Learning">https://github.com/psmarter/PMPP-Learning</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;qian-yan&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="çŸ¥è¯†åˆ†äº«" scheme="https://smarter.xin/categories/knowledge-sharing/"/>
    
    
    <category term="CUDA" scheme="https://smarter.xin/tags/CUDA/"/>
    
    <category term="GPUç¼–ç¨‹" scheme="https://smarter.xin/tags/gpu-programming/"/>
    
    <category term="å¹¶è¡Œè®¡ç®—" scheme="https://smarter.xin/tags/parallel-computing/"/>
    
    <category term="PMPP" scheme="https://smarter.xin/tags/PMPP/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-å¤šç»´åŠ¨æ€è§„åˆ’</title>
    <link href="https://smarter.xin/posts/d6a5396e/"/>
    <id>https://smarter.xin/posts/d6a5396e/</id>
    <published>2026-01-07T06:15:14.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="duo-wei-dong-tai-gui-hua-zai-geng-gao-wei-du-si-kao" tabindex="-1">å¤šç»´åŠ¨æ€è§„åˆ’ï¼šåœ¨æ›´é«˜ç»´åº¦æ€è€ƒ</h1><blockquote><p>å½“ä¸€ä¸ªç»´åº¦ä¸å¤Ÿç”¨æ—¶,å°±å¤šåŠ ä¸€ä¸ªç»´åº¦!</p></blockquote><hr><h2 id="shi-yao-shi-duo-wei-dong-tai-gui-hua" tabindex="-1" id="ä»€ä¹ˆæ˜¯å¤šç»´åŠ¨æ€è§„åˆ’">ä»€ä¹ˆæ˜¯å¤šç»´åŠ¨æ€è§„åˆ’</h2><p><strong>å¤šç»´åŠ¨æ€è§„åˆ’</strong>æ˜¯åŠ¨æ€è§„åˆ’çš„æ‰©å±•,ä½¿ç”¨å¤šä¸ªç»´åº¦çš„çŠ¶æ€æ¥æè¿°é—®é¢˜ã€‚å¦‚æœè¯´ä¸€ç»´DPæ˜¯ä¸€æ¡çº¿,é‚£ä¹ˆäºŒç»´DPå°±æ˜¯ä¸€ä¸ªå¹³é¢,ä¸‰ç»´DPåˆ™æ˜¯ä¸€ä¸ªç«‹ä½“ç©ºé—´ã€‚</p><blockquote><p><strong>æ ¸å¿ƒæ€æƒ³</strong>:å½“é—®é¢˜éœ€è¦å¤šä¸ªå‚æ•°æ‰èƒ½æè¿°æ¸…æ¥šçŠ¶æ€æ—¶,å°±éœ€è¦ä½¿ç”¨å¤šç»´DP</p></blockquote><h3 id="xing-xiang-li-jie" tabindex="-1" id="å½¢è±¡ç†è§£">å½¢è±¡ç†è§£</h3><p>æƒ³è±¡ä½ åœ¨ç©ä¸€ä¸ªæ¸¸æˆ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ç»´DP: åœ¨ä¸€æ¡è·¯ä¸Šå‰è¿›,åªéœ€è¦è®°å½•&quot;åˆ°è¾¾ç¬¬iä¸ªä½ç½®&quot;</span><br><span class="line">äºŒç»´DP: åœ¨ä¸€ä¸ªç½‘æ ¼ä¸­ç§»åŠ¨,éœ€è¦è®°å½•&quot;åˆ°è¾¾åæ ‡(i,j)&quot;</span><br><span class="line">ä¸‰ç»´DP: åœ¨å¤šä¸ªç‰©å“ä¸­é€‰æ‹©,éœ€è¦è®°å½•&quot;å‰iä¸ªç‰©å“,å®¹é‡ä¸ºj,ä»·å€¼ä¸ºk&quot;</span><br></pre></td></tr></table></figure><p>å°±åƒä»ä¸€ç»´æ•°è½´è¿›åŒ–åˆ°äºŒç»´å¹³é¢,å†åˆ°ä¸‰ç»´ç©ºé—´!</p><hr><h2 id="cong-yi-wei-dao-duo-wei-de-si-wei-yue-qian" tabindex="-1" id="ä»ä¸€ç»´åˆ°å¤šç»´çš„æ€ç»´è·ƒè¿">ä»ä¸€ç»´åˆ°å¤šç»´çš„æ€ç»´è·ƒè¿</h2><h3 id="wei-du-zeng-jia-de-bi-yao-xing" tabindex="-1" id="ç»´åº¦å¢åŠ çš„å¿…è¦æ€§">ç»´åº¦å¢åŠ çš„å¿…è¦æ€§</h3><pre><code class="highlight mermaid">graph TD    A[é—®é¢˜å¤æ‚åº¦] --&gt; B&#123;ä¸€ä¸ªå‚æ•°å¤Ÿå—?&#125;    B --&gt;|å¤Ÿ| C[ä¸€ç»´DP]    B --&gt;|ä¸å¤Ÿ| D&#123;ä¸¤ä¸ªå‚æ•°å¤Ÿå—?&#125;    D --&gt;|å¤Ÿ| E[äºŒç»´DP]    D --&gt;|ä¸å¤Ÿ| F[ä¸‰ç»´/æ›´é«˜ç»´DP]        style A fill:#FFE4B5    style E fill:#90EE90    style F fill:#87CEEB</code></pre><h3 id="shi-yao-shi-hou-yong-duo-wei-dp" tabindex="-1" id="ä»€ä¹ˆæ—¶å€™ç”¨å¤šç»´DP">ä»€ä¹ˆæ—¶å€™ç”¨å¤šç»´DP?</h3><table><thead><tr><th>åœºæ™¯</th><th>ç»´åº¦</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>è·¯å¾„é—®é¢˜</td><td>äºŒç»´</td><td>ç½‘æ ¼ä¸­çš„æœ€çŸ­è·¯å¾„</td></tr><tr><td>åŒåºåˆ—åŒ¹é…</td><td>äºŒç»´</td><td>æœ€é•¿å…¬å…±å­åºåˆ—</td></tr><tr><td>èƒŒåŒ…é—®é¢˜</td><td>äºŒç»´/ä¸‰ç»´</td><td>01èƒŒåŒ…ã€å¤šé‡èƒŒåŒ…</td></tr><tr><td>åŒºé—´é—®é¢˜</td><td>äºŒç»´</td><td>æˆ³æ°”çƒã€åˆå¹¶çŸ³å¤´</td></tr><tr><td>çŠ¶æ€æœºé—®é¢˜</td><td>å¤šç»´</td><td>ä¹°å–è‚¡ç¥¨</td></tr></tbody></table><hr><h2 id="er-wei-dp-jing-dian-wen-ti" tabindex="-1" id="äºŒç»´DPç»å…¸é—®é¢˜">äºŒç»´DPç»å…¸é—®é¢˜</h2><h3 id="1-bu-tong-lu-jing-leet-code-62" tabindex="-1" id="1-ä¸åŒè·¯å¾„-LeetCode-62">1. ä¸åŒè·¯å¾„ (LeetCode 62)</h3><blockquote><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª mÃ—n ç½‘æ ¼çš„å·¦ä¸Šè§’,æ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–å‘å³ç§»åŠ¨,é—®åˆ°è¾¾å³ä¸‹è§’æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„?</p></blockquote><h4 id="wen-ti-fen-xi" tabindex="-1" id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç½‘æ ¼: 3Ã—7</span><br><span class="line">èµ·ç‚¹: (0,0)</span><br><span class="line">ç»ˆç‚¹: (2,6)</span><br><span class="line"></span><br><span class="line">æ¯æ¬¡åªèƒ½: å‘å³ æˆ– å‘ä¸‹</span><br></pre></td></tr></table></figure><h4 id="ke-shi-hua-li-jie" tabindex="-1" id="å¯è§†åŒ–ç†è§£">å¯è§†åŒ–ç†è§£</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">èµ·ç‚¹â†’ â–¡ â–¡ â–¡ â–¡ â–¡ â–¡</span><br><span class="line">      â–¡ â–¡ â–¡ â–¡ â–¡ â–¡</span><br><span class="line">      â–¡ â–¡ â–¡ â–¡ â–¡ â† ç»ˆç‚¹</span><br><span class="line"></span><br><span class="line">åˆ°è¾¾(i,j)çš„æ–¹å¼ = ä»(i-1,j)å‘ä¸‹ + ä»(i,j-1)å‘å³</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi" tabindex="-1" id="çŠ¶æ€å®šä¹‰">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: åˆ°è¾¾ä½ç½®(i,j)çš„ä¸åŒè·¯å¾„æ•°</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-1][j] + dp[i][j-1]</span><br><span class="line">            â†‘            â†‘</span><br><span class="line">          ä»ä¸Šæ–¹æ¥    ä»å·¦æ–¹æ¥</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1: äºŒç»´DPæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—éƒ½åªæœ‰ä¸€ç§èµ°æ³•</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            dp[i][j] = dp[i<span class="number">-1</span>][j] + dp[i][j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[m<span class="number">-1</span>][n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2: ç©ºé—´ä¼˜åŒ– - æ»šåŠ¨æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n, <span class="number">1</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            dp[j] = dp[j] + dp[j<span class="number">-1</span>];</span><br><span class="line">                    â†‘        â†‘</span><br><span class="line">                  ä¸Šæ–¹     å·¦æ–¹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(mÃ—n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(mÃ—n) â†’ ä¼˜åŒ–å O(n)</p><h4 id="zhi-xing-guo-cheng" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">m=3, n=7</span><br><span class="line"></span><br><span class="line">åˆå§‹çŠ¶æ€ (ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—éƒ½æ˜¯1):</span><br><span class="line">1  1  1  1  1  1  1</span><br><span class="line">1  ?  ?  ?  ?  ?  ?</span><br><span class="line">1  ?  ?  ?  ?  ?  ?</span><br><span class="line"></span><br><span class="line">è®¡ç®—è¿‡ç¨‹:</span><br><span class="line">1  1  1   1   1   1   1</span><br><span class="line">1  2  3   4   5   6   7</span><br><span class="line">1  3  6  10  15  21  28</span><br><span class="line">      â†‘</span><br><span class="line">    dp[1][2] = dp[0][2] + dp[1][1] = 1 + 2 = 3</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆ: 28ç§è·¯å¾„</span><br></pre></td></tr></table></figure><hr><h3 id="2-zui-xiao-lu-jing-he-leet-code-64" tabindex="-1" id="2-æœ€å°è·¯å¾„å’Œ-LeetCode-64">2. æœ€å°è·¯å¾„å’Œ (LeetCode 64)</h3><blockquote><p>ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ mÃ—n ç½‘æ ¼,æ‰¾åˆ°ä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„,ä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œæœ€å°</p></blockquote><h4 id="wen-ti-fen-xi-1" tabindex="-1" id="é—®é¢˜åˆ†æ-2">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">1  3  1</span><br><span class="line">1  5  1</span><br><span class="line">4  2  1</span><br><span class="line"></span><br><span class="line">è¾“å‡º: 7</span><br><span class="line">è·¯å¾„: 1â†’3â†’1â†’1â†’1 = 7</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-1" tabindex="-1" id="çŠ¶æ€å®šä¹‰-2">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: ä»(0,0)åˆ°(i,j)çš„æœ€å°è·¯å¾„å’Œ</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-1" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-2">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = grid[i][j] + min(dp[i-1][j], dp[i][j-1])</span><br><span class="line">                          â†‘             â†‘</span><br><span class="line">                        ä»ä¸Šæ–¹æ¥      ä»å·¦æ–¹æ¥</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-1" tabindex="-1" id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">minPathSum</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = grid.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–èµ·ç‚¹</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = grid[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = dp[i<span class="number">-1</span>][<span class="number">0</span>] + grid[i][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j<span class="number">-1</span>] + grid[<span class="number">0</span>][j];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            dp[i][j] = grid[i][j] + <span class="built_in">min</span>(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[m<span class="number">-1</span>][n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(mÃ—n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(mÃ—n)</p><h4 id="zhi-xing-guo-cheng-1" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-2">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">grid:</span><br><span class="line">1  3  1</span><br><span class="line">1  5  1</span><br><span class="line">4  2  1</span><br><span class="line"></span><br><span class="line">DPè¿‡ç¨‹:</span><br><span class="line">1  4  5     â† ç¬¬ä¸€è¡Œ: ç´¯åŠ </span><br><span class="line">â†“</span><br><span class="line">2  7  6     â† dp[1][1] = 5 + min(4,2) = 7</span><br><span class="line">â†“</span><br><span class="line">6  8  7     â† dp[2][2] = 1 + min(6,8) = 7</span><br><span class="line">       â†‘</span><br><span class="line">      ç­”æ¡ˆ</span><br><span class="line"></span><br><span class="line">æœ€å°è·¯å¾„å’Œ: 7</span><br></pre></td></tr></table></figure><hr><h3 id="3-zui-chang-gong-gong-zi-xu-lie-leet-code-1143" tabindex="-1" id="3-æœ€é•¿å…¬å…±å­åºåˆ—-LeetCode-1143">3. æœ€é•¿å…¬å…±å­åºåˆ— (LeetCode 1143)</h3><blockquote><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²,æ±‚å®ƒä»¬çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦</p></blockquote><h4 id="wen-ti-fen-xi-2" tabindex="-1" id="é—®é¢˜åˆ†æ-3">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text1 = &quot;abcde&quot;</span><br><span class="line">text2 = &quot;ace&quot;</span><br><span class="line"></span><br><span class="line">æœ€é•¿å…¬å…±å­åºåˆ—: &quot;ace&quot; (é•¿åº¦ä¸º3)</span><br></pre></td></tr></table></figure><h4 id="shuang-xu-lie-dp-de-jing-sui" tabindex="-1" id="åŒåºåˆ—DPçš„ç²¾é«“">åŒåºåˆ—DPçš„ç²¾é«“</h4><p>è¿™æ˜¯å…¸å‹çš„<strong>åŒåºåˆ—åŒ¹é…é—®é¢˜</strong>,éœ€è¦åŒæ—¶è¿½è¸ªä¸¤ä¸ªåºåˆ—çš„ä½ç½®!</p><h4 id="zhuang-tai-ding-yi-2" tabindex="-1" id="çŠ¶æ€å®šä¹‰-3">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: text1å‰iä¸ªå­—ç¬¦ ä¸ text2å‰jä¸ªå­—ç¬¦ çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-2" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-3">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (text1[i-1] == text2[j-1]):</span><br><span class="line">    dp[i][j] = dp[i-1][j-1] + 1</span><br><span class="line">else:</span><br><span class="line">    dp[i][j] = max(dp[i-1][j], dp[i][j-1])</span><br><span class="line">                    â†‘            â†‘</span><br><span class="line">                è·³è¿‡text1[i]  è·³è¿‡text2[j]</span><br></pre></td></tr></table></figure><h4 id="ke-shi-hua-li-jie-1" tabindex="-1" id="å¯è§†åŒ–ç†è§£-2">å¯è§†åŒ–ç†è§£</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;   0  0  0  0</span><br><span class="line">a    0  1  1  1  â† text1[0]=&#x27;a&#x27; == text2[0]=&#x27;a&#x27;, dp[1][1]=1</span><br><span class="line">b    0  1  1  1</span><br><span class="line">c    0  1  2  2  â† text1[2]=&#x27;c&#x27; == text2[1]=&#x27;c&#x27;, dp[3][2]=2</span><br><span class="line">d    0  1  2  2</span><br><span class="line">e    0  1  2  3  â† text1[4]=&#x27;e&#x27; == text2[2]=&#x27;e&#x27;, dp[5][3]=3</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-2" tabindex="-1" id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(string text1, string text2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = text<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = text<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text1[i<span class="number">-1</span>] == text2[j<span class="number">-1</span>]) &#123;</span><br><span class="line">                <span class="comment">// å­—ç¬¦åŒ¹é…,é•¿åº¦+1</span></span><br><span class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å­—ç¬¦ä¸åŒ¹é…,å–è¾ƒå¤§å€¼</span></span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(mÃ—n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(mÃ—n)</p><h4 id="wan-zheng-zhi-xing-guo-cheng" tabindex="-1" id="å®Œæ•´æ‰§è¡Œè¿‡ç¨‹">å®Œæ•´æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">text1 = &quot;abcde&quot;</span><br><span class="line">text2 = &quot;ace&quot;</span><br><span class="line"></span><br><span class="line">DPè¡¨:</span><br><span class="line">      &quot;&quot;  a  c  e</span><br><span class="line">  &quot;&quot;   0  0  0  0</span><br><span class="line">  a    0  1  1  1</span><br><span class="line">  b    0  1  1  1</span><br><span class="line">  c    0  1  2  2</span><br><span class="line">  d    0  1  2  2</span><br><span class="line">  e    0  1  2  3</span><br><span class="line"></span><br><span class="line">å…³é”®æ­¥éª¤:</span><br><span class="line">- dp[1][1]: &#x27;a&#x27;==&#x27;a&#x27;, dp[1][1]=dp[0][0]+1=1</span><br><span class="line">- dp[3][2]: &#x27;c&#x27;==&#x27;c&#x27;, dp[3][2]=dp[2][1]+1=2</span><br><span class="line">- dp[5][3]: &#x27;e&#x27;==&#x27;e&#x27;, dp[5][3]=dp[4][2]+1=3</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆ: 3</span><br></pre></td></tr></table></figure><hr><h3 id="4-bian-ji-ju-chi-leet-code-72" tabindex="-1" id="4-ç¼–è¾‘è·ç¦»-LeetCode-72">4. ç¼–è¾‘è·ç¦» (LeetCode 72)</h3><blockquote><p>ç»™å®šä¸¤ä¸ªå•è¯,è®¡ç®—ä»ä¸€ä¸ªå•è¯è½¬æ¢æˆå¦ä¸€ä¸ªå•è¯æ‰€éœ€çš„æœ€å°‘æ“ä½œæ•°ã€‚å…è®¸çš„æ“ä½œ:æ’å…¥ã€åˆ é™¤ã€æ›¿æ¢</p></blockquote><h4 id="wen-ti-fen-xi-3" tabindex="-1" id="é—®é¢˜åˆ†æ-4">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">word1 = &quot;horse&quot;</span><br><span class="line">word2 = &quot;ros&quot;</span><br><span class="line"></span><br><span class="line">æ“ä½œåºåˆ—:</span><br><span class="line">horse â†’ rorse (æ›¿æ¢ hâ†’r)</span><br><span class="line">rorse â†’ rose  (åˆ é™¤ r)</span><br><span class="line">rose  â†’ ros   (åˆ é™¤ e)</span><br><span class="line"></span><br><span class="line">å…±3æ­¥</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-3" tabindex="-1" id="çŠ¶æ€å®šä¹‰-4">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: word1å‰iä¸ªå­—ç¬¦ è½¬æ¢ä¸º word2å‰jä¸ªå­—ç¬¦ çš„æœ€å°‘æ“ä½œæ•°</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-3" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-4">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (word1[i-1] == word2[j-1]):</span><br><span class="line">    dp[i][j] = dp[i-1][j-1]  // å­—ç¬¦ç›¸åŒ,ä¸éœ€è¦æ“ä½œ</span><br><span class="line">else:</span><br><span class="line">    dp[i][j] = 1 + min(&#123;</span><br><span class="line">        dp[i-1][j],    // åˆ é™¤word1[i]</span><br><span class="line">        dp[i][j-1],    // æ’å…¥word2[j]</span><br><span class="line">        dp[i-1][j-1]   // æ›¿æ¢word1[i]ä¸ºword2[j]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-3" tabindex="-1" id="ä»£ç å®ç°-4">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">minDistance</span><span class="params">(string word1, string word2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = word<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = word<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n + <span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–:ç©ºä¸²è½¬æ¢éœ€è¦çš„æ“ä½œæ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = i;  <span class="comment">// åˆ é™¤æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = j;  <span class="comment">// æ’å…¥æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (word1[i<span class="number">-1</span>] == word2[j<span class="number">-1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="number">1</span> + <span class="built_in">min</span>(&#123;</span><br><span class="line">                    dp[i<span class="number">-1</span>][j],      <span class="comment">// åˆ é™¤</span></span><br><span class="line">                    dp[i][j<span class="number">-1</span>],      <span class="comment">// æ’å…¥</span></span><br><span class="line">                    dp[i<span class="number">-1</span>][j<span class="number">-1</span>]     <span class="comment">// æ›¿æ¢</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(mÃ—n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(mÃ—n)</p><h4 id="zhi-xing-guo-cheng-2" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-3">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">word1 = &quot;horse&quot;</span><br><span class="line">word2 = &quot;ros&quot;</span><br><span class="line"></span><br><span class="line">DPè¡¨:</span><br><span class="line">      &quot;&quot;  r  o  s</span><br><span class="line">  &quot;&quot;   0  1  2  3</span><br><span class="line">  h    1  1  2  3</span><br><span class="line">  o    2  2  1  2</span><br><span class="line">  r    3  2  2  2</span><br><span class="line">  s    4  3  3  2</span><br><span class="line">  e    5  4  4  3</span><br><span class="line">              â†‘</span><br><span class="line">            ç­”æ¡ˆ</span><br><span class="line"></span><br><span class="line">å…³é”®æ­¥éª¤:</span><br><span class="line">- dp[2][2]: &#x27;o&#x27;==&#x27;o&#x27;, dp[2][2]=dp[1][1]=1</span><br><span class="line">- dp[3][1]: &#x27;r&#x27;==&#x27;r&#x27;, dp[3][1]=dp[2][0]=2</span><br><span class="line">- dp[4][3]: &#x27;s&#x27;==&#x27;s&#x27;, dp[4][3]=dp[3][2]=2</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆ: 3æ­¥</span><br></pre></td></tr></table></figure><hr><h3 id="5-mai-mai-gu-piao-de-zui-jia-shi-ji-iii-leet-code-123" tabindex="-1" id="5-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºIII-LeetCode-123">5. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºIII (LeetCode 123)</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•°ç»„,æœ€å¤šå¯ä»¥å®Œæˆ<strong>ä¸¤ç¬”</strong>äº¤æ˜“,æ±‚æœ€å¤§åˆ©æ¶¦</p></blockquote><h4 id="wen-ti-fen-xi-4" tabindex="-1" id="é—®é¢˜åˆ†æ-5">é—®é¢˜åˆ†æ</h4><p>è¿™æ˜¯ä¸€ä¸ª<strong>çŠ¶æ€æœºDP</strong>é—®é¢˜,éœ€è¦è¿½è¸ª:</p><ul><li>å½“å‰ç¬¬å‡ å¤©</li><li>å½“å‰å¤„äºä»€ä¹ˆçŠ¶æ€(æŒæœ‰/ä¸æŒæœ‰è‚¡ç¥¨)</li><li>å®Œæˆäº†å‡ æ¬¡äº¤æ˜“</li></ul><h4 id="zhuang-tai-ding-yi-4" tabindex="-1" id="çŠ¶æ€å®šä¹‰-5">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buy1[i]:  ç¬¬iå¤©,ç¬¬ä¸€æ¬¡ä¹°å…¥åçš„æœ€å¤§åˆ©æ¶¦</span><br><span class="line">sell1[i]: ç¬¬iå¤©,ç¬¬ä¸€æ¬¡å–å‡ºåçš„æœ€å¤§åˆ©æ¶¦</span><br><span class="line">buy2[i]:  ç¬¬iå¤©,ç¬¬äºŒæ¬¡ä¹°å…¥åçš„æœ€å¤§åˆ©æ¶¦</span><br><span class="line">sell2[i]: ç¬¬iå¤©,ç¬¬äºŒæ¬¡å–å‡ºåçš„æœ€å¤§åˆ©æ¶¦</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-4" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-5">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buy1[i]  = max(buy1[i-1], -prices[i])</span><br><span class="line">sell1[i] = max(sell1[i-1], buy1[i-1] + prices[i])</span><br><span class="line">buy2[i]  = max(buy2[i-1], sell1[i-1] - prices[i])</span><br><span class="line">sell2[i] = max(sell2[i-1], buy2[i-1] + prices[i])</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-tu" tabindex="-1" id="çŠ¶æ€è½¬ç§»å›¾">çŠ¶æ€è½¬ç§»å›¾</h4><pre><code class="highlight mermaid">graph LR    A[åˆå§‹] --&gt;|ä¹°å…¥| B[æŒæœ‰1]    B --&gt;|å–å‡º| C[å®Œæˆ1ç¬”]    C --&gt;|ä¹°å…¥| D[æŒæœ‰2]    D --&gt;|å–å‡º| E[å®Œæˆ2ç¬”]        style A fill:#FFE4B5    style C fill:#90EE90    style E fill:#87CEEB</code></pre><h4 id="dai-ma-shi-xian-4" tabindex="-1" id="ä»£ç å®ç°-5">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = prices.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="type">int</span> buy1 = -prices[<span class="number">0</span>], sell1 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> buy2 = -prices[<span class="number">0</span>], sell2 = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        buy1 = <span class="built_in">max</span>(buy1, -prices[i]);</span><br><span class="line">        sell1 = <span class="built_in">max</span>(sell1, buy1 + prices[i]);</span><br><span class="line">        buy2 = <span class="built_in">max</span>(buy2, sell1 - prices[i]);</span><br><span class="line">        sell2 = <span class="built_in">max</span>(sell2, buy2 + prices[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sell2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(1)</p><h4 id="zhi-xing-guo-cheng-3" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-4">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">prices = [3,3,5,0,0,3,1,4]</span><br><span class="line"></span><br><span class="line">Day 0: buy1=-3, sell1=0, buy2=-3, sell2=0</span><br><span class="line">Day 1: buy1=-3, sell1=0, buy2=-3, sell2=0</span><br><span class="line">Day 2: buy1=-3, sell1=2, buy2=-1, sell2=2</span><br><span class="line">Day 3: buy1=-3, sell1=2, buy2=2, sell2=2</span><br><span class="line">Day 4: buy1=-3, sell1=2, buy2=2, sell2=2</span><br><span class="line">Day 5: buy1=-3, sell1=2, buy2=2, sell2=5</span><br><span class="line">Day 6: buy1=-3, sell1=2, buy2=2, sell2=5</span><br><span class="line">Day 7: buy1=-3, sell1=2, buy2=2, sell2=6</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆ: 6 (åœ¨0ä¹°å…¥,åœ¨3å–å‡º,å†åœ¨3ä¹°å…¥,åœ¨4å–å‡º)</span><br></pre></td></tr></table></figure><hr><h2 id="san-wei-dp-wen-ti" tabindex="-1" id="ä¸‰ç»´DPé—®é¢˜">ä¸‰ç»´DPé—®é¢˜</h2><h3 id="01-bei-bao-wen-ti-jing-dian" tabindex="-1" id="01èƒŒåŒ…é—®é¢˜-ç»å…¸">01èƒŒåŒ…é—®é¢˜ (ç»å…¸)</h3><blockquote><p>æœ‰nä¸ªç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºWçš„èƒŒåŒ…,æ¯ä¸ªç‰©å“æœ‰é‡é‡w[i]å’Œä»·å€¼v[i],æ¯ä¸ªç‰©å“åªèƒ½é€‰ä¸€æ¬¡,æ±‚æœ€å¤§ä»·å€¼</p></blockquote><h4 id="wen-ti-fen-xi-5" tabindex="-1" id="é—®é¢˜åˆ†æ-6">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç‰©å“: [(é‡é‡,ä»·å€¼)]</span><br><span class="line">ç‰©å“1: (2, 3)</span><br><span class="line">ç‰©å“2: (3, 4)</span><br><span class="line">ç‰©å“3: (4, 5)</span><br><span class="line">èƒŒåŒ…å®¹é‡: 5</span><br><span class="line"></span><br><span class="line">æœ€ä¼˜æ–¹æ¡ˆ: é€‰ç‰©å“1å’Œ2,ä»·å€¼=7</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-5" tabindex="-1" id="çŠ¶æ€å®šä¹‰-6">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: å‰iä¸ªç‰©å“,å®¹é‡ä¸ºjæ—¶çš„æœ€å¤§ä»·å€¼</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-5" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-6">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = max(</span><br><span class="line">    dp[i-1][j],              // ä¸é€‰ç¬¬iä¸ªç‰©å“</span><br><span class="line">    dp[i-1][j-w[i]] + v[i]   // é€‰ç¬¬iä¸ªç‰©å“</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-5" tabindex="-1" id="ä»£ç å®ç°-6">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´DP</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">knapsack</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; w, vector&lt;<span class="type">int</span>&gt;&amp; v, <span class="type">int</span> W)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = w.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(W + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= W; ++j) &#123;</span><br><span class="line">            <span class="comment">// ä¸é€‰ç¬¬iä¸ªç‰©å“</span></span><br><span class="line">            dp[i][j] = dp[i<span class="number">-1</span>][j];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœèƒ½é€‰ç¬¬iä¸ªç‰©å“</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt;= w[i<span class="number">-1</span>]) &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i][j], dp[i<span class="number">-1</span>][j-w[i<span class="number">-1</span>]] + v[i<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n][W];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©ºé—´ä¼˜åŒ–:ä¸€ç»´DP (ä»åå‘å‰éå†)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">knapsack</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; w, vector&lt;<span class="type">int</span>&gt;&amp; v, <span class="type">int</span> W)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = w.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(W + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="comment">// å¿…é¡»ä»åå‘å‰,å¦åˆ™ä¼šé‡å¤ä½¿ç”¨åŒä¸€ç‰©å“</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = W; j &gt;= w[i]; --j) &#123;</span><br><span class="line">            dp[j] = <span class="built_in">max</span>(dp[j], dp[j - w[i]] + v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[W];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(nÃ—W)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(nÃ—W) â†’ ä¼˜åŒ–å O(W)</p><h4 id="wei-shi-yao-yao-cong-hou-xiang-qian" tabindex="-1" id="ä¸ºä»€ä¹ˆè¦ä»åå‘å‰">ä¸ºä»€ä¹ˆè¦ä»åå‘å‰?</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä»å‰å‘å:</span><br><span class="line">dp[2] = dp[2-w[0]] + v[0]  // ä½¿ç”¨äº†w[0]</span><br><span class="line">dp[4] = dp[4-w[0]] + v[0]  // åˆä½¿ç”¨äº†w[0]! âŒé‡å¤ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">ä»åå‘å‰:</span><br><span class="line">dp[4] = dp[4-w[0]] + v[0]  // ä½¿ç”¨æ—§çš„dp[2]</span><br><span class="line">dp[2] = dp[2-w[0]] + v[0]  // ä½¿ç”¨æ—§çš„dp[0]</span><br><span class="line">âœ“ æ¯ä¸ªç‰©å“åªç”¨ä¸€æ¬¡</span><br></pre></td></tr></table></figure><hr><h3 id="zui-chang-hui-wen-zi-xu-lie-leet-code-516" tabindex="-1" id="æœ€é•¿å›æ–‡å­åºåˆ—-LeetCode-516">æœ€é•¿å›æ–‡å­åºåˆ— (LeetCode 516)</h3><blockquote><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²,æ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„å›æ–‡å­åºåˆ—é•¿åº¦</p></blockquote><h4 id="wen-ti-fen-xi-6" tabindex="-1" id="é—®é¢˜åˆ†æ-7">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;bbbab&quot;</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: æœ€é•¿å›æ–‡å­åºåˆ—æ˜¯ &quot;bbbb&quot;</span><br></pre></td></tr></table></figure><h4 id="qu-jian-dp-si-xiang" tabindex="-1" id="åŒºé—´DPæ€æƒ³">åŒºé—´DPæ€æƒ³</h4><p>è¿™æ˜¯<strong>åŒºé—´DP</strong>çš„å…¸å‹é—®é¢˜,éœ€è¦æ€è€ƒ:</p><ul><li>å­ä¸²[i,j]çš„ç­”æ¡ˆ</li><li>å¦‚ä½•ä»æ›´å°çš„åŒºé—´æ¨å¯¼</li></ul><h4 id="zhuang-tai-ding-yi-6" tabindex="-1" id="çŠ¶æ€å®šä¹‰-7">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j]: å­—ç¬¦ä¸²[i,j]åŒºé—´å†…çš„æœ€é•¿å›æ–‡å­åºåˆ—é•¿åº¦</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-6" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-7">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (s[i] == s[j]):</span><br><span class="line">    dp[i][j] = dp[i+1][j-1] + 2</span><br><span class="line">else:</span><br><span class="line">    dp[i][j] = max(dp[i+1][j], dp[i][j-1])</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-6" tabindex="-1" id="ä»£ç å®ç°-7">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">longestPalindromeSubseq</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å•ä¸ªå­—ç¬¦éƒ½æ˜¯å›æ–‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        dp[i][i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»é•¿åº¦2å¼€å§‹æšä¸¾</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> len = <span class="number">2</span>; len &lt;= n; ++len) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i + len - <span class="number">1</span> &lt; n; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (s[i] == s[j]) &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">+1</span>][j<span class="number">-1</span>] + <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i<span class="number">+1</span>][j], dp[i][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>][n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: O(nÂ²)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>: O(nÂ²)</p><h4 id="zhi-xing-guo-cheng-4" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-5">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">s = &quot;bbbab&quot;</span><br><span class="line"></span><br><span class="line">DPè¡¨ (ä¸‹ä¸‰è§’æœªä½¿ç”¨):</span><br><span class="line">      0  1  2  3  4</span><br><span class="line">  0   1  2  3  4  4</span><br><span class="line">  1   -  1  2  3  3</span><br><span class="line">  2   -  -  1  2  2</span><br><span class="line">  3   -  -  -  1  1</span><br><span class="line">  4   -  -  -  -  1</span><br><span class="line"></span><br><span class="line">è®¡ç®—é¡ºåº (æŒ‰é•¿åº¦é€’å¢):</span><br><span class="line">len=1: å¯¹è§’çº¿å…¨ä¸º1</span><br><span class="line">len=2: dp[0][1], dp[1][2], dp[2][3], dp[3][4]</span><br><span class="line">len=3: dp[0][2], dp[1][3], dp[2][4]</span><br><span class="line">len=4: dp[0][3], dp[1][4]</span><br><span class="line">len=5: dp[0][4]</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆ: dp[0][4] = 4 (&quot;bbbb&quot;)</span><br></pre></td></tr></table></figure><hr><h2 id="duo-wei-dp-you-hua-ji-qiao" tabindex="-1" id="å¤šç»´DPä¼˜åŒ–æŠ€å·§">å¤šç»´DPä¼˜åŒ–æŠ€å·§</h2><h3 id="1-gun-dong-shu-zu" tabindex="-1" id="1-æ»šåŠ¨æ•°ç»„">1. æ»šåŠ¨æ•°ç»„</h3><p>å½“dp[i][j]åªä¾èµ–dp[i-1][â€¦]æ—¶:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹: O(mÃ—n)ç©ºé—´</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–: O(n)ç©ºé—´</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">prev</span><span class="params">(n)</span>, <span class="title">curr</span><span class="params">(n)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">        curr[j] = ...;  <span class="comment">// ä½¿ç”¨prev[j]ç­‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">swap</span>(prev, curr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-dao-xu-bian-li-01-bei-bao" tabindex="-1" id="2-å€’åºéå†-01èƒŒåŒ…">2. å€’åºéå† (01èƒŒåŒ…)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æ­£åºä¼šé‡å¤ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= W; ++j) &#123;</span><br><span class="line">    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w] + v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ“ å€’åºé¿å…é‡å¤</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = W; j &gt;= w; --j) &#123;</span><br><span class="line">    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w] + v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-zhuang-tai-ya-suo" tabindex="-1" id="3-çŠ¶æ€å‹ç¼©">3. çŠ¶æ€å‹ç¼©</h3><p>æŸäº›é—®é¢˜å¯ä»¥ç”¨ä½è¿ç®—å‹ç¼©çŠ¶æ€:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾‹å¦‚:æ—…è¡Œå•†é—®é¢˜ (TSP)</span></span><br><span class="line"><span class="comment">// dp[state][i]: è®¿é—®çŠ¶æ€ä¸ºstate,å½“å‰åœ¨åŸå¸‚içš„æœ€çŸ­è·ç¦»</span></span><br><span class="line"><span class="comment">// stateç”¨äºŒè¿›åˆ¶è¡¨ç¤º: 101è¡¨ç¤ºè®¿é—®äº†åŸå¸‚0å’Œ2</span></span><br></pre></td></tr></table></figure><hr><h2 id="duo-wei-dp-wen-ti-fen-lei" tabindex="-1" id="å¤šç»´DPé—®é¢˜åˆ†ç±»">å¤šç»´DPé—®é¢˜åˆ†ç±»</h2><h3 id="lu-jing-wen-ti" tabindex="-1" id="è·¯å¾„é—®é¢˜">è·¯å¾„é—®é¢˜</h3><pre><code class="highlight mermaid">graph LR    A[è·¯å¾„é—®é¢˜] --&gt; B[ä¸åŒè·¯å¾„]    A --&gt; C[æœ€å°è·¯å¾„å’Œ]    A --&gt; D[åœ°ä¸‹åŸæ¸¸æˆ]        style A fill:#FFE4B5    style B fill:#90EE90</code></pre><p><strong>ç‰¹ç‚¹</strong>: åœ¨ç½‘æ ¼ä¸­ç§»åŠ¨,dp[i][j]è¡¨ç¤ºåˆ°è¾¾(i,j)çš„çŠ¶æ€</p><h3 id="shuang-xu-lie-pi-pei" tabindex="-1" id="åŒåºåˆ—åŒ¹é…">åŒåºåˆ—åŒ¹é…</h3><pre><code class="highlight mermaid">graph LR    A[åŒåºåˆ—] --&gt; B[æœ€é•¿å…¬å…±å­åºåˆ—]    A --&gt; C[ç¼–è¾‘è·ç¦»]    A --&gt; D[ä¸åŒçš„å­åºåˆ—]        style A fill:#87CEEB</code></pre><p><strong>ç‰¹ç‚¹</strong>: ä¸¤ä¸ªå­—ç¬¦ä¸²/æ•°ç»„,dp[i][j]è¡¨ç¤ºå¤„ç†åˆ°ç¬¬iå’Œç¬¬jä¸ªå­—ç¬¦</p><h3 id="qu-jian-dp" tabindex="-1" id="åŒºé—´DP">åŒºé—´DP</h3><pre><code class="highlight mermaid">graph LR    A[åŒºé—´DP] --&gt; B[æœ€é•¿å›æ–‡å­åºåˆ—]    A --&gt; C[æˆ³æ°”çƒ]    A --&gt; D[åˆå¹¶çŸ³å¤´]        style A fill:#DDA0DD</code></pre><p><strong>ç‰¹ç‚¹</strong>: dp[i][j]è¡¨ç¤ºåŒºé—´[i,j]çš„ç­”æ¡ˆ,æŒ‰åŒºé—´é•¿åº¦é€’å¢è®¡ç®—</p><h3 id="bei-bao-dp" tabindex="-1" id="èƒŒåŒ…DP">èƒŒåŒ…DP</h3><pre><code class="highlight mermaid">graph LR    A[èƒŒåŒ…DP] --&gt; B[01èƒŒåŒ…]    A --&gt; C[å®Œå…¨èƒŒåŒ…]    A --&gt; D[å¤šé‡èƒŒåŒ…]        style A fill:#F0E68C</code></pre><p><strong>ç‰¹ç‚¹</strong>: é€‰æˆ–ä¸é€‰,dp[i][j]è¡¨ç¤ºå‰iä¸ªç‰©å“,å®¹é‡ä¸ºjçš„æœ€ä¼˜è§£</p><hr><h2 id="jie-ti-si-lu-zong-jie" tabindex="-1" id="è§£é¢˜æ€è·¯æ€»ç»“">è§£é¢˜æ€è·¯æ€»ç»“</h2><h3 id="bu-zou-1-que-ding-wei-du" tabindex="-1" id="æ­¥éª¤1-ç¡®å®šç»´åº¦">æ­¥éª¤1: ç¡®å®šç»´åº¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜éœ€è¦å‡ ä¸ªå‚æ•°æè¿°?</span><br><span class="line">- 1ä¸ªå‚æ•° â†’ ä¸€ç»´DP</span><br><span class="line">- 2ä¸ªå‚æ•° â†’ äºŒç»´DP</span><br><span class="line">- æ›´å¤š â†’ ä¸‰ç»´/æ›´é«˜ç»´DP</span><br></pre></td></tr></table></figure><h3 id="bu-zou-2-ding-yi-zhuang-tai" tabindex="-1" id="æ­¥éª¤2-å®šä¹‰çŠ¶æ€">æ­¥éª¤2: å®šä¹‰çŠ¶æ€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] ä»£è¡¨ä»€ä¹ˆå«ä¹‰?</span><br><span class="line"></span><br><span class="line">å¸¸è§å®šä¹‰:</span><br><span class="line">- dp[i][j]: åˆ°è¾¾(i,j)çš„...</span><br><span class="line">- dp[i][j]: å‰iä¸ª...å‰jä¸ª...çš„...</span><br><span class="line">- dp[i][j]: åŒºé—´[i,j]çš„...</span><br></pre></td></tr></table></figure><h3 id="bu-zou-3-zhao-zhuang-tai-zhuan-yi" tabindex="-1" id="æ­¥éª¤3-æ‰¾çŠ¶æ€è½¬ç§»">æ­¥éª¤3: æ‰¾çŠ¶æ€è½¬ç§»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰çŠ¶æ€ä»å“ªäº›çŠ¶æ€è½¬ç§»è€Œæ¥?</span><br><span class="line"></span><br><span class="line">å¸¸è§è½¬ç§»:</span><br><span class="line">- æœ€ä¼˜åŒ–: max/min</span><br><span class="line">- è®¡æ•°: ç´¯åŠ </span><br><span class="line">- åˆ¤æ–­: é€»è¾‘æˆ–/ä¸</span><br></pre></td></tr></table></figure><h3 id="bu-zou-4-chu-shi-hua" tabindex="-1" id="æ­¥éª¤4-åˆå§‹åŒ–">æ­¥éª¤4: åˆå§‹åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¡®å®šè¾¹ç•Œæ¡ä»¶:</span><br><span class="line">- dp[0][0] = ?</span><br><span class="line">- dp[i][0] = ?</span><br><span class="line">- dp[0][j] = ?</span><br></pre></td></tr></table></figure><h3 id="bu-zou-5-que-ding-ji-suan-shun-xu" tabindex="-1" id="æ­¥éª¤5-ç¡®å®šè®¡ç®—é¡ºåº">æ­¥éª¤5: ç¡®å®šè®¡ç®—é¡ºåº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¿è¯è®¡ç®—dp[i][j]æ—¶,ä¾èµ–çš„çŠ¶æ€å·²ç»è®¡ç®—:</span><br><span class="line">- ä»å°åˆ°å¤§ (å¤§å¤šæ•°æƒ…å†µ)</span><br><span class="line">- æŒ‰é•¿åº¦é€’å¢ (åŒºé—´DP)</span><br><span class="line">- å€’åº (01èƒŒåŒ…)</span><br></pre></td></tr></table></figure><hr><h2 id="chang-jian-xian-jing-yu-ji-qiao" tabindex="-1" id="å¸¸è§é™·é˜±ä¸æŠ€å·§">å¸¸è§é™·é˜±ä¸æŠ€å·§</h2><h3 id="xian-jing-1-suo-yin-hun-yao" tabindex="-1" id="é™·é˜±1-ç´¢å¼•æ··æ·†">é™·é˜±1: ç´¢å¼•æ··æ·†</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æ•°ç»„è¶Šç•Œ</span></span><br><span class="line">dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;  <span class="comment">// å½“i=0æˆ–j=0æ—¶è¶Šç•Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ“ æ­£ç¡®å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨i-1, j-1è®¿é—®åŸæ•°ç»„</span></span><br><span class="line">        <span class="keyword">if</span> (text1[i<span class="number">-1</span>] == text2[j<span class="number">-1</span>]) &#123;</span><br><span class="line">            dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xian-jing-2-chu-shi-hua-cuo-wu" tabindex="-1" id="é™·é˜±2-åˆå§‹åŒ–é”™è¯¯">é™·é˜±2: åˆå§‹åŒ–é”™è¯¯</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å¿˜è®°åˆå§‹åŒ–è¾¹ç•Œ</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ“ æ­£ç¡®åˆå§‹åŒ–</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>));</span><br><span class="line"><span class="comment">// æˆ–è€…æ˜¾å¼å¤„ç†ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—</span></span><br></pre></td></tr></table></figure><h3 id="xian-jing-3-bian-li-shun-xu-cuo-wu" tabindex="-1" id="é™·é˜±3-éå†é¡ºåºé”™è¯¯">é™·é˜±3: éå†é¡ºåºé”™è¯¯</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ 01èƒŒåŒ…æ­£åºéå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= W; ++j) &#123;  <span class="comment">// ä¼šé‡å¤ä½¿ç”¨ç‰©å“</span></span><br><span class="line">    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w] + v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ“ å€’åºéå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = W; j &gt;= w; --j) &#123;</span><br><span class="line">    dp[j] = <span class="built_in">max</span>(dp[j], dp[j-w] + v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-1-hua-biao-ge-fu-zhu-si-kao" tabindex="-1" id="æŠ€å·§1-ç”»è¡¨æ ¼è¾…åŠ©æ€è€ƒ">æŠ€å·§1: ç”»è¡¨æ ¼è¾…åŠ©æ€è€ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºåŒåºåˆ—é—®é¢˜,ç”»å‡ºDPè¡¨æ ¼:</span><br><span class="line"></span><br><span class="line">      &quot;&quot;  a  c  e</span><br><span class="line">  &quot;&quot;   0  0  0  0</span><br><span class="line">  a    0  ?  ?  ?</span><br><span class="line">  b    0  ?  ?  ?</span><br><span class="line">  c    0  ?  ?  ?</span><br><span class="line"></span><br><span class="line">æ€è€ƒæ¯ä¸ª?å¦‚ä½•å¡«</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-2-cong-jian-dan-li-zi-ru-shou" tabindex="-1" id="æŠ€å·§2-ä»ç®€å•ä¾‹å­å…¥æ‰‹">æŠ€å·§2: ä»ç®€å•ä¾‹å­å…¥æ‰‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸è¦ä¸€å¼€å§‹å°±æƒ³å¤æ‚æƒ…å†µ:</span><br><span class="line">1. å…ˆè€ƒè™‘n=1, n=2çš„æƒ…å†µ</span><br><span class="line">2. æ‰¾è§„å¾‹,æ¨å¯¼çŠ¶æ€è½¬ç§»</span><br><span class="line">3. éªŒè¯è¾¹ç•Œæ¡ä»¶</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-3-ji-zhu-jing-dian-mo-ban" tabindex="-1" id="æŠ€å·§3-è®°ä½ç»å…¸æ¨¡æ¿">æŠ€å·§3: è®°ä½ç»å…¸æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒåºåˆ—æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (æ¡ä»¶) &#123;</span><br><span class="line">            dp[i][j] = ...;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dp[i][j] = ...;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒºé—´DPæ¨¡æ¿</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> len = <span class="number">2</span>; len &lt;= n; ++len) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i + len - <span class="number">1</span> &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">        dp[i][j] = ...;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="si-wei-dao-tu" tabindex="-1" id="æ€ç»´å¯¼å›¾">æ€ç»´å¯¼å›¾</h2><pre><code class="highlight mermaid">graph TD    A[å¤šç»´DP] --&gt; B[é—®é¢˜ç±»å‹]    A --&gt; C[æ ¸å¿ƒæŠ€å·§]    A --&gt; D[ä¼˜åŒ–æ–¹æ³•]        B --&gt; B1[è·¯å¾„é—®é¢˜]    B --&gt; B2[åŒåºåˆ—åŒ¹é…]    B --&gt; B3[åŒºé—´DP]    B --&gt; B4[èƒŒåŒ…DP]        C --&gt; C1[ç¡®å®šç»´åº¦]    C --&gt; C2[å®šä¹‰çŠ¶æ€]    C --&gt; C3[çŠ¶æ€è½¬ç§»]    C --&gt; C4[åˆå§‹åŒ–]        D --&gt; D1[æ»šåŠ¨æ•°ç»„]    D --&gt; D2[å€’åºéå†]    D --&gt; D3[çŠ¶æ€å‹ç¼©]        style A fill:#FFE4B5    style B fill:#90EE90    style C fill:#87CEEB    style D fill:#DDA0DD</code></pre><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>å¤šç»´DP = å¤šä¸ªå‚æ•°æè¿°çŠ¶æ€</strong></li><li><strong>äºŒç»´æ˜¯æœ€å¸¸è§çš„</strong>: è·¯å¾„ã€åŒåºåˆ—ã€èƒŒåŒ…</li><li><strong>ç”»è¡¨æ ¼</strong>: è¾…åŠ©ç†è§£çŠ¶æ€è½¬ç§»</li><li><strong>æ³¨æ„è¾¹ç•Œ</strong>: åˆå§‹åŒ–å’Œç´¢å¼•å¤„ç†</li><li><strong>ç©ºé—´ä¼˜åŒ–</strong>: æ»šåŠ¨æ•°ç»„ã€å€’åºéå†</li></ol><h3 id="dai-ma-mo-ban" tabindex="-1" id="ä»£ç æ¨¡æ¿">ä»£ç æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´DPæ¨¡æ¿ (åŒåºåˆ—)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = s<span class="number">1.</span><span class="built_in">size</span>(), n = s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) dp[i][<span class="number">0</span>] = ...;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= n; ++j) dp[<span class="number">0</span>][j] = ...;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i<span class="number">-1</span>] == s2[j<span class="number">-1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + ...;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 01èƒŒåŒ…æ¨¡æ¿ (ç©ºé—´ä¼˜åŒ–)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">knapsack</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; w, vector&lt;<span class="type">int</span>&gt;&amp; v, <span class="type">int</span> W)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(W + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = W; j &gt;= w[i]; --j) &#123;  <span class="comment">// å€’åº!</span></span><br><span class="line">            dp[j] = <span class="built_in">max</span>(dp[j], dp[j - w[i]] + v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[W];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒºé—´DPæ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å•ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        dp[i][i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‰é•¿åº¦é€’å¢</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> len = <span class="number">2</span>; len &lt;= n; ++len) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i + len - <span class="number">1</span> &lt; n; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> j = i + len - <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (s[i] == s[j]) &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">+1</span>][j<span class="number">-1</span>] + <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i<span class="number">+1</span>][j], dp[i][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>][n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¨èç»ƒä¹ </strong>:</p><ul><li><a href="https://leetcode.com/problems/unique-paths/">LeetCode 62 - ä¸åŒè·¯å¾„</a></li><li><a href="https://leetcode.com/problems/minimum-path-sum/">LeetCode 64 - æœ€å°è·¯å¾„å’Œ</a></li><li><a href="https://leetcode.com/problems/longest-common-subsequence/">LeetCode 1143 - æœ€é•¿å…¬å…±å­åºåˆ—</a></li><li><a href="https://leetcode.com/problems/edit-distance/">LeetCode 72 - ç¼–è¾‘è·ç¦»</a></li><li><a href="https://leetcode.com/problems/longest-palindromic-subsequence/">LeetCode 516 - æœ€é•¿å›æ–‡å­åºåˆ—</a></li><li><a href="https://leetcode.com/problems/coin-change/">LeetCode 322 - é›¶é’±å…‘æ¢</a></li></ul><p><strong>æ¨èé˜…è¯»</strong>:</p><ul><li><a href="https://book.douban.com/subject/20432061/">ã€Šç®—æ³•å¯¼è®ºã€‹ç¬¬15ç« :åŠ¨æ€è§„åˆ’</a></li><li><a href="https://labuladong.gitee.io/algo/">åŠ¨æ€è§„åˆ’ä¸“é¢˜è¯¦è§£</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;duo-wei-dong-tai-gui-hua-zai-geng-gao-wei-du-si-kao&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ç®—æ³•è®¾è®¡" scheme="https://smarter.xin/tags/algorithm-design/"/>
    
    <category term="åŠ¨æ€è§„åˆ’" scheme="https://smarter.xin/tags/dynamic-programming/"/>
    
    <category term="å¤šç»´DP" scheme="https://smarter.xin/tags/multi-dimensional-dp/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-ä¸€ç»´åŠ¨æ€è§„åˆ’</title>
    <link href="https://smarter.xin/posts/a92afa11/"/>
    <id>https://smarter.xin/posts/a92afa11/</id>
    <published>2026-01-07T03:09:38.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="yi-wei-dong-tai-gui-hua-hua-fan-wei-jian-de-zhi-hui" tabindex="-1">ä¸€ç»´åŠ¨æ€è§„åˆ’ï¼šåŒ–ç¹ä¸ºç®€çš„æ™ºæ…§</h1><blockquote><p>è®°ä½è¿‡å»ï¼Œæ‰èƒ½æ›´å¥½åœ°é¢å¯¹æœªæ¥</p></blockquote><hr><h2 id="shi-yao-shi-dong-tai-gui-hua" tabindex="-1" id="ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’">ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’</h2><p><strong>åŠ¨æ€è§„åˆ’</strong>ï¼ˆDynamic Programmingï¼ŒDPï¼‰æ˜¯ä¸€ç§é€šè¿‡æŠŠåŸé—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç®€å•çš„å­é—®é¢˜çš„æ–¹å¼æ¥æ±‚è§£å¤æ‚é—®é¢˜çš„æ–¹æ³•ã€‚</p><blockquote><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†ä¸€ä¸ªé—®é¢˜æ‹†åˆ†æˆè‹¥å¹²å­é—®é¢˜ï¼Œä¿å­˜å­é—®é¢˜çš„ç­”æ¡ˆï¼Œä½¿å¾—æ¯ä¸ªå­é—®é¢˜åªæ±‚è§£ä¸€æ¬¡ï¼Œæœ€ç»ˆè·å¾—åŸé—®é¢˜çš„ç­”æ¡ˆã€‚</p></blockquote><h3 id="xing-xiang-li-jie" tabindex="-1" id="å½¢è±¡ç†è§£">å½¢è±¡ç†è§£</h3><p>æƒ³è±¡ä½ åœ¨çˆ¬æ¥¼æ¢¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆ°ç¬¬10å±‚æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æš´åŠ›ï¼šæšä¸¾æ‰€æœ‰å¯èƒ½çš„èµ°æ³•ï¼ˆæŒ‡æ•°çº§å¤æ‚åº¦ï¼‰</span><br><span class="line"></span><br><span class="line">åŠ¨æ€è§„åˆ’ï¼š</span><br><span class="line">- åˆ°ç¬¬10å±‚ = ä»ç¬¬9å±‚èµ°1æ­¥ + ä»ç¬¬8å±‚èµ°2æ­¥</span><br><span class="line">- åˆ°ç¬¬9å±‚ = ä»ç¬¬8å±‚èµ°1æ­¥ + ä»ç¬¬7å±‚èµ°2æ­¥</span><br><span class="line">- ...</span><br><span class="line">åªéœ€è¦è®°ä½å‰é¢çš„ç»“æœï¼</span><br></pre></td></tr></table></figure><hr><h2 id="dp-de-he-xin-yao-su" tabindex="-1" id="DPçš„æ ¸å¿ƒè¦ç´ ">DPçš„æ ¸å¿ƒè¦ç´ </h2><h3 id="san-da-te-zheng" tabindex="-1" id="ä¸‰å¤§ç‰¹å¾">ä¸‰å¤§ç‰¹å¾</h3><pre><code class="highlight mermaid">graph LR    A[åŠ¨æ€è§„åˆ’] --&gt; B[æœ€ä¼˜å­ç»“æ„]    A --&gt; C[é‡å å­é—®é¢˜]    A --&gt; D[æ— åæ•ˆæ€§]        B --&gt; B1[æœ€ä¼˜è§£åŒ…å«å­é—®é¢˜æœ€ä¼˜è§£]    C --&gt; C1[å­é—®é¢˜ä¼šé‡å¤å‡ºç°]    D --&gt; D1[å½“å‰çŠ¶æ€ä¸å—æœªæ¥å½±å“]        style A fill:#FFE4B5    style B fill:#90EE90    style C fill:#87CEEB</code></pre><h3 id="si-ge-bu-zou" tabindex="-1" id="å››ä¸ªæ­¥éª¤">å››ä¸ªæ­¥éª¤</h3><ol><li><strong>å®šä¹‰çŠ¶æ€</strong>ï¼š<code>dp[i]</code> è¡¨ç¤ºä»€ä¹ˆå«ä¹‰</li><li><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼š<code>dp[i]</code> å¦‚ä½•ä»ä¹‹å‰çš„çŠ¶æ€æ¨å¯¼</li><li><strong>åˆå§‹åŒ–</strong>ï¼šè¾¹ç•Œæ¡ä»¶</li><li><strong>è®¡ç®—é¡ºåº</strong>ï¼šä»å°åˆ°å¤§è¿˜æ˜¯ä»å¤§åˆ°å°</li></ol><hr><h2 id="jing-dian-wen-ti-xiang-jie" tabindex="-1" id="ç»å…¸é—®é¢˜è¯¦è§£">ç»å…¸é—®é¢˜è¯¦è§£</h2><h3 id="1-pa-lou-ti-leet-code-70" tabindex="-1" id="1-çˆ¬æ¥¼æ¢¯ï¼ˆLeetCode-70ï¼‰">1. çˆ¬æ¥¼æ¢¯ï¼ˆLeetCode 70ï¼‰</h3><blockquote><p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ï¼Œéœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ï¼Ÿ</p></blockquote><h4 id="wen-ti-fen-xi" tabindex="-1" id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = 3</span><br><span class="line"></span><br><span class="line">æ–¹æ³•1: 1æ­¥ + 1æ­¥ + 1æ­¥</span><br><span class="line">æ–¹æ³•2: 1æ­¥ + 2æ­¥</span><br><span class="line">æ–¹æ³•3: 2æ­¥ + 1æ­¥</span><br><span class="line"></span><br><span class="line">å…±3ç§æ–¹æ³•</span><br></pre></td></tr></table></figure><h4 id="dp-si-lu" tabindex="-1" id="DPæ€è·¯">DPæ€è·¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ°è¾¾ç¬¬ n é˜¶çš„æ–¹æ³•æ•° = åˆ°è¾¾ç¬¬ n-1 é˜¶çš„æ–¹æ³•æ•° + åˆ°è¾¾ç¬¬ n-2 é˜¶çš„æ–¹æ³•æ•°</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆï¼Ÿ</span><br><span class="line">- ä»ç¬¬ n-1 é˜¶èµ°1æ­¥åˆ°è¾¾ç¬¬ n é˜¶</span><br><span class="line">- ä»ç¬¬ n-2 é˜¶èµ°2æ­¥åˆ°è¾¾ç¬¬ n é˜¶</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi" tabindex="-1" id="çŠ¶æ€å®šä¹‰">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šåˆ°è¾¾ç¬¬ i é˜¶çš„æ–¹æ³•æ•°</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = dp[i-1] + dp[i-2]</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸å°±æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—å—ï¼</strong></p><h4 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1ï¼šDPæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        dp[i] = dp[i<span class="number">-1</span>] + dp[i<span class="number">-2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2ï¼šç©ºé—´ä¼˜åŒ–ï¼ˆæ»šåŠ¨å˜é‡ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> prev2 = <span class="number">1</span>, prev1 = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> current = prev1 + prev2;</span><br><span class="line">        prev2 = prev1;</span><br><span class="line">        prev1 = current;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> prev1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n) â†’ ä¼˜åŒ–å O(1)</p><h4 id="zhi-xing-guo-cheng" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = 5</span><br><span class="line"></span><br><span class="line">i=3: dp[3] = dp[2] + dp[1] = 2 + 1 = 3</span><br><span class="line">i=4: dp[4] = dp[3] + dp[2] = 3 + 2 = 5</span><br><span class="line">i=5: dp[5] = dp[4] + dp[3] = 5 + 3 = 8</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š8ç§æ–¹æ³•</span><br></pre></td></tr></table></figure><hr><h3 id="2-da-jia-jie-she-leet-code-198" tabindex="-1" id="2-æ‰“å®¶åŠ«èˆï¼ˆLeetCode-198ï¼‰">2. æ‰“å®¶åŠ«èˆï¼ˆLeetCode 198ï¼‰</h3><blockquote><p>ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œæ²¿ç€ä¸€æ¡è¡—æœ‰è‹¥å¹²æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚</p></blockquote><h4 id="wen-ti-fen-xi-1" tabindex="-1" id="é—®é¢˜åˆ†æ-2">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[2,7,9,3,1]</span><br><span class="line">è¾“å‡ºï¼š12</span><br><span class="line">è§£é‡Šï¼šå·çªƒ1å·æˆ¿å±‹(2)ï¼Œ3å·æˆ¿å±‹(9)ï¼Œ5å·æˆ¿å±‹(1) = 2 + 9 + 1 = 12</span><br><span class="line"></span><br><span class="line">ä¸èƒ½å·ç›¸é‚»çš„æˆ¿å±‹ï¼</span><br></pre></td></tr></table></figure><h4 id="dp-si-lu-1" tabindex="-1" id="DPæ€è·¯-2">DPæ€è·¯</h4><p>å¯¹äºç¬¬ i é—´æˆ¿å±‹ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. å·ç¬¬ i é—´ï¼šè·å¾— nums[i] + dp[i-2]ï¼ˆä¸èƒ½å·ç¬¬ i-1 é—´ï¼‰</span><br><span class="line">2. ä¸å·ç¬¬ i é—´ï¼šä¿æŒ dp[i-1]</span><br><span class="line"></span><br><span class="line">é€‰æœ€å¤§çš„ï¼</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-1" tabindex="-1" id="çŠ¶æ€å®šä¹‰-2">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šè€ƒè™‘å‰ i é—´æˆ¿å±‹ï¼Œèƒ½å·åˆ°çš„æœ€å¤§é‡‘é¢</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-1" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-2">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = max(dp[i-1], dp[i-2] + nums[i])</span><br><span class="line">         â†‘           â†‘</span><br><span class="line">       ä¸å·ç¬¬ié—´    å·ç¬¬ié—´</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-1" tabindex="-1" id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1ï¼šDPæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rob</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line">    dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="built_in">max</span>(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        dp[i] = <span class="built_in">max</span>(dp[i<span class="number">-1</span>], dp[i<span class="number">-2</span>] + nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2ï¼šç©ºé—´ä¼˜åŒ–</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rob</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> prev2 = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> prev1 = <span class="built_in">max</span>(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> current = <span class="built_in">max</span>(prev1, prev2 + nums[i]);</span><br><span class="line">        prev2 = prev1;</span><br><span class="line">        prev1 = current;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> prev1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="zhi-xing-guo-cheng-1" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-2">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nums = [2, 7, 9, 3, 1]</span><br><span class="line"></span><br><span class="line">i=0: dp[0] = 2</span><br><span class="line">i=1: dp[1] = max(2, 7) = 7</span><br><span class="line">i=2: dp[2] = max(7, 2+9) = 11</span><br><span class="line">i=3: dp[3] = max(11, 7+3) = 11</span><br><span class="line">i=4: dp[4] = max(11, 11+1) = 12</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š12</span><br></pre></td></tr></table></figure><p><strong>å¯è§†åŒ–å†³ç­–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æˆ¿å±‹ï¼š  [2]  [7]  [9]  [3]  [1]</span><br><span class="line">å†³ç­–ï¼š   âˆš    âˆš    âˆš    âœ—    âˆš</span><br><span class="line">       å·   å·   å·   ä¸å·  å·</span><br><span class="line"></span><br><span class="line">2 + 9 + 1 = 12ï¼ˆä¸èƒ½å·7å’Œ3ï¼Œå› ä¸ºç›¸é‚»ï¼‰</span><br></pre></td></tr></table></figure><hr><h3 id="3-zui-da-zi-shu-zu-he-leet-code-53-kadane-suan-fa" tabindex="-1" id="3-æœ€å¤§å­æ•°ç»„å’Œï¼ˆLeetCode-53ï¼‰-Kadaneç®—æ³•">3. æœ€å¤§å­æ•°ç»„å’Œï¼ˆLeetCode 53ï¼‰- Kadaneç®—æ³•</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ã€‚</p></blockquote><h4 id="zhuang-tai-ding-yi-2" tabindex="-1" id="çŠ¶æ€å®šä¹‰-3">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šä»¥ç¬¬ i ä¸ªå…ƒç´ ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œ</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-2" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-3">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = max(nums[i], dp[i-1] + nums[i])</span><br><span class="line">         â†‘            â†‘</span><br><span class="line">      é‡æ–°å¼€å§‹      ç»§ç»­ç´¯åŠ </span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-2" tabindex="-1" id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxSubArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> maxEndingHere = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> maxSoFar = nums[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        maxEndingHere = <span class="built_in">max</span>(nums[i], maxEndingHere + nums[i]);</span><br><span class="line">        maxSoFar = <span class="built_in">max</span>(maxSoFar, maxEndingHere);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> maxSoFar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦è§ä¹‹å‰çš„ <a href="%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95-Kadane.md">Kadaneç®—æ³•åšå®¢</a></p><hr><h3 id="4-mai-mai-gu-piao-de-zui-jia-shi-ji-leet-code-121" tabindex="-1" id="4-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºï¼ˆLeetCode-121ï¼‰">4. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºï¼ˆLeetCode 121ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ä½ åªèƒ½é€‰æ‹©æŸä¸€å¤©ä¹°å…¥å¹¶åœ¨æœªæ¥æŸä¸€å¤©å–å‡ºï¼Œè®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p></blockquote><h4 id="wen-ti-fen-xi-2" tabindex="-1" id="é—®é¢˜åˆ†æ-3">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[7,1,5,3,6,4]</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šç¬¬2å¤©ä¹°å…¥(1)ï¼Œç¬¬5å¤©å–å‡º(6)ï¼Œåˆ©æ¶¦ = 6-1 = 5</span><br></pre></td></tr></table></figure><h4 id="fang-fa-1-bao-cun-zui-di-jie-ge" tabindex="-1" id="æ–¹æ³•1ï¼šä¿å­˜æœ€ä½ä»·æ ¼">æ–¹æ³•1ï¼šä¿å­˜æœ€ä½ä»·æ ¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> minPrice = INT_MAX;</span><br><span class="line">    <span class="type">int</span> maxProfit = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> price : prices) &#123;</span><br><span class="line">        minPrice = <span class="built_in">min</span>(minPrice, price);</span><br><span class="line">        maxProfit = <span class="built_in">max</span>(maxProfit, price - minPrice);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> maxProfit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="fang-fa-2-dp-shi-jiao" tabindex="-1" id="æ–¹æ³•2ï¼šDPè§†è§’">æ–¹æ³•2ï¼šDPè§†è§’</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šç¬¬ i å¤©å–å‡ºèƒ½è·å¾—çš„æœ€å¤§åˆ©æ¶¦</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (prices.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> minPrice = prices[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> maxProfit = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; prices.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        maxProfit = <span class="built_in">max</span>(maxProfit, prices[i] - minPrice);</span><br><span class="line">        minPrice = <span class="built_in">min</span>(minPrice, prices[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> maxProfit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)</p><hr><h3 id="5-zui-chang-di-zeng-zi-xu-lie-leet-code-300" tabindex="-1" id="5-æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLeetCode-300ï¼‰">5. æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLeetCode 300ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p></blockquote><h4 id="wen-ti-fen-xi-3" tabindex="-1" id="é—®é¢˜åˆ†æ-4">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[10,9,2,5,3,7,101,18]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œé•¿åº¦ä¸º4</span><br></pre></td></tr></table></figure><h4 id="dp-si-lu-2" tabindex="-1" id="DPæ€è·¯-3">DPæ€è·¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºæ¯ä¸ªä½ç½® iï¼Œè€ƒè™‘æ‰€æœ‰ j &lt; i çš„æƒ…å†µï¼š</span><br><span class="line">- å¦‚æœ nums[j] &lt; nums[i]ï¼Œå¯ä»¥æ¥åœ¨åé¢</span><br><span class="line">- å–æ‰€æœ‰å¯èƒ½ä¸­æœ€é•¿çš„</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-3" tabindex="-1" id="çŠ¶æ€å®šä¹‰-4">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šä»¥ nums[i] ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—é•¿åº¦</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-3" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-4">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = max(dp[j] + 1), å…¶ä¸­ 0 &lt;= j &lt; i ä¸” nums[j] &lt; nums[i]</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-3" tabindex="-1" id="ä»£ç å®ç°-4">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">lengthOfLIS</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n, <span class="number">1</span>)</span></span>;  <span class="comment">// åˆå§‹åŒ–ä¸º1ï¼Œæ¯ä¸ªå…ƒç´ è‡ªå·±æ„æˆä¸€ä¸ªåºåˆ—</span></span><br><span class="line">    <span class="type">int</span> maxLen = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt; nums[i]) &#123;</span><br><span class="line">                dp[i] = <span class="built_in">max</span>(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maxLen = <span class="built_in">max</span>(maxLen, dp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ²)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p><h4 id="zhi-xing-guo-cheng-2" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-3">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nums = [10, 9, 2, 5, 3, 7, 101, 18]</span><br><span class="line"></span><br><span class="line">i=0: dp[0]=1  [10]</span><br><span class="line">i=1: dp[1]=1  [9]</span><br><span class="line">i=2: dp[2]=1  [2]</span><br><span class="line">i=3: dp[3]=2  [2,5]  (ä»2æ¥ä¸Š)</span><br><span class="line">i=4: dp[4]=2  [2,3]  (ä»2æ¥ä¸Š)</span><br><span class="line">i=5: dp[5]=3  [2,5,7] æˆ– [2,3,7]</span><br><span class="line">i=6: dp[6]=4  [2,5,7,101] æˆ– [2,3,7,101]</span><br><span class="line">i=7: dp[7]=4  [2,5,7,18] æˆ– [2,3,7,18]</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š4</span><br></pre></td></tr></table></figure><h4 id="you-hua-tan-xin-er-fen-o-n-log-n" tabindex="-1" id="ä¼˜åŒ–ï¼šè´ªå¿ƒ-äºŒåˆ†ï¼ˆO-n-log-n-ï¼‰">ä¼˜åŒ–ï¼šè´ªå¿ƒ+äºŒåˆ†ï¼ˆO(n log n)ï¼‰</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">lengthOfLIS</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; tails;  <span class="comment">// tails[i]: é•¿åº¦ä¸ºi+1çš„é€’å¢å­åºåˆ—çš„æœ€å°æœ«å°¾å…ƒç´ </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        <span class="keyword">auto</span> it = <span class="built_in">lower_bound</span>(tails.<span class="built_in">begin</span>(), tails.<span class="built_in">end</span>(), num);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (it == tails.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            tails.<span class="built_in">push_back</span>(num);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            *it = num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> tails.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="6-fen-ge-deng-he-zi-ji-leet-code-416" tabindex="-1" id="6-åˆ†å‰²ç­‰å’Œå­é›†ï¼ˆLeetCode-416ï¼‰">6. åˆ†å‰²ç­‰å’Œå­é›†ï¼ˆLeetCode 416ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªåªåŒ…å«æ­£æ•´æ•°çš„éç©ºæ•°ç»„ï¼Œæ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ï¼Ÿ</p></blockquote><h4 id="wen-ti-fen-xi-4" tabindex="-1" id="é—®é¢˜åˆ†æ-5">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[1,5,11,5]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šæ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1,5,5] å’Œ [11]</span><br></pre></td></tr></table></figure><h4 id="zhuan-hua-wei-01-bei-bao-wen-ti" tabindex="-1" id="è½¬åŒ–ä¸º01èƒŒåŒ…é—®é¢˜">è½¬åŒ–ä¸º01èƒŒåŒ…é—®é¢˜</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜è½¬åŒ–ï¼šèƒ½å¦æ‰¾åˆ°å­é›†ï¼Œå’Œä¸ºæ€»å’Œçš„ä¸€åŠï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ€»å’Œ = 22</span><br><span class="line">ç›®æ ‡ï¼šæ‰¾åˆ°å’Œä¸º11çš„å­é›†</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-4" tabindex="-1" id="çŠ¶æ€å®šä¹‰-5">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šæ˜¯å¦å¯ä»¥å‡‘å‡ºå’Œä¸º i</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-4" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-5">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = dp[i] || dp[i - nums[j]]</span><br><span class="line">         â†‘           â†‘</span><br><span class="line">      ä¸é€‰nums[j]  é€‰nums[j]</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-4" tabindex="-1" id="ä»£ç å®ç°-5">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">canPartition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        sum += num;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (sum % <span class="number">2</span> != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// å¥‡æ•°æ— æ³•å¹³åˆ†</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> target = sum / <span class="number">2</span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">dp</span><span class="params">(target + <span class="number">1</span>, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="literal">true</span>;  <span class="comment">// å’Œä¸º0æ€»æ˜¯å¯ä»¥ï¼ˆä¸é€‰ä»»ä½•å…ƒç´ ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        <span class="comment">// ä»åå¾€å‰éå†ï¼Œé¿å…é‡å¤ä½¿ç”¨åŒä¸€å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = target; i &gt;= num; --i) &#123;</span><br><span class="line">            dp[i] = dp[i] || dp[i - num];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[target];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n Ã— sum)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(sum)</p><h4 id="zhi-xing-guo-cheng-3" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-4">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nums = [1, 5, 11, 5], target = 11</span><br><span class="line"></span><br><span class="line">åˆå§‹ï¼šdp[0] = true</span><br><span class="line"></span><br><span class="line">å¤„ç†1ï¼šdp[1] = true</span><br><span class="line">      [T, T, F, F, F, F, F, F, F, F, F, F]</span><br><span class="line"></span><br><span class="line">å¤„ç†5ï¼šdp[5] = true, dp[6] = dp[6] || dp[1] = true</span><br><span class="line">      [T, T, F, F, F, T, T, F, F, F, F, F]</span><br><span class="line"></span><br><span class="line">å¤„ç†11ï¼šdp[11] = true, dp[16]è¶Šç•Œå¿½ç•¥</span><br><span class="line">       [T, T, F, F, F, T, T, F, F, F, F, T]</span><br><span class="line"></span><br><span class="line">å¤„ç†5ï¼šdp[11]å·²ç»æ˜¯true</span><br><span class="line">      [T, T, F, F, F, T, T, F, F, F, T, T]</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼šdp[11] = true</span><br></pre></td></tr></table></figure><hr><h3 id="7-dan-ci-chai-fen-leet-code-139" tabindex="-1" id="7-å•è¯æ‹†åˆ†ï¼ˆLeetCode-139ï¼‰">7. å•è¯æ‹†åˆ†ï¼ˆLeetCode 139ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸²å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯çš„åˆ—è¡¨ï¼Œåˆ¤å®šå­—ç¬¦ä¸²æ˜¯å¦å¯ä»¥è¢«ç©ºæ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåœ¨å­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚</p></blockquote><h4 id="wen-ti-fen-xi-5" tabindex="-1" id="é—®é¢˜åˆ†æ-6">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;leetcode&quot;, wordDict = [&quot;leet&quot;, &quot;code&quot;]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼š&quot;leetcode&quot; å¯ä»¥æ‹†åˆ†æˆ &quot;leet code&quot;</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-5" tabindex="-1" id="çŠ¶æ€å®šä¹‰-6">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šå­—ç¬¦ä¸²å‰ i ä¸ªå­—ç¬¦èƒ½å¦æ‹†åˆ†æˆå­—å…¸ä¸­çš„å•è¯</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-5" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-6">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = dp[j] &amp;&amp; (s[j:i] åœ¨å­—å…¸ä¸­), å…¶ä¸­ 0 &lt;= j &lt; i</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-5" tabindex="-1" id="ä»£ç å®ç°-6">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">wordBreak</span><span class="params">(string s, vector&lt;string&gt;&amp; wordDict)</span> </span>&#123;</span><br><span class="line">    <span class="function">unordered_set&lt;string&gt; <span class="title">wordSet</span><span class="params">(wordDict.begin(), wordDict.end())</span></span>;</span><br><span class="line">    <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="literal">true</span>;  <span class="comment">// ç©ºå­—ç¬¦ä¸²å¯ä»¥æ‹†åˆ†</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[j] &amp;&amp; wordSet.<span class="built_in">count</span>(s.<span class="built_in">substr</span>(j, i - j))) &#123;</span><br><span class="line">                dp[i] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;  <span class="comment">// æ‰¾åˆ°ä¸€ç§æ‹†åˆ†æ–¹å¼å³å¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ² Ã— m)ï¼Œmä¸ºå¹³å‡å•è¯é•¿åº¦<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p><h4 id="zhi-xing-guo-cheng-4" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-5">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s = &quot;leetcode&quot;, wordDict = [&quot;leet&quot;, &quot;code&quot;]</span><br><span class="line"></span><br><span class="line">i=0: dp[0] = true</span><br><span class="line"></span><br><span class="line">i=1: &quot;l&quot; ä¸åœ¨å­—å…¸ â†’ dp[1] = false</span><br><span class="line">i=2: &quot;le&quot; ä¸åœ¨å­—å…¸ â†’ dp[2] = false</span><br><span class="line">i=3: &quot;lee&quot; ä¸åœ¨å­—å…¸ â†’ dp[3] = false</span><br><span class="line">i=4: &quot;leet&quot; åœ¨å­—å…¸ &amp;&amp; dp[0]=true â†’ dp[4] = true</span><br><span class="line">i=5: &quot;eetc&quot; ç­‰éƒ½ä¸åœ¨å­—å…¸ â†’ dp[5] = false</span><br><span class="line">...</span><br><span class="line">i=8: &quot;code&quot; åœ¨å­—å…¸ &amp;&amp; dp[4]=true â†’ dp[8] = true</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼štrue</span><br></pre></td></tr></table></figure><hr><h3 id="8-wan-quan-ping-fang-shu-leet-code-279" tabindex="-1" id="8-å®Œå…¨å¹³æ–¹æ•°ï¼ˆLeetCode-279ï¼‰">8. å®Œå…¨å¹³æ–¹æ•°ï¼ˆLeetCode 279ï¼‰</h3><blockquote><p>ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nï¼Œè¿”å›å’Œä¸º n çš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡ã€‚</p></blockquote><h4 id="wen-ti-fen-xi-6" tabindex="-1" id="é—®é¢˜åˆ†æ-7">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 12</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š12 = 4 + 4 + 4</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-ding-yi-6" tabindex="-1" id="çŠ¶æ€å®šä¹‰-7">çŠ¶æ€å®šä¹‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i]ï¼šå’Œä¸º i çš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡</span><br></pre></td></tr></table></figure><h4 id="zhuang-tai-zhuan-yi-fang-cheng-6" tabindex="-1" id="çŠ¶æ€è½¬ç§»æ–¹ç¨‹-7">çŠ¶æ€è½¬ç§»æ–¹ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = min(dp[i - j*j] + 1), å…¶ä¸­ j*j &lt;= i</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-6" tabindex="-1" id="ä»£ç å®ç°-7">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">numSquares</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>, INT_MAX)</span></span>;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j * j &lt;= i; ++j) &#123;</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i], dp[i - j*j] + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n Ã— âˆšn)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p><h4 id="zhi-xing-guo-cheng-5" tabindex="-1" id="æ‰§è¡Œè¿‡ç¨‹-6">æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = 12</span><br><span class="line"></span><br><span class="line">i=0: dp[0] = 0</span><br><span class="line">i=1: dp[1] = dp[0] + 1 = 1  (1 = 1Â²)</span><br><span class="line">i=2: dp[2] = dp[1] + 1 = 2  (2 = 1Â² + 1Â²)</span><br><span class="line">i=3: dp[3] = dp[2] + 1 = 3  (3 = 1Â² + 1Â² + 1Â²)</span><br><span class="line">i=4: dp[4] = dp[0] + 1 = 1  (4 = 2Â²)</span><br><span class="line">...</span><br><span class="line">i=12: dp[12] = min(dp[11]+1, dp[8]+1, dp[3]+1)</span><br><span class="line">            = min(4, 2, 4) = 3</span><br><span class="line">            (12 = 4 + 4 + 4)</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š3</span><br></pre></td></tr></table></figure><hr><h2 id="kong-jian-you-hua-ji-qiao" tabindex="-1" id="ç©ºé—´ä¼˜åŒ–æŠ€å·§">ç©ºé—´ä¼˜åŒ–æŠ€å·§</h2><h3 id="gun-dong-shu-zu" tabindex="-1" id="æ»šåŠ¨æ•°ç»„">æ»šåŠ¨æ•°ç»„</h3><p>å½“ <code>dp[i]</code> åªä¾èµ–äº <code>dp[i-1]</code> å’Œ <code>dp[i-2]</code> æ—¶ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹ç‰ˆæœ¬ O(n)</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    dp[i] = dp[i<span class="number">-1</span>] + dp[i<span class="number">-2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–ç‰ˆæœ¬ O(1)</span></span><br><span class="line"><span class="type">int</span> prev2 = ..., prev1 = ...;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="type">int</span> current = prev1 + prev2;</span><br><span class="line">    prev2 = prev1;</span><br><span class="line">    prev1 = current;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="01-bei-bao-kong-jian-you-hua" tabindex="-1" id="01èƒŒåŒ…ç©ºé—´ä¼˜åŒ–">01èƒŒåŒ…ç©ºé—´ä¼˜åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´DP</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(sum, <span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–ä¸ºä¸€ç»´ï¼ˆä»åå¾€å‰éå†ï¼‰</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">dp</span><span class="params">(sum, <span class="literal">false</span>)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = sum; i &gt;= num; --i) &#123;  <span class="comment">// ä»åå¾€å‰</span></span><br><span class="line">        dp[i] = dp[i] || dp[i - num];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="dp-wen-ti-fen-lei" tabindex="-1" id="DPé—®é¢˜åˆ†ç±»">DPé—®é¢˜åˆ†ç±»</h2><h3 id="xian-xing-dp" tabindex="-1" id="çº¿æ€§DP">çº¿æ€§DP</h3><pre><code class="highlight mermaid">graph LR    A[çº¿æ€§DP] --&gt; B[çˆ¬æ¥¼æ¢¯]    A --&gt; C[æ‰“å®¶åŠ«èˆ]    A --&gt; D[æœ€å¤§å­æ•°ç»„å’Œ]    A --&gt; E[æœ€é•¿é€’å¢å­åºåˆ—]        style A fill:#FFE4B5    style B fill:#90EE90</code></pre><p><strong>ç‰¹ç‚¹</strong>ï¼šé—®é¢˜æŒ‰æŸç§é¡ºåºæ’åˆ—ï¼ŒçŠ¶æ€è½¬ç§»æœ‰æ˜ç¡®æ–¹å‘</p><h3 id="bei-bao-dp" tabindex="-1" id="èƒŒåŒ…DP">èƒŒåŒ…DP</h3><pre><code class="highlight mermaid">graph LR    A[èƒŒåŒ…DP] --&gt; B[åˆ†å‰²ç­‰å’Œå­é›†]    A --&gt; C[é›¶é’±å…‘æ¢]    A --&gt; D[å®Œå…¨å¹³æ–¹æ•°]        style A fill:#87CEEB</code></pre><p><strong>ç‰¹ç‚¹</strong>ï¼šé€‰æˆ–ä¸é€‰çš„é—®é¢˜</p><h3 id="xu-lie-dp" tabindex="-1" id="åºåˆ—DP">åºåˆ—DP</h3><pre><code class="highlight mermaid">graph LR    A[åºåˆ—DP] --&gt; B[å•è¯æ‹†åˆ†]    A --&gt; C[è§£ç æ–¹æ³•]        style A fill:#DDA0DD</code></pre><p><strong>ç‰¹ç‚¹</strong>ï¼šå­—ç¬¦ä¸²ã€åºåˆ—ç›¸å…³</p><hr><h2 id="si-wei-dao-tu" tabindex="-1" id="æ€ç»´å¯¼å›¾">æ€ç»´å¯¼å›¾</h2><pre><code class="highlight mermaid">graph TD    A[ä¸€ç»´DP] --&gt; B[æ ¸å¿ƒè¦ç´ ]    A --&gt; C[ç»å…¸é—®é¢˜]    A --&gt; D[ä¼˜åŒ–æŠ€å·§]        B --&gt; B1[çŠ¶æ€å®šä¹‰]    B --&gt; B2[çŠ¶æ€è½¬ç§»æ–¹ç¨‹]    B --&gt; B3[åˆå§‹åŒ–]    B --&gt; B4[è®¡ç®—é¡ºåº]        C --&gt; C1[çˆ¬æ¥¼æ¢¯]    C --&gt; C2[æ‰“å®¶åŠ«èˆ]    C --&gt; C3[æœ€é•¿é€’å¢å­åºåˆ—]    C --&gt; C4[èƒŒåŒ…é—®é¢˜]        D --&gt; D1[æ»šåŠ¨æ•°ç»„]    D --&gt; D2[ç©ºé—´ä¼˜åŒ–]    D --&gt; D3[è®°å¿†åŒ–æœç´¢]        style A fill:#FFE4B5    style C fill:#90EE90    style D fill:#87CEEB</code></pre><hr><h2 id="jie-ti-tao-lu" tabindex="-1" id="è§£é¢˜å¥—è·¯">è§£é¢˜å¥—è·¯</h2><h3 id="1-shi-bie-dp-wen-ti" tabindex="-1" id="1-è¯†åˆ«DPé—®é¢˜">1. è¯†åˆ«DPé—®é¢˜</h3><p><strong>ä¿¡å·è¯</strong>ï¼š</p><ul><li>æœ€å¤§/æœ€å°å€¼</li><li>æœ‰å¤šå°‘ç§æ–¹æ³•</li><li>æ˜¯å¦å¯èƒ½</li><li>æœ€é•¿/æœ€çŸ­</li></ul><h3 id="2-jie-ti-bu-zou" tabindex="-1" id="2-è§£é¢˜æ­¥éª¤">2. è§£é¢˜æ­¥éª¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. å®šä¹‰çŠ¶æ€</span><br><span class="line">   - dp[i] è¡¨ç¤ºä»€ä¹ˆï¼Ÿ</span><br><span class="line">   - é€šå¸¸æ˜¯&quot;å‰iä¸ª&quot;æˆ–&quot;ä»¥iç»“å°¾&quot;</span><br><span class="line"></span><br><span class="line">2. æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span><br><span class="line">   - å½“å‰çŠ¶æ€å¦‚ä½•ä»ä¹‹å‰çš„çŠ¶æ€æ¨å¯¼ï¼Ÿ</span><br><span class="line">   - ç”»å›¾ã€åˆ—ä¸¾å°ä¾‹å­</span><br><span class="line"></span><br><span class="line">3. åˆå§‹åŒ–</span><br><span class="line">   - dp[0] æˆ– dp[1] çš„å€¼</span><br><span class="line">   - è¾¹ç•Œæ¡ä»¶</span><br><span class="line"></span><br><span class="line">4. ç¡®å®šè®¡ç®—é¡ºåº</span><br><span class="line">   - ä»å°åˆ°å¤§è¿˜æ˜¯ä»å¤§åˆ°å°ï¼Ÿ</span><br><span class="line">   - ä¸€ç»´è¿˜æ˜¯å¤šç»´éå†ï¼Ÿ</span><br><span class="line"></span><br><span class="line">5. è¿”å›ç»“æœ</span><br><span class="line">   - é€šå¸¸æ˜¯ dp[n] æˆ– max(dp)</span><br></pre></td></tr></table></figure><h3 id="3-kong-jian-you-hua-si-lu" tabindex="-1" id="3-ç©ºé—´ä¼˜åŒ–æ€è·¯">3. ç©ºé—´ä¼˜åŒ–æ€è·¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœ dp[i] åªä¾èµ–äºæœ‰é™ä¸ªä¹‹å‰çš„çŠ¶æ€ï¼š</span><br><span class="line">â†’ ç”¨æ»šåŠ¨å˜é‡ä»£æ›¿æ•°ç»„</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯èƒŒåŒ…ç±»é—®é¢˜ï¼š</span><br><span class="line">â†’ ä»åå¾€å‰éå†ï¼Œä¸€ç»´æ•°ç»„å³å¯</span><br></pre></td></tr></table></figure><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>DP = è®°å¿†åŒ–é€’å½’</strong>ï¼šé¿å…é‡å¤è®¡ç®—</li><li><strong>çŠ¶æ€å®šä¹‰æœ€å…³é”®</strong>ï¼šå®šä¹‰æ¸…æ¥šäº†å°±æˆåŠŸä¸€åŠ</li><li><strong>ç”»å›¾æ‰¾è§„å¾‹</strong>ï¼šå°ä¾‹å­æ¨å¯¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹</li><li><strong>ç©ºé—´å¯ä¼˜åŒ–</strong>ï¼šæ»šåŠ¨æ•°ç»„é™ä½ç©ºé—´å¤æ‚åº¦</li></ol><h3 id="dai-ma-mo-ban" tabindex="-1" id="ä»£ç æ¨¡æ¿">ä»£ç æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ç»´DPé€šç”¨æ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="comment">/* è¾“å…¥å‚æ•° */</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. çŠ¶æ€å®šä¹‰</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–</span></span><br><span class="line">    dp[<span class="number">0</span>] = ...;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. çŠ¶æ€è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="comment">/* æšä¸¾å†³ç­– */</span>) &#123;</span><br><span class="line">            dp[i] = <span class="comment">/* è½¬ç§»æ–¹ç¨‹ */</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="tui-jian-ti-mu" tabindex="-1" id="æ¨èé¢˜ç›®">æ¨èé¢˜ç›®</h3><p><strong>å…¥é—¨çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/climbing-stairs/">LeetCode 70 - çˆ¬æ¥¼æ¢¯</a></li><li><a href="https://leetcode.com/problems/house-robber/">LeetCode 198 - æ‰“å®¶åŠ«èˆ</a></li><li><a href="https://leetcode.com/problems/maximum-subarray/">LeetCode 53 - æœ€å¤§å­æ•°ç»„å’Œ</a></li></ul><p><strong>è¿›é˜¶çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/longest-increasing-subsequence/">LeetCode 300 - æœ€é•¿é€’å¢å­åºåˆ—</a></li><li><a href="https://leetcode.com/problems/word-break/">LeetCode 139 - å•è¯æ‹†åˆ†</a></li><li><a href="https://leetcode.com/problems/perfect-squares/">LeetCode 279 - å®Œå…¨å¹³æ–¹æ•°</a></li></ul><p><strong>é«˜çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/partition-equal-subset-sum/">LeetCode 416 - åˆ†å‰²ç­‰å’Œå­é›†</a></li><li><a href="https://leetcode.com/problems/coin-change/">LeetCode 322 - é›¶é’±å…‘æ¢</a></li><li><a href="https://leetcode.com/problems/maximum-product-subarray/">LeetCode 152 - ä¹˜ç§¯æœ€å¤§å­æ•°ç»„</a></li></ul><p><strong>æ¨èé˜…è¯»</strong>ï¼š</p><ul><li><a href="https://labuladong.github.io/algo/">åŠ¨æ€è§„åˆ’å¥—è·¯è¯¦è§£ - labuladong</a></li><li><a href="https://book.douban.com/subject/20432061/">ã€Šç®—æ³•å¯¼è®ºã€‹ç¬¬15ç« ï¼šåŠ¨æ€è§„åˆ’</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;yi-wei-dong-tai-gui-hua-hua-fan-wei-jian-de-zhi-hui&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ç®—æ³•è®¾è®¡" scheme="https://smarter.xin/tags/algorithm-design/"/>
    
    <category term="åŠ¨æ€è§„åˆ’" scheme="https://smarter.xin/tags/dynamic-programming/"/>
    
    <category term="DP" scheme="https://smarter.xin/tags/DP/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-æ•°å­¦æŠ€å·§</title>
    <link href="https://smarter.xin/posts/e33b4520/"/>
    <id>https://smarter.xin/posts/e33b4520/</id>
    <published>2026-01-06T13:14:20.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="shu-xue-suan-fa-bian-cheng-zhong-de-shu-xue-mo-fa" tabindex="-1">æ•°å­¦ç®—æ³•ï¼šç¼–ç¨‹ä¸­çš„æ•°å­¦é­”æ³•</h1><blockquote><p>å½“ç®—æ³•é‡ä¸Šæ•°å­¦ï¼Œç®€æ´è€Œä¼˜é›…</p></blockquote><hr><h2 id="yin-yan" tabindex="-1" id="å¼•è¨€">å¼•è¨€</h2><p>åœ¨ç®—æ³•ä¸–ç•Œé‡Œï¼Œæ•°å­¦ä¸ä»…ä»…æ˜¯å…¬å¼å’Œå®šç†ï¼Œæ›´æ˜¯è§£å†³é—®é¢˜çš„å¼ºå¤§å·¥å…·ã€‚å¾ˆå¤šçœ‹ä¼¼å¤æ‚çš„é—®é¢˜ï¼Œåªè¦æ‰¾åˆ°èƒŒåçš„æ•°å­¦è§„å¾‹ï¼Œå¾€å¾€èƒ½ç”¨å¯¥å¯¥å‡ è¡Œä»£ç ä¼˜é›…åœ°è§£å†³ã€‚</p><p><strong>æœ¬æ–‡æ¶µç›–</strong>ï¼š</p><ul><li>è´¨æ•°ä¸å› æ•°åˆ†è§£</li><li>æœ€å¤§å…¬çº¦æ•°ä¸æœ€å°å…¬å€æ•°</li><li>å¿«é€Ÿå¹‚ä¸æ¨¡è¿ç®—</li><li>æ•°å­¦è§„å¾‹ä¸æ‰¾è§„å¾‹é—®é¢˜</li><li>ç»„åˆæ•°å­¦åŸºç¡€</li></ul><hr><h2 id="yi-zhi-shu-xiang-guan" tabindex="-1" id="ä¸€ã€è´¨æ•°ç›¸å…³">ä¸€ã€è´¨æ•°ç›¸å…³</h2><h3 id="1-1-pan-duan-zhi-shu" tabindex="-1" id="1-1-åˆ¤æ–­è´¨æ•°">1.1 åˆ¤æ–­è´¨æ•°</h3><blockquote><p><strong>è´¨æ•°</strong>ï¼šå¤§äº1çš„è‡ªç„¶æ•°ä¸­ï¼Œåªèƒ½è¢«1å’Œè‡ªå·±æ•´é™¤çš„æ•°</p></blockquote><h4 id="fang-fa-1-shi-chu-fa-ji-chu" tabindex="-1" id="æ–¹æ³•1ï¼šè¯•é™¤æ³•ï¼ˆåŸºç¡€ï¼‰">æ–¹æ³•1ï¼šè¯•é™¤æ³•ï¼ˆåŸºç¡€ï¼‰</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPrime</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// æ’é™¤å¶æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i * i &lt;= n; i += <span class="number">2</span>) &#123;  <span class="comment">// åªæ£€æŸ¥å¥‡æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‚¹</strong>ï¼š</p><ul><li>åªéœ€æ£€æŸ¥åˆ°âˆšn</li><li>è·³è¿‡å¶æ•°ï¼Œåªæ£€æŸ¥å¥‡æ•°</li></ul><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(âˆšn)</p><h4 id="wei-shi-yao-zhi-xu-yao-jian-cha-dao-n" tabindex="-1" id="ä¸ºä»€ä¹ˆåªéœ€è¦æ£€æŸ¥åˆ°âˆšnï¼Ÿ">ä¸ºä»€ä¹ˆåªéœ€è¦æ£€æŸ¥åˆ°âˆšnï¼Ÿ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ n = a Ã— b</span><br><span class="line">å¦‚æœ a å’Œ b éƒ½å¤§äºâˆšnï¼š</span><br><span class="line">  a Ã— b &gt; âˆšn Ã— âˆšn = nï¼ˆçŸ›ç›¾ï¼ï¼‰</span><br><span class="line">  </span><br><span class="line">æ‰€ä»¥å¿…æœ‰ä¸€ä¸ªå› æ•° â‰¤ âˆšn</span><br><span class="line"></span><br><span class="line">ä¾‹å­ï¼š36 = 6 Ã— 6</span><br><span class="line">    å¦‚æœå­˜åœ¨å› æ•°ï¼Œå¿…æœ‰ä¸€ä¸ª â‰¤ 6</span><br></pre></td></tr></table></figure><hr><h3 id="1-2-ai-la-tuo-si-te-ni-shai-fa-sieve-of-eratosthenes" tabindex="-1" id="1-2-åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•ï¼ˆSieve-of-Eratosthenesï¼‰">1.2 åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•ï¼ˆSieve of Eratosthenesï¼‰</h3><blockquote><p><strong>LeetCode 204</strong>ï¼šç»Ÿè®¡æ‰€æœ‰å°äºéè´Ÿæ•´æ•° n çš„è´¨æ•°çš„æ•°é‡</p></blockquote><h4 id="wen-ti-fen-xi" tabindex="-1" id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 10</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šå°äº10çš„è´¨æ•°æœ‰ 2, 3, 5, 7</span><br></pre></td></tr></table></figure><h4 id="suan-fa-si-lu-shai-fa" tabindex="-1" id="ç®—æ³•æ€è·¯ï¼šç­›æ³•">ç®—æ³•æ€è·¯ï¼šç­›æ³•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä»2å¼€å§‹ï¼Œæ ‡è®°2çš„æ‰€æœ‰å€æ•°ä¸ºåˆæ•°</span><br><span class="line">ä»3å¼€å§‹ï¼Œæ ‡è®°3çš„æ‰€æœ‰å€æ•°ä¸ºåˆæ•°</span><br><span class="line">ä»5å¼€å§‹ï¼Œæ ‡è®°5çš„æ‰€æœ‰å€æ•°ä¸ºåˆæ•°</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">å‰©ä¸‹æœªè¢«æ ‡è®°çš„å°±æ˜¯è´¨æ•°</span><br></pre></td></tr></table></figure><h4 id="ke-shi-hua-guo-cheng" tabindex="-1" id="å¯è§†åŒ–è¿‡ç¨‹">å¯è§†åŒ–è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">n = 20</span><br><span class="line"></span><br><span class="line">åˆå§‹ï¼š[2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</span><br><span class="line"></span><br><span class="line">æ ‡è®°2çš„å€æ•°ï¼š</span><br><span class="line">  [2, 3, âœ—, 5, âœ—, 7, âœ—, 9, âœ—, 11, âœ—, 13, âœ—, 15, âœ—, 17, âœ—, 19]</span><br><span class="line">   4,6,8,10,12,14,16,18è¢«æ ‡è®°</span><br><span class="line"></span><br><span class="line">æ ‡è®°3çš„å€æ•°ï¼š</span><br><span class="line">  [2, 3, âœ—, 5, âœ—, 7, âœ—, âœ—, âœ—, 11, âœ—, 13, âœ—, âœ—, âœ—, 17, âœ—, 19]</span><br><span class="line">   9,15ä¹Ÿè¢«æ ‡è®°</span><br><span class="line"></span><br><span class="line">æ ‡è®°5çš„å€æ•°ï¼š</span><br><span class="line">  [2, 3, âœ—, 5, âœ—, 7, âœ—, âœ—, âœ—, 11, âœ—, 13, âœ—, âœ—, âœ—, 17, âœ—, 19]</span><br><span class="line">   ï¼ˆ10,15,20å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼‰</span><br><span class="line"></span><br><span class="line">è´¨æ•°ï¼š2, 3, 5, 7, 11, 13, 17, 19</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">countPrimes</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">isPrime</span><span class="params">(n, <span class="literal">true</span>)</span></span>;</span><br><span class="line">    isPrime[<span class="number">0</span>] = isPrime[<span class="number">1</span>] = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªéœ€è¦ä»2éå†åˆ°âˆšn</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPrime[i]) &#123;</span><br><span class="line">            <span class="comment">// æ ‡è®°içš„æ‰€æœ‰å€æ•°ä¸ºåˆæ•°</span></span><br><span class="line">            <span class="comment">// ä¼˜åŒ–ï¼šä»i*iå¼€å§‹ï¼Œå› ä¸ºi*(i-1)å·²ç»è¢«æ›´å°çš„è´¨æ•°æ ‡è®°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i * i; j &lt; n; j += i) &#123;</span><br><span class="line">                isPrime[j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»Ÿè®¡è´¨æ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPrime[i]) count++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log log n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p><h4 id="you-hua-ji-qiao" tabindex="-1" id="ä¼˜åŒ–æŠ€å·§">ä¼˜åŒ–æŠ€å·§</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–1ï¼šä»i*iå¼€å§‹æ ‡è®°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = i * i; j &lt; n; j += i)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–2ï¼šè·³è¿‡å¶æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i * i &lt; n; i += <span class="number">2</span>)</span><br></pre></td></tr></table></figure><hr><h3 id="1-3-fen-jie-zhi-yin-shu" tabindex="-1" id="1-3-åˆ†è§£è´¨å› æ•°">1.3 åˆ†è§£è´¨å› æ•°</h3><blockquote><p>å°†ä¸€ä¸ªæ­£æ•´æ•°åˆ†è§£æˆè´¨æ•°çš„ä¹˜ç§¯</p></blockquote><h4 id="wen-ti-shi-li" tabindex="-1" id="é—®é¢˜ç¤ºä¾‹">é—®é¢˜ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š12</span><br><span class="line">è¾“å‡ºï¼š2^2 Ã— 3 = [2, 2, 3]</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š315</span><br><span class="line">è¾“å‡ºï¼š3^2 Ã— 5 Ã— 7 = [3, 3, 5, 7]</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-1" tabindex="-1" id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">primeFactorization</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; factors;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å› æ•°2</span></span><br><span class="line">    <span class="keyword">while</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        factors.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">        n /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†å¥‡æ•°å› æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i * i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">            factors.<span class="built_in">push_back</span>(i);</span><br><span class="line">            n /= i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœnå¤§äº1ï¼Œè¯´æ˜næœ¬èº«æ˜¯è´¨æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        factors.<span class="built_in">push_back</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> factors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹æ‰§è¡Œ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = 60</span><br><span class="line"></span><br><span class="line">å¤„ç†2ï¼š60 / 2 = 30, 30 / 2 = 15</span><br><span class="line">       factors = [2, 2]</span><br><span class="line"></span><br><span class="line">å¤„ç†3ï¼š15 / 3 = 5</span><br><span class="line">       factors = [2, 2, 3]</span><br><span class="line"></span><br><span class="line">å¤„ç†5ï¼š5æ˜¯è´¨æ•°ï¼Œç›´æ¥åŠ å…¥</span><br><span class="line">       factors = [2, 2, 3, 5]</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š60 = 2^2 Ã— 3 Ã— 5</span><br></pre></td></tr></table></figure><hr><h2 id="er-zui-da-gong-yue-shu-gcd-yu-zui-xiao-gong-bei-shu-lcm" tabindex="-1" id="äºŒã€æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰ä¸æœ€å°å…¬å€æ•°ï¼ˆLCMï¼‰">äºŒã€æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰ä¸æœ€å°å…¬å€æ•°ï¼ˆLCMï¼‰</h2><h3 id="2-1-zui-da-gong-yue-shu-gcd" tabindex="-1" id="2-1-æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰">2.1 æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰</h3><blockquote><p>ä¸¤ä¸ªæˆ–å¤šä¸ªæ•´æ•°å…±æœ‰çº¦æ•°ä¸­æœ€å¤§çš„ä¸€ä¸ª</p></blockquote><h4 id="ou-ji-li-de-suan-fa-zhan-zhuan-xiang-chu-fa" tabindex="-1" id="æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰">æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰</h4><p><strong>æ•°å­¦åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcd(a, b) = gcd(b, a % b)</span><br><span class="line">gcd(a, 0) = a</span><br></pre></td></tr></table></figure><p><strong>å¯è§†åŒ–</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gcd(48, 18)</span><br><span class="line">= gcd(18, 48 % 18)</span><br><span class="line">= gcd(18, 12)</span><br><span class="line">= gcd(12, 18 % 12)</span><br><span class="line">= gcd(12, 6)</span><br><span class="line">= gcd(6, 12 % 6)</span><br><span class="line">= gcd(6, 0)</span><br><span class="line">= 6</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-2" tabindex="-1" id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> temp = b;</span><br><span class="line">        b = a % b;</span><br><span class="line">        a = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17æ ‡å‡†åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="type">int</span> result = std::<span class="built_in">gcd</span>(a, b);</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log min(a, b))</p><hr><h3 id="2-2-zui-xiao-gong-bei-shu-lcm" tabindex="-1" id="2-2-æœ€å°å…¬å€æ•°ï¼ˆLCMï¼‰">2.2 æœ€å°å…¬å€æ•°ï¼ˆLCMï¼‰</h3><blockquote><p>ä¸¤ä¸ªæˆ–å¤šä¸ªæ•´æ•°å…¬æœ‰çš„å€æ•°ä¸­æœ€å°çš„ä¸€ä¸ª</p></blockquote><h4 id="shu-xue-guan-xi" tabindex="-1" id="æ•°å­¦å…³ç³»">æ•°å­¦å…³ç³»</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lcm(a, b) = (a Ã— b) / gcd(a, b)</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-3" tabindex="-1" id="ä»£ç å®ç°-4">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">lcm</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…ˆé™¤åä¹˜ï¼Œé¿å…æº¢å‡º</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="type">long</span> <span class="type">long</span>)a / <span class="built_in">gcd</span>(a, b) * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17æ ‡å‡†åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> result = std::<span class="built_in">lcm</span>(a, b);</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè¦é˜²æ­¢æ•´æ•°æº¢å‡ºï¼</p><hr><h3 id="2-3-ying-yong-jian-hua-fen-shu" tabindex="-1" id="2-3-åº”ç”¨ï¼šç®€åŒ–åˆ†æ•°">2.3 åº”ç”¨ï¼šç®€åŒ–åˆ†æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Fraction</span> &#123;</span><br><span class="line">    <span class="type">int</span> numerator;    <span class="comment">// åˆ†å­</span></span><br><span class="line">    <span class="type">int</span> denominator;  <span class="comment">// åˆ†æ¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">simplify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> g = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(numerator), <span class="built_in">abs</span>(denominator));</span><br><span class="line">        numerator /= g;</span><br><span class="line">        denominator /= g;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¡®ä¿åˆ†æ¯ä¸ºæ­£</span></span><br><span class="line">        <span class="keyword">if</span> (denominator &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            numerator = -numerator;</span><br><span class="line">            denominator = -denominator;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">12/18 ç®€åŒ–ï¼š</span><br><span class="line">gcd(12, 18) = 6</span><br><span class="line">12/6 = 2, 18/6 = 3</span><br><span class="line">ç»“æœï¼š2/3</span><br></pre></td></tr></table></figure><hr><h2 id="san-kuai-su-mi-yu-mo-yun-suan" tabindex="-1" id="ä¸‰ã€å¿«é€Ÿå¹‚ä¸æ¨¡è¿ç®—">ä¸‰ã€å¿«é€Ÿå¹‚ä¸æ¨¡è¿ç®—</h2><h3 id="3-1-kuai-su-mi-leet-code-50" tabindex="-1" id="3-1-å¿«é€Ÿå¹‚ï¼ˆLeetCode-50ï¼‰">3.1 å¿«é€Ÿå¹‚ï¼ˆLeetCode 50ï¼‰</h3><blockquote><p>è®¡ç®— x^nï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦ O(log n)</p></blockquote><h4 id="bao-li-fang-fa" tabindex="-1" id="æš´åŠ›æ–¹æ³•">æš´åŠ›æ–¹æ³•</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// O(n)</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">pow</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        result *= x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼šnå¾ˆå¤§æ—¶å¤ªæ…¢</p><h4 id="kuai-su-mi-fen-zhi" tabindex="-1" id="å¿«é€Ÿå¹‚ï¼ˆåˆ†æ²»ï¼‰">å¿«é€Ÿå¹‚ï¼ˆåˆ†æ²»ï¼‰</h4><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x^8 = (x^4)^2 = ((x^2)^2)^2</span><br><span class="line"></span><br><span class="line">x^n = (x^(n/2))^2        (nä¸ºå¶æ•°)</span><br><span class="line">x^n = x Ã— (x^(n/2))^2     (nä¸ºå¥‡æ•°)</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">è®¡ç®— 2^10ï¼š</span><br><span class="line"></span><br><span class="line">2^10 = (2^5)^2</span><br><span class="line">2^5 = 2 Ã— (2^2)^2</span><br><span class="line">2^2 = (2^1)^2</span><br><span class="line">2^1 = 2</span><br><span class="line"></span><br><span class="line">åå‘è®¡ç®—ï¼š</span><br><span class="line">2^1 = 2</span><br><span class="line">2^2 = 2 Ã— 2 = 4</span><br><span class="line">2^5 = 2 Ã— 4^2 = 2 Ã— 16 = 32</span><br><span class="line">2^10 = 32^2 = 1024</span><br><span class="line"></span><br><span class="line">åªéœ€è¦4æ¬¡ä¹˜æ³•ï¼ï¼ˆæš´åŠ›éœ€è¦9æ¬¡ï¼‰</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-di-gui-ban" tabindex="-1" id="ä»£ç å®ç°ï¼ˆé€’å½’ç‰ˆï¼‰">ä»£ç å®ç°ï¼ˆé€’å½’ç‰ˆï¼‰</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">myPow</span><span class="params">(<span class="type">double</span> x, <span class="type">long</span> <span class="type">long</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        x = <span class="number">1</span> / x;</span><br><span class="line">        n = -n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fastPow</span>(x, n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">fastPow</span><span class="params">(<span class="type">double</span> x, <span class="type">long</span> <span class="type">long</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">double</span> half = <span class="built_in">fastPow</span>(x, n / <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> half * half;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> half * half * x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-die-dai-ban-tui-jian" tabindex="-1" id="ä»£ç å®ç°ï¼ˆè¿­ä»£ç‰ˆï¼Œæ¨èï¼‰">ä»£ç å®ç°ï¼ˆè¿­ä»£ç‰ˆï¼Œæ¨èï¼‰</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">myPow</span><span class="params">(<span class="type">double</span> x, <span class="type">long</span> <span class="type">long</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        x = <span class="number">1</span> / x;</span><br><span class="line">        n = -n;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">double</span> result = <span class="number">1.0</span>;</span><br><span class="line">    <span class="type">double</span> current = x;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;  <span class="comment">// næ˜¯å¥‡æ•°</span></span><br><span class="line">            result *= current;</span><br><span class="line">        &#125;</span><br><span class="line">        current *= current;  <span class="comment">// current = x^(2^i)</span></span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p><hr><h3 id="3-2-mo-yun-suan-xia-de-kuai-su-mi" tabindex="-1" id="3-2-æ¨¡è¿ç®—ä¸‹çš„å¿«é€Ÿå¹‚">3.2 æ¨¡è¿ç®—ä¸‹çš„å¿«é€Ÿå¹‚</h3><blockquote><p><strong>LeetCode 1969</strong>ï¼šè¶…çº§æ¬¡æ–¹</p></blockquote><h4 id="mo-yun-suan-xing-zhi" tabindex="-1" id="æ¨¡è¿ç®—æ€§è´¨">æ¨¡è¿ç®—æ€§è´¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(a Ã— b) % p = ((a % p) Ã— (b % p)) % p</span><br><span class="line">(a + b) % p = ((a % p) + (b % p)) % p</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-4" tabindex="-1" id="ä»£ç å®ç°-5">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">powMod</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x, <span class="type">long</span> <span class="type">long</span> n, <span class="type">long</span> <span class="type">long</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> result = <span class="number">1</span>;</span><br><span class="line">    x %= mod;  <span class="comment">// å…ˆå–æ¨¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            result = (result * x) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        x = (x * x) % mod;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨</strong>ï¼šè®¡ç®—å¤§æ•°çš„å¹‚æ¬¡ï¼Œé˜²æ­¢æº¢å‡º</p><hr><h2 id="si-shu-xue-gui-lu-wen-ti" tabindex="-1" id="å››ã€æ•°å­¦è§„å¾‹é—®é¢˜">å››ã€æ•°å­¦è§„å¾‹é—®é¢˜</h2><h3 id="4-1-jie-cheng-mo-wei-ling-de-ge-shu-leet-code-172" tabindex="-1" id="4-1-é˜¶ä¹˜æœ«å°¾é›¶çš„ä¸ªæ•°ï¼ˆLeetCode-172ï¼‰">4.1 é˜¶ä¹˜æœ«å°¾é›¶çš„ä¸ªæ•°ï¼ˆLeetCode 172ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å› n! ç»“æœå°¾æ•°ä¸­é›¶çš„æ•°é‡</p></blockquote><h4 id="fen-xi" tabindex="-1" id="åˆ†æ">åˆ†æ</h4><p>æœ«å°¾çš„0æ¥è‡ªäº 2 Ã— 5ï¼Œå› å­2çš„æ•°é‡æ€»æ˜¯æ¯”5å¤šï¼Œæ‰€ä»¥åªéœ€è¦æ•°5çš„ä¸ªæ•°ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5! = 120 â†’ 1ä¸ª0ï¼ˆä¸€ä¸ª5ï¼‰</span><br><span class="line">10! = 3628800 â†’ 2ä¸ª0ï¼ˆä¸¤ä¸ª5ï¼š5å’Œ10ï¼‰</span><br><span class="line">25! â†’ è‡³å°‘6ä¸ª0ï¼ˆ5,10,15,20,25Ã—2ï¼‰</span><br></pre></td></tr></table></figure><h4 id="shu-5-de-ge-shu" tabindex="-1" id="æ•°5çš„ä¸ªæ•°">æ•°5çš„ä¸ªæ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n / 5ï¼šæœ‰å¤šå°‘ä¸ª5çš„å€æ•°</span><br><span class="line">n / 25ï¼šæœ‰å¤šå°‘ä¸ª25çš„å€æ•°ï¼ˆé¢å¤–è´¡çŒ®ä¸€ä¸ª5ï¼‰</span><br><span class="line">n / 125ï¼šæœ‰å¤šå°‘ä¸ª125çš„å€æ•°ï¼ˆé¢å¤–è´¡çŒ®ä¸€ä¸ª5ï¼‰</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-5" tabindex="-1" id="ä»£ç å®ç°-6">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">trailingZeroes</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        n /= <span class="number">5</span>;</span><br><span class="line">        count += n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = 25</span><br><span class="line"></span><br><span class="line">ç¬¬1è½®ï¼šn = 25 / 5 = 5, count = 5</span><br><span class="line">ç¬¬2è½®ï¼šn = 5 / 5 = 1, count = 6</span><br><span class="line">ç¬¬3è½®ï¼šn = 1 / 5 = 0, ç»“æŸ</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š6ä¸ª0</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p><hr><h3 id="4-2-shu-zi-1-de-ge-shu-leet-code-233" tabindex="-1" id="4-2-æ•°å­—1çš„ä¸ªæ•°ï¼ˆLeetCode-233ï¼‰">4.2 æ•°å­—1çš„ä¸ªæ•°ï¼ˆLeetCode 233ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè®¡ç®—æ‰€æœ‰å°äºç­‰äº n çš„éè´Ÿæ•´æ•°ä¸­æ•°å­— 1 å‡ºç°çš„æ¬¡æ•°</p></blockquote><h4 id="wen-ti-shi-li-1" tabindex="-1" id="é—®é¢˜ç¤ºä¾‹-2">é—®é¢˜ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 13</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line">è§£é‡Šï¼š1, 10, 11(2ä¸ª), 12, 13 â†’ å…±6ä¸ª1</span><br></pre></td></tr></table></figure><h4 id="shu-wei-dp-si-lu" tabindex="-1" id="æ•°ä½DPæ€è·¯">æ•°ä½DPæ€è·¯</h4><p>æŒ‰ä½ç»Ÿè®¡ï¼šä¸ªä½ã€åä½ã€ç™¾ä½â€¦å„æœ‰å¤šå°‘ä¸ª1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äº n = 234ï¼Œç»Ÿè®¡åä½ä¸Š1çš„ä¸ªæ•°ï¼š</span><br><span class="line"></span><br><span class="line">å½“åä½ä¸º1æ—¶ï¼Œå¯èƒ½çš„æ•°å­—ï¼š</span><br><span class="line">- 010-019ï¼ˆç™¾ä½ä¸º0ï¼‰</span><br><span class="line">- 110-119ï¼ˆç™¾ä½ä¸º1ï¼‰</span><br><span class="line">- 210-219ï¼ˆç™¾ä½ä¸º2ï¼‰</span><br><span class="line">å…±ï¼š3 Ã— 10 = 30ä¸ª</span><br><span class="line"></span><br><span class="line">ä½†234çš„åä½æ˜¯3ï¼ˆâ‰ 1ï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹æ®Šå¤„ç†</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-6" tabindex="-1" id="ä»£ç å®ç°-7">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">countDigitOne</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> factor = <span class="number">1</span>;  <span class="comment">// å½“å‰ä½çš„æƒé‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (factor &lt;= n) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> higher = n / (factor * <span class="number">10</span>);  <span class="comment">// é«˜ä½æ•°å­—</span></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> cur = (n / factor) % <span class="number">10</span>;     <span class="comment">// å½“å‰ä½æ•°å­—</span></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> lower = n % factor;          <span class="comment">// ä½ä½æ•°å­—</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (cur == <span class="number">0</span>) &#123;</span><br><span class="line">            count += higher * factor;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cur == <span class="number">1</span>) &#123;</span><br><span class="line">            count += higher * factor + lower + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count += (higher + <span class="number">1</span>) * factor;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        factor *= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="4-3-chou-shu-leet-code-264" tabindex="-1" id="4-3-ä¸‘æ•°ï¼ˆLeetCode-264ï¼‰">4.3 ä¸‘æ•°ï¼ˆLeetCode 264ï¼‰</h3><blockquote><p>ä¸‘æ•°æ˜¯åªåŒ…å«è´¨å› æ•° 2, 3, 5 çš„æ­£æ•´æ•°</p></blockquote><h4 id="wen-ti" tabindex="-1" id="é—®é¢˜">é—®é¢˜</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šn = 10</span><br><span class="line">è¾“å‡ºï¼š12</span><br><span class="line">è§£é‡Šï¼š1,2,3,4,5,6,8,9,10,12æ˜¯å‰10ä¸ªä¸‘æ•°</span><br></pre></td></tr></table></figure><h4 id="dong-tai-gui-hua-san-zhi-zhen" tabindex="-1" id="åŠ¨æ€è§„åˆ’ï¼ˆä¸‰æŒ‡é’ˆï¼‰">åŠ¨æ€è§„åˆ’ï¼ˆä¸‰æŒ‡é’ˆï¼‰</h4><p><strong>æ€è·¯</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¯ä¸ªä¸‘æ•°éƒ½æ˜¯ä¹‹å‰çš„ä¸‘æ•° Ã— 2ã€Ã— 3 æˆ– Ã— 5 å¾—åˆ°çš„</span><br><span class="line">ç”¨ä¸‰ä¸ªæŒ‡é’ˆåˆ†åˆ«ç»´æŠ¤</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-7" tabindex="-1" id="ä»£ç å®ç°-8">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">nthUglyNumber</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> p2 = <span class="number">0</span>, p3 = <span class="number">0</span>, p5 = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> next2 = dp[p2] * <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> next3 = dp[p3] * <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> next5 = dp[p5] * <span class="number">5</span>;</span><br><span class="line">        </span><br><span class="line">        dp[i] = <span class="built_in">min</span>(&#123;next2, next3, next5&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å»é‡</span></span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next2) p2++;</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next3) p3++;</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next5) p5++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿‡ç¨‹æ¼”ç¤º</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹ï¼šdp[0] = 1</span><br><span class="line"></span><br><span class="line">i=1: next2=2, next3=3, next5=5 â†’ dp[1]=2, p2++</span><br><span class="line">i=2: next2=3, next3=3, next5=5 â†’ dp[2]=3, p2++, p3++</span><br><span class="line">i=3: next2=4, next3=6, next5=5 â†’ dp[3]=4, p2++</span><br><span class="line">i=4: next2=6, next3=6, next5=5 â†’ dp[4]=5, p5++</span><br><span class="line">i=5: next2=6, next3=6, next5=10 â†’ dp[5]=6, p2++, p3++</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ä¸‘æ•°åºåˆ—ï¼š1, 2, 3, 4, 5, 6, 8, 9, 10, 12...</span><br></pre></td></tr></table></figure><hr><h2 id="wu-zu-he-shu-xue" tabindex="-1" id="äº”ã€ç»„åˆæ•°å­¦">äº”ã€ç»„åˆæ•°å­¦</h2><h3 id="5-1-pa-si-qia-san-jiao-xing-leet-code-118" tabindex="-1" id="5-1-å¸•æ–¯å¡ä¸‰è§’å½¢ï¼ˆLeetCode-118ï¼‰">5.1 å¸•æ–¯å¡ä¸‰è§’å½¢ï¼ˆLeetCode 118ï¼‰</h3><blockquote><p>æ¨è¾‰ä¸‰è§’/å¸•æ–¯å¡ä¸‰è§’å½¢</p></blockquote><h4 id="ke-shi-hua" tabindex="-1" id="å¯è§†åŒ–">å¯è§†åŒ–</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">         1</span><br><span class="line">       1   1</span><br><span class="line">     1   2   1</span><br><span class="line">   1   3   3   1</span><br><span class="line"> 1   4   6   4   1</span><br><span class="line">1   5  10  10   5   1</span><br></pre></td></tr></table></figure><p><strong>è§„å¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¯ä¸ªæ•° = å·¦ä¸Šæ–¹çš„æ•° + å³ä¸Šæ–¹çš„æ•°</span><br><span class="line">C(n, k) = C(n-1, k-1) + C(n-1, k)</span><br></pre></td></tr></table></figure><h4 id="dai-ma-shi-xian-8" tabindex="-1" id="ä»£ç å®ç°-9">ä»£ç å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">generate</span>(<span class="type">int</span> numRows) &#123;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; triangle;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numRows; ++i) &#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">row</span><span class="params">(i + <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; i; ++j) &#123;</span><br><span class="line">            row[j] = triangle[i<span class="number">-1</span>][j<span class="number">-1</span>] + triangle[i<span class="number">-1</span>][j];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        triangle.<span class="built_in">push_back</span>(row);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> triangle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="5-2-zu-he-shu-ji-suan" tabindex="-1" id="5-2-ç»„åˆæ•°è®¡ç®—">5.2 ç»„åˆæ•°è®¡ç®—</h3><blockquote><p>è®¡ç®— C(n, k) = n! / (k! Ã— (n-k)!)</p></blockquote><h4 id="fang-fa-1-di-tui-gong-shi" tabindex="-1" id="æ–¹æ³•1ï¼šé€’æ¨å…¬å¼">æ–¹æ³•1ï¼šé€’æ¨å…¬å¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">combination</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &gt; n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span> || k == n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// C(n, k) = C(n-1, k-1) + C(n-1, k)</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(k + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &lt;= k) dp[i][i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; i &amp;&amp; j &lt;= k; ++j) &#123;</span><br><span class="line">            dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + dp[i<span class="number">-1</span>][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n][k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="fang-fa-2-zhi-jie-ji-suan-fang-yi-chu" tabindex="-1" id="æ–¹æ³•2ï¼šç›´æ¥è®¡ç®—ï¼ˆé˜²æº¢å‡ºï¼‰">æ–¹æ³•2ï¼šç›´æ¥è®¡ç®—ï¼ˆé˜²æº¢å‡ºï¼‰</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">combination</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &gt; n - k) k = n - k;  <span class="comment">// åˆ©ç”¨å¯¹ç§°æ€§</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        result = result * (n - i) / (i + <span class="number">1</span>);  <span class="comment">// è¾¹ä¹˜è¾¹é™¤ï¼Œé˜²æº¢å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="liu-qi-ta-shu-xue-ji-qiao" tabindex="-1" id="å…­ã€å…¶ä»–æ•°å­¦æŠ€å·§">å…­ã€å…¶ä»–æ•°å­¦æŠ€å·§</h2><h3 id="6-1-pan-duan-wan-quan-ping-fang-shu" tabindex="-1" id="6-1-åˆ¤æ–­å®Œå…¨å¹³æ–¹æ•°">6.1 åˆ¤æ–­å®Œå…¨å¹³æ–¹æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPerfectSquare</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (num &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> x = <span class="built_in">sqrt</span>(num);</span><br><span class="line">    <span class="keyword">return</span> x * x == num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒåˆ†æŸ¥æ‰¾ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPerfectSquare</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> left = <span class="number">0</span>, right = num;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> square = mid * mid;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (square == num) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (square &lt; num) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="6-2-zheng-shu-fan-zhuan-leet-code-7" tabindex="-1" id="6-2-æ•´æ•°åè½¬ï¼ˆLeetCode-7ï¼‰">6.2 æ•´æ•°åè½¬ï¼ˆLeetCode 7ï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> digit = x % <span class="number">10</span>;</span><br><span class="line">        x /= <span class="number">10</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥æº¢å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (result &gt; INT_MAX / <span class="number">10</span> || (result == INT_MAX / <span class="number">10</span> &amp;&amp; digit &gt; <span class="number">7</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (result &lt; INT_MIN / <span class="number">10</span> || (result == INT_MIN / <span class="number">10</span> &amp;&amp; digit &lt; <span class="number">-8</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        result = result * <span class="number">10</span> + digit;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="6-3-hui-wen-shu-leet-code-9" tabindex="-1" id="6-3-å›æ–‡æ•°ï¼ˆLeetCode-9ï¼‰">6.3 å›æ–‡æ•°ï¼ˆLeetCode 9ï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è´Ÿæ•°å’Œæœ«å°¾ä¸º0çš„æ•°ï¼ˆé™¤äº†0æœ¬èº«ï¼‰ä¸æ˜¯å›æ–‡</span></span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span> || (x % <span class="number">10</span> == <span class="number">0</span> &amp;&amp; x != <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> reversed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x &gt; reversed) &#123;</span><br><span class="line">        reversed = reversed * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">        x /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¥‡æ•°ä½ï¼šx == reversed / 10</span></span><br><span class="line">    <span class="comment">// å¶æ•°ä½ï¼šx == reversed</span></span><br><span class="line">    <span class="keyword">return</span> x == reversed || x == reversed / <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>è´¨æ•°åˆ¤æ–­</strong>ï¼šè¯•é™¤æ³• O(âˆšn)ï¼ŒåŸƒæ°ç­›æ³• O(n log log n)</li><li><strong>GCD</strong>ï¼šæ¬§å‡ é‡Œå¾—ç®—æ³• O(log min(a,b))</li><li><strong>å¿«é€Ÿå¹‚</strong>ï¼šåˆ†æ²»æ€æƒ³ï¼ŒO(log n)</li><li><strong>æ‰¾è§„å¾‹</strong>ï¼šè§‚å¯Ÿæ•°å­¦æ€§è´¨ï¼Œé™ä½å¤æ‚åº¦</li></ol><h3 id="chang-yong-mo-ban" tabindex="-1" id="å¸¸ç”¨æ¨¡æ¿">å¸¸ç”¨æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­è´¨æ•°</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPrime</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i * i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿«é€Ÿå¹‚</span></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">quickPow</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x, <span class="type">long</span> <span class="type">long</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) result *= x;</span><br><span class="line">        x *= x;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡è¿ç®—å¿«é€Ÿå¹‚</span></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">powMod</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x, <span class="type">long</span> <span class="type">long</span> n, <span class="type">long</span> <span class="type">long</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> result = <span class="number">1</span>;</span><br><span class="line">    x %= mod;</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) result = (result * x) % mod;</span><br><span class="line">        x = (x * x) % mod;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="tui-jian-ti-mu" tabindex="-1" id="æ¨èé¢˜ç›®">æ¨èé¢˜ç›®</h3><p><strong>å…¥é—¨çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/palindrome-number/">LeetCode 9 - å›æ–‡æ•°</a></li><li><a href="https://leetcode.com/problems/reverse-integer/">LeetCode 7 - æ•´æ•°åè½¬</a></li><li><a href="https://leetcode.com/problems/count-primes/">LeetCode 204 - è®¡æ•°è´¨æ•°</a></li></ul><p><strong>è¿›é˜¶çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/powx-n/">LeetCode 50 - Pow(x, n)</a></li><li><a href="https://leetcode.com/problems/factorial-trailing-zeroes/">LeetCode 172 - é˜¶ä¹˜åçš„é›¶</a></li><li><a href="https://leetcode.com/problems/ugly-number-ii/">LeetCode 264 - ä¸‘æ•° II</a></li></ul><p><strong>é«˜çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/number-of-digit-one/">LeetCode 233 - æ•°å­—1çš„ä¸ªæ•°</a></li><li><a href="https://leetcode.com/problems/consecutive-numbers-sum/">LeetCode 829 - è¿ç»­æ•´æ•°æ±‚å’Œ</a></li></ul><p><strong>æ¨èé˜…è¯»</strong>ï¼š</p><ul><li><a href="https://book.douban.com/subject/21323941/">ã€Šå…·ä½“æ•°å­¦ã€‹- Graham, Knuth, Patashnik</a></li><li><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E8%AE%BA">æ•°è®ºåŸºç¡€ - ç»´åŸºç™¾ç§‘</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;shu-xue-suan-fa-bian-cheng-zhong-de-shu-xue-mo-fa&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ç®—æ³•æŠ€å·§" scheme="https://smarter.xin/tags/algorithm-tricks/"/>
    
    <category term="æ•°å­¦" scheme="https://smarter.xin/tags/math/"/>
    
    <category term="è´¨æ•°" scheme="https://smarter.xin/tags/prime/"/>
    
    <category term="æœ€å¤§å…¬çº¦æ•°" scheme="https://smarter.xin/tags/gcd/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-ä½è¿ç®—</title>
    <link href="https://smarter.xin/posts/3609144b/"/>
    <id>https://smarter.xin/posts/3609144b/</id>
    <published>2026-01-06T12:11:53.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="wei-yun-suan-zai-er-jin-zhi-shi-jie-li-pian-pian-qi-wu" tabindex="-1">ä½è¿ç®—ï¼šåœ¨äºŒè¿›åˆ¶ä¸–ç•Œé‡Œç¿©ç¿©èµ·èˆ</h1><blockquote><p>å½“åˆ«äººè¿˜åœ¨ç”¨åŠ å‡ä¹˜é™¤æ—¶ï¼Œä½ å·²ç»åœ¨ç”¨ä¸æˆ–éå¼‚æˆ–äº†</p></blockquote><hr><h2 id="shi-yao-shi-wei-yun-suan" tabindex="-1" id="ä»€ä¹ˆæ˜¯ä½è¿ç®—">ä»€ä¹ˆæ˜¯ä½è¿ç®—</h2><p><strong>ä½è¿ç®—</strong>ï¼ˆBit Manipulationï¼‰æ˜¯ç›´æ¥å¯¹æ•´æ•°åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œçš„è¿ç®—æ–¹å¼ã€‚ç›¸æ¯”æ™®é€šçš„ç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—åœ¨æŸäº›åœºæ™¯ä¸‹é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœç©ºé—´ã€‚</p><blockquote><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šç›´æ¥æ“ä½œäºŒè¿›åˆ¶ä½ï¼Œæ•ˆç‡æé«˜</p></blockquote><h3 id="wei-shi-yao-yao-xue-wei-yun-suan" tabindex="-1" id="ä¸ºä»€ä¹ˆè¦å­¦ä½è¿ç®—ï¼Ÿ">ä¸ºä»€ä¹ˆè¦å­¦ä½è¿ç®—ï¼Ÿ</h3><pre><code class="highlight mermaid">graph LR    A[ä½è¿ç®—çš„ä¼˜åŠ¿] --&gt; B[é€Ÿåº¦å¿«]    A --&gt; C[çœç©ºé—´]    A --&gt; D[æŠ€å·§æ€§å¼º]    A --&gt; E[é¢è¯•å¸¸è€ƒ]        B --&gt; B1[CPUç›´æ¥æ”¯æŒ]    C --&gt; C1[ç”¨ä½è¡¨ç¤ºçŠ¶æ€]    D --&gt; D1[å·§å¦™è§£å†³é—®é¢˜]    E --&gt; E1[è€ƒå¯ŸåŸºæœ¬åŠŸ]        style A fill:#FFE4B5    style B fill:#90EE90    style D fill:#87CEEB</code></pre><hr><h2 id="ji-chu-wei-yun-suan-fu" tabindex="-1" id="åŸºç¡€ä½è¿ç®—ç¬¦">åŸºç¡€ä½è¿ç®—ç¬¦</h2><h3 id="liu-da-yun-suan-fu" tabindex="-1" id="å…­å¤§è¿ç®—ç¬¦">å…­å¤§è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>åç§°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>&amp;</code></td><td>æŒ‰ä½ä¸</td><td>ä¸¤ä½éƒ½ä¸º1æ‰ä¸º1</td><td><code>5 &amp; 3 = 1</code></td></tr><tr><td><code>|</code></td><td>æŒ‰ä½æˆ–</td><td>æœ‰ä¸€ä½ä¸º1å°±ä¸º1</td><td><code>5 | 3 = 7</code></td></tr><tr><td><code>^</code></td><td>æŒ‰ä½å¼‚æˆ–</td><td>ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1</td><td><code>5 ^ 3 = 6</code></td></tr><tr><td><code>~</code></td><td>æŒ‰ä½å–å</td><td>0å˜1ï¼Œ1å˜0</td><td><code>~5 = -6</code></td></tr><tr><td><code>&lt;&lt;</code></td><td>å·¦ç§»</td><td>å‘å·¦ç§»ä½ï¼Œå³è¾¹è¡¥0</td><td><code>5 &lt;&lt; 1 = 10</code></td></tr><tr><td><code>&gt;&gt;</code></td><td>å³ç§»</td><td>å‘å³ç§»ä½ï¼Œå·¦è¾¹è¡¥ç¬¦å·ä½</td><td><code>5 &gt;&gt; 1 = 2</code></td></tr></tbody></table><h3 id="yun-suan-fu-xiang-jie" tabindex="-1" id="è¿ç®—ç¬¦è¯¦è§£">è¿ç®—ç¬¦è¯¦è§£</h3><h4 id="1-an-wei-yu-amp" tabindex="-1" id="1-æŒ‰ä½ä¸ï¼ˆ-ï¼‰">1. æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼šä¸¤ä½éƒ½ä¸º1æ‰ä¸º1</span><br><span class="line"></span><br><span class="line">    5:  0101</span><br><span class="line">  &amp; 3:  0011</span><br><span class="line">  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">    1:  0001</span><br><span class="line"></span><br><span class="line">åº”ç”¨ï¼š</span><br><span class="line">- åˆ¤æ–­å¥‡å¶ï¼šn &amp; 1ï¼ˆæœ€ä½ä½ä¸º1æ˜¯å¥‡æ•°ï¼‰</span><br><span class="line">- æ¸…é›¶ç‰¹å®šä½</span><br><span class="line">- æå–ç‰¹å®šä½</span><br></pre></td></tr></table></figure><h4 id="2-an-wei-huo" tabindex="-1" id="2-æŒ‰ä½æˆ–ï¼ˆ-ï¼‰">2. æŒ‰ä½æˆ–ï¼ˆ|ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼šæœ‰ä¸€ä½ä¸º1å°±ä¸º1</span><br><span class="line"></span><br><span class="line">    5:  0101</span><br><span class="line">  | 3:  0011</span><br><span class="line">  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">    7:  0111</span><br><span class="line"></span><br><span class="line">åº”ç”¨ï¼š</span><br><span class="line">- è®¾ç½®ç‰¹å®šä½ä¸º1</span><br><span class="line">- åˆå¹¶æ ‡å¿—ä½</span><br></pre></td></tr></table></figure><h4 id="3-an-wei-yi-huo" tabindex="-1" id="3-æŒ‰ä½å¼‚æˆ–ï¼ˆ-ï¼‰â˜…">3. æŒ‰ä½å¼‚æˆ–ï¼ˆ^ï¼‰â˜…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼šç›¸åŒä¸º0ï¼Œä¸åŒä¸º1</span><br><span class="line"></span><br><span class="line">    5:  0101</span><br><span class="line">  ^ 3:  0011</span><br><span class="line">  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">    6:  0110</span><br><span class="line"></span><br><span class="line">ç¥å¥‡æ€§è´¨ï¼š</span><br><span class="line">1. a ^ a = 0ï¼ˆè‡ªå·±å¼‚æˆ–è‡ªå·±ç­‰äº0ï¼‰</span><br><span class="line">2. a ^ 0 = aï¼ˆä»»ä½•æ•°å¼‚æˆ–0ç­‰äºè‡ªå·±ï¼‰</span><br><span class="line">3. äº¤æ¢å¾‹ï¼ša ^ b = b ^ a</span><br><span class="line">4. ç»“åˆå¾‹ï¼ša ^ b ^ c = a ^ (b ^ c)</span><br></pre></td></tr></table></figure><h4 id="4-an-wei-qu-fan" tabindex="-1" id="4-æŒ‰ä½å–åï¼ˆ-ï¼‰">4. æŒ‰ä½å–åï¼ˆ~ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼š0å˜1ï¼Œ1å˜0</span><br><span class="line"></span><br><span class="line">  ~5:  ~0101 = 1010ï¼ˆè¡¥ç è¡¨ç¤ºä¸º-6ï¼‰</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šæ¶‰åŠåˆ°è¡¥ç ï¼Œè´Ÿæ•°è¡¨ç¤º</span><br></pre></td></tr></table></figure><h4 id="5-zuo-yi-lt-lt" tabindex="-1" id="5-å·¦ç§»ï¼ˆ-ï¼‰">5. å·¦ç§»ï¼ˆ&lt;&lt;ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼šå‘å·¦ç§»nä½ï¼Œç›¸å½“äºä¹˜ä»¥2^n</span><br><span class="line"></span><br><span class="line">5 &lt;&lt; 1:  0101 &lt;&lt; 1 = 1010 (10)</span><br><span class="line">5 &lt;&lt; 2:  0101 &lt;&lt; 2 = 10100 (20)</span><br><span class="line"></span><br><span class="line">è§„å¾‹ï¼šn &lt;&lt; k = n * 2^k</span><br></pre></td></tr></table></figure><h4 id="6-you-yi-gt-gt" tabindex="-1" id="6-å³ç§»ï¼ˆ-ï¼‰">6. å³ç§»ï¼ˆ&gt;&gt;ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è§„åˆ™ï¼šå‘å³ç§»nä½ï¼Œç›¸å½“äºé™¤ä»¥2^n</span><br><span class="line"></span><br><span class="line">5 &gt;&gt; 1:  0101 &gt;&gt; 1 = 0010 (2)</span><br><span class="line">5 &gt;&gt; 2:  0101 &gt;&gt; 2 = 0001 (1)</span><br><span class="line"></span><br><span class="line">è§„å¾‹ï¼šn &gt;&gt; k = n / 2^kï¼ˆå‘ä¸‹å–æ•´ï¼‰</span><br></pre></td></tr></table></figure><hr><h2 id="chang-jian-wei-yun-suan-ji-qiao" tabindex="-1" id="å¸¸è§ä½è¿ç®—æŠ€å·§">å¸¸è§ä½è¿ç®—æŠ€å·§</h2><h3 id="1-pan-duan-qi-ou" tabindex="-1" id="1-åˆ¤æ–­å¥‡å¶">1. åˆ¤æ–­å¥‡å¶</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹æ³•</span></span><br><span class="line"><span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">/* å¶æ•° */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½è¿ç®—ï¼ˆæ›´å¿«ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; <span class="comment">/* å¶æ•° */</span> &#125;</span><br><span class="line"><span class="keyword">if</span> (n &amp; <span class="number">1</span>) &#123; <span class="comment">/* å¥‡æ•° */</span> &#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šäºŒè¿›åˆ¶æœ€ä½ä½ä¸º0æ˜¯å¶æ•°ï¼Œä¸º1æ˜¯å¥‡æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4: 0100 &amp; 1 = 0 (å¶æ•°)</span><br><span class="line">5: 0101 &amp; 1 = 1 (å¥‡æ•°)</span><br></pre></td></tr></table></figure><hr><h3 id="2-jiao-huan-liang-ge-shu-bu-yong-lin-shi-bian-liang" tabindex="-1" id="2-äº¤æ¢ä¸¤ä¸ªæ•°ï¼ˆä¸ç”¨ä¸´æ—¶å˜é‡ï¼‰">2. äº¤æ¢ä¸¤ä¸ªæ•°ï¼ˆä¸ç”¨ä¸´æ—¶å˜é‡ï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹æ³•</span></span><br><span class="line"><span class="type">int</span> temp = a;</span><br><span class="line">a = b;</span><br><span class="line">b = temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½è¿ç®—ï¼ˆæ— éœ€ä¸´æ—¶å˜é‡ï¼‰</span></span><br><span class="line">a = a ^ b;</span><br><span class="line">b = a ^ b;  <span class="comment">// b = (a^b) ^ b = a</span></span><br><span class="line">a = a ^ b;  <span class="comment">// a = (a^b) ^ a = b</span></span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šåˆ©ç”¨å¼‚æˆ–çš„æ€§è´¨ <code>a ^ b ^ b = a</code></p><hr><h3 id="3-huo-qu-she-zhi-qing-chu-te-ding-wei" tabindex="-1" id="3-è·å–-è®¾ç½®-æ¸…é™¤ç‰¹å®šä½">3. è·å–/è®¾ç½®/æ¸…é™¤ç‰¹å®šä½</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ç¬¬kä½ï¼ˆä»0å¼€å§‹ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &gt;&gt; k) &amp; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç¬¬kä½ä¸º1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">setBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n | (<span class="number">1</span> &lt;&lt; k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…é™¤ç¬¬kä½ï¼ˆè®¾ä¸º0ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clearBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &amp; ~(<span class="number">1</span> &lt;&lt; k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡æ¢ç¬¬kä½ï¼ˆ0å˜1ï¼Œ1å˜0ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">toggleBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n ^ (<span class="number">1</span> &lt;&lt; k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n = 5 (0101)</span><br><span class="line"></span><br><span class="line">getBit(5, 2) = (0101 &gt;&gt; 2) &amp; 1 = 01 &amp; 1 = 1</span><br><span class="line">setBit(5, 1) = 0101 | 0010 = 0111 = 7</span><br><span class="line">clearBit(5, 0) = 0101 &amp; ~0001 = 0101 &amp; 1110 = 0100 = 4</span><br><span class="line">toggleBit(5, 1) = 0101 ^ 0010 = 0111 = 7</span><br></pre></td></tr></table></figure><hr><h3 id="4-qing-chu-zui-di-wei-de-1" tabindex="-1" id="4-æ¸…é™¤æœ€ä½ä½çš„1">4. æ¸…é™¤æœ€ä½ä½çš„1</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¸…é™¤æœ€å³è¾¹çš„1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clearLowestBit</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &amp; (n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†å›¾è§£</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = 12:  1100</span><br><span class="line">n-1 = 11: 1011</span><br><span class="line">n &amp; (n-1): 1100 &amp; 1011 = 1000 = 8</span><br><span class="line">         æ¸…é™¤äº†æœ€å³è¾¹çš„1</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨</strong>ï¼šç»Ÿè®¡1çš„ä¸ªæ•°ï¼ˆBrian Kernighanç®—æ³•ï¼‰</p><hr><h3 id="5-huo-qu-zui-di-wei-de-1" tabindex="-1" id="5-è·å–æœ€ä½ä½çš„1">5. è·å–æœ€ä½ä½çš„1</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªä¿ç•™æœ€å³è¾¹çš„1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getLowestBit</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &amp; (-n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = 12:   0...01100</span><br><span class="line">-n:       1...10100ï¼ˆè¡¥ç ï¼‰</span><br><span class="line">n &amp; (-n): 0...00100 = 4</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨</strong>ï¼šæ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰</p><hr><h3 id="6-pan-duan-shi-fou-wei-2-de-mi" tabindex="-1" id="6-åˆ¤æ–­æ˜¯å¦ä¸º2çš„å¹‚">6. åˆ¤æ–­æ˜¯å¦ä¸º2çš„å¹‚</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; (n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š2çš„å¹‚åªæœ‰ä¸€ä¸ª1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2:  0010 &amp; 0001 = 0000 âœ“</span><br><span class="line">4:  0100 &amp; 0011 = 0000 âœ“</span><br><span class="line">6:  0110 &amp; 0101 = 0100 âœ—</span><br><span class="line">8:  1000 &amp; 0111 = 0000 âœ“</span><br></pre></td></tr></table></figure><hr><h3 id="7-tong-ji-1-de-ge-shu" tabindex="-1" id="7-ç»Ÿè®¡1çš„ä¸ªæ•°">7. ç»Ÿè®¡1çš„ä¸ªæ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•1ï¼šBrian Kernighanç®—æ³•ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countOnes</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        n &amp;= (n - <span class="number">1</span>);  <span class="comment">// æ¸…é™¤æœ€å³è¾¹çš„1</span></span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•2ï¼šé€ä½æ£€æŸ¥</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countOnes2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        count += (n &amp; <span class="number">1</span>);</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•3ï¼šC++å†…ç½®å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countOnes3</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> __builtin_popcount(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆç‡å¯¹æ¯”</strong>ï¼š</p><ul><li>æ–¹æ³•1ï¼šO(k)ï¼Œkä¸º1çš„ä¸ªæ•°</li><li>æ–¹æ³•2ï¼šO(32)</li><li>æ–¹æ³•3ï¼šç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œæœ€å¿«</li></ul><hr><h2 id="jing-dian-leet-code-wen-ti" tabindex="-1" id="ç»å…¸LeetCodeé—®é¢˜">ç»å…¸LeetCodeé—®é¢˜</h2><h3 id="1-zhi-chu-xian-yi-ci-de-shu-zi-leet-code-136" tabindex="-1" id="1-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼ˆLeetCode-136ï¼‰">1. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼ˆLeetCode 136ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[2,2,1]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š[4,1,2,1,2]</span><br><span class="line">è¾“å‡ºï¼š4</span><br></pre></td></tr></table></figure><h4 id="jie-fa-yi-huo" tabindex="-1" id="è§£æ³•ï¼šå¼‚æˆ–">è§£æ³•ï¼šå¼‚æˆ–</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">singleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        result ^= num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a ^ a = 0</span><br><span class="line">a ^ 0 = a</span><br><span class="line">äº¤æ¢å¾‹å’Œç»“åˆå¾‹</span><br><span class="line"></span><br><span class="line">[4,1,2,1,2]</span><br><span class="line">= 4 ^ 1 ^ 2 ^ 1 ^ 2</span><br><span class="line">= 4 ^ (1 ^ 1) ^ (2 ^ 2)</span><br><span class="line">= 4 ^ 0 ^ 0</span><br><span class="line">= 4</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)</p><hr><h3 id="2-wei-1-de-ge-shu-leet-code-191" tabindex="-1" id="2-ä½1çš„ä¸ªæ•°ï¼ˆLeetCode-191ï¼‰">2. ä½1çš„ä¸ªæ•°ï¼ˆLeetCode 191ï¼‰</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š11 (0000...1011)</span><br><span class="line">è¾“å‡ºï¼š3</span><br></pre></td></tr></table></figure><h4 id="jie-fa-brian-kernighan-suan-fa" tabindex="-1" id="è§£æ³•ï¼šBrian-Kernighanç®—æ³•">è§£æ³•ï¼šBrian Kernighanç®—æ³•</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">hammingWeight</span><span class="params">(<span class="type">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        n &amp;= (n - <span class="number">1</span>);  <span class="comment">// æ¸…é™¤æœ€å³è¾¹çš„1</span></span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿‡ç¨‹æ¼”ç¤º</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">n = 11 (1011)</span><br><span class="line"></span><br><span class="line">ç¬¬1æ¬¡ï¼šn = 1011</span><br><span class="line">      n-1 = 1010</span><br><span class="line">      n &amp; (n-1) = 1010, count=1</span><br><span class="line"></span><br><span class="line">ç¬¬2æ¬¡ï¼šn = 1010</span><br><span class="line">      n-1 = 1001</span><br><span class="line">      n &amp; (n-1) = 1000, count=2</span><br><span class="line"></span><br><span class="line">ç¬¬3æ¬¡ï¼šn = 1000</span><br><span class="line">      n-1 = 0111</span><br><span class="line">      n &amp; (n-1) = 0000, count=3</span><br><span class="line"></span><br><span class="line">ç»“æŸï¼Œè¿”å›3</span><br></pre></td></tr></table></figure><hr><h3 id="3-2-de-mi-leet-code-231" tabindex="-1" id="3-2çš„å¹‚ï¼ˆLeetCode-231ï¼‰">3. 2çš„å¹‚ï¼ˆLeetCode 231ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; (n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2çš„å¹‚åªæœ‰ä¸€ä¸ª1ï¼š</span><br><span class="line">2:   0010</span><br><span class="line">4:   0100</span><br><span class="line">8:   1000</span><br><span class="line"></span><br><span class="line">é2çš„å¹‚æœ‰å¤šä¸ª1ï¼š</span><br><span class="line">3:   0011</span><br><span class="line">6:   0110</span><br></pre></td></tr></table></figure><hr><h3 id="4-dian-dao-er-jin-zhi-wei-leet-code-190" tabindex="-1" id="4-é¢ å€’äºŒè¿›åˆ¶ä½ï¼ˆLeetCode-190ï¼‰">4. é¢ å€’äºŒè¿›åˆ¶ä½ï¼ˆLeetCode 190ï¼‰</h3><blockquote><p>é¢ å€’ç»™å®šçš„ 32 ä½æ— ç¬¦å·æ•´æ•°çš„äºŒè¿›åˆ¶ä½ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š43261596 (00000010100101000001111010011100)</span><br><span class="line">è¾“å‡ºï¼š964176192 (00111001011110000010100101000000)</span><br></pre></td></tr></table></figure><h4 id="jie-fa-zhu-wei-fan-zhuan" tabindex="-1" id="è§£æ³•ï¼šé€ä½ç¿»è½¬">è§£æ³•ï¼šé€ä½ç¿»è½¬</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">reverseBits</span><span class="params">(<span class="type">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i) &#123;</span><br><span class="line">        result = (result &lt;&lt; <span class="number">1</span>) | (n &amp; <span class="number">1</span>);  <span class="comment">// å–næœ€ä½ä½ï¼ŒåŠ åˆ°resultæœ«å°¾</span></span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;                            <span class="comment">// nå³ç§»</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿‡ç¨‹æ¼”ç¤º</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">n = 1011 (åªçœ‹4ä½)</span><br><span class="line"></span><br><span class="line">i=0: result = 0, n=1011</span><br><span class="line">     result = (0 &lt;&lt; 1) | 1 = 1</span><br><span class="line">     n = 0101</span><br><span class="line"></span><br><span class="line">i=1: result = 1, n=0101</span><br><span class="line">     result = (1 &lt;&lt; 1) | 1 = 11</span><br><span class="line">     n = 0010</span><br><span class="line"></span><br><span class="line">i=2: result = 11, n=0010</span><br><span class="line">     result = (11 &lt;&lt; 1) | 0 = 110</span><br><span class="line">     n = 0001</span><br><span class="line"></span><br><span class="line">i=3: result = 110, n=0001</span><br><span class="line">     result = (110 &lt;&lt; 1) | 1 = 1101</span><br><span class="line">     n = 0000</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š1101ï¼ˆåŸæ•°1011çš„ç¿»è½¬ï¼‰</span><br></pre></td></tr></table></figure><hr><h3 id="5-zhi-chu-xian-yi-ci-de-shu-zi-iii-leet-code-260" tabindex="-1" id="5-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—IIIï¼ˆLeetCode-260ï¼‰">5. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—IIIï¼ˆLeetCode 260ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå…¶ä¸­æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´ ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[1,2,1,3,2,5]</span><br><span class="line">è¾“å‡ºï¼š[3,5]</span><br></pre></td></tr></table></figure><h4 id="jie-fa-fen-zu-yi-huo" tabindex="-1" id="è§£æ³•ï¼šåˆ†ç»„å¼‚æˆ–">è§£æ³•ï¼šåˆ†ç»„å¼‚æˆ–</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">singleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ­¥éª¤1ï¼šå…¨éƒ¨å¼‚æˆ–ï¼Œå¾—åˆ°ä¸¤ä¸ªå•ç‹¬æ•°å­—çš„å¼‚æˆ–ç»“æœ</span></span><br><span class="line">    <span class="type">int</span> xorResult = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        xorResult ^= num;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¥éª¤2ï¼šæ‰¾åˆ°xorResultä¸­ä»»æ„ä¸€ä¸ªä¸º1çš„ä½</span></span><br><span class="line">    <span class="comment">// è¿™ä¸€ä½åœ¨ä¸¤ä¸ªæ•°å­—ä¸­ä¸åŒ</span></span><br><span class="line">    <span class="type">int</span> rightmostBit = xorResult &amp; (-xorResult);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¥éª¤3ï¼šæ ¹æ®è¿™ä¸€ä½åˆ†ç»„</span></span><br><span class="line">    <span class="type">int</span> num1 = <span class="number">0</span>, num2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &amp; rightmostBit) &#123;</span><br><span class="line">            num1 ^= num;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            num2 ^= num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;num1, num2&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†å›¾è§£</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[1,2,1,3,2,5]</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1ï¼šå…¨éƒ¨å¼‚æˆ–</span><br><span class="line">1 ^ 2 ^ 1 ^ 3 ^ 2 ^ 5 = 3 ^ 5 = 0011 ^ 0101 = 0110</span><br><span class="line"></span><br><span class="line">æ­¥éª¤2ï¼šæ‰¾æœ€å³è¾¹çš„1</span><br><span class="line">0110 &amp; (-0110) = 0010</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3ï¼šæŒ‰ç¬¬2ä½åˆ†ç»„</span><br><span class="line">ç¬¬2ä½ä¸º0ï¼š1(0001), 1(0001), 3(0011), 5(0101)</span><br><span class="line">ç¬¬2ä½ä¸º1ï¼š2(0010), 2(0010)</span><br><span class="line"></span><br><span class="line">ç»„1å¼‚æˆ–ï¼š1 ^ 1 ^ 3 ^ 5 = 3 ^ 5 = 6... é”™äº†ï¼Ÿ</span><br><span class="line">åº”è¯¥æ˜¯ï¼š</span><br><span class="line">ç¬¬2ä½ä¸º1ï¼š2(0010), 2(0010)</span><br><span class="line">ç¬¬2ä½ä¸º0ï¼š1(0001), 1(0001), 3(0011), 5(0101)</span><br><span class="line"></span><br><span class="line">é‡æ–°åˆ†æï¼š</span><br><span class="line">rightmostBit = 0010</span><br><span class="line"></span><br><span class="line">ç¬¬2ä½ä¸º1ï¼š2, 2 â†’ å¼‚æˆ– = 0</span><br><span class="line">ç¬¬2ä½ä¸º0ï¼š1, 1, 3, 5 â†’ å¼‚æˆ– = 3 ^ 5</span><br><span class="line"></span><br><span class="line">ä¸å¯¹ï¼Œè®©æˆ‘é‡æ–°ç†è§£ï¼š</span><br><span class="line">æŒ‰ç…§è¿™ä¸€ä½æŠŠæ‰€æœ‰æ•°åˆ†æˆä¸¤ç»„ï¼Œæ¯ç»„å†…æˆå¯¹çš„ä¼šæ¶ˆæ‰ï¼Œå‰©ä¸‹å„è‡ªçš„å•ç‹¬æ•°å­—</span><br></pre></td></tr></table></figure><hr><h3 id="6-bi-te-wei-ji-shu-leet-code-338" tabindex="-1" id="6-æ¯”ç‰¹ä½è®¡æ•°ï¼ˆLeetCode-338ï¼‰">6. æ¯”ç‰¹ä½è®¡æ•°ï¼ˆLeetCode 338ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numï¼Œå¯¹äºèŒƒå›´ [0, num] ä¸­çš„æ¯ä¸ªæ•°å­—ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­ 1 çš„ä¸ªæ•°ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š5</span><br><span class="line">è¾“å‡ºï¼š[0,1,1,2,1,2]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">0: 0000 â†’ 0ä¸ª1</span><br><span class="line">1: 0001 â†’ 1ä¸ª1</span><br><span class="line">2: 0010 â†’ 1ä¸ª1</span><br><span class="line">3: 0011 â†’ 2ä¸ª1</span><br><span class="line">4: 0100 â†’ 1ä¸ª1</span><br><span class="line">5: 0101 â†’ 2ä¸ª1</span><br></pre></td></tr></table></figure><h4 id="jie-fa-1-dong-tai-gui-hua-zui-di-wei" tabindex="-1" id="è§£æ³•1ï¼šåŠ¨æ€è§„åˆ’-æœ€ä½ä½">è§£æ³•1ï¼šåŠ¨æ€è§„åˆ’ + æœ€ä½ä½</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">countBits</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">result</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        result[i] = result[i &gt;&gt; <span class="number">1</span>] + (i &amp; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">içš„1çš„ä¸ªæ•° = (i/2)çš„1çš„ä¸ªæ•° + içš„æœ€ä½ä½</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">6 (110) = 3 (11) å‘å³ç§»ä¸€ä½ + 0 (æœ€ä½ä½)</span><br><span class="line">        = 2ä¸ª1 + 0 = 2</span><br><span class="line"></span><br><span class="line">7 (111) = 3 (11) å‘å³ç§»ä¸€ä½ + 1 (æœ€ä½ä½)</span><br><span class="line">        = 2ä¸ª1 + 1 = 3</span><br></pre></td></tr></table></figure><h4 id="jie-fa-2-dong-tai-gui-hua-qing-chu-zui-di-wei" tabindex="-1" id="è§£æ³•2ï¼šåŠ¨æ€è§„åˆ’-æ¸…é™¤æœ€ä½ä½">è§£æ³•2ï¼šåŠ¨æ€è§„åˆ’ + æ¸…é™¤æœ€ä½ä½</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">countBits</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">result</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        result[i] = result[i &amp; (i - <span class="number">1</span>)] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">içš„1çš„ä¸ªæ•° = (iæ¸…é™¤æœ€ä½ä½å)çš„1çš„ä¸ªæ•° + 1</span><br><span class="line"></span><br><span class="line">6 (110) = 4 (100) æ¸…é™¤æœ€ä½ä½ + 1</span><br><span class="line">        = 1ä¸ª1 + 1 = 2</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)</p><hr><h3 id="7-yi-ming-ju-chi-leet-code-461" tabindex="-1" id="7-æ±‰æ˜è·ç¦»ï¼ˆLeetCode-461ï¼‰">7. æ±‰æ˜è·ç¦»ï¼ˆLeetCode 461ï¼‰</h3><blockquote><p>ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¯¹åº”äºŒè¿›åˆ¶ä½ä¸åŒçš„ä½ç½®çš„æ•°ç›®ã€‚</p></blockquote><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šx = 1, y = 4</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">1: 0001</span><br><span class="line">4: 0100</span><br><span class="line">ä¸åŒä½ï¼š2ä¸ª</span><br></pre></td></tr></table></figure><h4 id="jie-fa-yi-huo-ji-shu" tabindex="-1" id="è§£æ³•ï¼šå¼‚æˆ–-è®¡æ•°">è§£æ³•ï¼šå¼‚æˆ– + è®¡æ•°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">hammingDistance</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> xorResult = x ^ y;  <span class="comment">// ä¸åŒçš„ä½ä¸º1</span></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (xorResult) &#123;</span><br><span class="line">        xorResult &amp;= (xorResult - <span class="number">1</span>);  <span class="comment">// æ¸…é™¤æœ€å³è¾¹çš„1</span></span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="gao-ji-ji-qiao" tabindex="-1" id="é«˜çº§æŠ€å·§">é«˜çº§æŠ€å·§</h2><h3 id="1-zi-ji-sheng-cheng-zhuang-tai-ya-suo" tabindex="-1" id="1-å­é›†ç”Ÿæˆï¼ˆçŠ¶æ€å‹ç¼©ï¼‰">1. å­é›†ç”Ÿæˆï¼ˆçŠ¶æ€å‹ç¼©ï¼‰</h3><p>ç”¨ä½è¿ç®—ç”Ÿæˆé›†åˆçš„æ‰€æœ‰å­é›†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">subsets</span>(vector&lt;<span class="type">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†0åˆ°2^n-1çš„æ‰€æœ‰æ•°å­—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> mask = <span class="number">0</span>; mask &lt; (<span class="number">1</span> &lt;&lt; n); ++mask) &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; subset;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥ç¬¬iä½æ˜¯å¦ä¸º1</span></span><br><span class="line">            <span class="keyword">if</span> (mask &amp; (<span class="number">1</span> &lt;&lt; i)) &#123;</span><br><span class="line">                subset.<span class="built_in">push_back</span>(nums[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        result.<span class="built_in">push_back</span>(subset);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nums = [1,2,3]</span><br><span class="line">ç”¨3ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼š</span><br><span class="line"></span><br><span class="line">000: []</span><br><span class="line">001: [1]</span><br><span class="line">010: [2]</span><br><span class="line">011: [1,2]</span><br><span class="line">100: [3]</span><br><span class="line">101: [1,3]</span><br><span class="line">110: [2,3]</span><br><span class="line">111: [1,2,3]</span><br></pre></td></tr></table></figure><hr><h3 id="2-n-huang-hou-wei-yun-suan-you-hua" tabindex="-1" id="2-Nçš‡åä½è¿ç®—ä¼˜åŒ–">2. Nçš‡åä½è¿ç®—ä¼˜åŒ–</h3><p>ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–Nçš‡åé—®é¢˜çš„çŠ¶æ€è¡¨ç¤ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">solveNQueens</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> cols, <span class="type">int</span> diag1, <span class="type">int</span> diag2, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (row == n) &#123;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ä¸€ä¸ªè§£</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯æ”¾ç½®çš„ä½ç½®ï¼šæœªè¢«å ç”¨çš„åˆ—å’Œå¯¹è§’çº¿</span></span><br><span class="line">    <span class="type">int</span> available = ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>) &amp; ~(cols | diag1 | diag2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (available) &#123;</span><br><span class="line">        <span class="type">int</span> position = available &amp; (-available);  <span class="comment">// å–æœ€å³è¾¹çš„1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ”¾ç½®çš‡å</span></span><br><span class="line">        <span class="built_in">solveNQueens</span>(row + <span class="number">1</span>, </span><br><span class="line">                     cols | position,</span><br><span class="line">                     (diag1 | position) &lt;&lt; <span class="number">1</span>,</span><br><span class="line">                     (diag2 | position) &gt;&gt; <span class="number">1</span>,</span><br><span class="line">                     n);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç§»é™¤è¿™ä¸ªä½ç½®</span></span><br><span class="line">        available &amp;= (available - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ç”¨æ•´æ•°è¡¨ç¤ºçŠ¶æ€ï¼ŒèŠ‚çœç©ºé—´</li><li>ä½è¿ç®—é€Ÿåº¦å¿«</li></ul><hr><h2 id="wei-yun-suan-kou-jue" tabindex="-1" id="ä½è¿ç®—å£è¯€">ä½è¿ç®—å£è¯€</h2><h3 id="chang-yong-ji-qiao-ji-yi" tabindex="-1" id="å¸¸ç”¨æŠ€å·§è®°å¿†">å¸¸ç”¨æŠ€å·§è®°å¿†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. åˆ¤æ–­å¥‡å¶ï¼šn &amp; 1</span><br><span class="line">2. ä¹˜ä»¥2ï¼šn &lt;&lt; 1</span><br><span class="line">3. é™¤ä»¥2ï¼šn &gt;&gt; 1</span><br><span class="line">4. äº¤æ¢ä¸ç”¨ä¸´æ—¶å˜é‡ï¼ša ^= b; b ^= a; a ^= b;</span><br><span class="line">5. æ¸…é™¤æœ€å³è¾¹çš„1ï¼šn &amp; (n-1)</span><br><span class="line">6. è·å–æœ€å³è¾¹çš„1ï¼šn &amp; (-n)</span><br><span class="line">7. åˆ¤æ–­2çš„å¹‚ï¼šn &amp; (n-1) == 0</span><br></pre></td></tr></table></figure><h3 id="yi-huo-de-shen-qi-xing-zhi" tabindex="-1" id="å¼‚æˆ–çš„ç¥å¥‡æ€§è´¨">å¼‚æˆ–çš„ç¥å¥‡æ€§è´¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è‡ªå·±å¼‚æˆ–è‡ªå·±ç­‰äº0ï¼ša ^ a = 0</span><br><span class="line">ä»»ä½•æ•°å¼‚æˆ–0ç­‰äºè‡ªå·±ï¼ša ^ 0 = a</span><br><span class="line">æ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹</span><br></pre></td></tr></table></figure><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>å¼‚æˆ–æ˜¯ç‹è€…</strong>ï¼šå¤§å¤šæ•°ä½è¿ç®—é¢˜ç›®çš„æ ¸å¿ƒ</li><li><strong>n &amp; (n-1)</strong>ï¼šæ¸…é™¤æœ€å³è¾¹çš„1ï¼Œè¶…çº§å®ç”¨</li><li><strong>çŠ¶æ€å‹ç¼©</strong>ï¼šç”¨ä½è¡¨ç¤ºé›†åˆçŠ¶æ€</li><li><strong>æ•ˆç‡ä¼˜åŠ¿</strong>ï¼šä½è¿ç®—æ¯”æ™®é€šè¿ç®—å¿«</li></ol><h3 id="chang-yong-mo-ban" tabindex="-1" id="å¸¸ç”¨æ¨¡æ¿">å¸¸ç”¨æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ç»Ÿè®¡1çš„ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countOnes</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        n &amp;= (n - <span class="number">1</span>);</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. åˆ¤æ–­2çš„å¹‚</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; (n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è·å–/è®¾ç½®/æ¸…é™¤ç¬¬kä½</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123; <span class="keyword">return</span> (n &gt;&gt; k) &amp; <span class="number">1</span>; &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">setBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123; <span class="keyword">return</span> n | (<span class="number">1</span> &lt;&lt; k); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clearBit</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123; <span class="keyword">return</span> n &amp; ~(<span class="number">1</span> &lt;&lt; k); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¼‚æˆ–æ‰¾å•ç‹¬æ•°å­—</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findSingle</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        result ^= num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="tui-jian-ti-mu" tabindex="-1" id="æ¨èé¢˜ç›®">æ¨èé¢˜ç›®</h3><p><strong>å…¥é—¨çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/single-number/">LeetCode 136 - åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</a></li><li><a href="https://leetcode.com/problems/number-of-1-bits/">LeetCode 191 - ä½1çš„ä¸ªæ•°</a></li><li><a href="https://leetcode.com/problems/power-of-two/">LeetCode 231 - 2çš„å¹‚</a></li></ul><p><strong>è¿›é˜¶çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/counting-bits/">LeetCode 338 - æ¯”ç‰¹ä½è®¡æ•°</a></li><li><a href="https://leetcode.com/problems/single-number-iii/">LeetCode 260 - åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—III</a></li><li><a href="https://leetcode.com/problems/hamming-distance/">LeetCode 461 - æ±‰æ˜è·ç¦»</a></li></ul><p><strong>é«˜çº§</strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/subsets/">LeetCode 78 - å­é›†ï¼ˆä½è¿ç®—è§£æ³•ï¼‰</a></li><li><a href="https://leetcode.com/problems/partition-to-k-equal-sum-subsets/">LeetCode 698 - åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†ï¼ˆçŠ¶æ€å‹ç¼©ï¼‰</a></li></ul><p><strong>æ¨èé˜…è¯»</strong>ï¼š</p><ul><li><a href="https://graphics.stanford.edu/~seander/bithacks.html">ä½è¿ç®—æŠ€å·§æ€»ç»“</a></li><li><a href="https://book.douban.com/subject/1784887/">ã€ŠHackerâ€™s Delightã€‹</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;wei-yun-suan-zai-er-jin-zhi-shi-jie-li-pian-pian-qi-wu&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ä½è¿ç®—" scheme="https://smarter.xin/tags/bit-manipulation/"/>
    
    <category term="äºŒè¿›åˆ¶" scheme="https://smarter.xin/tags/binary/"/>
    
    <category term="ç®—æ³•æŠ€å·§" scheme="https://smarter.xin/tags/algorithm-tricks/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-å¿«é€Ÿé€‰æ‹©</title>
    <link href="https://smarter.xin/posts/c68751d1/"/>
    <id>https://smarter.xin/posts/c68751d1/</id>
    <published>2026-01-06T05:50:05.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="kuai-su-xuan-ze-bu-wan-quan-pai-xu-de-yi-zhu" tabindex="-1">å¿«é€Ÿé€‰æ‹©ï¼šä¸å®Œå…¨æ’åºçš„è‰ºæœ¯</h1><blockquote><p>å½“ä½ åªéœ€è¦æ‰¾åˆ°ç¬¬Kå¤§çš„å…ƒç´ æ—¶ï¼Œä¸ºä»€ä¹ˆè¦æŠŠæ•´ä¸ªæ•°ç»„éƒ½æ’åºå‘¢?</p></blockquote><hr><h2 id="shi-yao-shi-kuai-su-xuan-ze" tabindex="-1" id="ä»€ä¹ˆæ˜¯å¿«é€Ÿé€‰æ‹©">ä»€ä¹ˆæ˜¯å¿«é€Ÿé€‰æ‹©</h2><p><strong>å¿«é€Ÿé€‰æ‹©</strong>ï¼ˆQuickSelectï¼‰æ˜¯ä¸€ç§ä»æ— åºæ•°ç»„ä¸­æ‰¾åˆ°ç¬¬Kå°ï¼ˆæˆ–ç¬¬Kå¤§ï¼‰å…ƒç´ çš„é€‰æ‹©ç®—æ³•ã€‚å®ƒåŸºäºå¿«é€Ÿæ’åºçš„åˆ†åŒºæ€æƒ³ï¼Œä½†ä¸éœ€è¦å®Œå…¨æ’åºã€‚</p><blockquote><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ¯æ¬¡åˆ†åŒºåï¼Œpivotå…ƒç´ çš„ä½ç½®å°±æ˜¯å®ƒåœ¨æœ‰åºæ•°ç»„ä¸­çš„æœ€ç»ˆä½ç½®</p></blockquote><h3 id="xing-xiang-li-jie" tabindex="-1" id="å½¢è±¡ç†è§£">å½¢è±¡ç†è§£</h3><p>æƒ³è±¡ä½ è¦åœ¨ç­çº§é‡Œæ‰¾å‡ºç¬¬3åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ™®é€šæ–¹æ³•ï¼šç»™å…¨ç­æ’åºï¼Œç„¶åå–ç¬¬3å â†’ O(n log n)</span><br><span class="line">å¿«é€Ÿé€‰æ‹©ï¼šæ¯æ¬¡æ’é™¤ä¸€åŠä¸å¯èƒ½çš„äºº â†’ O(n)</span><br></pre></td></tr></table></figure><p>å°±åƒæ‰“æ“‚å°èµ›ï¼Œæ¯è½®æ·˜æ±°ä¸€åŠé€‰æ‰‹ï¼Œä¸éœ€è¦å®Œæ•´æ’åºå°±èƒ½æ‰¾åˆ°å† å†›ï¼</p><hr><h2 id="suan-fa-yuan-li" tabindex="-1" id="ç®—æ³•åŸç†">ç®—æ³•åŸç†</h2><h3 id="he-xin-si-xiang" tabindex="-1" id="æ ¸å¿ƒæ€æƒ³">æ ¸å¿ƒæ€æƒ³</h3><p>å¿«é€Ÿé€‰æ‹©åˆ©ç”¨å¿«é€Ÿæ’åºçš„ <strong>partitionï¼ˆåˆ†åŒºï¼‰</strong> æ“ä½œï¼š</p><pre><code class="highlight mermaid">graph TD    A[é€‰æ‹©pivot] --&gt; B[åˆ†åŒºæ“ä½œ]    B --&gt; C&#123;pivotä½ç½® vs ç›®æ ‡ä½ç½®&#125;    C --&gt;|ç›¸ç­‰| D[æ‰¾åˆ°ç›®æ ‡ï¼Œè¿”å›]    C --&gt;|pivoté å·¦| E[åœ¨å³åŠéƒ¨åˆ†ç»§ç»­]    C --&gt;|pivoté å³| F[åœ¨å·¦åŠéƒ¨åˆ†ç»§ç»­]    E --&gt; A    F --&gt; A        style D fill:#90EE90    style A fill:#FFE4B5</code></pre><h3 id="fen-qu-cao-zuo-xiang-jie" tabindex="-1" id="åˆ†åŒºæ“ä½œè¯¦è§£">åˆ†åŒºæ“ä½œè¯¦è§£</h3><p>Partitionå°†æ•°ç»„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[å°äºpivotçš„å…ƒç´ ] | [pivot] | [å¤§äºpivotçš„å…ƒç´ ]</span><br><span class="line">     åŒºåŸŸ1         ä½ç½®p       åŒºåŸŸ2</span><br></pre></td></tr></table></figure><p><strong>å…³é”®æ€§è´¨</strong>ï¼šåˆ†åŒºåï¼Œpivotå…ƒç´ åœ¨å®ƒæœ€ç»ˆæ’åºä½ç½®ä¸Š</p><hr><h2 id="suan-fa-bu-zou-tu-jie" tabindex="-1" id="ç®—æ³•æ­¥éª¤å›¾è§£">ç®—æ³•æ­¥éª¤å›¾è§£</h2><h3 id="shi-li-zhao-di-2-da-yuan-su" tabindex="-1" id="ç¤ºä¾‹ï¼šæ‰¾ç¬¬2å¤§å…ƒç´ ">ç¤ºä¾‹ï¼šæ‰¾ç¬¬2å¤§å…ƒç´ </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">æ•°ç»„ï¼š[3, 2, 1, 5, 6, 4]</span><br><span class="line">ç›®æ ‡ï¼šç¬¬2å¤§ = ç¬¬5å°ï¼ˆç´¢å¼•4ï¼‰</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1: é€‰æ‹©pivot=4ï¼Œåˆ†åŒº</span><br><span class="line">[3, 2, 1] [4] [5, 6]</span><br><span class="line">  0,1,2    3   4,5</span><br><span class="line">         â†‘ pivotåœ¨ä½ç½®3</span><br><span class="line"></span><br><span class="line">æ­¥éª¤2: ç›®æ ‡åœ¨ä½ç½®4ï¼Œpivotåœ¨ä½ç½®3</span><br><span class="line">       ç›®æ ‡ &gt; pivotï¼Œåœ¨å³åŠéƒ¨åˆ†ç»§ç»­</span><br><span class="line">       [5, 6]</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3: é€‰æ‹©pivot=5ï¼Œåˆ†åŒº</span><br><span class="line">[5] [6]</span><br><span class="line"> 4   5</span><br><span class="line"> â†‘ pivotåœ¨ä½ç½®4</span><br><span class="line"></span><br><span class="line">æ­¥éª¤4: pivotä½ç½® = ç›®æ ‡ä½ç½® = 4</span><br><span class="line">       æ‰¾åˆ°ç­”æ¡ˆï¼š5 âœ“</span><br></pre></td></tr></table></figure><h3 id="wan-zheng-guo-cheng-ke-shi-hua" tabindex="-1" id="å®Œæ•´è¿‡ç¨‹å¯è§†åŒ–">å®Œæ•´è¿‡ç¨‹å¯è§†åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">åŸæ•°ç»„ï¼š[3, 2, 1, 5, 6, 4]</span><br><span class="line">æ‰¾ç¬¬2å¤§</span><br><span class="line"></span><br><span class="line">ç¬¬1è½® Partition (pivot=4):</span><br><span class="line">Before: [3, 2, 1, 5, 6, 4]</span><br><span class="line">After:  [3, 2, 1, 4, 5, 6]</span><br><span class="line">                   â†‘</span><br><span class="line">                ä½ç½®3ï¼Œç›®æ ‡åœ¨å³è¾¹</span><br><span class="line"></span><br><span class="line">ç¬¬2è½® Partition (pivot=6):  </span><br><span class="line">Range:  [5, 6]</span><br><span class="line">After:  [5, 6]</span><br><span class="line">            â†‘</span><br><span class="line">         ä½ç½®5ï¼Œç›®æ ‡åœ¨å·¦è¾¹</span><br><span class="line"></span><br><span class="line">ç¬¬3è½® Partition (pivot=5):</span><br><span class="line">å•å…ƒç´ ï¼š5</span><br><span class="line">         â†‘</span><br><span class="line">      ä½ç½®4ï¼Œæ‰¾åˆ°ï¼</span><br></pre></td></tr></table></figure><hr><h2 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h2><h3 id="ji-chu-ban-ben" tabindex="-1" id="åŸºç¡€ç‰ˆæœ¬">åŸºç¡€ç‰ˆæœ¬</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">quickSelect</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºå‡†æƒ…å†µï¼šåªæœ‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (left == right) &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[left];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†åŒºæ“ä½œ</span></span><br><span class="line">    <span class="type">int</span> pivotIndex = <span class="built_in">partition</span>(nums, left, right);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­pivotä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (pivotIndex == k) &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[k];           <span class="comment">// æ‰¾åˆ°ç›®æ ‡</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pivotIndex &lt; k) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, pivotIndex + <span class="number">1</span>, right, k);  <span class="comment">// åœ¨å³è¾¹</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, left, pivotIndex - <span class="number">1</span>, k);   <span class="comment">// åœ¨å·¦è¾¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">partition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// éšæœºé€‰æ‹©pivotï¼Œé¿å…æœ€åæƒ…å†µ</span></span><br><span class="line">    <span class="type">int</span> randomIndex = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">swap</span>(nums[randomIndex], nums[right]);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> pivot = nums[right];</span><br><span class="line">    <span class="type">int</span> i = left - <span class="number">1</span>;  <span class="comment">// iæŒ‡å‘å°äºpivotåŒºåŸŸçš„æœ€åä¸€ä¸ªä½ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = left; j &lt; right; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[j] &lt;= pivot) &#123;</span><br><span class="line">            ++i;</span><br><span class="line">            <span class="built_in">swap</span>(nums[i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†pivotæ”¾åˆ°æ­£ç¡®ä½ç½®</span></span><br><span class="line">    <span class="built_in">swap</span>(nums[i + <span class="number">1</span>], nums[right]);</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="zhao-di-k-da-yuan-su" tabindex="-1" id="æ‰¾ç¬¬Kå¤§å…ƒç´ ">æ‰¾ç¬¬Kå¤§å…ƒç´ </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">findKthLargest</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬kå¤§ = ç¬¬(n-k)å°ï¼ˆä»0å¼€å§‹ç´¢å¼•ï¼‰</span></span><br><span class="line">    <span class="type">int</span> targetIndex = nums.<span class="built_in">size</span>() - k;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, targetIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="partition-guo-cheng-xiang-jie" tabindex="-1" id="Partitionè¿‡ç¨‹è¯¦è§£">Partitionè¿‡ç¨‹è¯¦è§£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">æ•°ç»„: [3, 2, 1, 5, 6, 4]</span><br><span class="line">pivot = 4 (é€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ )</span><br><span class="line"></span><br><span class="line">åˆå§‹: i = -1</span><br><span class="line">      [3, 2, 1, 5, 6, 4]</span><br><span class="line">       j              pivot</span><br><span class="line"></span><br><span class="line">j=0: nums[0]=3 &lt;= 4 âœ“</span><br><span class="line">     i++, swap(nums[0], nums[0])</span><br><span class="line">     [3, 2, 1, 5, 6, 4]</span><br><span class="line">      i,j</span><br><span class="line"></span><br><span class="line">j=1: nums[1]=2 &lt;= 4 âœ“</span><br><span class="line">     i++, swap(nums[1], nums[1])</span><br><span class="line">     [3, 2, 1, 5, 6, 4]</span><br><span class="line">         i,j</span><br><span class="line"></span><br><span class="line">j=2: nums[2]=1 &lt;= 4 âœ“</span><br><span class="line">     i++, swap(nums[2], nums[2])</span><br><span class="line">     [3, 2, 1, 5, 6, 4]</span><br><span class="line">            i,j</span><br><span class="line"></span><br><span class="line">j=3: nums[3]=5 &gt; 4 âœ—</span><br><span class="line">     ä¸äº¤æ¢</span><br><span class="line">     [3, 2, 1, 5, 6, 4]</span><br><span class="line">            i  j</span><br><span class="line"></span><br><span class="line">j=4: nums[4]=6 &gt; 4 âœ—</span><br><span class="line">     ä¸äº¤æ¢</span><br><span class="line">     [3, 2, 1, 5, 6, 4]</span><br><span class="line">            i     j</span><br><span class="line"></span><br><span class="line">æœ€å: swap(nums[i+1], nums[right])</span><br><span class="line">     [3, 2, 1, 4, 6, 5]</span><br><span class="line">               â†‘</span><br><span class="line">            pivotä½ç½®=3</span><br></pre></td></tr></table></figure><hr><h2 id="fu-za-du-fen-xi" tabindex="-1" id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h2><h3 id="shi-jian-fu-za-du" tabindex="-1" id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3><table><thead><tr><th>æƒ…å†µ</th><th>å¤æ‚åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å¹³å‡</td><td><strong>O(n)</strong></td><td>æ¯æ¬¡å‡åŠæœç´¢ç©ºé—´</td></tr><tr><td>æœ€å¥½</td><td>O(n)</td><td>æ¯æ¬¡åˆ†åŒºéƒ½åœ¨ä¸­é—´</td></tr><tr><td>æœ€å</td><td>O(nÂ²)</td><td>æ¯æ¬¡åˆ†åŒºéƒ½åœ¨è¾¹ç•Œ</td></tr></tbody></table><h3 id="wei-shi-yao-ping-jun-shi-o-n" tabindex="-1" id="ä¸ºä»€ä¹ˆå¹³å‡æ˜¯-O-n-ï¼Ÿ">ä¸ºä»€ä¹ˆå¹³å‡æ˜¯ O(n)ï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬1è½®ï¼šå¤„ç† n ä¸ªå…ƒç´ </span><br><span class="line">ç¬¬2è½®ï¼šå¤„ç† n/2 ä¸ªå…ƒç´ </span><br><span class="line">ç¬¬3è½®ï¼šå¤„ç† n/4 ä¸ªå…ƒç´ </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">æ€»æ—¶é—´ = n + n/2 + n/4 + ... â‰ˆ 2n = O(n)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå‡ ä½•çº§æ•°ï¼</p><pre><code class="highlight mermaid">graph LR    A[nä¸ªå…ƒç´ ] --&gt; B[n/2ä¸ªå…ƒç´ ]    B --&gt; C[n/4ä¸ªå…ƒç´ ]    C --&gt; D[n/8ä¸ªå…ƒç´ ]    D --&gt; E[...]        style A fill:#FF6B6B    style B fill:#FFB6C1    style C fill:#FFE4B5</code></pre><h3 id="yu-kuai-su-pai-xu-dui-bi" tabindex="-1" id="ä¸å¿«é€Ÿæ’åºå¯¹æ¯”">ä¸å¿«é€Ÿæ’åºå¯¹æ¯”</h3><table><thead><tr><th>ç®—æ³•</th><th>æ—¶é—´å¤æ‚åº¦ï¼ˆå¹³å‡ï¼‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å¿«é€Ÿæ’åº</td><td>O(n log n)</td><td>ä¸¤è¾¹éƒ½è¦é€’å½’</td></tr><tr><td>å¿«é€Ÿé€‰æ‹©</td><td><strong>O(n)</strong></td><td><strong>åªé€’å½’ä¸€è¾¹</strong></td></tr></tbody></table><p><strong>å…³é”®åŒºåˆ«</strong>ï¼šå¿«é€Ÿé€‰æ‹©åªéœ€è¦é€’å½’ä¸€ä¾§ï¼Œå¿«é€Ÿæ’åºéœ€è¦é€’å½’ä¸¤ä¾§ï¼</p><hr><h2 id="you-hua-ji-qiao" tabindex="-1" id="ä¼˜åŒ–æŠ€å·§">ä¼˜åŒ–æŠ€å·§</h2><h3 id="1-sui-ji-hua-pivot" tabindex="-1" id="1-éšæœºåŒ–Pivot">1. éšæœºåŒ–Pivot</h3><p><strong>é—®é¢˜</strong>ï¼šå›ºå®šé€‰æ‹©pivotï¼ˆå¦‚æœ€åä¸€ä¸ªå…ƒç´ ï¼‰åœ¨æœ‰åºæ•°ç»„ä¸­ä¼šé€€åŒ–ä¸ºO(nÂ²)</p><p><strong>è§£å†³</strong>ï¼šéšæœºé€‰æ‹©pivot</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> randomIndex = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line"><span class="built_in">swap</span>(nums[randomIndex], nums[right]);</span><br></pre></td></tr></table></figure><h3 id="2-san-shu-qu-zhong-fa" tabindex="-1" id="2-ä¸‰æ•°å–ä¸­æ³•">2. ä¸‰æ•°å–ä¸­æ³•</h3><p>ä»é¦–ã€ä¸­ã€å°¾ä¸‰ä¸ªä½ç½®é€‰æ‹©ä¸­ä½æ•°ä½œä¸ºpivot</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getMidPivot</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†ä¸‰ä¸ªæ•°çš„ä¸­ä½æ•°ç§»åˆ°rightä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> (nums[left] &gt; nums[mid]) <span class="built_in">swap</span>(nums[left], nums[mid]);</span><br><span class="line">    <span class="keyword">if</span> (nums[left] &gt; nums[right]) <span class="built_in">swap</span>(nums[left], nums[right]);</span><br><span class="line">    <span class="keyword">if</span> (nums[mid] &gt; nums[right]) <span class="built_in">swap</span>(nums[mid], nums[right]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">swap</span>(nums[mid], nums[right]);</span><br><span class="line">    <span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-die-dai-ban-ben-bi-mian-di-gui-zhan-yi-chu" tabindex="-1" id="3-è¿­ä»£ç‰ˆæœ¬ï¼ˆé¿å…é€’å½’æ ˆæº¢å‡ºï¼‰">3. è¿­ä»£ç‰ˆæœ¬ï¼ˆé¿å…é€’å½’æ ˆæº¢å‡ºï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">quickSelectIterative</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> pivotIndex = <span class="built_in">partition</span>(nums, left, right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (pivotIndex == k) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[k];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pivotIndex &lt; k) &#123;</span><br><span class="line">            left = pivotIndex + <span class="number">1</span>;  <span class="comment">// åœ¨å³è¾¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = pivotIndex - <span class="number">1</span>; <span class="comment">// åœ¨å·¦è¾¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nums[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="jing-dian-ying-yong" tabindex="-1" id="ç»å…¸åº”ç”¨">ç»å…¸åº”ç”¨</h2><h3 id="1-di-k-da-yuan-su-leet-code-215" tabindex="-1" id="1-ç¬¬Kå¤§å…ƒç´ ï¼ˆLeetCode-215ï¼‰">1. ç¬¬Kå¤§å…ƒç´ ï¼ˆLeetCode 215ï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">findKthLargest</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> targetIndex = nums.<span class="built_in">size</span>() - k;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, targetIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[3,2,1,5,6,4], k=2</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼šç¬¬2å¤§çš„å…ƒç´ æ˜¯5</span><br></pre></td></tr></table></figure><hr><h3 id="2-shu-zu-zhong-de-di-k-ge-zui-da-yuan-su-kuo-zhan" tabindex="-1" id="2-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ï¼ˆæ‰©å±•ï¼‰">2. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ï¼ˆæ‰©å±•ï¼‰</h3><p>æ‰¾å‡ºæ•°ç»„ä¸­å‰Kå¤§çš„å…ƒç´ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">topKLargest</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ç¬¬kå¤§å…ƒç´ çš„ä½ç½®</span></span><br><span class="line">    <span class="type">int</span> targetIndex = nums.<span class="built_in">size</span>() - k;</span><br><span class="line">    <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, targetIndex);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä»targetIndexå¼€å§‹çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(nums.<span class="built_in">begin</span>() + targetIndex, nums.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-xun-zhao-zhong-wei-shu" tabindex="-1" id="3-å¯»æ‰¾ä¸­ä½æ•°">3. å¯»æ‰¾ä¸­ä½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">findMedian</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å¥‡æ•°ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¶æ•°ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="type">int</span> mid1 = <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span> - <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> mid2 = <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> (mid1 + mid2) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="kuai-su-xuan-ze-vs-qi-ta-fang-fa" tabindex="-1" id="å¿«é€Ÿé€‰æ‹©-vs-å…¶ä»–æ–¹æ³•">å¿«é€Ÿé€‰æ‹© vs å…¶ä»–æ–¹æ³•</h2><h3 id="dui-bi-biao" tabindex="-1" id="å¯¹æ¯”è¡¨">å¯¹æ¯”è¡¨</h3><table><thead><tr><th>æ–¹æ³•</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å¿«é€Ÿé€‰æ‹©</strong></td><td>O(n) å¹³å‡</td><td>O(1)</td><td><strong>ä¸€æ¬¡æ€§æŸ¥è¯¢</strong></td></tr><tr><td>æ’åº</td><td>O(n log n)</td><td>O(1)</td><td>å¤šæ¬¡æŸ¥è¯¢</td></tr><tr><td>å †</td><td>O(n log k)</td><td>O(k)</td><td>Kå¾ˆå°æ—¶</td></tr><tr><td>è®¡æ•°æ’åº</td><td>O(n + m)</td><td>O(m)</td><td>æ•°å€¼èŒƒå›´å°</td></tr></tbody></table><h3 id="xuan-ze-jian-yi" tabindex="-1" id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®</h3><pre><code class="highlight mermaid">graph TD    A&#123;éœ€è¦ä»€ä¹ˆï¼Ÿ&#125; --&gt; B[åªæŸ¥è¯¢ä¸€æ¬¡]    A --&gt; C[å¤šæ¬¡æŸ¥è¯¢]    A --&gt; D[Kå¾ˆå°]        B --&gt; E[å¿«é€Ÿé€‰æ‹© O n]    C --&gt; F[æ’åº O n log n]    D --&gt; G[å † O n log k]        style E fill:#90EE90    style B fill:#FFE4B5</code></pre><hr><h2 id="shi-zhan-an-li" tabindex="-1" id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</h2><h3 id="an-li-1-zhao-shu-zu-zhong-de-di-k-ge-zui-da-yuan-su" tabindex="-1" id="æ¡ˆä¾‹1ï¼šæ‰¾æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ">æ¡ˆä¾‹1ï¼šæ‰¾æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LeetCode 215</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findKthLargest</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> targetIndex = nums.<span class="built_in">size</span>() - k;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, targetIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">quickSelect</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left == right) <span class="keyword">return</span> nums[left];</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> pivotIndex = <span class="built_in">partition</span>(nums, left, right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (pivotIndex == k) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[k];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pivotIndex &lt; k) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, pivotIndex + <span class="number">1</span>, right, k);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, left, pivotIndex - <span class="number">1</span>, k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">partition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> randomIndex = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">swap</span>(nums[randomIndex], nums[right]);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> pivot = nums[right];</span><br><span class="line">        <span class="type">int</span> i = left - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = left; j &lt; right; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt;= pivot) &#123;</span><br><span class="line">                <span class="built_in">swap</span>(nums[++i], nums[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">swap</span>(nums[i + <span class="number">1</span>], nums[right]);</span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h3 id="an-li-2-zhao-chu-shu-zu-zhong-wei-shu" tabindex="-1" id="æ¡ˆä¾‹2ï¼šæ‰¾å‡ºæ•°ç»„ä¸­ä½æ•°">æ¡ˆä¾‹2ï¼šæ‰¾å‡ºæ•°ç»„ä¸­ä½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">findMedian</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦æ‰¾ä¸¤ä¸ªä¸­é—´å…ƒç´ </span></span><br><span class="line">            <span class="type">int</span> left = <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span> - <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> right = <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, n - <span class="number">1</span>, n / <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> (left + right) / <span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">quickSelect</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left == right) <span class="keyword">return</span> nums[left];</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> pivotIndex = <span class="built_in">partition</span>(nums, left, right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (pivotIndex == k) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[k];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pivotIndex &lt; k) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, pivotIndex + <span class="number">1</span>, right, k);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, left, pivotIndex - <span class="number">1</span>, k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">partition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> randomIndex = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">swap</span>(nums[randomIndex], nums[right]);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> pivot = nums[right];</span><br><span class="line">        <span class="type">int</span> i = left - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = left; j &lt; right; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt;= pivot) &#123;</span><br><span class="line">                <span class="built_in">swap</span>(nums[++i], nums[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">swap</span>(nums[i + <span class="number">1</span>], nums[right]);</span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="chang-jian-xian-jing-yu-ji-qiao" tabindex="-1" id="å¸¸è§é™·é˜±ä¸æŠ€å·§">å¸¸è§é™·é˜±ä¸æŠ€å·§</h2><h3 id="xian-jing-1-suo-yin-zhuan-huan-cuo-wu" tabindex="-1" id="é™·é˜±1ï¼šç´¢å¼•è½¬æ¢é”™è¯¯">é™·é˜±1ï¼šç´¢å¼•è½¬æ¢é”™è¯¯</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨k</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, k);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šç¬¬kå¤§ = ç¬¬(n-k)å°</span></span><br><span class="line"><span class="type">int</span> targetIndex = nums.<span class="built_in">size</span>() - k;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>, targetIndex);</span><br></pre></td></tr></table></figure><h3 id="xian-jing-2-wang-ji-sui-ji-hua" tabindex="-1" id="é™·é˜±2ï¼šå¿˜è®°éšæœºåŒ–">é™·é˜±2ï¼šå¿˜è®°éšæœºåŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©ï¼šå›ºå®šé€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="type">int</span> pivot = nums[right];</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å®‰å…¨ï¼šéšæœºé€‰æ‹©pivot</span></span><br><span class="line"><span class="type">int</span> randomIndex = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line"><span class="built_in">swap</span>(nums[randomIndex], nums[right]);</span><br><span class="line"><span class="type">int</span> pivot = nums[right];</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-1-ji-zhu-partition-mo-ban" tabindex="-1" id="æŠ€å·§1ï¼šè®°ä½partitionæ¨¡æ¿">æŠ€å·§1ï¼šè®°ä½partitionæ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">partition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// éšæœºpivot</span></span><br><span class="line">    <span class="type">int</span> random = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">swap</span>(nums[random], nums[right]);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> pivot = nums[right];</span><br><span class="line">    <span class="type">int</span> i = left - <span class="number">1</span>;  <span class="comment">// å…³é”®ï¼šä»left-1å¼€å§‹</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = left; j &lt; right; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[j] &lt;= pivot) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(nums[++i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">swap</span>(nums[i + <span class="number">1</span>], nums[right]);</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-2-kou-jue-ji-yi" tabindex="-1" id="æŠ€å·§2ï¼šå£è¯€è®°å¿†">æŠ€å·§2ï¼šå£è¯€è®°å¿†</h3><blockquote><p><strong>â€œæ‰¾å¤§å‡Kï¼Œæ‰¾å°ç”¨Kâ€</strong></p></blockquote><ul><li>æ‰¾ç¬¬Kå¤§ï¼š<code>targetIndex = n - k</code></li><li>æ‰¾ç¬¬Kå°ï¼š<code>targetIndex = k - 1</code>ï¼ˆä»0å¼€å§‹ç´¢å¼•ï¼‰</li></ul><hr><h2 id="si-wei-dao-tu" tabindex="-1" id="æ€ç»´å¯¼å›¾">æ€ç»´å¯¼å›¾</h2><pre><code class="highlight mermaid">graph TD    A[å¿«é€Ÿé€‰æ‹©] --&gt; B[æ ¸å¿ƒæ€æƒ³]    A --&gt; C[å…³é”®æ“ä½œ]    A --&gt; D[åº”ç”¨åœºæ™¯]    A --&gt; E[ä¼˜åŒ–æŠ€å·§]        B --&gt; B1[åŸºäºå¿«æ’åˆ†åŒº]    B --&gt; B2[åªé€’å½’ä¸€ä¾§]    B --&gt; B3[O n å¹³å‡å¤æ‚åº¦]        C --&gt; C1[Partitionåˆ†åŒº]    C --&gt; C2[æ¯”è¾ƒpivotä½ç½®]    C --&gt; C3[é€’å½’/è¿­ä»£]        D --&gt; D1[ç¬¬Kå¤§å…ƒç´ ]    D --&gt; D2[ä¸­ä½æ•°]    D --&gt; D3[TopKé—®é¢˜]        E --&gt; E1[éšæœºåŒ–pivot]    E --&gt; E2[ä¸‰æ•°å–ä¸­]    E --&gt; E3[è¿­ä»£ç‰ˆæœ¬]        style A fill:#FFE4B5    style B fill:#87CEEB    style D fill:#90EE90</code></pre><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>å¿«é€Ÿé€‰æ‹© = å¿«æ’åˆ†åŒº + å•ä¾§é€’å½’</strong></li><li><strong>å¹³å‡O(n)å¤æ‚åº¦</strong>ï¼šæ¯”å®Œå…¨æ’åºå¿«</li><li><strong>éšæœºåŒ–pivot</strong>ï¼šé¿å…æœ€åæƒ…å†µ</li><li><strong>ç´¢å¼•è½¬æ¢</strong>ï¼šç¬¬Kå¤§ = ç¬¬(n-k)å°</li></ol><h3 id="dai-ma-mo-ban" tabindex="-1" id="ä»£ç æ¨¡æ¿">ä»£ç æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿé€‰æ‹©æ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">quickSelect</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span> nums[left];</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> pivotIndex = <span class="built_in">partition</span>(nums, left, right);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (pivotIndex == k) &#123;</span><br><span class="line">        <span class="keyword">return</span> nums[k];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pivotIndex &lt; k) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, pivotIndex + <span class="number">1</span>, right, k);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quickSelect</span>(nums, left, pivotIndex - <span class="number">1</span>, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Partitionæ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">partition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> random = left + <span class="built_in">rand</span>() % (right - left + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">swap</span>(nums[random], nums[right]);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> pivot = nums[right];</span><br><span class="line">    <span class="type">int</span> i = left - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = left; j &lt; right; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[j] &lt;= pivot) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(nums[++i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">swap</span>(nums[i + <span class="number">1</span>], nums[right]);</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¨èç»ƒä¹ </strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/kth-largest-element-in-an-array/">LeetCode 215 - æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></li><li><a href="https://leetcode.com/problems/k-closest-points-to-origin/">LeetCode 973 - æœ€æ¥è¿‘åŸç‚¹çš„Kä¸ªç‚¹</a></li><li><a href="https://leetcode.com/problems/top-k-frequent-elements/">LeetCode 347 - å‰Kä¸ªé«˜é¢‘å…ƒç´ </a></li></ul><p><strong>æ¨èé˜…è¯»</strong>ï¼š</p><ul><li><a href="https://book.douban.com/subject/20432061/">ã€Šç®—æ³•å¯¼è®ºã€‹ç¬¬9ç« ï¼šä¸­ä½æ•°å’Œé¡ºåºç»Ÿè®¡é‡</a></li><li><a href="https://en.wikipedia.org/wiki/Quickselect">å¿«é€Ÿé€‰æ‹©ç®—æ³•è¯¦è§£</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;kuai-su-xuan-ze-bu-wan-quan-pai-xu-de-yi-zhu&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ç®—æ³•è®¾è®¡" scheme="https://smarter.xin/tags/algorithm-design/"/>
    
    <category term="åˆ†æ²»" scheme="https://smarter.xin/tags/divide-and-conquer/"/>
    
    <category term="å¿«é€Ÿé€‰æ‹©" scheme="https://smarter.xin/tags/quick-select/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§æ•°æ®ç»“æ„-å †</title>
    <link href="https://smarter.xin/posts/60d62905/"/>
    <id>https://smarter.xin/posts/60d62905/</id>
    <published>2026-01-06T03:12:06.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="dui-xiang-jie-shu-de-xing-shu-zu-de-xin" tabindex="-1">å †è¯¦è§£ï¼šæ ‘çš„å½¢ï¼Œæ•°ç»„çš„å¿ƒ</h1><blockquote><p>æ·±å…¥ç†è§£å †çš„å†…éƒ¨åŸç†å’Œæ‰‹å†™å®ç°</p></blockquote><hr><h2 id="shi-yao-shi-dui" tabindex="-1" id="ä»€ä¹ˆæ˜¯å †">ä»€ä¹ˆæ˜¯å †</h2><p><strong>å †</strong>ï¼ˆHeapï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ»¡è¶³å †æ€§è´¨ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­èŠ‚ç‚¹çš„å€¼ã€‚</p><blockquote><p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šç”¨æ•°ç»„å­˜å‚¨çš„å®Œå…¨äºŒå‰æ ‘ï¼ŒåŠ¨æ€ç»´æŠ¤æœ€å€¼</p></blockquote><h3 id="liang-chong-dui" tabindex="-1" id="ä¸¤ç§å †">ä¸¤ç§å †</h3><pre><code class="highlight mermaid">graph LR    A[å †] --&gt; B[æœ€å¤§å † Max Heap]    A --&gt; C[æœ€å°å † Min Heap]        B --&gt; B1[çˆ¶èŠ‚ç‚¹ â‰¥ å­èŠ‚ç‚¹]    B --&gt; B2[æ ¹èŠ‚ç‚¹æœ€å¤§]        C --&gt; C1[çˆ¶èŠ‚ç‚¹ â‰¤ å­èŠ‚ç‚¹]    C --&gt; C2[æ ¹èŠ‚ç‚¹æœ€å°]        style A fill:#FFE4B5    style B fill:#FF6B6B    style C fill:#87CEEB</code></pre><h4 id="zui-da-dui-shi-li" tabindex="-1" id="æœ€å¤§å †ç¤ºä¾‹">æœ€å¤§å †ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">     9            æ•°ç»„è¡¨ç¤ºï¼š[9, 7, 8, 3, 5, 6, 2]</span><br><span class="line">   /   \          </span><br><span class="line">  7     8         ç´¢å¼•å…³ç³»ï¼š</span><br><span class="line"> / \   / \        - çˆ¶èŠ‚ç‚¹ i</span><br><span class="line">3   5 6   2       - å·¦å­èŠ‚ç‚¹ 2i + 1</span><br><span class="line">                  - å³å­èŠ‚ç‚¹ 2i + 2</span><br></pre></td></tr></table></figure><h4 id="zui-xiao-dui-shi-li" tabindex="-1" id="æœ€å°å †ç¤ºä¾‹">æœ€å°å †ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     1            æ•°ç»„è¡¨ç¤ºï¼š[1, 3, 2, 7, 5, 6, 8]</span><br><span class="line">   /   \          </span><br><span class="line">  3     2         ç‰¹ç‚¹ï¼š</span><br><span class="line"> / \   / \        - å®Œå…¨äºŒå‰æ ‘</span><br><span class="line">7   5 6   8       - çˆ¶ â‰¤ å­</span><br></pre></td></tr></table></figure><hr><h2 id="wei-shi-yao-yong-shu-zu-cun-chu" tabindex="-1" id="ä¸ºä»€ä¹ˆç”¨æ•°ç»„å­˜å‚¨">ä¸ºä»€ä¹ˆç”¨æ•°ç»„å­˜å‚¨</h2><h3 id="wan-quan-er-cha-shu-de-xing-zhi" tabindex="-1" id="å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨">å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨</h3><p>å®Œå…¨äºŒå‰æ ‘å¯ä»¥ç”¨æ•°ç»„ç´§å‡‘å­˜å‚¨ï¼Œä¸æµªè´¹ç©ºé—´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">        0</span><br><span class="line">      /   \</span><br><span class="line">     1     2</span><br><span class="line">    / \   / \</span><br><span class="line">   3   4 5   6</span><br><span class="line"></span><br><span class="line">æ•°ç»„ï¼š[0, 1, 2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure><h3 id="suo-yin-ji-suan-gong-shi" tabindex="-1" id="ç´¢å¼•è®¡ç®—å…¬å¼">ç´¢å¼•è®¡ç®—å…¬å¼</h3><p>å¯¹äºç´¢å¼•ä¸º <code>i</code> çš„èŠ‚ç‚¹ï¼š</p><table><thead><tr><th>å…³ç³»</th><th>å…¬å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>çˆ¶èŠ‚ç‚¹</td><td><code>(i - 1) / 2</code></td><td>å‘ä¸‹å–æ•´</td></tr><tr><td>å·¦å­èŠ‚ç‚¹</td><td><code>2 * i + 1</code></td><td>-</td></tr><tr><td>å³å­èŠ‚ç‚¹</td><td><code>2 * i + 2</code></td><td>-</td></tr><tr><td>æ˜¯å¦æœ‰å·¦å­</td><td><code>2 * i + 1 &lt; size</code></td><td>åˆ¤æ–­æ˜¯å¦è¶Šç•Œ</td></tr><tr><td>æ˜¯å¦æœ‰å³å­</td><td><code>2 * i + 2 &lt; size</code></td><td>åˆ¤æ–­æ˜¯å¦è¶Šç•Œ</td></tr><tr><td>æœ€åéå¶å­</td><td><code>size / 2 - 1</code></td><td>å»ºå †æ—¶çš„èµ·ç‚¹</td></tr></tbody></table><blockquote><p><strong>è®°å¿†æŠ€å·§</strong>ï¼šä» 0 å¼€å§‹ç´¢å¼•ï¼Œå·¦å­ = 2i+1ï¼Œå³å­ = 2i+2</p></blockquote><hr><h2 id="dui-de-he-xin-cao-zuo" tabindex="-1" id="å †çš„æ ¸å¿ƒæ“ä½œ">å †çš„æ ¸å¿ƒæ“ä½œ</h2><h3 id="1-shang-fu-sift-up" tabindex="-1" id="1-ä¸Šæµ®ï¼ˆSift-Upï¼‰">1. ä¸Šæµ®ï¼ˆSift Upï¼‰</h3><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ’å…¥æ–°å…ƒç´ åï¼Œæ¢å¤å †æ€§è´¨</p><p><strong>åŸç†</strong>ï¼šæ–°å…ƒç´ ä¸çˆ¶èŠ‚ç‚¹æ¯”è¾ƒï¼Œè‹¥è¿åå †æ€§è´¨åˆ™äº¤æ¢ï¼Œé‡å¤ç›´åˆ°æ ¹èŠ‚ç‚¹æˆ–æ»¡è¶³æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">æœ€å¤§å †æ’å…¥ 10ï¼š</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1: æ’å…¥åˆ°æœ«å°¾          æ­¥éª¤2: ä¸çˆ¶èŠ‚ç‚¹æ¯”è¾ƒ</span><br><span class="line">         9                        9</span><br><span class="line">       /   \                    /   \</span><br><span class="line">      7     8       â†’          10    8</span><br><span class="line">     / \   / \                / \   / \</span><br><span class="line">    3   5 6   2  10          3   5 6   2  7</span><br><span class="line">                â†‘                         â†‘</span><br><span class="line">            æ–°æ’å…¥                     ä¸Šæµ®ä¸€æ¬¡</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3: ç»§ç»­æ¯”è¾ƒ            æ­¥éª¤4: å®Œæˆ</span><br><span class="line">         10                      10</span><br><span class="line">       /   \                    /   \</span><br><span class="line">      9     8       â†’          9     8</span><br><span class="line">     / \   / \                / \   / \</span><br><span class="line">    3   5 6   2  7           3   5 6   2  7</span><br><span class="line">    â†‘                        </span><br><span class="line">  ä¸Šæµ®åˆ°æ ¹</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">siftUp</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; heap, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> parent = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ€å¤§å †ï¼šå­èŠ‚ç‚¹ &gt; çˆ¶èŠ‚ç‚¹æ—¶ä¸Šæµ®</span></span><br><span class="line">        <span class="keyword">if</span> (heap[index] &gt; heap[parent]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(heap[index], heap[parent]);</span><br><span class="line">            index = parent;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)ï¼Œæœ€å¤šä¸Šæµ® h å±‚ï¼ˆh ä¸ºæ ‘é«˜ï¼‰</p><hr><h3 id="2-xia-chen-sift-down" tabindex="-1" id="2-ä¸‹æ²‰ï¼ˆSift-Downï¼‰">2. ä¸‹æ²‰ï¼ˆSift Downï¼‰</h3><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šåˆ é™¤å †é¡¶åï¼Œæ¢å¤å †æ€§è´¨</p><p><strong>åŸç†</strong>ï¼šç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢å †é¡¶ï¼Œç„¶åä¸è¾ƒå¤§çš„å­èŠ‚ç‚¹æ¯”è¾ƒï¼Œè‹¥è¿åå †æ€§è´¨åˆ™äº¤æ¢ï¼Œé‡å¤ç›´åˆ°å¶å­èŠ‚ç‚¹æˆ–æ»¡è¶³æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">æœ€å¤§å †åˆ é™¤å †é¡¶ï¼š</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1: ç”¨æœ«å°¾æ›¿æ¢å †é¡¶      æ­¥éª¤2: ä¸å­èŠ‚ç‚¹æ¯”è¾ƒ</span><br><span class="line">         9                        2</span><br><span class="line">       /   \                    /   \</span><br><span class="line">      7     8       â†’          7     8</span><br><span class="line">     / \   / \                / \   / </span><br><span class="line">    3   5 6   2              3   5 6</span><br><span class="line">         åˆ é™¤ â†‘                â†“</span><br><span class="line">              2              ä¸‹æ²‰</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3: äº¤æ¢å¹¶ç»§ç»­          æ­¥éª¤4: å®Œæˆ</span><br><span class="line">         7                        8</span><br><span class="line">       /   \                    /   \</span><br><span class="line">      2     8       â†’          7     6</span><br><span class="line">     / \   /                  / \   / </span><br><span class="line">    3   5 6                  3   5 2</span><br><span class="line">        â†“                              </span><br><span class="line">      ç»§ç»­ä¸‹æ²‰                     ç¨³å®š</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">siftDown</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; heap, <span class="type">int</span> index, <span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">2</span> * index + <span class="number">1</span> &lt; size) &#123;  <span class="comment">// æœ‰å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> left = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> right = <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> largest = index;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰¾å‡ºçˆ¶ã€å·¦å­ã€å³å­ä¸­æœ€å¤§çš„</span></span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; heap[left] &gt; heap[largest]) &#123;</span><br><span class="line">            largest = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; heap[right] &gt; heap[largest]) &#123;</span><br><span class="line">            largest = right;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœçˆ¶èŠ‚ç‚¹æœ€å¤§ï¼Œè¯´æ˜å·²æ»¡è¶³å †æ€§è´¨</span></span><br><span class="line">        <span class="keyword">if</span> (largest == index) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">swap</span>(heap[index], heap[largest]);</span><br><span class="line">        index = largest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p><hr><h3 id="3-cha-ru-insert" tabindex="-1" id="3-æ’å…¥ï¼ˆInsertï¼‰">3. æ’å…¥ï¼ˆInsertï¼‰</h3><p><strong>æ­¥éª¤</strong>ï¼š</p><ol><li>å°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„æœ«å°¾</li><li>ä¸Šæµ®è°ƒæ•´</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; heap, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    heap.<span class="built_in">push_back</span>(value);      <span class="comment">// æ·»åŠ åˆ°æœ«å°¾</span></span><br><span class="line">    <span class="built_in">siftUp</span>(heap, heap.<span class="built_in">size</span>() - <span class="number">1</span>);  <span class="comment">// ä¸Šæµ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p><hr><h3 id="4-shan-chu-dui-ding-extract-max-min" tabindex="-1" id="4-åˆ é™¤å †é¡¶ï¼ˆExtract-Max-Minï¼‰">4. åˆ é™¤å †é¡¶ï¼ˆExtract Max/Minï¼‰</h3><p><strong>æ­¥éª¤</strong>ï¼š</p><ol><li>è®°å½•å †é¡¶å…ƒç´ </li><li>ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢å †é¡¶</li><li>åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ </li><li>ä¸‹æ²‰è°ƒæ•´</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">extractMax</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; heap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;Heap is empty&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> maxValue = heap[<span class="number">0</span>];          <span class="comment">// è®°å½•æœ€å¤§å€¼</span></span><br><span class="line">    heap[<span class="number">0</span>] = heap.<span class="built_in">back</span>();           <span class="comment">// ç”¨æœ«å°¾æ›¿æ¢å †é¡¶</span></span><br><span class="line">    heap.<span class="built_in">pop_back</span>();                 <span class="comment">// åˆ é™¤æœ«å°¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="built_in">siftDown</span>(heap, <span class="number">0</span>, heap.<span class="built_in">size</span>());  <span class="comment">// ä¸‹æ²‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> maxValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(log n)</p><hr><h3 id="5-jian-dui-build-heap" tabindex="-1" id="5-å»ºå †ï¼ˆBuild-Heapï¼‰">5. å»ºå †ï¼ˆBuild Heapï¼‰</h3><p><strong>æ–¹æ³•1ï¼šè‡ªé¡¶å‘ä¸‹</strong></p><p>é€ä¸ªæ’å…¥å…ƒç´ ï¼Œæ¯æ¬¡æ’å…¥åä¸Šæµ®è°ƒæ•´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">buildHeapTopDown</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; heap;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : arr) &#123;</span><br><span class="line">        <span class="built_in">insert</span>(heap, num);  <span class="comment">// O(log n) æ’å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> heap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log n)</p><hr><p><strong>æ–¹æ³•2ï¼šè‡ªåº•å‘ä¸Šï¼ˆæ›´ä¼˜ï¼‰</strong></p><p>å°†æ•°ç»„çœ‹ä½œå®Œå…¨äºŒå‰æ ‘ï¼Œä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡ä¸‹æ²‰è°ƒæ•´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">åŸæ•°ç»„ï¼š[3, 2, 1, 7, 8, 4, 5]</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1ï¼šæ‰¾æœ€åéå¶å­èŠ‚ç‚¹ = size/2-1 = 2ï¼ˆå€¼ä¸º1ï¼‰</span><br><span class="line">         3</span><br><span class="line">       /   \</span><br><span class="line">      2     1</span><br><span class="line">     / \   / \</span><br><span class="line">    7   8 4   5</span><br><span class="line"></span><br><span class="line">æ­¥éª¤2ï¼šä»ç´¢å¼•2å¼€å§‹ä¸‹æ²‰</span><br><span class="line">         3</span><br><span class="line">       /   \</span><br><span class="line">      2     5</span><br><span class="line">     / \   / \</span><br><span class="line">    7   8 4   1</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3ï¼šå¤„ç†ç´¢å¼•1</span><br><span class="line">         3</span><br><span class="line">       /   \</span><br><span class="line">      8     5</span><br><span class="line">     / \   / \</span><br><span class="line">    7   2 4   1</span><br><span class="line"></span><br><span class="line">æ­¥éª¤4ï¼šå¤„ç†ç´¢å¼•0ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰</span><br><span class="line">         8</span><br><span class="line">       /   \</span><br><span class="line">      7     5</span><br><span class="line">     / \   / \</span><br><span class="line">    3   2 4   1</span><br><span class="line"></span><br><span class="line">å®Œæˆï¼æœ€å¤§å †æ„å»ºå®Œæˆ</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildHeap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; heap)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = heap.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œå‘å‰éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="built_in">siftDown</span>(heap, i, n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n) ğŸ¯</p><h4 id="wei-shi-yao-shi-o-n-er-bu-shi-o-n-log-n" tabindex="-1" id="ä¸ºä»€ä¹ˆæ˜¯-O-n-è€Œä¸æ˜¯-O-n-log-n-ï¼Ÿ">ä¸ºä»€ä¹ˆæ˜¯ O(n) è€Œä¸æ˜¯ O(n log n)ï¼Ÿ</h4><p>è™½ç„¶æ¯æ¬¡ä¸‹æ²‰æœ€åæ˜¯ O(log n)ï¼Œä½†å®é™…ä¸Šï¼š</p><ul><li>å¶å­èŠ‚ç‚¹ä¸éœ€è¦ä¸‹æ²‰ï¼ˆå ä¸€åŠï¼‰</li><li>å€’æ•°ç¬¬äºŒå±‚æœ€å¤šä¸‹æ²‰ 1 å±‚ï¼ˆå  1/4ï¼‰</li><li>å€’æ•°ç¬¬ä¸‰å±‚æœ€å¤šä¸‹æ²‰ 2 å±‚ï¼ˆå  1/8ï¼‰</li><li>â€¦</li></ul><p>æ€»æ—¶é—´ = n/2 Ã— 0 + n/4 Ã— 1 + n/8 Ã— 2 + â€¦ = O(n)</p><hr><h2 id="wan-zheng-de-dui-lei-shi-xian" tabindex="-1" id="å®Œæ•´çš„å †ç±»å®ç°">å®Œæ•´çš„å †ç±»å®ç°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MaxHeap</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; heap;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">siftUp</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> parent = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (heap[index] &gt; heap[parent]) &#123;</span><br><span class="line">                <span class="built_in">swap</span>(heap[index], heap[parent]);</span><br><span class="line">                index = parent;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">siftDown</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> size = heap.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">2</span> * index + <span class="number">1</span> &lt; size) &#123;</span><br><span class="line">            <span class="type">int</span> left = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> right = <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> largest = index;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (left &lt; size &amp;&amp; heap[left] &gt; heap[largest]) &#123;</span><br><span class="line">                largest = left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (right &lt; size &amp;&amp; heap[right] &gt; heap[largest]) &#123;</span><br><span class="line">                largest = right;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (largest == index) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">swap</span>(heap[index], heap[largest]);</span><br><span class="line">            index = largest;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MaxHeap</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">MaxHeap</span>(vector&lt;<span class="type">int</span>&gt; arr) : <span class="built_in">heap</span>(arr) &#123;</span><br><span class="line">        <span class="comment">// å»ºå †</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = heap.<span class="built_in">size</span>() / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="built_in">siftDown</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        heap.<span class="built_in">push_back</span>(value);</span><br><span class="line">        <span class="built_in">siftUp</span>(heap.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">extractMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;Heap is empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> maxValue = heap[<span class="number">0</span>];</span><br><span class="line">        heap[<span class="number">0</span>] = heap.<span class="built_in">back</span>();</span><br><span class="line">        heap.<span class="built_in">pop_back</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="built_in">siftDown</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> maxValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getMax</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;Heap is empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heap[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> heap.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> heap.<span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="dui-pai-xu-xiang-jie" tabindex="-1" id="å †æ’åºè¯¦è§£">å †æ’åºè¯¦è§£</h2><h3 id="suan-fa-si-lu" tabindex="-1" id="ç®—æ³•æ€è·¯">ç®—æ³•æ€è·¯</h3><p>åˆ©ç”¨å †çš„æ€§è´¨è¿›è¡Œæ’åºï¼š</p><ol><li><strong>å»ºå †</strong>ï¼šO(n)</li><li><strong>æ’åº</strong>ï¼šä¾æ¬¡å–å‡ºå †é¡¶ï¼ˆæœ€å¤§å€¼ï¼‰ï¼Œæ”¾åˆ°æ•°ç»„æœ«å°¾</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">åŸæ•°ç»„ï¼š[3, 2, 1, 7, 8, 4, 5]</span><br><span class="line"></span><br><span class="line">æ­¥éª¤1ï¼šå»ºæœ€å¤§å †</span><br><span class="line">[8, 7, 5, 3, 2, 4, 1]</span><br><span class="line"> â†‘ æœ€å¤§å€¼</span><br><span class="line"></span><br><span class="line">æ­¥éª¤2ï¼šå †é¡¶ä¸æœ«å°¾äº¤æ¢</span><br><span class="line">[1, 7, 5, 3, 2, 4 | 8]</span><br><span class="line"> â†‘              å·²æ’åº</span><br><span class="line"></span><br><span class="line">æ­¥éª¤3ï¼šç¼©å°å †èŒƒå›´å¹¶ä¸‹æ²‰è°ƒæ•´</span><br><span class="line">[7, 3, 5, 1, 2, 4 | 8]</span><br><span class="line"> â†‘              å·²æ’åº</span><br><span class="line"></span><br><span class="line">æ­¥éª¤4ï¼šé‡å¤</span><br><span class="line">[4, 3, 5, 1, 2 | 7, 8]</span><br><span class="line">[5, 3, 4, 1, 2 | 7, 8]</span><br><span class="line">...</span><br><span class="line">[1, 2, 3, 4, 5, 7, 8]  å®Œæˆï¼</span><br></pre></td></tr></table></figure><h3 id="dai-ma-shi-xian" tabindex="-1" id="ä»£ç å®ç°">ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">heapSort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. å»ºå †ï¼ˆä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="built_in">heapify</span>(nums, n, i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. æ’åºï¼ˆä¾æ¬¡å–å‡ºå †é¡¶ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[<span class="number">0</span>], nums[i]);   <span class="comment">// å †é¡¶ä¸æœ«å°¾äº¤æ¢</span></span><br><span class="line">        <span class="built_in">heapify</span>(nums, i, <span class="number">0</span>);       <span class="comment">// è°ƒæ•´å †</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">heapify</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> n, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> largest = i;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> right = <span class="number">2</span> * i + <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (left &lt; n &amp;&amp; nums[left] &gt; nums[largest]) &#123;</span><br><span class="line">        largest = left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (right &lt; n &amp;&amp; nums[right] &gt; nums[largest]) &#123;</span><br><span class="line">        largest = right;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[i], nums[largest]);</span><br><span class="line">        <span class="built_in">heapify</span>(nums, n, largest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fu-za-du-fen-xi" tabindex="-1" id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log n)<ul><li>å»ºå †ï¼šO(n)</li><li>n-1 æ¬¡è°ƒæ•´ï¼Œæ¯æ¬¡ O(log n)</li></ul></li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1) åŸåœ°æ’åº</li><li><strong>ç¨³å®šæ€§</strong>ï¼šâŒ ä¸ç¨³å®š</li></ul><h3 id="dui-pai-xu-de-you-que-dian" tabindex="-1" id="å †æ’åºçš„ä¼˜ç¼ºç‚¹">å †æ’åºçš„ä¼˜ç¼ºç‚¹</h3><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>âœ… æ—¶é—´å¤æ‚åº¦ç¨³å®š</td><td>âŒ ä¸ç¨³å®šæ’åº</td></tr><tr><td>âœ… åŸåœ°æ’åºï¼Œç©ºé—´ O(1)</td><td>âŒ ç¼“å­˜ä¸å‹å¥½</td></tr><tr><td>âœ… ä¸ä¾èµ–è¾“å…¥åˆ†å¸ƒ</td><td>âŒ å®é™…æ€§èƒ½ä¸å¦‚å¿«æ’</td></tr></tbody></table><hr><h2 id="dui-vs-qi-ta-shu-ju-jie-gou" tabindex="-1" id="å †-vs-å…¶ä»–æ•°æ®ç»“æ„">å † vs å…¶ä»–æ•°æ®ç»“æ„</h2><h3 id="cao-zuo-fu-za-du-dui-bi" tabindex="-1" id="æ“ä½œå¤æ‚åº¦å¯¹æ¯”">æ“ä½œå¤æ‚åº¦å¯¹æ¯”</h3><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>æ’å…¥</th><th>åˆ é™¤æœ€å€¼</th><th>æŸ¥çœ‹æœ€å€¼</th><th>æŸ¥æ‰¾ä»»æ„å…ƒç´ </th></tr></thead><tbody><tr><td><strong>å †</strong></td><td>O(log n)</td><td>O(log n)</td><td><strong>O(1)</strong></td><td>O(n)</td></tr><tr><td>æ— åºæ•°ç»„</td><td>O(1)</td><td>O(n)</td><td>O(n)</td><td>O(n)</td></tr><tr><td>æœ‰åºæ•°ç»„</td><td>O(n)</td><td>O(1)</td><td>O(1)</td><td>O(log n)</td></tr><tr><td>å¹³è¡¡äºŒå‰æœç´¢æ ‘</td><td>O(log n)</td><td>O(log n)</td><td>O(log n)</td><td>O(log n)</td></tr></tbody></table><h3 id="dui-de-you-shi-chang-jing" tabindex="-1" id="å †çš„ä¼˜åŠ¿åœºæ™¯">å †çš„ä¼˜åŠ¿åœºæ™¯</h3><pre><code class="highlight mermaid">graph LR    A[ä»€ä¹ˆæ—¶å€™ç”¨å †ï¼Ÿ] --&gt; B[éœ€è¦é¢‘ç¹è·å–æœ€å€¼]    A --&gt; C[ä¸éœ€è¦æŸ¥æ‰¾ä»»æ„å…ƒç´ ]    A --&gt; D[åŠ¨æ€æ•°æ®æµ]    A --&gt; E[Top K é—®é¢˜]        style A fill:#FFE4B5    style B fill:#90EE90    style E fill:#87CEEB</code></pre><hr><h2 id="jing-dian-ying-yong-chang-jing" tabindex="-1" id="ç»å…¸åº”ç”¨åœºæ™¯">ç»å…¸åº”ç”¨åœºæ™¯</h2><h3 id="1-top-k-wen-ti" tabindex="-1" id="1-Top-K-é—®é¢˜">1. Top K é—®é¢˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ K å¤§å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findKthLargest</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, greater&lt;<span class="type">int</span>&gt;&gt; minHeap;  <span class="comment">// æœ€å°å †</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        minHeap.<span class="built_in">push</span>(num);</span><br><span class="line">        <span class="keyword">if</span> (minHeap.<span class="built_in">size</span>() &gt; k) &#123;</span><br><span class="line">            minHeap.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> minHeap.<span class="built_in">top</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-he-bing-k-ge-you-xu-lian-biao-shu-zu" tabindex="-1" id="2-åˆå¹¶-K-ä¸ªæœ‰åºé“¾è¡¨-æ•°ç»„">2. åˆå¹¶ K ä¸ªæœ‰åºé“¾è¡¨/æ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mergeKSorted</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; arrays)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> cmp = [](tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt;&amp; a, tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt;&amp; b) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(a) &gt; <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(b);  <span class="comment">// æœ€å°å †</span></span><br><span class="line">    &#125;;</span><br><span class="line">    priority_queue&lt;tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt;, vector&lt;tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt;&gt;, <span class="keyword">decltype</span>(cmp)&gt; <span class="built_in">minHeap</span>(cmp);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ï¼šæ¯ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; arrays.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!arrays[i].<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            minHeap.<span class="built_in">push</span>(&#123;arrays[i][<span class="number">0</span>], i, <span class="number">0</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">    <span class="keyword">while</span> (!minHeap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [val, arrIdx, elemIdx] = minHeap.<span class="built_in">top</span>();</span><br><span class="line">        minHeap.<span class="built_in">pop</span>();</span><br><span class="line">        result.<span class="built_in">push_back</span>(val);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ å…¥ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (elemIdx + <span class="number">1</span> &lt; arrays[arrIdx].<span class="built_in">size</span>()) &#123;</span><br><span class="line">            minHeap.<span class="built_in">push</span>(&#123;arrays[arrIdx][elemIdx + <span class="number">1</span>], arrIdx, elemIdx + <span class="number">1</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-shu-ju-liu-zhong-wei-shu" tabindex="-1" id="3-æ•°æ®æµä¸­ä½æ•°">3. æ•°æ®æµä¸­ä½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MedianFinder</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>&gt; maxHeap;  <span class="comment">// è¾ƒå°çš„ä¸€åŠ</span></span><br><span class="line">    priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, greater&lt;<span class="type">int</span>&gt;&gt; minHeap;  <span class="comment">// è¾ƒå¤§çš„ä¸€åŠ</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addNum</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        maxHeap.<span class="built_in">push</span>(num);</span><br><span class="line">        minHeap.<span class="built_in">push</span>(maxHeap.<span class="built_in">top</span>());</span><br><span class="line">        maxHeap.<span class="built_in">pop</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (minHeap.<span class="built_in">size</span>() &gt; maxHeap.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            maxHeap.<span class="built_in">push</span>(minHeap.<span class="built_in">top</span>());</span><br><span class="line">            minHeap.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">findMedian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (maxHeap.<span class="built_in">size</span>() &gt; minHeap.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> maxHeap.<span class="built_in">top</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (maxHeap.<span class="built_in">top</span>() + minHeap.<span class="built_in">top</span>()) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="zui-da-dui-vs-zui-xiao-dui" tabindex="-1" id="æœ€å¤§å †-vs-æœ€å°å †">æœ€å¤§å † vs æœ€å°å †</h2><h3 id="he-shi-shi-yong" tabindex="-1" id="ä½•æ—¶ä½¿ç”¨ï¼Ÿ">ä½•æ—¶ä½¿ç”¨ï¼Ÿ</h3><pre><code class="highlight mermaid">graph TD    A[é€‰æ‹©å †ç±»å‹] --&gt; B&#123;éœ€è¦ä»€ä¹ˆï¼Ÿ&#125;        B --&gt;|æœ€å¤§å€¼| C[æœ€å¤§å †]    B --&gt;|æœ€å°å€¼| D[æœ€å°å †]        C --&gt; E[ç›´æ¥è·å–]    D --&gt; F[ç›´æ¥è·å–]        style A fill:#FFE4B5    style C fill:#FF6B6B    style D fill:#87CEEB</code></pre><h3 id="top-k-wen-ti-kou-jue" tabindex="-1" id="Top-K-é—®é¢˜å£è¯€">Top K é—®é¢˜å£è¯€</h3><blockquote><p><strong>æ±‚å¤§ç”¨å°ï¼Œæ±‚å°ç”¨å¤§</strong></p></blockquote><table><thead><tr><th>é—®é¢˜</th><th>ä½¿ç”¨çš„å †</th><th>åŸå› </th></tr></thead><tbody><tr><td>ç¬¬ K å¤§å…ƒç´ </td><td>æœ€å°å †</td><td>ä¿ç•™æœ€å¤§çš„ K ä¸ª</td></tr><tr><td>ç¬¬ K å°å…ƒç´ </td><td>æœ€å¤§å †</td><td>ä¿ç•™æœ€å°çš„ K ä¸ª</td></tr><tr><td>å‰ K å¤§</td><td>æœ€å°å †</td><td>æ·˜æ±°å°çš„ï¼Œä¿ç•™å¤§çš„</td></tr><tr><td>å‰ K å°</td><td>æœ€å¤§å †</td><td>æ·˜æ±°å¤§çš„ï¼Œä¿ç•™å°çš„</td></tr></tbody></table><h3 id="dai-ma-zhuan-huan" tabindex="-1" id="ä»£ç è½¬æ¢">ä»£ç è½¬æ¢</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€å¤§å †ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">priority_queue&lt;<span class="type">int</span>&gt; maxHeap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å°å †ï¼ˆéœ€è¦æŒ‡å®šæ¯”è¾ƒå™¨ï¼‰</span></span><br><span class="line">priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, greater&lt;<span class="type">int</span>&gt;&gt; minHeap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¯”è¾ƒå™¨</span></span><br><span class="line"><span class="keyword">auto</span> cmp = [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> a &gt; b; &#125;;  <span class="comment">// æœ€å°å †</span></span><br><span class="line">priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, <span class="keyword">decltype</span>(cmp)&gt; <span class="built_in">customHeap</span>(cmp);</span><br></pre></td></tr></table></figure><hr><h2 id="dui-de-bian-chong" tabindex="-1" id="å †çš„å˜ç§">å †çš„å˜ç§</h2><h3 id="1-er-cha-dui-binary-heap" tabindex="-1" id="1-äºŒå‰å †ï¼ˆBinary-Heapï¼‰">1. äºŒå‰å †ï¼ˆBinary Heapï¼‰</h3><p>æˆ‘ä»¬åˆšæ‰è®²çš„å°±æ˜¯äºŒå‰å †ï¼Œæœ€å¸¸ç”¨ã€‚</p><h3 id="2-fei-bo-na-qi-dui-fibonacci-heap" tabindex="-1" id="2-æ–æ³¢é‚£å¥‘å †ï¼ˆFibonacci-Heapï¼‰">2. æ–æ³¢é‚£å¥‘å †ï¼ˆFibonacci Heapï¼‰</h3><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šåˆå¹¶æ“ä½œ O(1)</li><li><strong>ç¼ºç‚¹</strong>ï¼šå®ç°å¤æ‚ï¼Œå¸¸æ•°å› å­å¤§</li><li><strong>åº”ç”¨</strong>ï¼šDijkstraã€Prim ç®—æ³•çš„ä¼˜åŒ–ç‰ˆæœ¬</li></ul><h3 id="3-er-xiang-dui-binomial-heap" tabindex="-1" id="3-äºŒé¡¹å †ï¼ˆBinomial-Heapï¼‰">3. äºŒé¡¹å †ï¼ˆBinomial Heapï¼‰</h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šå¤šä¸ªäºŒé¡¹æ ‘ç»„æˆ</li><li><strong>åº”ç”¨</strong>ï¼šç†è®ºç ”ç©¶</li></ul><hr><h2 id="chang-jian-xian-jing-yu-ji-qiao" tabindex="-1" id="å¸¸è§é™·é˜±ä¸æŠ€å·§">å¸¸è§é™·é˜±ä¸æŠ€å·§</h2><h3 id="xian-jing-1-suo-yin-ji-suan-cuo-wu" tabindex="-1" id="é™·é˜±1ï¼šç´¢å¼•è®¡ç®—é”™è¯¯">é™·é˜±1ï¼šç´¢å¼•è®¡ç®—é”™è¯¯</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä»1å¼€å§‹ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> parent = i / <span class="number">2</span>;      <span class="comment">// ä¸é€‚ç”¨äºä»0å¼€å§‹çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šä»0å¼€å§‹ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> parent = (i - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> left = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> right = <span class="number">2</span> * i + <span class="number">2</span>;</span><br></pre></td></tr></table></figure><h3 id="xian-jing-2-bi-jiao-qi-fang-xiang-gao-fan" tabindex="-1" id="é™·é˜±2ï¼šæ¯”è¾ƒå™¨æ–¹å‘æå">é™·é˜±2ï¼šæ¯”è¾ƒå™¨æ–¹å‘æå</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ priority_queue çš„æ¯”è¾ƒå™¨ä¸ sort ç›¸åï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å°å †ï¼ˆå †é¡¶æœ€å°ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> cmp = [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> a &gt; b; &#125;;  <span class="comment">// æ³¨æ„æ˜¯ &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å †ï¼ˆå †é¡¶æœ€å¤§ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> cmp = [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> a &lt; b; &#125;;  <span class="comment">// æ³¨æ„æ˜¯ &lt;</span></span><br></pre></td></tr></table></figure><h3 id="ji-qiao-1-jian-dui-you-hua" tabindex="-1" id="æŠ€å·§1ï¼šå»ºå †ä¼˜åŒ–">æŠ€å·§1ï¼šå»ºå †ä¼˜åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä½æ•ˆï¼šé€ä¸ªæ’å…¥ O(n log n)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">    minHeap.<span class="built_in">push</span>(num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… é«˜æ•ˆï¼šæ‰¹é‡å»ºå † O(n)</span></span><br><span class="line"><span class="function">priority_queue&lt;<span class="type">int</span>&gt; <span class="title">maxHeap</span><span class="params">(nums.begin(), nums.end())</span></span>;</span><br></pre></td></tr></table></figure><h3 id="ji-qiao-2-ji-zhu-kou-jue" tabindex="-1" id="æŠ€å·§2ï¼šè®°ä½å£è¯€">æŠ€å·§2ï¼šè®°ä½å£è¯€</h3><ul><li><strong>æ±‚å¤§ç”¨å°ï¼Œæ±‚å°ç”¨å¤§</strong></li><li><strong>çˆ¶èŠ‚ç‚¹ = (i-1)/2</strong></li><li><strong>å·¦å­ = 2i+1ï¼Œå³å­ = 2i+2</strong></li></ul><hr><h2 id="si-wei-dao-tu" tabindex="-1" id="æ€ç»´å¯¼å›¾">æ€ç»´å¯¼å›¾</h2><pre><code class="highlight mermaid">graph TD    A[å †] --&gt; B[åŸºæœ¬æ¦‚å¿µ]    A --&gt; C[æ ¸å¿ƒæ“ä½œ]    A --&gt; D[åº”ç”¨åœºæ™¯]    A --&gt; E[ç»å…¸ç®—æ³•]        B --&gt; B1[å®Œå…¨äºŒå‰æ ‘]    B --&gt; B2[æ•°ç»„å­˜å‚¨]    B --&gt; B3[æœ€å¤§å †/æœ€å°å †]        C --&gt; C1[ä¸Šæµ® O log n]    C --&gt; C2[ä¸‹æ²‰ O log n]    C --&gt; C3[æ’å…¥ O log n]    C --&gt; C4[åˆ é™¤å †é¡¶ O log n]    C --&gt; C5[å»ºå † O n]        D --&gt; D1[Top K é—®é¢˜]    D --&gt; D2[ä¼˜å…ˆé˜Ÿåˆ—]    D --&gt; D3[å †æ’åº]    D --&gt; D4[æ•°æ®æµç»Ÿè®¡]        E --&gt; E1[å †æ’åº]    E --&gt; E2[Dijkstra]    E --&gt; E3[Huffmanç¼–ç ]        style A fill:#FFE4B5    style C fill:#87CEEB    style D fill:#90EE90</code></pre><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><h3 id="he-xin-yao-dian" tabindex="-1" id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3><ol><li><strong>å † = å®Œå…¨äºŒå‰æ ‘ + æ•°ç»„å­˜å‚¨</strong></li><li><strong>ä¸¤ä¸ªå…³é”®æ“ä½œ</strong>ï¼šä¸Šæµ®ã€ä¸‹æ²‰</li><li><strong>å»ºå †ä¼˜åŒ–</strong>ï¼šè‡ªåº•å‘ä¸Š O(n)</li><li><strong>Top K å£è¯€</strong>ï¼šæ±‚å¤§ç”¨å°ï¼Œæ±‚å°ç”¨å¤§</li></ol><h3 id="shi-jian-fu-za-du-zong-jie" tabindex="-1" id="æ—¶é—´å¤æ‚åº¦æ€»ç»“">æ—¶é—´å¤æ‚åº¦æ€»ç»“</h3><table><thead><tr><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(log n)</td><td>ä¸Šæµ®</td></tr><tr><td>åˆ é™¤å †é¡¶</td><td>O(log n)</td><td>ä¸‹æ²‰</td></tr><tr><td>æŸ¥çœ‹å †é¡¶</td><td>O(1)</td><td>ç›´æ¥è®¿é—®</td></tr><tr><td>å»ºå †</td><td><strong>O(n)</strong></td><td>è‡ªåº•å‘ä¸Š</td></tr><tr><td>å †æ’åº</td><td>O(n log n)</td><td>n æ¬¡åˆ é™¤å †é¡¶</td></tr></tbody></table><h3 id="dai-ma-mo-ban" tabindex="-1" id="ä»£ç æ¨¡æ¿">ä»£ç æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€å¤§å †æ ¸å¿ƒæ“ä½œ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaxHeap</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸Šæµ®</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">siftUp</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; heap[i] &gt; heap[(i<span class="number">-1</span>)/<span class="number">2</span>]) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(heap[i], heap[(i<span class="number">-1</span>)/<span class="number">2</span>]);</span><br><span class="line">            i = (i - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸‹æ²‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">siftDown</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">2</span>*i<span class="number">+1</span> &lt; size) &#123;</span><br><span class="line">            <span class="type">int</span> j = <span class="number">2</span>*i<span class="number">+1</span>;  <span class="comment">// å·¦å­</span></span><br><span class="line">            <span class="keyword">if</span> (j<span class="number">+1</span> &lt; size &amp;&amp; heap[j<span class="number">+1</span>] &gt; heap[j]) j++;  <span class="comment">// å³å­æ›´å¤§</span></span><br><span class="line">            <span class="keyword">if</span> (heap[i] &gt;= heap[j]) <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">swap</span>(heap[i], heap[j]);</span><br><span class="line">            i = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ¨èç»ƒä¹ </strong>ï¼š</p><ul><li><a href="https://leetcode.com/problems/kth-largest-element-in-an-array/">LeetCode 215 - æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></li><li><a href="https://leetcode.com/problems/top-k-frequent-elements/">LeetCode 347 - å‰Kä¸ªé«˜é¢‘å…ƒç´ </a></li><li><a href="https://leetcode.com/problems/find-median-from-data-stream/">LeetCode 295 - æ•°æ®æµçš„ä¸­ä½æ•°</a></li><li><a href="https://leetcode.com/problems/merge-k-sorted-lists/">LeetCode 23 - åˆå¹¶Kä¸ªå‡åºé“¾è¡¨</a></li></ul><p><strong>æ¨èé˜…è¯»</strong>ï¼š</p><ul><li><a href="https://book.douban.com/subject/20432061/">ã€Šç®—æ³•å¯¼è®ºã€‹ç¬¬6ç« ï¼šå †æ’åº</a></li><li><a href="https://leetcode.com/tag/heap-priority-queue/">LeetCode å †ä¸“é¢˜</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;dui-xiang-jie-shu-de-xing-shu-zu-de-xin&quot; tabindex=&quot;-1&quot;&gt;å †è¯¦è§£ï¼šæ ‘çš„å½¢ï¼Œæ•°ç»„çš„å¿ƒ&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;æ·±å…¥ç†è§£å †çš„å†…éƒ¨åŸç†å’Œæ‰‹å†™å®ç°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2</summary>
        
      
    
    
    
    <category term="æ•°æ®ç»“æ„" scheme="https://smarter.xin/categories/data-structure/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="å †" scheme="https://smarter.xin/tags/heap/"/>
    
    <category term="æ•°æ®ç»“æ„" scheme="https://smarter.xin/tags/data-structure/"/>
    
    <category term="ç®—æ³•è®¾è®¡" scheme="https://smarter.xin/tags/algorithm-design/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾</title>
    <link href="https://smarter.xin/posts/e84ddac/"/>
    <id>https://smarter.xin/posts/e84ddac/</id>
    <published>2026-01-05T05:45:42.000Z</published>
    <updated>2026-01-18T14:12:10.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="xie-zai-qian-mian" tabindex="-1" id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2><p>äºŒåˆ†æŸ¥æ‰¾åº”è¯¥æ˜¯æˆ‘åˆ·LeetCodeæ—¶æœ€æ—©æ¥è§¦çš„ç®—æ³•ä¹‹ä¸€ï¼Œå½“æ—¶è§‰å¾—æŒºç®€å•çš„â€”â€”ä¸å°±æ˜¯æŠ˜åŠæŸ¥æ‰¾å˜›ã€‚ç»“æœçœŸæ­£å†™èµ·æ¥æ‰å‘ç°ï¼Œ<code>left</code>ã€<code>right</code>ã€<code>mid</code>è¿™äº›è¾¹ç•Œæ¡ä»¶ä¸€ä¸å°å¿ƒå°±å†™é”™ï¼Œè¦ä¹ˆæ­»å¾ªç¯ï¼Œè¦ä¹ˆæ¼æ‰å…ƒç´ ã€‚åæ¥æ‰æ„è¯†åˆ°ï¼ŒäºŒåˆ†æŸ¥æ‰¾çœ‹ä¼¼ç®€å•ï¼Œå…¶å®ç»†èŠ‚å¾ˆå¤šã€‚</p><p>è¿™ç¯‡æ–‡ç« æˆ‘ä¼šæŒ‰ç…§è‡ªå·±çš„ç†è§£ï¼ŒæŠŠäºŒåˆ†æŸ¥æ‰¾ä»åŸºç¡€åˆ°å˜ç§éƒ½æ¢³ç†ä¸€éã€‚</p><hr><h2 id="er-fen-cha-zhao-shi-shi-yao" tabindex="-1" id="äºŒåˆ†æŸ¥æ‰¾æ˜¯ä»€ä¹ˆ">äºŒåˆ†æŸ¥æ‰¾æ˜¯ä»€ä¹ˆ</h2><p>æœ€åŸºç¡€çš„äºŒåˆ†æŸ¥æ‰¾å°±æ˜¯åœ¨<strong>æœ‰åºæ•°ç»„</strong>ä¸­æ‰¾ä¸€ä¸ªç›®æ ‡å€¼ï¼Œæ¯æ¬¡é€šè¿‡æ¯”è¾ƒä¸­é—´å…ƒç´ ï¼Œæ’é™¤ä¸€åŠçš„æœç´¢ç©ºé—´ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ <code>[1, 3, 5, 7, 9, 11, 13]</code> ä¸­æ‰¾ <code>7</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬1æ¬¡: èŒƒå›´ [1,3,5,7,9,11,13]ï¼Œä¸­é—´æ˜¯ 7ï¼Œæ‰¾åˆ°äº†ï¼</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾ <code>8</code> å‘¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬1æ¬¡: èŒƒå›´ [1,3,5,7,9,11,13]ï¼Œä¸­é—´æ˜¯ 7ï¼Œ8 &gt; 7ï¼Œå»å³è¾¹æ‰¾</span><br><span class="line">ç¬¬2æ¬¡: èŒƒå›´ [9,11,13]ï¼Œä¸­é—´æ˜¯ 11ï¼Œ8 &lt; 11ï¼Œå»å·¦è¾¹æ‰¾</span><br><span class="line">ç¬¬3æ¬¡: èŒƒå›´ [9]ï¼Œ9 != 8ï¼Œæ‰¾ä¸åˆ°</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š<strong>æ¯æ¬¡æ’é™¤ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°æˆ–è€…èŒƒå›´ä¸ºç©º</strong>ã€‚</p><p>æ—¶é—´å¤æ‚åº¦ O(log n)ï¼Œè¿™ä¹Ÿæ˜¯äºŒåˆ†æŸ¥æ‰¾çš„é­…åŠ›æ‰€åœ¨â€”â€”æ•°æ®é‡è¶Šå¤§ï¼Œä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚100ä¸‡æ¡æ•°æ®ï¼Œæœ€å¤šæŸ¥20æ¬¡ã€‚</p><hr><h2 id="ji-chu-mo-ban" tabindex="-1" id="åŸºç¡€æ¨¡æ¿">åŸºç¡€æ¨¡æ¿</h2><p>æˆ‘è‡ªå·±ç”¨çš„æœ€å¤šçš„æ˜¯å·¦é—­å³é—­åŒºé—´çš„å†™æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>[left, right]</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">binarySearch</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;  <span class="comment">// æ³¨æ„æ˜¯ n-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;  <span class="comment">// æ³¨æ„æ˜¯ &lt;=</span></span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;  <span class="comment">// é˜²æº¢å‡º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;  <span class="comment">// å»å³åŠè¾¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;  <span class="comment">// å»å·¦åŠè¾¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ji-ge-xi-jie" tabindex="-1" id="å‡ ä¸ªç»†èŠ‚">å‡ ä¸ªç»†èŠ‚</h3><ol><li><p><strong>ä¸ºä»€ä¹ˆæ˜¯ <code>right = nums.size() - 1</code>ï¼Ÿ</strong><br>å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯é—­åŒºé—´ <code>[left, right]</code>ï¼Œå³è¾¹ç•Œè¦åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆå¾ªç¯æ¡ä»¶æ˜¯ <code>left &lt;= right</code>ï¼Ÿ</strong><br>å½“ <code>left == right</code> æ—¶ï¼ŒåŒºé—´ <code>[left, right]</code> è¿˜æœ‰ä¸€ä¸ªå…ƒç´ æ²¡æ£€æŸ¥ï¼Œæ‰€ä»¥è¦ç”¨ <code>&lt;=</code>ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆæ˜¯ <code>mid = left + (right - left) / 2</code>ï¼Ÿ</strong><br>å¦‚æœå†™æˆ <code>(left + right) / 2</code>ï¼Œå½“ <code>left</code> å’Œ <code>right</code> éƒ½å¾ˆå¤§æ—¶å¯èƒ½æº¢å‡ºã€‚è™½ç„¶LeetCodeæ•°æ®èŒƒå›´ä¸€èˆ¬ä¸ä¼šæº¢å‡ºï¼Œä½†è¿™æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆæ˜¯ <code>left = mid + 1</code> è€Œä¸æ˜¯ <code>mid</code>ï¼Ÿ</strong><br>å› ä¸º <code>nums[mid]</code> å·²ç»æ£€æŸ¥è¿‡äº†ï¼Œä¸æ˜¯ç›®æ ‡å€¼ï¼Œæ‰€ä»¥å¯ä»¥æ’é™¤ã€‚</p></li></ol><hr><h2 id="zuo-bi-you-kai-xie-fa" tabindex="-1" id="å·¦é—­å³å¼€å†™æ³•">å·¦é—­å³å¼€å†™æ³•</h2><p>æœ‰äº›äººå–œæ¬¢ç”¨å·¦é—­å³å¼€åŒºé—´ <code>[left, right)</code>ï¼Œä¹Ÿå°±æ˜¯å³è¾¹ç•Œä¸åŒ…å«ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">binarySearch</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>();  <span class="comment">// æ³¨æ„æ˜¯ nï¼ˆä¸åŒ…å«ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;  <span class="comment">// æ³¨æ„æ˜¯ &lt;</span></span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;  <span class="comment">// æ³¨æ„æ˜¯ midï¼Œä¸æ˜¯ mid - 1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´å®è¯ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿçº ç»“ç”¨å“ªç§å†™æ³•ã€‚åæ¥å‘ç°ï¼Œ<strong>é€‰ä¸€ä¸ªç”¨ç†Ÿå°±è¡Œ</strong>ï¼Œå…³é”®æ˜¯ç†è§£åŒºé—´çš„å«ä¹‰ï¼Œä¸è¦æ··ç”¨ã€‚</p><hr><h2 id="bian-chong-1-cha-zhao-zuo-bian-jie" tabindex="-1" id="å˜ç§1ï¼šæŸ¥æ‰¾å·¦è¾¹ç•Œ">å˜ç§1ï¼šæŸ¥æ‰¾å·¦è¾¹ç•Œ</h2><p>æœ‰æ—¶å€™æ•°ç»„ä¸­æœ‰é‡å¤å…ƒç´ ï¼Œæˆ‘ä»¬è¦æ‰¾ç¬¬ä¸€ä¸ªç­‰äº <code>target</code> çš„ä½ç½®ã€‚</p><p>æ¯”å¦‚ <code>[1, 2, 2, 2, 3]</code> ä¸­æ‰¾ <code>2</code> çš„å·¦è¾¹ç•Œï¼Œåº”è¯¥è¿”å›ç´¢å¼• <code>1</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">searchLeft</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            result = mid;     <span class="comment">// è®°å½•ä½ç½®</span></span><br><span class="line">            right = mid - <span class="number">1</span>;  <span class="comment">// ç»§ç»­å‘å·¦æ‰¾</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€è·¯ï¼šæ‰¾åˆ° <code>target</code> åä¸ç«‹å³è¿”å›ï¼Œè€Œæ˜¯ç»§ç»­å‘å·¦ç¼©å°èŒƒå›´ã€‚</p><hr><h2 id="bian-chong-2-cha-zhao-you-bian-jie" tabindex="-1" id="å˜ç§2ï¼šæŸ¥æ‰¾å³è¾¹ç•Œ">å˜ç§2ï¼šæŸ¥æ‰¾å³è¾¹ç•Œ</h2><p>åŒç†ï¼Œæ‰¾æœ€åä¸€ä¸ªç­‰äº <code>target</code> çš„ä½ç½®ã€‚</p><p><code>[1, 2, 2, 2, 3]</code> ä¸­æ‰¾ <code>2</code> çš„å³è¾¹ç•Œï¼Œåº”è¯¥è¿”å›ç´¢å¼• <code>3</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">searchRight</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            result = mid;    <span class="comment">// è®°å½•ä½ç½®</span></span><br><span class="line">            left = mid + <span class="number">1</span>;  <span class="comment">// ç»§ç»­å‘å³æ‰¾</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="bian-chong-3-zhao-di-yi-ge-da-yu-deng-yu-target-de-wei-zhi" tabindex="-1" id="å˜ç§3ï¼šæ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºtargetçš„ä½ç½®">å˜ç§3ï¼šæ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºtargetçš„ä½ç½®</h2><p>è¿™ä¸ªåœ¨å®é™…åº”ç”¨ä¸­å¾ˆå¸¸è§ï¼Œæ¯”å¦‚æŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowerBound</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;  <span class="comment">// nums[mid] &gt;= targetï¼Œå¯èƒ½æ˜¯ç­”æ¡ˆ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œæˆ‘ç”¨çš„æ˜¯å·¦é—­å³å¼€å†™æ³• <code>[left, right)</code>ï¼Œå› ä¸ºè¿™æ ·å†™èµ·æ¥æ¯”è¾ƒç®€æ´ã€‚</p><p>å¦‚æœæ•°ç»„æ˜¯ <code>[1, 3, 5, 7]</code>ï¼Œ<code>target = 4</code>ï¼Œè¿”å›ç´¢å¼• <code>2</code>ï¼ˆä¹Ÿå°±æ˜¯ <code>5</code> çš„ä½ç½®ï¼‰ã€‚</p><hr><h2 id="bian-chong-4-zhao-di-yi-ge-da-yu-target-de-wei-zhi" tabindex="-1" id="å˜ç§4ï¼šæ‰¾ç¬¬ä¸€ä¸ªå¤§äºtargetçš„ä½ç½®">å˜ç§4ï¼šæ‰¾ç¬¬ä¸€ä¸ªå¤§äºtargetçš„ä½ç½®</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">upperBound</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right = nums.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt;= target) &#123;  <span class="comment">// æ³¨æ„æ˜¯ &lt;=</span></span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="shi-zhan-ti-mu" tabindex="-1" id="å®æˆ˜é¢˜ç›®">å®æˆ˜é¢˜ç›®</h2><h3 id="leet-code-704-er-fen-cha-zhao" tabindex="-1" id="LeetCode-704-äºŒåˆ†æŸ¥æ‰¾">LeetCode 704 - äºŒåˆ†æŸ¥æ‰¾</h3><p>æœ€åŸºç¡€çš„é¢˜ï¼Œç›´æ¥å¥—æ¨¡æ¿å°±è¡Œã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) <span class="keyword">return</span> mid;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) left = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> right = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="leet-code-35-sou-suo-cha-ru-wei-zhi" tabindex="-1" id="LeetCode-35-æœç´¢æ’å…¥ä½ç½®">LeetCode 35 - æœç´¢æ’å…¥ä½ç½®</h3><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œç›®æ ‡å€¼ï¼Œå¦‚æœæ‰¾åˆ°è¿”å›ç´¢å¼•ï¼Œå¦åˆ™è¿”å›å®ƒåº”è¯¥è¢«æ’å…¥çš„ä½ç½®ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">searchInsert</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = nums.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æ‰¾ç¬¬ä¸€ä¸ª <code>&gt;= target</code> çš„ä½ç½®ï¼ˆlower_boundï¼‰ã€‚</p><hr><h3 id="leet-code-34-zai-pai-xu-shu-zu-zhong-cha-zhao-yuan-su-de-di-yi-ge-he-zui-hou-yi-ge-wei-zhi" tabindex="-1" id="LeetCode-34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®">LeetCode 34 - åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</h3><p>è¿™é¢˜å°±æ˜¯æ‰¾å·¦å³è¾¹ç•Œçš„ç»¼åˆåº”ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">searchRange</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.<span class="built_in">empty</span>()) <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> left = <span class="built_in">searchLeft</span>(nums, target);</span><br><span class="line">    <span class="keyword">if</span> (left == <span class="number">-1</span>) <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;;  <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> right = <span class="built_in">searchRight</span>(nums, target);</span><br><span class="line">    <span class="keyword">return</span> &#123;left, right&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="leet-code-69-x-de-ping-fang-gen" tabindex="-1" id="LeetCode-69-x-çš„å¹³æ–¹æ ¹">LeetCode 69 - x çš„å¹³æ–¹æ ¹</h3><p>è®¡ç®—å¹¶è¿”å› x çš„å¹³æ–¹æ ¹ï¼ˆåªä¿ç•™æ•´æ•°éƒ¨åˆ†ï¼‰ã€‚</p><p>è¿™é¢˜å…¶å®æ˜¯åœ¨ <code>[0, x]</code> ä¸­æ‰¾æœ€åä¸€ä¸ªæ»¡è¶³ <code>i * i &lt;= x</code> çš„æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">mySqrt</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> left = <span class="number">1</span>, right = x;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (mid &lt;= x / mid) &#123;  <span class="comment">// é¿å…æº¢å‡º</span></span><br><span class="line">            result = mid;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°æŠ€å·§</strong>ï¼šç”¨ <code>mid &lt;= x / mid</code> ä»£æ›¿ <code>mid * mid &lt;= x</code>ï¼Œé¿å…æ•´æ•°æº¢å‡ºã€‚</p><hr><h3 id="leet-code-33-sou-suo-xuan-zhuan-pai-xu-shu-zu" tabindex="-1" id="LeetCode-33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„">LeetCode 33 - æœç´¢æ—‹è½¬æ’åºæ•°ç»„</h3><p>è¿™é¢˜æœ‰ç‚¹æ„æ€ï¼Œæ•°ç»„è¢«æ—‹è½¬äº†ï¼Œæ¯”å¦‚ <code>[4,5,6,7,0,1,2]</code>ã€‚</p><p>æ ¸å¿ƒæ€è·¯ï¼šè™½ç„¶æ•´ä½“æ— åºï¼Œä½†è‚¯å®šæœ‰ä¸€åŠæ˜¯æœ‰åºçš„ã€‚å…ˆåˆ¤æ–­å“ªåŠè¾¹æœ‰åºï¼Œå†åˆ¤æ–­ <code>target</code> åœ¨ä¸åœ¨æœ‰åºçš„é‚£åŠè¾¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) <span class="keyword">return</span> mid;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å·¦åŠè¾¹æœ‰åº</span></span><br><span class="line">        <span class="keyword">if</span> (nums[left] &lt;= nums[mid]) &#123;</span><br><span class="line">            <span class="comment">// target åœ¨å·¦åŠè¾¹</span></span><br><span class="line">            <span class="keyword">if</span> (target &gt;= nums[left] &amp;&amp; target &lt; nums[mid]) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³åŠè¾¹æœ‰åº</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// target åœ¨å³åŠè¾¹</span></span><br><span class="line">            <span class="keyword">if</span> (target &gt; nums[mid] &amp;&amp; target &lt;= nums[right]) &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="leet-code-153-xun-zhao-xuan-zhuan-pai-xu-shu-zu-zhong-de-zui-xiao-zhi" tabindex="-1" id="LeetCode-153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼">LeetCode 153 - å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼</h3><p>è¿˜æ˜¯æ—‹è½¬æ•°ç»„ï¼Œè¿™æ¬¡æ˜¯æ‰¾æœ€å°å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">findMin</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å³åŠè¾¹æ— åºï¼Œæœ€å°å€¼åœ¨å³è¾¹</span></span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &gt; nums[right]) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å·¦åŠè¾¹æ— åºæˆ–å…¨éƒ¨æœ‰åºï¼Œæœ€å°å€¼åœ¨å·¦è¾¹ï¼ˆåŒ…æ‹¬midï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nums[left];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="er-fen-da-an" tabindex="-1" id="äºŒåˆ†ç­”æ¡ˆ">äºŒåˆ†ç­”æ¡ˆ</h2><p>é™¤äº†åœ¨æ•°ç»„ä¸­äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿˜æœ‰ä¸€ç±»é¢˜æ˜¯<strong>äºŒåˆ†ç­”æ¡ˆ</strong>ã€‚ä¹Ÿå°±æ˜¯ç­”æ¡ˆæœ‰ä¸€å®šèŒƒå›´ï¼Œé€šè¿‡äºŒåˆ†çŒœç­”æ¡ˆï¼Œç„¶åéªŒè¯æ˜¯å¦å¯è¡Œã€‚</p><h3 id="jing-dian-li-ti-leet-code-875-ai-chi-xiang-jiao-de-ke-ke" tabindex="-1" id="ç»å…¸ä¾‹é¢˜ï¼šLeetCode-875-çˆ±åƒé¦™è•‰çš„ç‚ç‚">ç»å…¸ä¾‹é¢˜ï¼šLeetCode 875 - çˆ±åƒé¦™è•‰çš„ç‚ç‚</h3><p>ç‚ç‚æœ‰ N å †é¦™è•‰ï¼Œç¬¬ i å †æœ‰ <code>piles[i]</code> æ ¹é¦™è•‰ã€‚å¥¹å¯ä»¥å†³å®šæ¯å°æ—¶åƒé¦™è•‰çš„é€Ÿåº¦ Kï¼ˆæ ¹/å°æ—¶ï¼‰ã€‚æ¯å°æ—¶å¥¹ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œåƒ K æ ¹ï¼ˆå¦‚æœè¿™å †ä¸å¤Ÿ K æ ¹ï¼Œå¥¹ä¼šåƒå®Œè¿™å †å°±åœä¸‹æ¥ï¼‰ã€‚</p><p>é—®ï¼šåœ¨ H å°æ—¶å†…åƒå®Œæ‰€æœ‰é¦™è•‰ï¼Œæœ€å°çš„ K æ˜¯å¤šå°‘ï¼Ÿ</p><p><strong>æ€è·¯</strong>ï¼šK çš„èŒƒå›´æ˜¯ <code>[1, max(piles)]</code>ï¼Œæˆ‘ä»¬å¯ä»¥äºŒåˆ† K çš„å€¼ã€‚å¯¹äºæ¯ä¸ª Kï¼Œæ£€æŸ¥èƒ½å¦åœ¨ H å°æ—¶å†…åƒå®Œã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">minEatingSpeed</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; piles, <span class="type">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> right = *<span class="built_in">max_element</span>(piles.<span class="built_in">begin</span>(), piles.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥èƒ½å¦åœ¨ h å°æ—¶å†…åƒå®Œ</span></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> hours = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> pile : piles) &#123;</span><br><span class="line">            hours += (pile + mid - <span class="number">1</span>) / mid;  <span class="comment">// å‘ä¸Šå–æ•´</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (hours &lt;= h) &#123;</span><br><span class="line">            right = mid;  <span class="comment">// å¯ä»¥åƒå®Œï¼Œå°è¯•æ›´å°çš„é€Ÿåº¦</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;  <span class="comment">// åƒä¸å®Œï¼Œéœ€è¦æ›´å¿«çš„é€Ÿåº¦</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°æŠ€å·§</strong>ï¼š<code>(pile + mid - 1) / mid</code> æ˜¯å‘ä¸Šå–æ•´çš„æŠ€å·§ï¼Œç­‰ä»·äº <code>ceil(pile / mid)</code>ã€‚</p><hr><h2 id="rong-yi-cai-de-keng" tabindex="-1" id="å®¹æ˜“è¸©çš„å‘">å®¹æ˜“è¸©çš„å‘</h2><ol><li><p><strong>å¾ªç¯æ¡ä»¶å†™é”™</strong><br><code>left &lt;= right</code> è¿˜æ˜¯ <code>left &lt; right</code>ï¼Ÿå–å†³äºåŒºé—´å®šä¹‰ã€‚è®°ä½ï¼šé—­åŒºé—´ç”¨ <code>&lt;=</code>ï¼ŒåŠå¼€åŒºé—´ç”¨ <code>&lt;</code>ã€‚</p></li><li><p><strong>è¾¹ç•Œæ›´æ–°å†™é”™</strong><br><code>left = mid</code> è¿˜æ˜¯ <code>left = mid + 1</code>ï¼Ÿè®°ä½ï¼šå·²ç»æ£€æŸ¥è¿‡ <code>mid</code> äº†ï¼Œè¦æ’é™¤å°±ç”¨ <code>+1</code> æˆ– <code>-1</code>ã€‚</p></li><li><p><strong>æ­»å¾ªç¯</strong><br>å¦‚æœè¾¹ç•Œæ›´æ–°ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´ <code>left</code> å’Œ <code>right</code> æ°¸è¿œæ— æ³•ç›¸é‡ã€‚æ¯”å¦‚ç”¨ <code>left &lt; right</code> ä½†æ›´æ–°æ—¶ç”¨ <code>right = mid</code>ï¼Œå½“ <code>left = mid - 1</code> æ—¶å°±ä¼šæ­»å¾ªç¯ã€‚</p></li><li><p><strong>æº¢å‡ºé—®é¢˜</strong><br>å†™æˆ <code>(left + right) / 2</code> åœ¨ç†è®ºä¸Šå¯èƒ½æº¢å‡ºï¼Œè™½ç„¶LeetCodeä¸€èˆ¬ä¸ä¼šå¡è¿™ä¸ªã€‚</p></li><li><p><strong>è¾¹ç•Œæ¡ä»¶é—æ¼</strong><br>æ•°ç»„ä¸ºç©ºã€<code>target</code> ä¸åœ¨èŒƒå›´å†…ç­‰ç‰¹æ®Šæƒ…å†µè¦å•ç‹¬å¤„ç†ã€‚</p></li></ol><hr><h2 id="zong-jie" tabindex="-1" id="æ€»ç»“">æ€»ç»“</h2><p>äºŒåˆ†æŸ¥æ‰¾è™½ç„¶çœ‹èµ·æ¥ç®€å•ï¼Œä½†è¦å†™å¯¹è¿˜æ˜¯éœ€è¦ç»†å¿ƒã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼š</p><ol><li><strong>é€‰å®šä¸€ç§å†™æ³•</strong>ï¼ˆé—­åŒºé—´æˆ–åŠå¼€åŒºé—´ï¼‰ï¼Œç†Ÿç»ƒæŒæ¡å®ƒ</li><li><strong>ç†è§£åŒºé—´ä¸å˜é‡</strong>ï¼šæ¯æ¬¡å¾ªç¯åï¼Œç­”æ¡ˆä¸€å®šåœ¨ <code>[left, right]</code> åŒºé—´å†…</li><li><strong>å¤šåˆ·é¢˜</strong>ï¼šå˜ç§é¢˜åšå¤šäº†ï¼Œè‡ªç„¶å°±æœ‰æ„Ÿè§‰äº†</li></ol><p>å¸¸è§çš„äºŒåˆ†æŸ¥æ‰¾é¢˜å‹ï¼š</p><ul><li>åŸºç¡€äºŒåˆ†ï¼šLeetCode 704</li><li>æŸ¥æ‰¾è¾¹ç•Œï¼šLeetCode 34</li><li>æ—‹è½¬æ•°ç»„ï¼šLeetCode 33, 153</li><li>äºŒåˆ†ç­”æ¡ˆï¼šLeetCode 875, 1011, 410</li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;xie-zai-qian-mian&quot; tabindex=&quot;-1&quot;</summary>
        
      
    
    
    
    <category term="ç®—æ³•" scheme="https://smarter.xin/categories/algorithm/"/>
    
    
    <category term="C++" scheme="https://smarter.xin/tags/C/"/>
    
    <category term="LeetCode" scheme="https://smarter.xin/tags/LeetCode/"/>
    
    <category term="ç®—æ³•è®¾è®¡" scheme="https://smarter.xin/tags/algorithm-design/"/>
    
    <category term="åˆ†æ²»" scheme="https://smarter.xin/tags/divide-and-conquer/"/>
    
    <category term="äºŒåˆ†æŸ¥æ‰¾" scheme="https://smarter.xin/tags/binary-search/"/>
    
    <category term="æœç´¢" scheme="https://smarter.xin/tags/search/"/>
    
  </entry>
  
</feed>
